<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é’åŸŸ</title>
  
  
  <link href="http://yoursite.com/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2024-01-25T11:21:45.306Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>tianL.R</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>yolov8-ç«ç¾æ£€æµ‹</title>
    <link href="http://yoursite.com/2024/01/25/yolov8%EF%BC%9A%E7%81%AB%E7%81%BE%E6%A3%80%E6%B5%8B/"/>
    <id>http://yoursite.com/2024/01/25/yolov8%EF%BC%9A%E7%81%AB%E7%81%BE%E6%A3%80%E6%B5%8B/</id>
    <published>2024-01-25T09:23:20.000Z</published>
    <updated>2024-01-25T11:21:45.306Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><h3 id="GPU"><a href="#GPU" class="headerlink" title="GPU"></a>GPU</h3><ul><li><font color="gold">NVIDIA 3090*2</font></li><li><font color="gold">æ˜¾å¡é©±åŠ¨ 535.104.05</font></li><li><font color="gold">CUDAç‰ˆæœ¬ 12.2</font></li><li><font color="gold">CUDAtoolkit</font> (cuda_12.2.2_535.104.05_linux)</li><li><font color="gold">cuDNN (v8.9.7)</font></li></ul><h3 id="yoloç‰ˆæœ¬"><a href="#yoloç‰ˆæœ¬" class="headerlink" title="yoloç‰ˆæœ¬"></a>yoloç‰ˆæœ¬</h3><ul><li><font color="gold">v8.1.5</font> (ultralytics yolov8)</li></ul><h3 id="pytorchç‰ˆæœ¬"><a href="#pytorchç‰ˆæœ¬" class="headerlink" title="pytorchç‰ˆæœ¬"></a>pytorchç‰ˆæœ¬</h3><ul><li><font color="gold">v2.1.2</font></li></ul><h3 id="pythonç¯å¢ƒ"><a href="#pythonç¯å¢ƒ" class="headerlink" title="pythonç¯å¢ƒ"></a>pythonç¯å¢ƒ</h3><ul><li><font color="gold">CentOS7.9</font></li><li><font color="gold">anaconda3</font></li><li><font color="gold">python3.9</font></li></ul><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>æºç ä¸»é¡µï¼š<a href="https://github.com/ultralytics/ultralytics" target="_blank" rel="noopener">https://github.com/ultralytics/ultralytics</a></p><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.ultralytics.com/zh" target="_blank" rel="noopener">https://docs.ultralytics.com/zh</a></p><p><img src="/2024/01/25/yolov8ï¼šç«ç¾æ£€æµ‹/1.png" alt></p><h3 id="å…‹éš†æºç "><a href="#å…‹éš†æºç " class="headerlink" title="å…‹éš†æºç "></a>å…‹éš†æºç </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://hub.nuaa.cf/ultralytics/ultralytics.git</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pip install ultralytics -i https://mirror.baidu.com/pypi/simple</span><br></pre></td></tr></table></figure><h3 id="ç¯å¢ƒéªŒè¯"><a href="#ç¯å¢ƒéªŒè¯" class="headerlink" title="ç¯å¢ƒéªŒè¯"></a>ç¯å¢ƒéªŒè¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yolo predict model=yolov8n.pt source=ultralytics/assets/zidane.jpg</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæ¯•åå¾—åˆ°è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(py39_yolov8) [root@jdz yolov8]# yolo predict model=yolov8n.pt source=ultralytics/assets/zidane.jpg </span><br><span class="line">Ultralytics YOLOv8.1.5 ğŸš€ Python-3.9.18 torch-2.1.2+cu121 CUDA:0 (NVIDIA GeForce RTX 3090, 24260MiB)</span><br><span class="line">YOLOv8n summary (fused): 168 layers, 3151904 parameters, 0 gradients, 8.7 GFLOPs</span><br><span class="line"></span><br><span class="line">image 1/1 /exp/work/video/yolov8/ultralytics/assets/zidane.jpg: 384x640 2 persons, 1 tie, 216.9ms</span><br><span class="line">Speed: 7.3ms preprocess, 216.9ms inference, 762.4ms postprocess per image at shape (1, 3, 384, 640)</span><br><span class="line">Results saved to runs/detect/predict</span><br><span class="line">ğŸ’¡ Learn more at https://docs.ultralytics.com/modes/predict</span><br></pre></td></tr></table></figure><p>å°†åœ¨<code>Results saved to runs/detect/predict</code>ç›®å½•ä¸‹æ‰¾åˆ°è¾“å‡ºç»“æœ</p><a id="more"></a><p><img src="/2024/01/25/yolov8ï¼šç«ç¾æ£€æµ‹/2.png" alt></p><p>è‡³æ­¤ï¼Œå·²éªŒè¯åŸºç¡€ç¯å¢ƒæ­£å¸¸å·¥ä½œã€‚</p><h2 id="è®­ç»ƒé›†"><a href="#è®­ç»ƒé›†" class="headerlink" title="è®­ç»ƒé›†"></a>è®­ç»ƒé›†</h2><p>å‰å¾€kaggleå®˜ç½‘å¯»æ‰¾ç«ç„°è®­ç»ƒé›†ï¼Œè¿™é‡Œä½¿ç”¨Fire and Smoke Datasetæ•°æ®é›†ï¼ˆ<a href="https://www.kaggle.com/datasets/dataclusterlabs/fire-and-smoke-dataset" target="_blank" rel="noopener">https://www.kaggle.com/datasets/dataclusterlabs/fire-and-smoke-dataset</a>ï¼‰</p><p>æ•°æ®é›†åŒ…å«çƒŸã€ç«å›¾åƒå…±100å¼ </p><p><img src="/2024/01/25/yolov8ï¼šç«ç¾æ£€æµ‹/3.png" alt></p><p><img src="/2024/01/25/yolov8ï¼šç«ç¾æ£€æµ‹/4.png" alt></p><h2 id="æ•°æ®æ ‡æ³¨"><a href="#æ•°æ®æ ‡æ³¨" class="headerlink" title="æ•°æ®æ ‡æ³¨"></a>æ•°æ®æ ‡æ³¨</h2><h3 id="æ ‡æ³¨å·¥å…·ï¼šlabelme"><a href="#æ ‡æ³¨å·¥å…·ï¼šlabelme" class="headerlink" title="æ ‡æ³¨å·¥å…·ï¼šlabelme"></a>æ ‡æ³¨å·¥å…·ï¼šlabelme</h3><p>å¯¹å›¾åƒä¸­çš„ç«ç„°å’ŒçƒŸé›¾è¿›è¡ŒçŸ©å½¢æ ‡è®°ï¼Œå°†æ•°æ®çš„labelåˆ†ä¸ºä¸¤ç±»ï¼š0-ç«ç„°ï¼›1-çƒŸé›¾</p><p><img src="/2024/01/25/yolov8ï¼šç«ç¾æ£€æµ‹/5.png" alt></p><h3 id="æ•°æ®æ ¼å¼è½¬æ¢"><a href="#æ•°æ®æ ¼å¼è½¬æ¢" class="headerlink" title="æ•°æ®æ ¼å¼è½¬æ¢"></a>æ•°æ®æ ¼å¼è½¬æ¢</h3><p>å°†labelmeæ•°æ®æ ¼å¼è½¬ä¸ºyoloæ ¼å¼</p><h3 id="åˆ›å»ºè®­ç»ƒyamlæ–‡ä»¶"><a href="#åˆ›å»ºè®­ç»ƒyamlæ–‡ä»¶" class="headerlink" title="åˆ›å»ºè®­ç»ƒyamlæ–‡ä»¶"></a>åˆ›å»ºè®­ç»ƒyamlæ–‡ä»¶</h3><p>åœ¨æ•°æ®é›†çš„æ ¹ç›®å½•ä¸‹æ–°å»º<code>fire.yaml</code>æ–‡ä»¶ç”¨äºè®°å½•è®­ç»ƒé›†ä¿¡æ¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">train:</span> <span class="string">/exp/work/video/yolov8/datasets/fire/data/train/images</span> <span class="comment"># è®­ç»ƒé›†</span></span><br><span class="line"><span class="attr">val:</span> <span class="string">/exp/work/video/yolov8/datasets/fire/data/val/images</span> <span class="comment"># éªŒè¯é›†</span></span><br><span class="line"><span class="attr">test:</span> <span class="string">/exp/work/video/yolov8/datasets/fire/data/test/images</span> <span class="comment"># æµ‹è¯•é›†</span></span><br><span class="line"><span class="attr">nc:</span> <span class="number">2</span> <span class="comment"># åˆ†ç±»æ•°é‡</span></span><br><span class="line"></span><br><span class="line"><span class="attr">names:</span> <span class="string">[fire,</span> <span class="string">smoke]</span> <span class="comment"># ç±»åˆ«åç§°</span></span><br></pre></td></tr></table></figure><h2 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h2><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºè®­ç»ƒè„šæœ¬<code>yolov8_train.py</code>ï¼Œå¹¶è®¾ç½®åŒå¡è®­ç»ƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ultralytics <span class="keyword">import</span> YOLO</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½æ¨¡å‹</span></span><br><span class="line">model = YOLO(<span class="string">'yolov8n.pt'</span>)  <span class="comment"># åŠ è½½é¢„è®­ç»ƒæ¨¡å‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒå¡è®­ç»ƒ</span></span><br><span class="line">model.train(</span><br><span class="line">    data=<span class="string">'datasets/fire/data/fire.yaml'</span>,</span><br><span class="line">    epochs=<span class="number">300</span>,</span><br><span class="line">    device=[<span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨éªŒè¯</span></span><br><span class="line">model.val()</span><br></pre></td></tr></table></figure><p>å¯åŠ¨è®­ç»ƒè„šæœ¬ï¼Œå¼€å¯è®­ç»ƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python yolov8_train.py</span><br></pre></td></tr></table></figure><p>æ‰“å°é…ç½®ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Ultralytics YOLOv8.1.5 ğŸš€ Python-3.9.18 torch-2.1.2+cu121 CUDA:0 (NVIDIA GeForce RTX 3090, 24260MiB)</span><br><span class="line">                                                          CUDA:1 (NVIDIA GeForce RTX 3090, 24260MiB)</span><br><span class="line">engine/trainer: task=detect, mode=train, model=yolov8n.pt, data=datasets/fire/data/fire.yaml, epochs=300, time=None, patience=50, batch=16, imgsz=640, save=True, save_period=-1, cache=False, device=[0, 1], workers=8, project=None, name=train9, exist_ok=False, pretrained=True, optimizer=auto, verbose=True, seed=0, deterministic=True, single_cls=False, rect=False, cos_lr=False, close_mosaic=10, resume=False, amp=True, fraction=1.0, profile=False, freeze=None, multi_scale=False, overlap_mask=True, mask_ratio=4, dropout=0.0, val=True, split=val, save_json=False, save_hybrid=False, conf=None, iou=0.7, max_det=300, half=False, dnn=False, plots=True, source=None, vid_stride=1, stream_buffer=False, visualize=False, augment=False, agnostic_nms=False, classes=None, retina_masks=False, embed=None, show=False, save_frames=False, save_txt=False, save_conf=False, save_crop=False, show_labels=True, show_conf=True, show_boxes=True, line_width=None, format=torchscript, keras=False, optimize=False, int8=False, dynamic=False, simplify=False, opset=None, workspace=4, nms=False, lr0=0.01, lrf=0.01, momentum=0.937, weight_decay=0.0005, warmup_epochs=3.0, warmup_momentum=0.8, warmup_bias_lr=0.1, box=7.5, cls=0.5, dfl=1.5, pose=12.0, kobj=1.0, label_smoothing=0.0, nbs=64, hsv_h=0.015, hsv_s=0.7, hsv_v=0.4, degrees=0.0, translate=0.1, scale=0.5, shear=0.0, perspective=0.0, flipud=0.0, fliplr=0.5, mosaic=1.0, mixup=0.0, copy_paste=0.0, auto_augment=randaugment, erasing=0.4, crop_fraction=1.0, cfg=None, tracker=botsort.yaml, save_dir=runs/detect/train9</span><br><span class="line">Overriding model.yaml nc=80 with nc=2</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">                   from  n    params  module                                       arguments                     </span><br><span class="line">  0                  -1  1       464  ultralytics.nn.modules.conv.Conv             [3, 16, 3, 2]                 </span><br><span class="line">  1                  -1  1      4672  ultralytics.nn.modules.conv.Conv             [16, 32, 3, 2]                </span><br><span class="line">  2                  -1  1      7360  ultralytics.nn.modules.block.C2f             [32, 32, 1, True]             </span><br><span class="line">  3                  -1  1     18560  ultralytics.nn.modules.conv.Conv             [32, 64, 3, 2]                </span><br><span class="line">  4                  -1  2     49664  ultralytics.nn.modules.block.C2f             [64, 64, 2, True]             </span><br><span class="line">  5                  -1  1     73984  ultralytics.nn.modules.conv.Conv             [64, 128, 3, 2]               </span><br><span class="line">  6                  -1  2    197632  ultralytics.nn.modules.block.C2f             [128, 128, 2, True]           </span><br><span class="line">  7                  -1  1    295424  ultralytics.nn.modules.conv.Conv             [128, 256, 3, 2]              </span><br><span class="line">  8                  -1  1    460288  ultralytics.nn.modules.block.C2f             [256, 256, 1, True]           </span><br><span class="line">  9                  -1  1    164608  ultralytics.nn.modules.block.SPPF            [256, 256, 5]                 </span><br><span class="line"> 10                  -1  1         0  torch.nn.modules.upsampling.Upsample         [None, 2, 'nearest']          </span><br><span class="line"> 11             [-1, 6]  1         0  ultralytics.nn.modules.conv.Concat           [1]                           </span><br><span class="line"> 12                  -1  1    148224  ultralytics.nn.modules.block.C2f             [384, 128, 1]                 </span><br><span class="line"> 13                  -1  1         0  torch.nn.modules.upsampling.Upsample         [None, 2, 'nearest']          </span><br><span class="line"> 14             [-1, 4]  1         0  ultralytics.nn.modules.conv.Concat           [1]                           </span><br><span class="line"> 15                  -1  1     37248  ultralytics.nn.modules.block.C2f             [192, 64, 1]                  </span><br><span class="line"> 16                  -1  1     36992  ultralytics.nn.modules.conv.Conv             [64, 64, 3, 2]                </span><br><span class="line"> 17            [-1, 12]  1         0  ultralytics.nn.modules.conv.Concat           [1]                           </span><br><span class="line"> 18                  -1  1    123648  ultralytics.nn.modules.block.C2f             [192, 128, 1]                 </span><br><span class="line"> 19                  -1  1    147712  ultralytics.nn.modules.conv.Conv             [128, 128, 3, 2]              </span><br><span class="line"> 20             [-1, 9]  1         0  ultralytics.nn.modules.conv.Concat           [1]                           </span><br><span class="line"> 21                  -1  1    493056  ultralytics.nn.modules.block.C2f             [384, 256, 1]                 </span><br><span class="line"> 22        [15, 18, 21]  1    751702  ultralytics.nn.modules.head.Detect           [2, [64, 128, 256]]           </span><br><span class="line">Model summary: 225 layers, 3011238 parameters, 3011222 gradients, 8.2 GFLOPs</span><br><span class="line"></span><br><span class="line">Transferred 319/355 items from pretrained weights</span><br><span class="line">DDP: debug command /root/anaconda3/envs/py39_yolov8/bin/python -m torch.distributed.run --nproc_per_node 2 --master_port 45027 /root/.config/Ultralytics/DDP/_temp_bfxihrb7140614302513712.py</span><br><span class="line">WARNING:__main__:</span><br><span class="line">*****************************************</span><br><span class="line">Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. </span><br><span class="line">*****************************************</span><br><span class="line">Ultralytics YOLOv8.1.5 ğŸš€ Python-3.9.18 torch-2.1.2+cu121 CUDA:0 (NVIDIA GeForce RTX 3090, 24260MiB)</span><br><span class="line">                                                          CUDA:1 (NVIDIA GeForce RTX 3090, 24260MiB)</span><br><span class="line">Overriding model.yaml nc=80 with nc=2</span><br><span class="line">Transferred 319/355 items from pretrained weights</span><br><span class="line">Freezing layer 'model.22.dfl.conv.weight'</span><br><span class="line">AMP: running Automatic Mixed Precision (AMP) checks with YOLOv8n...</span><br><span class="line">AMP: checks passed âœ…</span><br></pre></td></tr></table></figure><p>è®°å½•æ¨¡å‹è¾“å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Plotting labels to runs/detect/train9/labels.jpg... </span><br><span class="line">optimizer: 'optimizer=auto' found, ignoring 'lr0=0.01' and 'momentum=0.937' and determining best 'optimizer', 'lr0' and 'momentum' automatically... </span><br><span class="line">optimizer: AdamW(lr=0.000714, momentum=0.9) with parameter groups 57 weight(decay=0.0), 64 weight(decay=0.0005), 63 bias(decay=0.0)</span><br><span class="line">Image sizes 640 train, 640 val</span><br><span class="line">Using 16 dataloader workers</span><br><span class="line">Logging results to runs/detect/train9</span><br></pre></td></tr></table></figure><p>è®­ç»ƒå¼€å§‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">Starting training for 300 epochs...</span><br><span class="line"></span><br><span class="line">      Epoch    GPU_mem   box_loss   cls_loss   dfl_loss  Instances       Size</span><br><span class="line">      1/300      1.38G      2.132      4.599       2.13          6        640: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:04&lt;00:00,  1.53s/it]</span><br><span class="line">                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  3.10it/s]</span><br><span class="line">                   all         41         62    0.00191      0.349     0.0223     0.0121</span><br><span class="line"></span><br><span class="line">      Epoch    GPU_mem   box_loss   cls_loss   dfl_loss  Instances       Size</span><br><span class="line">      2/300      1.44G      1.984      4.085      1.942         18        640: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  5.08it/s]</span><br><span class="line">                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00, 11.57it/s]</span><br><span class="line">                   all         41         62    0.00209      0.373     0.0247     0.0119</span><br><span class="line"></span><br><span class="line">      Epoch    GPU_mem   box_loss   cls_loss   dfl_loss  Instances       Size</span><br><span class="line">      3/300      1.48G      2.421      4.407      2.348         14        640: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  5.78it/s]</span><br><span class="line">                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00, 10.23it/s]</span><br><span class="line">                   all         41         62    0.00205      0.373     0.0335     0.0165</span><br><span class="line"></span><br><span class="line">      Epoch    GPU_mem   box_loss   cls_loss   dfl_loss  Instances       Size</span><br><span class="line">      4/300      1.48G      1.795      3.787      1.724         18        640: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  5.61it/s]</span><br><span class="line">                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  9.82it/s]</span><br><span class="line">                   all         41         62    0.00239      0.434     0.0445     0.0219</span><br><span class="line"></span><br><span class="line">      Epoch    GPU_mem   box_loss   cls_loss   dfl_loss  Instances       Size</span><br><span class="line">      5/300      1.48G      1.707      3.619      1.785         17        640: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  5.49it/s]</span><br><span class="line">                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  8.87it/s]</span><br><span class="line">                   all         41         62      0.003      0.495     0.0735     0.0283</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">      Epoch    GPU_mem   box_loss   cls_loss   dfl_loss  Instances       Size</span><br><span class="line">    295/300       1.5G     0.3742     0.5917     0.8247          7        640: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  7.21it/s]</span><br><span class="line">                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00, 11.40it/s]</span><br><span class="line">                   all         41         62      0.996          1      0.995      0.946</span><br><span class="line"></span><br><span class="line">      Epoch    GPU_mem   box_loss   cls_loss   dfl_loss  Instances       Size</span><br><span class="line">    296/300      1.44G     0.4263     0.6716     0.8004          7        640: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  6.86it/s]</span><br><span class="line">                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00, 11.97it/s]</span><br><span class="line">                   all         41         62      0.996          1      0.995      0.945</span><br><span class="line"></span><br><span class="line">      Epoch    GPU_mem   box_loss   cls_loss   dfl_loss  Instances       Size</span><br><span class="line">    297/300       1.5G      0.473     0.6775     0.8499          7        640: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  7.20it/s]</span><br><span class="line">                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00, 11.12it/s]</span><br><span class="line">                   all         41         62      0.996          1      0.995      0.945</span><br><span class="line"></span><br><span class="line">      Epoch    GPU_mem   box_loss   cls_loss   dfl_loss  Instances       Size</span><br><span class="line">    298/300      1.51G     0.4877     0.6956     0.8936         11        640: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  6.73it/s]</span><br><span class="line">                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00, 11.03it/s]</span><br><span class="line">                   all         41         62      0.996          1      0.995      0.942</span><br><span class="line"></span><br><span class="line">      Epoch    GPU_mem   box_loss   cls_loss   dfl_loss  Instances       Size</span><br><span class="line">    299/300       1.5G     0.4303      0.622     0.8264          6        640: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  6.89it/s]</span><br><span class="line">                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00, 11.62it/s]</span><br><span class="line">                   all         41         62      0.996          1      0.995      0.941</span><br><span class="line"></span><br><span class="line">      Epoch    GPU_mem   box_loss   cls_loss   dfl_loss  Instances       Size</span><br><span class="line">    300/300      1.44G     0.4593     0.6413     0.8419          6        640: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  6.31it/s]</span><br><span class="line">                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00, 11.83it/s]</span><br><span class="line">                   all         41         62      0.995          1      0.995       0.94</span><br></pre></td></tr></table></figure><p>è®­ç»ƒç»“æŸï¼ŒéªŒè¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">300 epochs completed in 0.101 hours.</span><br><span class="line">Optimizer stripped from runs/detect/train9/weights/last.pt, 6.3MB</span><br><span class="line">Optimizer stripped from runs/detect/train9/weights/best.pt, 6.3MB</span><br><span class="line"></span><br><span class="line">Validating runs/detect/train9/weights/best.pt...</span><br><span class="line">Ultralytics YOLOv8.1.5 ğŸš€ Python-3.9.18 torch-2.1.2+cu121 CUDA:0 (NVIDIA GeForce RTX 3090, 24260MiB)</span><br><span class="line">                                                          CUDA:1 (NVIDIA GeForce RTX 3090, 24260MiB)</span><br><span class="line">Model summary (fused): 168 layers, 3006038 parameters, 0 gradients, 8.1 GFLOPs</span><br><span class="line">                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00, 10.62it/s]</span><br><span class="line">                   all         41         62      0.996          1      0.995      0.946</span><br><span class="line">                  fire         41         41      0.999          1      0.995      0.938</span><br><span class="line">                 smoke         41         21      0.992          1      0.995      0.955</span><br><span class="line">Speed: 0.1ms preprocess, 1.4ms inference, 0.0ms loss, 1.0ms postprocess per image</span><br><span class="line">Results saved to runs/detect/train9</span><br><span class="line">Ultralytics YOLOv8.1.5 ğŸš€ Python-3.9.18 torch-2.1.2+cu121 CUDA:0 (NVIDIA GeForce RTX 3090, 24260MiB)</span><br><span class="line">                                                          CUDA:1 (NVIDIA GeForce RTX 3090, 24260MiB)</span><br><span class="line">Model summary (fused): 168 layers, 3006038 parameters, 0 gradients, 8.1 GFLOPs</span><br><span class="line">                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:04&lt;00:00,  1.41s/it]</span><br><span class="line">                   all         41         62      0.996          1      0.995      0.941</span><br><span class="line">                  fire         41         41      0.999          1      0.995      0.939</span><br><span class="line">                 smoke         41         21      0.992          1      0.995      0.942</span><br><span class="line">Speed: 0.2ms preprocess, 14.3ms inference, 0.0ms loss, 16.8ms postprocess per image</span><br><span class="line">Results saved to runs/detect/train92</span><br></pre></td></tr></table></figure><h2 id="è¯„ä¼°"><a href="#è¯„ä¼°" class="headerlink" title="è¯„ä¼°"></a>è¯„ä¼°</h2><p>è¿›å…¥ä¿å­˜è®­ç»ƒç»“æœçš„æ–‡ä»¶å¤¹å†…ï¼Œå…¶ä¸­<code>weights</code>æ–‡ä»¶å¤¹åŒ…å«äº†æœ€ä½³è®­ç»ƒæ¨¡å‹å’Œæœ€è¿‘è®­ç»ƒæ¨¡å‹ï¼Œæ–‡ä»¶å¤¹å¤–å­˜å‚¨è®­ç»ƒçš„å„é¡¹è®°å½•å’Œæµ‹è¯•æ›²çº¿ç­‰</p><p><img src="/2024/01/25/yolov8ï¼šç«ç¾æ£€æµ‹/6.png" alt></p><p><img src="/2024/01/25/yolov8ï¼šç«ç¾æ£€æµ‹/7.png" alt></p><p><code>result.csv</code>æ–‡ä»¶ä¸­è®°å½•äº†300è½®epochçš„è¯¦ç»†ç»“æœ</p><p><img src="/2024/01/25/yolov8ï¼šç«ç¾æ£€æµ‹/8.png" alt></p><h2 id="é¢„æµ‹"><a href="#é¢„æµ‹" class="headerlink" title="é¢„æµ‹"></a>é¢„æµ‹</h2><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºé¢„æµ‹è„šæœ¬<code>yolov8_test.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ultralytics <span class="keyword">import</span> YOLO</span><br><span class="line"></span><br><span class="line">model = YOLO(<span class="string">'runs/detect/train9/weights/best.pt'</span>) <span class="comment"># æŒ‡å®šæœ€ä½³æ¨¡å‹</span></span><br><span class="line">model.predict(<span class="string">'video/fire.mp4'</span>, save=<span class="literal">True</span>, classes=[<span class="number">0</span>, <span class="number">1</span>]) <span class="comment"># æŒ‡å®šè¾“å‡ºç±»åˆ«</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">video 1/1 (1/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 1 fire, 208.5ms</span><br><span class="line">video 1/1 (2/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 9.6ms</span><br><span class="line">video 1/1 (3/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 7.9ms</span><br><span class="line">video 1/1 (4/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 7.9ms</span><br><span class="line">video 1/1 (5/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 8.0ms</span><br><span class="line">video 1/1 (6/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 7.8ms</span><br><span class="line">video 1/1 (7/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 7.7ms</span><br><span class="line">video 1/1 (8/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 7.6ms</span><br><span class="line">video 1/1 (9/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 7.9ms</span><br><span class="line">video 1/1 (10/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 7.8ms</span><br><span class="line">video 1/1 (11/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 8.1ms</span><br><span class="line">video 1/1 (12/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 8.1ms</span><br><span class="line">video 1/1 (13/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 8.2ms</span><br><span class="line">video 1/1 (14/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 8.0ms</span><br><span class="line">video 1/1 (15/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 7.7ms</span><br><span class="line">video 1/1 (16/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 7.8ms</span><br><span class="line">video 1/1 (17/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 (no detections), 7.6ms</span><br><span class="line">video 1/1 (18/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 1 fire, 7.6ms</span><br><span class="line">video 1/1 (19/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 1 fire, 7.8ms</span><br><span class="line">video 1/1 (20/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 1 fire, 7.6ms</span><br><span class="line">video 1/1 (21/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 1 fire, 7.8ms</span><br><span class="line">video 1/1 (22/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 2 fires, 7.7ms</span><br><span class="line">video 1/1 (23/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 1 fire, 7.6ms</span><br><span class="line">video 1/1 (24/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 1 fire, 7.5ms</span><br><span class="line">video 1/1 (25/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 1 fire, 7.7ms</span><br><span class="line">video 1/1 (26/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 1 fire, 7.5ms</span><br><span class="line">video 1/1 (27/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 1 fire, 7.4ms</span><br><span class="line">video 1/1 (28/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 1 fire, 7.6ms</span><br><span class="line">video 1/1 (29/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 1 fire, 7.8ms</span><br><span class="line">video 1/1 (30/306) /exp/work/video/yolov8/video/fire.mp4: 384x640 1 fire, 7.7ms</span><br><span class="line">...</span><br><span class="line">Speed: 2.2ms preprocess, 8.3ms inference, 3.8ms postprocess per image at shape (1, 3, 384, 640)</span><br><span class="line">Results saved to runs/detect/predict13</span><br></pre></td></tr></table></figure><p><img src="/2024/01/25/yolov8ï¼šç«ç¾æ£€æµ‹/fire.gif" alt></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒ&quot;&gt;&lt;/a&gt;ç¯å¢ƒ&lt;/h2&gt;&lt;h3 id=&quot;GPU&quot;&gt;&lt;a href=&quot;#GPU&quot; class=&quot;headerlink&quot; title=&quot;GPU&quot;&gt;&lt;/a&gt;GPU&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;font color=&quot;gold&quot;&gt;NVIDIA 3090*2&lt;/font&gt;&lt;/li&gt;
&lt;li&gt;&lt;font color=&quot;gold&quot;&gt;æ˜¾å¡é©±åŠ¨ 535.104.05&lt;/font&gt;&lt;/li&gt;
&lt;li&gt;&lt;font color=&quot;gold&quot;&gt;CUDAç‰ˆæœ¬ 12.2&lt;/font&gt;&lt;/li&gt;
&lt;li&gt;&lt;font color=&quot;gold&quot;&gt;CUDAtoolkit&lt;/font&gt; (cuda_12.2.2_535.104.05_linux)&lt;/li&gt;
&lt;li&gt;&lt;font color=&quot;gold&quot;&gt;cuDNN (v8.9.7)&lt;/font&gt;

&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;yoloç‰ˆæœ¬&quot;&gt;&lt;a href=&quot;#yoloç‰ˆæœ¬&quot; class=&quot;headerlink&quot; title=&quot;yoloç‰ˆæœ¬&quot;&gt;&lt;/a&gt;yoloç‰ˆæœ¬&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;font color=&quot;gold&quot;&gt;v8.1.5&lt;/font&gt; (ultralytics yolov8)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;pytorchç‰ˆæœ¬&quot;&gt;&lt;a href=&quot;#pytorchç‰ˆæœ¬&quot; class=&quot;headerlink&quot; title=&quot;pytorchç‰ˆæœ¬&quot;&gt;&lt;/a&gt;pytorchç‰ˆæœ¬&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;font color=&quot;gold&quot;&gt;v2.1.2&lt;/font&gt;

&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;pythonç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#pythonç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;pythonç¯å¢ƒ&quot;&gt;&lt;/a&gt;pythonç¯å¢ƒ&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;font color=&quot;gold&quot;&gt;CentOS7.9&lt;/font&gt;
&lt;/li&gt;
&lt;li&gt;&lt;font color=&quot;gold&quot;&gt;anaconda3&lt;/font&gt;
&lt;/li&gt;
&lt;li&gt;&lt;font color=&quot;gold&quot;&gt;python3.9&lt;/font&gt;

&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h2&gt;&lt;p&gt;æºç ä¸»é¡µï¼š&lt;a href=&quot;https://github.com/ultralytics/ultralytics&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/ultralytics/ultralytics&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å®˜æ–¹æ–‡æ¡£ï¼š&lt;a href=&quot;https://docs.ultralytics.com/zh&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://docs.ultralytics.com/zh&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2024/01/25/yolov8ï¼šç«ç¾æ£€æµ‹/1.png&quot; alt&gt;&lt;/p&gt;
&lt;h3 id=&quot;å…‹éš†æºç &quot;&gt;&lt;a href=&quot;#å…‹éš†æºç &quot; class=&quot;headerlink&quot; title=&quot;å…‹éš†æºç &quot;&gt;&lt;/a&gt;å…‹éš†æºç &lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;git clone https://hub.nuaa.cf/ultralytics/ultralytics.git&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;å®‰è£…ä¾èµ–&quot;&gt;&lt;a href=&quot;#å®‰è£…ä¾èµ–&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…ä¾èµ–&quot;&gt;&lt;/a&gt;å®‰è£…ä¾èµ–&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;pip install pip install ultralytics -i https://mirror.baidu.com/pypi/simple&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;ç¯å¢ƒéªŒè¯&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒéªŒè¯&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒéªŒè¯&quot;&gt;&lt;/a&gt;ç¯å¢ƒéªŒè¯&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yolo predict model=yolov8n.pt source=ultralytics/assets/zidane.jpg&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ‰§è¡Œå®Œæ¯•åå¾—åˆ°è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;(py39_yolov8) [root@jdz yolov8]# yolo predict model=yolov8n.pt source=ultralytics/assets/zidane.jpg &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ultralytics YOLOv8.1.5 ğŸš€ Python-3.9.18 torch-2.1.2+cu121 CUDA:0 (NVIDIA GeForce RTX 3090, 24260MiB)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;YOLOv8n summary (fused): 168 layers, 3151904 parameters, 0 gradients, 8.7 GFLOPs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;image 1/1 /exp/work/video/yolov8/ultralytics/assets/zidane.jpg: 384x640 2 persons, 1 tie, 216.9ms&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Speed: 7.3ms preprocess, 216.9ms inference, 762.4ms postprocess per image at shape (1, 3, 384, 640)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Results saved to runs/detect/predict&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ğŸ’¡ Learn more at https://docs.ultralytics.com/modes/predict&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å°†åœ¨&lt;code&gt;Results saved to runs/detect/predict&lt;/code&gt;ç›®å½•ä¸‹æ‰¾åˆ°è¾“å‡ºç»“æœ&lt;/p&gt;</summary>
    
    
    
    <category term="ç›®æ ‡æ£€æµ‹" scheme="http://yoursite.com/categories/ç›®æ ‡æ£€æµ‹/"/>
    
    
    <category term="opencv" scheme="http://yoursite.com/tags/opencv/"/>
    
    <category term="yolov8" scheme="http://yoursite.com/tags/yolov8/"/>
    
  </entry>
  
  <entry>
    <title>NetworkX: å›¾è®ºç®—æ³•åº”ç”¨</title>
    <link href="http://yoursite.com/2024/01/08/NetworkX-%E5%9B%BE%E8%AE%BA%E7%AE%97%E6%B3%95%E5%BA%94%E7%94%A8/"/>
    <id>http://yoursite.com/2024/01/08/NetworkX-%E5%9B%BE%E8%AE%BA%E7%AE%97%E6%B3%95%E5%BA%94%E7%94%A8/</id>
    <published>2024-01-08T07:48:56.000Z</published>
    <updated>2024-01-25T08:23:02.432Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><h2 id="NetworkX"><a href="#NetworkX" class="headerlink" title="NetworkX"></a>NetworkX</h2><p>NetworkXæ˜¯ä¸€æ¬¾Pythonçš„è½¯ä»¶åŒ…ï¼Œç”¨äºåˆ›é€ ã€æ“ä½œå¤æ‚ç½‘ç»œï¼Œä»¥åŠå­¦ä¹ å¤æ‚ç½‘ç»œçš„ç»“æ„ã€åŠ¨åŠ›å­¦åŠå…¶åŠŸèƒ½ã€‚æœ‰äº†NetworkXå°±å¯ä»¥ç”¨æ ‡å‡†æˆ–è€…ä¸æ ‡å‡†çš„æ•°æ®æ ¼å¼åŠ è½½æˆ–è€…å­˜å‚¨ç½‘ç»œï¼Œå®ƒå¯ä»¥äº§ç”Ÿè®¸å¤šç§ç±»çš„éšæœºç½‘ç»œæˆ–ç»å…¸ç½‘ç»œï¼Œä¹Ÿå¯ä»¥åˆ†æç½‘ç»œç»“æ„ã€å»ºç«‹ç½‘ç»œæ¨¡å‹ã€è®¾è®¡æ–°çš„ç½‘ç»œç®—æ³•ã€ç»˜åˆ¶ç½‘ç»œç­‰</p><p>å‚è€ƒæ–‡çŒ®åœ°å€: <a href="https://www.osgeo.cn/networkx/reference/index.html" target="_blank" rel="noopener">https://www.osgeo.cn/networkx/reference/index.html</a></p><h2 id="å›¾è®¡ç®—åº”ç”¨æ–¹å¼æ¯”è¾ƒ"><a href="#å›¾è®¡ç®—åº”ç”¨æ–¹å¼æ¯”è¾ƒ" class="headerlink" title="å›¾è®¡ç®—åº”ç”¨æ–¹å¼æ¯”è¾ƒ"></a>å›¾è®¡ç®—åº”ç”¨æ–¹å¼æ¯”è¾ƒ</h2><h3 id="1-nebula-spark"><a href="#1-nebula-spark" class="headerlink" title="1.nebula + spark"></a>1.nebula + spark</h3><p>ä¾èµ–nebula-spark-connectoråŒ…ã€nebula-algorithmåŒ…å’Œsparké›†ç¾¤çš„æ•°æ®è¯»å–ã€å›¾è®¡ç®—æ–¹å¼</p><h3 id="2-clickhouse-NetworkX"><a href="#2-clickhouse-NetworkX" class="headerlink" title="2.clickhouse + NetworkX"></a>2.clickhouse + NetworkX</h3><p>ç”±äºnebula-algorithmä¾èµ–sparké›†ç¾¤ï¼Œä¸”nebula-consoleåŸç”Ÿçš„æ•°æ®è¯»å–èƒ½åŠ›ä¸ä½³ï¼Œåœ¨ç¯å¢ƒå—é™ä¸”è®¡ç®—é‡æœ‰é™çš„æƒ…å†µä¸‹ä¼˜å…ˆè€ƒè™‘è·³è¿‡sparké›†ç¾¤å’Œnebulaå›¾åº“ï¼Œé‡‡ç”¨clickhouse + NetworkXçš„å›¾è®¡ç®—æ–¹å¼ï¼Œå…¶ä¸­clickhouseæ˜¯å­˜å‚¨äº†nebulaæºæ•°æ®çš„åˆ—å¼åˆ†å¸ƒå¼è¡¨ï¼Œä½œç”¨ç±»ä¼¼äºæ–¹æ³•1ä¸­å°†nebulaé›†ç¾¤æ•°æ®é€šè¿‡nebula-spark-connectoråŒ…å¯¼å…¥ä¸ºspark-DataFrameï¼Œä»…ç”¨åšæ•°æ®è¯»å–ï¼Œå†é€šè¿‡å°†æ•°æ®è½¬åŒ–ä¸ºNetworkXçš„å›¾ç»“æ„è¿›è¡Œå›¾è®¡ç®—</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/9.png" alt></p><a id="more"></a><h2 id="åº”ç”¨å®ä¾‹"><a href="#åº”ç”¨å®ä¾‹" class="headerlink" title="åº”ç”¨å®ä¾‹"></a>åº”ç”¨å®ä¾‹</h2><p>nebulaé›†ç¾¤å­˜å‚¨ä»¥ç¾¤èŠå’Œç¾¤æˆå‘˜ã€å¥½å‹å…³ç³»æ‰€ç»„æˆçš„å…³ç³»ç½‘ï¼Œclickhouseé›†ç¾¤å­˜å‚¨èŠ‚ç‚¹æºæ•°æ®å’Œå¯¹åº”å…³ç³»</p><h3 id="ä¸€ã€é›†åˆè¿ç®—"><a href="#ä¸€ã€é›†åˆè¿ç®—" class="headerlink" title="ä¸€ã€é›†åˆè¿ç®—"></a>ä¸€ã€é›†åˆè¿ç®—</h3><p>äº¤ã€å¹¶ã€å·®é›†</p><p>ç›´æ¥ä½¿ç”¨clickhouseè¿›è¡ŒæŸ¥è¯¢ï¼Œé€‚ç”¨äºä¸¤ä¸ªç¾¤ç»„æˆå‘˜æˆ–è´¦å·æ‰€åŠ ç¾¤çš„äº¤å¹¶å·®é›†</p><p><strong>è¾“å…¥ï¼š</strong></p><p><strong><font color="gold">Â·</font></strong> nä¸ªè´¦å·ï¼ˆnâ‰¥2ï¼‰</p><p><strong><font color="gold">Â·</font></strong> nä¸ªç¾¤ç»„ï¼ˆnâ‰¥2ï¼‰</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/1.png" alt></p><h3 id="äºŒã€è·¯å¾„æ¢å¯»"><a href="#äºŒã€è·¯å¾„æ¢å¯»" class="headerlink" title="äºŒã€è·¯å¾„æ¢å¯»"></a>äºŒã€è·¯å¾„æ¢å¯»</h3><p>ç›´æ¥ä½¿ç”¨nebulaè¿›è¡ŒæŸ¥è¯¢ï¼Œé€‚ç”¨äºæœç´¢å›¾è°±ä¸­ä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹çš„æœ€çŸ­å¯è¾¾è·¯å¾„</p><p><strong>è¾“å…¥ï¼š</strong></p><p><strong><font color="gold">Â·</font></strong> ä»»æ„ç±»å‹2ä¸ªèŠ‚ç‚¹</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/2.png" alt></p><h3 id="ä¸‰ã€ä¸­å¿ƒæ€§"><a href="#ä¸‰ã€ä¸­å¿ƒæ€§" class="headerlink" title="ä¸‰ã€ä¸­å¿ƒæ€§"></a>ä¸‰ã€ä¸­å¿ƒæ€§</h3><p><strong>è¾“å…¥ï¼š</strong></p><p><strong><font color="gold">Â·</font></strong> nä¸ªç¾¤ç»„ï¼ˆnâ‰¥1ï¼‰ï¼Œåˆ†æåŒ…æ‹¬æŒ‡å®šnä¸ªç¾¤ç»„ã€ç¾¤ç»„ç¾¤æˆå‘˜ã€ç¾¤æˆå‘˜æ‰€åŠ ç¾¤ç»„æˆå…³ç³»ç½‘å„èŠ‚ç‚¹çš„ä¸­å¿ƒæ€§</p><p><strong><font color="gold">Â·</font></strong> nä¸ªè´¦å·ï¼ˆnâ‰¥1ï¼‰ï¼Œåˆ†æåŒ…æ‹¬æŒ‡å®šnä¸ªè´¦å·ã€è´¦å·æ‰€åŠ ç¾¤ã€ç¾¤æˆå‘˜ç»„æˆå…³ç³»ç½‘å„èŠ‚ç‚¹çš„ä¸­å¿ƒæ€§</p><p><strong><font color="gold">Â·</font></strong> æŒ‡å®šå…³ç³»ç½‘ï¼Œåˆ†æå„èŠ‚ç‚¹ä¸­å¿ƒæ€§</p><p><strong>ClickHouse SQLç¤ºä¾‹ï¼ˆå…³ç³»å›¾è°±ï¼‰ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  team_id,account_id <span class="keyword">FROM</span> mqv3.ly_team_ship lts </span><br><span class="line">PREWHERE account_id <span class="keyword">GLOBAL</span> <span class="keyword">IN</span> </span><br><span class="line">(<span class="keyword">SELECT</span> account_id <span class="keyword">FROM</span> mqv3.ly_team_ship lts PREWHERE team_id=<span class="string">'&#123;src_vid&#125;'</span>);</span><br></pre></td></tr></table></figure><h4 id="1-åº¦ä¸­å¿ƒæ€§"><a href="#1-åº¦ä¸­å¿ƒæ€§" class="headerlink" title="1.åº¦ä¸­å¿ƒæ€§"></a>1.åº¦ä¸­å¿ƒæ€§</h4><p>è¡¡é‡èŠ‚ç‚¹ä¸­å¿ƒæ€§çš„æŒ‡æ ‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res = nx.degree_centrality(G)</span><br><span class="line">res = dict(sorted(res.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="literal">True</span>))</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure><p><strong>e.g.</strong> ä»¥ç¾¤ï¼ˆ-1151413367ã€-1541749047ï¼‰ä¸ºæŒ‡å®šèŠ‚ç‚¹ï¼Œè®¡ç®—ä¸‰çº§å…³ç³»ç½‘å„èŠ‚ç‚¹åº¦ä¸­å¿ƒæ€§ï¼ˆæŠ›å¼ƒåº¦&lt;5çš„èŠ‚ç‚¹ï¼Œçªå‡ºç»“æ„ï¼‰</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/3.png" alt></p><h4 id="2-æ¥è¿‘ä¸­å¿ƒæ€§"><a href="#2-æ¥è¿‘ä¸­å¿ƒæ€§" class="headerlink" title="2.æ¥è¿‘ä¸­å¿ƒæ€§"></a>2.æ¥è¿‘ä¸­å¿ƒæ€§</h4><p>åæ˜ åœ¨å…³ç³»ç½‘ç»œä¸­æŸä¸€èŠ‚ç‚¹ä¸å…¶ä»–èŠ‚ç‚¹ä¹‹é—´çš„æ¥è¿‘ç¨‹åº¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res = nx.closeness_centrality(G)</span><br><span class="line">res = dict(sorted(res.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="literal">True</span>))</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure><p><strong>e.g.</strong> ä»¥ç¾¤ï¼ˆ-1151413367ã€-1541749047ï¼‰ä¸ºæŒ‡å®šèŠ‚ç‚¹ï¼Œè®¡ç®—ä¸‰çº§å…³ç³»ç½‘å„èŠ‚ç‚¹æ¥è¿‘ä¸­å¿ƒæ€§ï¼ˆæŠ›å¼ƒåº¦&lt;50çš„èŠ‚ç‚¹ï¼Œçªå‡ºç»“æ„ï¼‰</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/4.png" alt></p><h4 id="3-ä¸­ä»‹ä¸­å¿ƒæ€§"><a href="#3-ä¸­ä»‹ä¸­å¿ƒæ€§" class="headerlink" title="3.ä¸­ä»‹ä¸­å¿ƒæ€§"></a>3.ä¸­ä»‹ä¸­å¿ƒæ€§</h4><p>ä»¥ç»è¿‡æŸä¸ªèŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„æ•°ç›®æ¥åˆ»ç”»èŠ‚ç‚¹é‡è¦æ€§çš„æŒ‡æ ‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res = nx.betweenness_centrality(G, k=<span class="number">1000</span>)</span><br><span class="line">res = dict(sorted(res.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="literal">True</span>))</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure><p><strong>e.g.</strong> ä»¥ç¾¤ï¼ˆ-1151413367ã€-1541749047ï¼‰ä¸ºæŒ‡å®šèŠ‚ç‚¹ï¼Œè®¡ç®—ä¸‰çº§å…³ç³»ç½‘å„èŠ‚ç‚¹ä¸­ä»‹ä¸­å¿ƒæ€§ï¼ˆæŠ›å¼ƒåº¦&lt;5çš„èŠ‚ç‚¹ï¼Œçªå‡ºç»“æ„ï¼‰</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/5.png" alt></p><h4 id="4-ç‰¹å¾å‘é‡ä¸­å¿ƒæ€§"><a href="#4-ç‰¹å¾å‘é‡ä¸­å¿ƒæ€§" class="headerlink" title="4.ç‰¹å¾å‘é‡ä¸­å¿ƒæ€§"></a>4.ç‰¹å¾å‘é‡ä¸­å¿ƒæ€§</h4><p>å…³ç³»ç½‘ç»œä¸­ä¸€ä¸ªèŠ‚ç‚¹çš„é‡è¦æ€§æ—¢å–å†³äºå…¶é‚»å±…èŠ‚ç‚¹çš„æ•°é‡ï¼ˆå³è¯¥èŠ‚ç‚¹çš„åº¦ï¼‰ï¼Œä¹Ÿå–å†³äºå…¶é‚»å±…èŠ‚ç‚¹çš„é‡è¦æ€§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res = nx.eigenvector_centrality(G)</span><br><span class="line">res = dict(sorted(res.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="literal">True</span>))</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure><p><strong>e.g.</strong> ä»¥ç¾¤ï¼ˆ-1151413367ã€-1541749047ï¼‰ä¸ºæŒ‡å®šèŠ‚ç‚¹ï¼Œè®¡ç®—ä¸‰çº§å…³ç³»ç½‘å„èŠ‚ç‚¹ç‰¹å¾å‘é‡ä¸­å¿ƒæ€§ï¼ˆæŠ›å¼ƒåº¦&lt;5çš„èŠ‚ç‚¹ï¼Œçªå‡ºç»“æ„ï¼‰</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/6.png" alt></p><h3 id="å››ã€é‡è¦æ€§"><a href="#å››ã€é‡è¦æ€§" class="headerlink" title="å››ã€é‡è¦æ€§"></a>å››ã€é‡è¦æ€§</h3><p><strong>è¾“å…¥ï¼š</strong></p><p><strong><font color="gold">Â·</font></strong> nä¸ªç¾¤ç»„ï¼ˆnâ‰¥1ï¼‰ï¼Œåˆ†æåŒ…æ‹¬æŒ‡å®šnä¸ªç¾¤ç»„ã€ç¾¤ç»„ç¾¤æˆå‘˜ã€ç¾¤æˆå‘˜æ‰€åŠ ç¾¤ç»„æˆå…³ç³»ç½‘å„èŠ‚ç‚¹çš„é‡è¦ç¨‹åº¦</p><p><strong><font color="gold">Â·</font></strong> nä¸ªè´¦å·ï¼ˆnâ‰¥1ï¼‰ï¼Œåˆ†æåŒ…æ‹¬æŒ‡å®šnä¸ªè´¦å·ã€è´¦å·æ‰€åŠ ç¾¤ã€ç¾¤æˆå‘˜ç»„æˆå…³ç³»ç½‘å„èŠ‚ç‚¹çš„é‡è¦ç¨‹åº¦</p><p><strong><font color="gold">Â·</font></strong> æŒ‡å®šå…³ç³»ç½‘ï¼Œåˆ†æå„èŠ‚ç‚¹çš„é‡è¦ç¨‹åº¦</p><h4 id="1-kæ ¸"><a href="#1-kæ ¸" class="headerlink" title="1.kæ ¸"></a>1.kæ ¸</h4><p>ç”¨äºåœ¨å›¾ä¸­å¯»æ‰¾ç¬¦åˆä¸€å®šç´§å¯†å…³ç³»æ¡ä»¶ï¼ˆKï¼‰çš„å­å›¾ç»“æ„çš„ç®—æ³•ï¼Œè¦æ±‚æ¯ä¸ªé¡¶ç‚¹è‡³å°‘ä¸è¯¥å­å›¾çš„å…¶ä»–Kä¸ªé¡¶ç‚¹å…³è”</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">res1 = nx.core_number(G)</span><br><span class="line">res2 = nx.k_core(G, <span class="number">6</span>)</span><br><span class="line">res1 = dict(sorted(res1.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="literal">True</span>))</span><br><span class="line">print(res1)</span><br><span class="line">print(list(res2))</span><br></pre></td></tr></table></figure><p><strong>e.g.</strong> ä»¥ç¾¤ï¼ˆ-1151413367ã€-1541749047ï¼‰ä¸ºæŒ‡å®šèŠ‚ç‚¹ï¼Œè®¡ç®—ä¸‰çº§å…³ç³»ç½‘å„èŠ‚ç‚¹k-coreå€¼ï¼Œç»“åˆlouvainç¤¾åŒºä¸Šè‰²ï¼ˆå…¨å›¾ï¼‰</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/7.png" alt></p><h4 id="2-PageRank"><a href="#2-PageRank" class="headerlink" title="2.PageRank"></a>2.PageRank</h4><p>è¡¡é‡å›¾ä¸­èŠ‚ç‚¹é‡è¦æ€§çš„æŒ‡æ ‡ï¼Œå€¼è¶Šé«˜ï¼Œå›¾ä¸­è®¿é—®è¯¥èŠ‚ç‚¹çš„æ¦‚ç‡è¶Šé«˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res = nx.pagerank(G, alpha=<span class="number">0.85</span>)</span><br><span class="line">res = dict(sorted(res.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="literal">True</span>))</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure><p><strong>e.g.1.</strong> ä»¥ç¾¤ï¼ˆ-1151413367ã€-1541749047ï¼‰ä¸ºæŒ‡å®šèŠ‚ç‚¹ï¼Œè®¡ç®—ä¸‰çº§å…³ç³»ç½‘å„èŠ‚ç‚¹pagerankå€¼ï¼ˆæŠ›å¼ƒåº¦&lt;5çš„èŠ‚ç‚¹ï¼Œçªå‡ºç»“æ„ï¼‰</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/8.png" alt></p><p><strong>e.g.2.</strong> ä»¥ç¾¤ï¼ˆ-1151413367ã€-1541749047ï¼‰ä¸ºæŒ‡å®šèŠ‚ç‚¹ï¼Œè®¡ç®—ä¸‰çº§å…³ç³»ç½‘å„èŠ‚ç‚¹pagerankå€¼ï¼Œç»“åˆlouvainç¤¾åŒºï¼ˆå…¨å›¾ï¼‰</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/9.png" alt></p><h3 id="äº”ã€èšç±»ç®—æ³•"><a href="#äº”ã€èšç±»ç®—æ³•" class="headerlink" title="äº”ã€èšç±»ç®—æ³•"></a>äº”ã€èšç±»ç®—æ³•</h3><p><strong>è¾“å…¥ï¼ˆç¤¾åŒºå‘ç°ï¼‰ï¼š</strong></p><p><strong><font color="gold">Â·</font></strong> nä¸ªç¾¤ç»„ï¼ˆnâ‰¥1ï¼‰ï¼Œåˆ’åˆ†åŒ…æ‹¬æŒ‡å®šnä¸ªç¾¤ç»„ã€ç¾¤ç»„ç¾¤æˆå‘˜ã€ç¾¤æˆå‘˜æ‰€åŠ ç¾¤ç»„æˆå…³ç³»ç½‘çš„å„ä¸ªç¤¾åŒº</p><p><strong><font color="gold">Â·</font></strong> nä¸ªè´¦å·ï¼ˆnâ‰¥1ï¼‰ï¼Œåˆ’åˆ†åŒ…æ‹¬æŒ‡å®šnä¸ªè´¦å·ã€è´¦å·æ‰€åŠ ç¾¤ã€ç¾¤æˆå‘˜ç»„æˆå…³ç³»ç½‘çš„å„ä¸ªç¤¾åŒº</p><p><strong><font color="gold">Â·</font></strong> åˆ’åˆ†æŒ‡å®šå…³ç³»ç½‘å„èŠ‚ç‚¹çš„ç¤¾åŒº</p><p><strong>è¾“å…¥ï¼ˆä¸‰è§’å½¢è®¡æ•°ï¼‰ï¼š</strong></p><p><strong><font color="gold">Â·</font></strong> nä¸ªç¾¤ç»„ï¼ˆnâ‰¥1ï¼‰ï¼Œè®¡ç®—åŒ…æ‹¬æŒ‡å®šnä¸ªç¾¤ç»„ã€ç¾¤ç»„ç¾¤æˆå‘˜ã€ç¾¤æˆå‘˜å¥½å‹ã€ç¾¤æˆå‘˜æ‰€åŠ ç¾¤ç»„ã€ç¾¤æˆå‘˜æ‰€åŠ ç¾¤ç»„æˆå…³ç³»ç½‘çš„ä¸‰è§’å½¢æ•°é‡ï¼ŒæŒ–æ˜å›¢ä½“å…³ç³»</p><p><strong><font color="gold">Â·</font></strong> è®¡ç®—æŒ‡å®šå…³ç³»ç½‘å„èŠ‚ç‚¹çš„ä¸‰è§’å½¢æ•°é‡ï¼ŒæŒ–æ˜å›¢ä½“å…³ç³»</p><p>ç”¨äºè®¡ç®—å›¾è°±ä¸­ä¸‰è§’å…³ç³»æ•°é‡ï¼ŒæŒ–æ˜å…³ç³»å›¢ä½“</p><p><strong>ClickHouse SQLç¤ºä¾‹ï¼ˆä¸‰è§’å½¢è®¡æ•°ï¼‰ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> T <span class="keyword">AS</span>(<span class="comment">-- æŒ‡å®šç¾¤ç¾¤æˆå‘˜</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> team_id,account_id <span class="keyword">FROM</span> mqv3.ly_team_ship PREWHERE team_id = <span class="string">'&#123;src_vid&#125;'</span></span><br><span class="line">),T1 <span class="keyword">AS</span>(<span class="comment">-- æŒ‡å®šç¾¤ç¾¤æˆå‘˜çš„å¥½å‹</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> account_id,fri_account_id <span class="keyword">FROM</span> mqv3.ly_account_ship PREWHERE account_id <span class="keyword">GLOBAL</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> account_id <span class="keyword">FROM</span> T) </span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">DISTINCT</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> fri_account_id,account_id <span class="keyword">FROM</span> mqv3.ly_account_ship PREWHERE fri_account_id <span class="keyword">GLOBAL</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> account_id <span class="keyword">FROM</span> T)</span><br><span class="line">),T2 <span class="keyword">AS</span>(<span class="comment">-- ç¾¤æˆå‘˜æ‰€åŠ ç¾¤</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> team_id,account_id <span class="keyword">FROM</span> mqv3.ly_team_ship PREWHERE account_id <span class="keyword">GLOBAL</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> account_id <span class="keyword">FROM</span> T)</span><br><span class="line">),T3 <span class="keyword">AS</span>(<span class="comment">-- ç¾¤æˆå‘˜æ‰€åŠ ç¾¤å’Œç¾¤æˆå‘˜å’Œç¾¤æˆå‘˜çš„å¥½å‹</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> team_id,account_id,fri_account_id <span class="keyword">FROM</span> T2 <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> T1 <span class="keyword">ON</span> T2.account_id = T1.account_id</span><br><span class="line">),T4 <span class="keyword">AS</span>(<span class="comment">-- ç¾¤æˆå‘˜å¥½å‹æ‰€åŠ ç¾¤</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> team_id,account_id <span class="keyword">AS</span> fri_account_id <span class="keyword">FROM</span> mqv3.ly_team_ship lts PREWHERE lts.account_id <span class="keyword">GLOBAL</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> fri_account_id <span class="keyword">FROM</span> T1)</span><br><span class="line">),T5 <span class="keyword">AS</span>(<span class="comment">-- å…±åŒæ‰€åŠ ç¾¤</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> team_id,account_id,fri_account_id <span class="keyword">FROM</span> T3 <span class="keyword">JOIN</span> T4 <span class="keyword">ON</span> (T3.team_id = T4.team_id <span class="keyword">AND</span> T3.fri_account_id = T4.fri_account_id)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">DISTINCT</span> team_id,account_id,fri_account_id <span class="keyword">from</span> T5</span><br></pre></td></tr></table></figure><h4 id="1-æ ‡ç­¾ä¼ æ’­ï¼ˆLPAç¤¾åŒºå‘ç°ï¼‰"><a href="#1-æ ‡ç­¾ä¼ æ’­ï¼ˆLPAç¤¾åŒºå‘ç°ï¼‰" class="headerlink" title="1.æ ‡ç­¾ä¼ æ’­ï¼ˆLPAç¤¾åŒºå‘ç°ï¼‰"></a>1.æ ‡ç­¾ä¼ æ’­ï¼ˆLPAç¤¾åŒºå‘ç°ï¼‰</h4><p>åŸºäºlpaçš„ç¤¾åŒºåˆ’åˆ†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = nx.algorithms.community.label_propagation_communities(G)</span><br><span class="line">print(list(res))</span><br></pre></td></tr></table></figure><p><strong>e.g.</strong>ä»¥ç¾¤ï¼ˆ-1151413367ã€-1541749047ï¼‰ä¸ºæŒ‡å®šèŠ‚ç‚¹ï¼Œåˆ’åˆ†lpaæ ‡ç­¾ä¼ æ’­ç¤¾åŒºï¼ˆæŠ›å¼ƒåº¦&lt;5çš„èŠ‚ç‚¹ï¼Œçªå‡ºç»“æ„ï¼‰</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/10.png" alt></p><h4 id="2-é²æ±¶ï¼ˆLouvainç¤¾åŒºå‘ç°ï¼‰"><a href="#2-é²æ±¶ï¼ˆLouvainç¤¾åŒºå‘ç°ï¼‰" class="headerlink" title="2.é²æ±¶ï¼ˆLouvainç¤¾åŒºå‘ç°ï¼‰"></a>2.é²æ±¶ï¼ˆLouvainç¤¾åŒºå‘ç°ï¼‰</h4><p>åŸºäºlouvainçš„ç¤¾åŒºåˆ’åˆ†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = nx.algorithms.community.louvain_communities(G, resolution=<span class="number">0.5</span>)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure><p><strong>e.g.1.</strong>ä»¥ç¾¤ï¼ˆ-1151413367ã€-1541749047ï¼‰ä¸ºæŒ‡å®šèŠ‚ç‚¹ï¼Œåˆ’åˆ†louvainé²æ±¶ç¤¾åŒºï¼ˆresolution=1ï¼ŒæŠ›å¼ƒåº¦&lt;5çš„èŠ‚ç‚¹ï¼Œçªå‡ºç»“æ„ï¼‰</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/11.png" alt></p><p><strong>e.g.2.</strong>ä»¥ç¾¤ï¼ˆ-1151413367ã€-1541749047ï¼‰ä¸ºæŒ‡å®šèŠ‚ç‚¹ï¼Œåˆ’åˆ†louvainé²æ±¶ç¤¾åŒºï¼ˆresolution=0.3ï¼ŒæŠ›å¼ƒåº¦&lt;5çš„èŠ‚ç‚¹ï¼Œçªå‡ºç»“æ„ï¼‰</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/12.png" alt></p><h4 id="3-ä¸‰è§’å½¢è®¡æ•°"><a href="#3-ä¸‰è§’å½¢è®¡æ•°" class="headerlink" title="3.ä¸‰è§’å½¢è®¡æ•°"></a>3.ä¸‰è§’å½¢è®¡æ•°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res = nx.triangles(G)</span><br><span class="line">res = dict(sorted(res.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="literal">True</span>))</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure><p><strong>e.g.</strong>ä»¥ç¾¤ï¼ˆ-1151413367ã€-1541749047ï¼‰ä¸ºæŒ‡å®šèŠ‚ç‚¹ï¼Œè®¡ç®—å…³ç³»ç½‘ä¸­å„ä¸ªèŠ‚ç‚¹ä¸‰è§’å½¢æ•°é‡ï¼ˆæŠ›å¼ƒåº¦&lt;5çš„èŠ‚ç‚¹ï¼Œçªå‡ºç»“æ„ï¼‰</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/13.png" alt></p><h3 id="å…­ã€è¿é€šæ€§"><a href="#å…­ã€è¿é€šæ€§" class="headerlink" title="å…­ã€è¿é€šæ€§"></a>å…­ã€è¿é€šæ€§</h3><p><strong>è¾“å…¥ï¼š</strong></p><p><strong><font color="gold">Â·</font></strong> æŒ‡å®šnä¸ªç¾¤ç»„ï¼ˆnâ‰¥2ï¼‰ï¼Œåˆ¤æ–­ç¾¤ç»„ã€ç¾¤æˆå‘˜ã€ç¾¤æˆå‘˜æ‰€åŠ ç¾¤æ‰€ç»„å…³ç³»ç½‘æ˜¯å¦ä¸ºè¿é€šå›¾</p><p><strong><font color="gold">Â·</font></strong> æŒ‡å®šnä¸ªè´¦å·ï¼ˆnâ‰¥2ï¼‰ï¼Œåˆ¤æ–­è´¦å·ã€è´¦å·æ‰€åŠ ç¾¤ã€ç¾¤æˆå‘˜æ‰€ç»„å…³ç³»ç½‘æ˜¯å¦ä¸ºè¿é€šå›¾</p><p><strong><font color="gold">Â·</font></strong> æŒ‡å®šå…³ç³»ç½‘</p><h4 id="1-è¿é€šæ€§æ£€æµ‹"><a href="#1-è¿é€šæ€§æ£€æµ‹" class="headerlink" title="1.è¿é€šæ€§æ£€æµ‹"></a>1.è¿é€šæ€§æ£€æµ‹</h4><p>åˆ¤æ–­ç›®æ ‡å›¾è°±æ˜¯å¦ä¸ºè¿é€šå›¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res1 = nx.is_connected(G)</span><br><span class="line">print(res1)</span><br></pre></td></tr></table></figure><p><strong>e.g.1.</strong>è¿é€šå›¾</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/14.png" alt></p><p><strong>e.g.2.</strong>éè¿é€šå›¾</p><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/15.png" alt></p><h4 id="2-è”é€šç»„ä»¶æ•°"><a href="#2-è”é€šç»„ä»¶æ•°" class="headerlink" title="2.è”é€šç»„ä»¶æ•°"></a>2.è”é€šç»„ä»¶æ•°</h4><p>åˆ¤æ–­ç›®æ ‡å›¾è°±ä¸­è”é€šç»„ä»¶çš„æ•°é‡ï¼ˆnï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res2 = nx.number_connected_components(G)</span><br><span class="line">print(res2)</span><br></pre></td></tr></table></figure><h4 id="3-è”é€šç»„ä»¶"><a href="#3-è”é€šç»„ä»¶" class="headerlink" title="3.è”é€šç»„ä»¶"></a>3.è”é€šç»„ä»¶</h4><p>æ˜¾ç¤ºç›®æ ‡å›¾è°±ä¸­çš„å…¨éƒ¨è”é€šç»„ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res3 = nx.connected_components(G)</span><br><span class="line">print(res3)</span><br></pre></td></tr></table></figure><h4 id="4-æŒ‡å®šèŠ‚ç‚¹è”é€šç»„ä»¶"><a href="#4-æŒ‡å®šèŠ‚ç‚¹è”é€šç»„ä»¶" class="headerlink" title="4.æŒ‡å®šèŠ‚ç‚¹è”é€šç»„ä»¶"></a>4.æŒ‡å®šèŠ‚ç‚¹è”é€šç»„ä»¶</h4><p>æ˜¾ç¤ºç›®æ ‡å›¾è°±ä¸­æŒ‡å®šèŠ‚ç‚¹æ‰€åœ¨çš„è”é€šç»„ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res4 = nx.node_connected_component(G, <span class="string">"sample_node"</span>)</span><br><span class="line">print(res4)</span><br></pre></td></tr></table></figure><h3 id="ä¸ƒã€å‡ ä½•"><a href="#ä¸ƒã€å‡ ä½•" class="headerlink" title="ä¸ƒã€å‡ ä½•"></a>ä¸ƒã€å‡ ä½•</h3><p><strong>è¾“å…¥ï¼š</strong></p><p><strong><font color="gold">Â·</font></strong> æŒ‡å®šnä¸ªç¾¤ç»„ï¼ˆnâ‰¥2ï¼‰ï¼Œè®¡ç®—ç¾¤ç»„ã€ç¾¤æˆå‘˜ã€ç¾¤æˆå‘˜æ‰€åŠ ç¾¤æ‰€ç»„å…³ç³»ç½‘çš„ä¸­å¿ƒã€é‡å¿ƒ</p><p><strong><font color="gold">Â·</font></strong> æŒ‡å®šnä¸ªè´¦å·ï¼ˆnâ‰¥2ï¼‰ï¼Œè®¡ç®—è´¦å·ã€è´¦å·æ‰€åŠ ç¾¤ã€ç¾¤æˆå‘˜æ‰€ç»„å…³ç³»ç½‘çš„ä¸­å¿ƒã€é‡å¿ƒ</p><p><strong><font color="gold">Â·</font></strong> è®¡ç®—æŒ‡å®šå…³ç³»ç½‘å‡ ä½•ä¸­å¿ƒã€é‡å¿ƒ</p><h4 id="1-å‡ ä½•é‡å¿ƒ"><a href="#1-å‡ ä½•é‡å¿ƒ" class="headerlink" title="1.å‡ ä½•é‡å¿ƒ"></a>1.å‡ ä½•é‡å¿ƒ</h4><p>å›¾çš„é‡å¿ƒèŠ‚ç‚¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res1 = nx.barycenter(G)</span><br><span class="line">print(res1)</span><br></pre></td></tr></table></figure><h4 id="2-å‡ ä½•ä¸­å¿ƒ"><a href="#2-å‡ ä½•ä¸­å¿ƒ" class="headerlink" title="2.å‡ ä½•ä¸­å¿ƒ"></a>2.å‡ ä½•ä¸­å¿ƒ</h4><p>å›¾çš„ä¸­å¿ƒèŠ‚ç‚¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res2 = nx.center(G)</span><br><span class="line">print(res2)</span><br></pre></td></tr></table></figure><h2 id="ç»˜å›¾"><a href="#ç»˜å›¾" class="headerlink" title="ç»˜å›¾"></a>ç»˜å›¾</h2><p><strong>e.g.</strong> ä¸­å¿ƒä¸­å¿ƒæ€§ + LPAæ ‡ç­¾ä¼ æ’­ç®—æ³•èšç±»</p><p>æ•°æ®æºï¼š<a href="https://www.inetbio.org/wormnet/downloadnetwork.php" target="_blank" rel="noopener">https://www.inetbio.org/wormnet/downloadnetwork.php</a></p><p><strong><font color="gold">Â·</font></strong> WormNet v.3-GS (<a href="https://www.inetbio.org/wormnet/download.php?type=2" target="_blank" rel="noopener">https://www.inetbio.org/wormnet/download.php?type=2</a>)</p><p> å®Œæ•´ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> sample</span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Gold standard data of positive gene functional associations</span></span><br><span class="line"><span class="comment"># from https://www.inetbio.org/wormnet/downloadnetwork.php</span></span><br><span class="line">G = nx.read_edgelist(<span class="string">"WormNet.v3.benchmark.txt"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># remove randomly selected nodes (to make example fast)</span></span><br><span class="line">num_to_remove = int(len(G) / <span class="number">1.5</span>)</span><br><span class="line">nodes = sample(list(G.nodes), num_to_remove)</span><br><span class="line">G.remove_nodes_from(nodes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># remove low-degree nodes</span></span><br><span class="line">low_degree = [n <span class="keyword">for</span> n, d <span class="keyword">in</span> G.degree() <span class="keyword">if</span> d &lt; <span class="number">10</span>]</span><br><span class="line">G.remove_nodes_from(low_degree)</span><br><span class="line"></span><br><span class="line"><span class="comment"># largest connected component</span></span><br><span class="line">components = nx.connected_components(G)</span><br><span class="line">largest_component = max(components, key=len)</span><br><span class="line">H = G.subgraph(largest_component)</span><br><span class="line"></span><br><span class="line"><span class="comment"># compute centrality</span></span><br><span class="line">centrality = nx.betweenness_centrality(H, k=<span class="number">10</span>, endpoints=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># compute community structure</span></span><br><span class="line">lpc = nx.community.label_propagation_communities(H)</span><br><span class="line">community_index = &#123;n: i <span class="keyword">for</span> i, com <span class="keyword">in</span> enumerate(lpc) <span class="keyword">for</span> n <span class="keyword">in</span> com&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#### draw graph ####</span></span><br><span class="line">fig, ax = plt.subplots(figsize=(<span class="number">20</span>, <span class="number">15</span>))</span><br><span class="line">pos = nx.spring_layout(H, k=<span class="number">0.15</span>, seed=<span class="number">4572321</span>)</span><br><span class="line">node_color = [community_index[n] <span class="keyword">for</span> n <span class="keyword">in</span> H]</span><br><span class="line">node_size = [v * <span class="number">20000</span> <span class="keyword">for</span> v <span class="keyword">in</span> centrality.values()]</span><br><span class="line">nx.draw_networkx(</span><br><span class="line">    H,</span><br><span class="line">    pos=pos,</span><br><span class="line">    with_labels=<span class="literal">False</span>,</span><br><span class="line">    node_color=node_color,</span><br><span class="line">    node_size=node_size,</span><br><span class="line">    edge_color=<span class="string">"gainsboro"</span>,</span><br><span class="line">    alpha=<span class="number">0.4</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Title/legend</span></span><br><span class="line">font = &#123;<span class="string">"color"</span>: <span class="string">"k"</span>, <span class="string">"fontweight"</span>: <span class="string">"bold"</span>, <span class="string">"fontsize"</span>: <span class="number">20</span>&#125;</span><br><span class="line">ax.set_title(<span class="string">"Gene functional association network (C. elegans)"</span>, font)</span><br><span class="line"><span class="comment"># Change font color for legend</span></span><br><span class="line">font[<span class="string">"color"</span>] = <span class="string">"r"</span></span><br><span class="line"></span><br><span class="line">ax.text(</span><br><span class="line">    <span class="number">0.80</span>,</span><br><span class="line">    <span class="number">0.10</span>,</span><br><span class="line">    <span class="string">"node color = community structure"</span>,</span><br><span class="line">    horizontalalignment=<span class="string">"center"</span>,</span><br><span class="line">    transform=ax.transAxes,</span><br><span class="line">    fontdict=font,</span><br><span class="line">)</span><br><span class="line">ax.text(</span><br><span class="line">    <span class="number">0.80</span>,</span><br><span class="line">    <span class="number">0.06</span>,</span><br><span class="line">    <span class="string">"node size = betweeness centrality"</span>,</span><br><span class="line">    horizontalalignment=<span class="string">"center"</span>,</span><br><span class="line">    transform=ax.transAxes,</span><br><span class="line">    fontdict=font,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Resize figure for label readibility</span></span><br><span class="line">ax.margins(<span class="number">0.1</span>, <span class="number">0.05</span>)</span><br><span class="line">fig.tight_layout()</span><br><span class="line">plt.axis(<span class="string">"off"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/16.png" alt></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;NetworkX&quot;&gt;&lt;a href=&quot;#NetworkX&quot; class=&quot;headerlink&quot; title=&quot;NetworkX&quot;&gt;&lt;/a&gt;NetworkX&lt;/h2&gt;&lt;p&gt;NetworkXæ˜¯ä¸€æ¬¾Pythonçš„è½¯ä»¶åŒ…ï¼Œç”¨äºåˆ›é€ ã€æ“ä½œå¤æ‚ç½‘ç»œï¼Œä»¥åŠå­¦ä¹ å¤æ‚ç½‘ç»œçš„ç»“æ„ã€åŠ¨åŠ›å­¦åŠå…¶åŠŸèƒ½ã€‚æœ‰äº†NetworkXå°±å¯ä»¥ç”¨æ ‡å‡†æˆ–è€…ä¸æ ‡å‡†çš„æ•°æ®æ ¼å¼åŠ è½½æˆ–è€…å­˜å‚¨ç½‘ç»œï¼Œå®ƒå¯ä»¥äº§ç”Ÿè®¸å¤šç§ç±»çš„éšæœºç½‘ç»œæˆ–ç»å…¸ç½‘ç»œï¼Œä¹Ÿå¯ä»¥åˆ†æç½‘ç»œç»“æ„ã€å»ºç«‹ç½‘ç»œæ¨¡å‹ã€è®¾è®¡æ–°çš„ç½‘ç»œç®—æ³•ã€ç»˜åˆ¶ç½‘ç»œç­‰&lt;/p&gt;
&lt;p&gt;å‚è€ƒæ–‡çŒ®åœ°å€: &lt;a href=&quot;https://www.osgeo.cn/networkx/reference/index.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.osgeo.cn/networkx/reference/index.html&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;å›¾è®¡ç®—åº”ç”¨æ–¹å¼æ¯”è¾ƒ&quot;&gt;&lt;a href=&quot;#å›¾è®¡ç®—åº”ç”¨æ–¹å¼æ¯”è¾ƒ&quot; class=&quot;headerlink&quot; title=&quot;å›¾è®¡ç®—åº”ç”¨æ–¹å¼æ¯”è¾ƒ&quot;&gt;&lt;/a&gt;å›¾è®¡ç®—åº”ç”¨æ–¹å¼æ¯”è¾ƒ&lt;/h2&gt;&lt;h3 id=&quot;1-nebula-spark&quot;&gt;&lt;a href=&quot;#1-nebula-spark&quot; class=&quot;headerlink&quot; title=&quot;1.nebula + spark&quot;&gt;&lt;/a&gt;1.nebula + spark&lt;/h3&gt;&lt;p&gt;ä¾èµ–nebula-spark-connectoråŒ…ã€nebula-algorithmåŒ…å’Œsparké›†ç¾¤çš„æ•°æ®è¯»å–ã€å›¾è®¡ç®—æ–¹å¼&lt;/p&gt;
&lt;h3 id=&quot;2-clickhouse-NetworkX&quot;&gt;&lt;a href=&quot;#2-clickhouse-NetworkX&quot; class=&quot;headerlink&quot; title=&quot;2.clickhouse + NetworkX&quot;&gt;&lt;/a&gt;2.clickhouse + NetworkX&lt;/h3&gt;&lt;p&gt;ç”±äºnebula-algorithmä¾èµ–sparké›†ç¾¤ï¼Œä¸”nebula-consoleåŸç”Ÿçš„æ•°æ®è¯»å–èƒ½åŠ›ä¸ä½³ï¼Œåœ¨ç¯å¢ƒå—é™ä¸”è®¡ç®—é‡æœ‰é™çš„æƒ…å†µä¸‹ä¼˜å…ˆè€ƒè™‘è·³è¿‡sparké›†ç¾¤å’Œnebulaå›¾åº“ï¼Œé‡‡ç”¨clickhouse + NetworkXçš„å›¾è®¡ç®—æ–¹å¼ï¼Œå…¶ä¸­clickhouseæ˜¯å­˜å‚¨äº†nebulaæºæ•°æ®çš„åˆ—å¼åˆ†å¸ƒå¼è¡¨ï¼Œä½œç”¨ç±»ä¼¼äºæ–¹æ³•1ä¸­å°†nebulaé›†ç¾¤æ•°æ®é€šè¿‡nebula-spark-connectoråŒ…å¯¼å…¥ä¸ºspark-DataFrameï¼Œä»…ç”¨åšæ•°æ®è¯»å–ï¼Œå†é€šè¿‡å°†æ•°æ®è½¬åŒ–ä¸ºNetworkXçš„å›¾ç»“æ„è¿›è¡Œå›¾è®¡ç®—&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2024/01/08/NetworkX-å›¾è®ºç®—æ³•åº”ç”¨/9.png&quot; alt&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="NetworkX" scheme="http://yoursite.com/categories/NetworkX/"/>
    
    
    <category term="nebula" scheme="http://yoursite.com/tags/nebula/"/>
    
    <category term="å›¾ç®—æ³•" scheme="http://yoursite.com/tags/å›¾ç®—æ³•/"/>
    
    <category term="networkx" scheme="http://yoursite.com/tags/networkx/"/>
    
  </entry>
  
  <entry>
    <title>CentOS-LibreOfficeå·¥å…·åŒ…å®‰è£…</title>
    <link href="http://yoursite.com/2023/12/28/CentOS-LibreOffice%E5%B7%A5%E5%85%B7%E5%8C%85%E5%AE%89%E8%A3%85/"/>
    <id>http://yoursite.com/2023/12/28/CentOS-LibreOffice%E5%B7%A5%E5%85%B7%E5%8C%85%E5%AE%89%E8%A3%85/</id>
    <published>2023-12-28T06:43:49.000Z</published>
    <updated>2023-12-28T07:05:48.623Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><p><strong>Â·</strong> <font color="gold">ç³»ç»Ÿï¼š</font> CentOS7</p><p><strong>Â·</strong> <font color="gold">LibreOfficeï¼š</font> 7.4.5.1 ç¨³å®šç‰ˆ</p><h2 id="èµ„æºä¸‹è½½"><a href="#èµ„æºä¸‹è½½" class="headerlink" title="èµ„æºä¸‹è½½"></a>èµ„æºä¸‹è½½</h2><p><strong>Â·</strong> å®˜æ–¹ç½‘ç«™ï¼š <a href="https://zh-cn.libreoffice.org/download/libreoffice/" target="_blank" rel="noopener">https://zh-cn.libreoffice.org/download/libreoffice/</a></p><p><strong>Â·</strong> ä¸‹è½½åœ°å€ï¼š<a href="https://downloadarchive.documentfoundation.org/libreoffice/old/7.4.5.1/rpm/x86_64/" target="_blank" rel="noopener">https://downloadarchive.documentfoundation.org/libreoffice/old/7.4.5.1/rpm/x86_64/</a></p><p>é€‰æ‹©<code>LibreOffice_7.4.5.1_Linux_x86-64_rpm.tar.gz</code>å®‰è£…åŒ…å’Œ<code>LibreOffice_7.4.5.1_Linux_x86-64_rpm_langpack_zh-CN.tar.gz</code>ä¸­æ–‡è¯­è¨€åŒ…å¹¶ä¸‹è½½</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>è¿›å…¥å®‰è£…åŒ…ä¸‹è½½ç›®å½•è¿›è¡Œè§£å‹ï¼Œè¿™é‡Œä¸º<code>/usr/local/</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/   è¿›å…¥ç›®å½•</span><br><span class="line">tar -zxvf LibreOffice_7.4.6.1_Linux_x86-64_rpm.tar.gz   è§£å‹libreoffice</span><br><span class="line">tar -zxvf LibreOffice7.4.6.1_Linux_x86-64_rpm_langpack_zh-CN.tar.gz   è§£å‹ä¸­æ–‡è¯­è¨€åŒ…</span><br></pre></td></tr></table></figure><p>å®‰è£…<code>libreoffice</code>å’Œè¯­è¨€åŒ…çš„rpmåŒ…ï¼Œé»˜è®¤å®‰è£…ç›®å½•ä¸º<code>/opt/libreoffice7.4</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/LibreOffice_7.4.6.1_Linux_x86-64_rpm/RPMS/</span><br><span class="line">yum -y install *.rpm</span><br><span class="line">cd /usr/local/LibreOffice_7.4.6.1_Linux_x86-64_rpm_langpack_zh-CN/RPMS</span><br><span class="line">yum -y install *.rpm</span><br></pre></td></tr></table></figure><p>å®‰è£…<code>soffice</code>ï¼Œè¿›å…¥<code>/opt/libreoffice7.4/program</code>ç›®å½•æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/libreoffice7.4/program/</span><br><span class="line">yum install cairo </span><br><span class="line">yum install cups-libs</span><br><span class="line">yum install libSM</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/libreoffice7.4/program/soffice -help</span><br></pre></td></tr></table></figure><p>æ­£å¸¸è¾“å‡ºï¼Œå®‰è£…æˆåŠŸï¼Œæ¥ä¸‹æ¥å°†<code>soffice</code>æ·»åŠ åˆ°ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> libreoffice</span><br><span class="line">export LibreOffice_PATH=/opt/libreoffice7.4/program</span><br><span class="line">export PATH=$LibreOffice_PATH:$PATH</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="å®‰è£…ä¸­æ–‡å­—ä½“åŒ…"><a href="#å®‰è£…ä¸­æ–‡å­—ä½“åŒ…" class="headerlink" title="å®‰è£…ä¸­æ–‡å­—ä½“åŒ…"></a>å®‰è£…ä¸­æ–‡å­—ä½“åŒ…</h2><p>windowsç³»ç»Ÿå­—ä½“åŒ…ä½äºè·¯å¾„<code>C:\Windows\Font</code>ä¸‹</p><p>centosç³»ç»Ÿå­—ä½“åŒ…ä½äºè·¯å¾„<code>/usr/share/fonts</code>ä¸‹</p><p>è¿›å…¥<code>/usr/share/fonts</code>åˆ›å»ºwindowsç³»ç»Ÿå­—ä½“åŒ…ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/fonts/</span><br><span class="line">mkdir windowsFont</span><br></pre></td></tr></table></figure><p>å°†windowså­—ä½“æ–‡ä»¶å…¨éƒ¨æ‹·è´è¿›è¯¥è·¯å¾„ä¸‹ï¼Œæ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkfontscale</span><br><span class="line">mkfontdir</span><br><span class="line">fc-cache</span><br></pre></td></tr></table></figure><p>å®Œæˆï¼å¯ä»¥åœ¨linuxç³»ç»Ÿä¸‹é¡ºåˆ©æ“ä½œ<code>.docs</code>ã€<code>.pdf</code>ç­‰æ–‡æ¡£æ–‡ä»¶ï¼Œåœ¨langchain-chatchatä¸­æ·»åŠ æ–‡æ¡£å½¢çŸ¥è¯†åº“ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; &lt;font color=&quot;gold&quot;&gt;ç³»ç»Ÿï¼š&lt;/font&gt; CentOS7&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; &lt;font color=&quot;gold&quot;&gt;LibreOfficeï¼š&lt;/font&gt; 7.4.5.1 ç¨³å®šç‰ˆ&lt;/p&gt;
&lt;h2 id=&quot;èµ„æºä¸‹è½½&quot;&gt;&lt;a href=&quot;#èµ„æºä¸‹è½½&quot; class=&quot;headerlink&quot; title=&quot;èµ„æºä¸‹è½½&quot;&gt;&lt;/a&gt;èµ„æºä¸‹è½½&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; å®˜æ–¹ç½‘ç«™ï¼š &lt;a href=&quot;https://zh-cn.libreoffice.org/download/libreoffice/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://zh-cn.libreoffice.org/download/libreoffice/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; ä¸‹è½½åœ°å€ï¼š&lt;a href=&quot;https://downloadarchive.documentfoundation.org/libreoffice/old/7.4.5.1/rpm/x86_64/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://downloadarchive.documentfoundation.org/libreoffice/old/7.4.5.1/rpm/x86_64/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é€‰æ‹©&lt;code&gt;LibreOffice_7.4.5.1_Linux_x86-64_rpm.tar.gz&lt;/code&gt;å®‰è£…åŒ…å’Œ&lt;code&gt;LibreOffice_7.4.5.1_Linux_x86-64_rpm_langpack_zh-CN.tar.gz&lt;/code&gt;ä¸­æ–‡è¯­è¨€åŒ…å¹¶ä¸‹è½½&lt;/p&gt;
&lt;h2 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h2&gt;&lt;p&gt;è¿›å…¥å®‰è£…åŒ…ä¸‹è½½ç›®å½•è¿›è¡Œè§£å‹ï¼Œè¿™é‡Œä¸º&lt;code&gt;/usr/local/&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cd /usr/local/   è¿›å…¥ç›®å½•&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tar -zxvf LibreOffice_7.4.6.1_Linux_x86-64_rpm.tar.gz   è§£å‹libreoffice&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tar -zxvf LibreOffice7.4.6.1_Linux_x86-64_rpm_langpack_zh-CN.tar.gz   è§£å‹ä¸­æ–‡è¯­è¨€åŒ…&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å®‰è£…&lt;code&gt;libreoffice&lt;/code&gt;å’Œè¯­è¨€åŒ…çš„rpmåŒ…ï¼Œé»˜è®¤å®‰è£…ç›®å½•ä¸º&lt;code&gt;/opt/libreoffice7.4&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cd /usr/local/LibreOffice_7.4.6.1_Linux_x86-64_rpm/RPMS/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum -y install *.rpm&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd /usr/local/LibreOffice_7.4.6.1_Linux_x86-64_rpm_langpack_zh-CN/RPMS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum -y install *.rpm&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å®‰è£…&lt;code&gt;soffice&lt;/code&gt;ï¼Œè¿›å…¥&lt;code&gt;/opt/libreoffice7.4/program&lt;/code&gt;ç›®å½•æ‰§è¡Œ&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cd /opt/libreoffice7.4/program/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install cairo &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install cups-libs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install libSM&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ£€æŸ¥&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;/opt/libreoffice7.4/program/soffice -help&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ­£å¸¸è¾“å‡ºï¼Œå®‰è£…æˆåŠŸï¼Œæ¥ä¸‹æ¥å°†&lt;code&gt;soffice&lt;/code&gt;æ·»åŠ åˆ°ç¯å¢ƒå˜é‡&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;vim /etc/profile&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt; libreoffice&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;export LibreOffice_PATH=/opt/libreoffice7.4/program&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;export PATH=$LibreOffice_PATH:$PATH&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;source /etc/profile&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
    <category term="linuxå·¥å…·" scheme="http://yoursite.com/tags/linuxå·¥å…·/"/>
    
    <category term="LibreOffice" scheme="http://yoursite.com/tags/LibreOffice/"/>
    
  </entry>
  
  <entry>
    <title>LangChain + ChatGLM2-6Bçš„æœ¬åœ°çŸ¥è¯†é—®ç­”åº“</title>
    <link href="http://yoursite.com/2023/10/24/LangChain%20+%20ChatGLM2-6B%E7%9A%84%E6%9C%AC%E5%9C%B0%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94%E5%BA%93/"/>
    <id>http://yoursite.com/2023/10/24/LangChain%20+%20ChatGLM2-6B%E7%9A%84%E6%9C%AC%E5%9C%B0%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94%E5%BA%93/</id>
    <published>2023-10-24T01:14:34.000Z</published>
    <updated>2023-11-06T08:31:28.442Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><p>åŸé¡¹ç›®Githubï¼š<a href="https://github.com/imClumsyPanda/langchain-ChatGLM" target="_blank" rel="noopener">https://github.com/imClumsyPanda/langchain-ChatGLM</a></p><h2 id="é¡¹ç›®éƒ¨ç½²"><a href="#é¡¹ç›®éƒ¨ç½²" class="headerlink" title="é¡¹ç›®éƒ¨ç½²"></a>é¡¹ç›®éƒ¨ç½²</h2><p><strong>Â·</strong> <font color="gold">v 0.2.6</font></p><h3 id="æœºå™¨é…ç½®ï¼š"><a href="#æœºå™¨é…ç½®ï¼š" class="headerlink" title="æœºå™¨é…ç½®ï¼š"></a>æœºå™¨é…ç½®ï¼š</h3><p><strong>Â·</strong> <font color="gold">python ç¯å¢ƒï¼šanaconda3 + python3.10.12</font></p><p><strong>Â·</strong> <font color="gold">GPUï¼šRTX3090*2 + CUDA11.7</font></p><p><strong>Â·</strong> <font color="gold">torchï¼š2.0.1ï¼ˆCUDAæœªå‡è‡³12ï¼‰</font></p><p><strong>Â·</strong> <font color="gold">condaï¼špy310_dtglm</font></p><h3 id="æ¨¡å‹ä¸‹è½½"><a href="#æ¨¡å‹ä¸‹è½½" class="headerlink" title="æ¨¡å‹ä¸‹è½½"></a>æ¨¡å‹ä¸‹è½½</h3><p><strong>Â·</strong> <font color="gold">m3e</font> <a href="https://huggingface.co/moka-ai/m3e-base/tree/main" target="_blank" rel="noopener">https://huggingface.co/moka-ai/m3e-base/tree/main</a></p><p><strong>Â·</strong> <font color="gold">chatglm2-6b</font> <a href="https://huggingface.co/THUDM/chatglm2-6b/tree/main" target="_blank" rel="noopener">https://huggingface.co/THUDM/chatglm2-6b/tree/main</a></p><p>chatglmæ¸…åæº <a href="https://cloud.tsinghua.edu.cn/d/674208019e314311ab5c/?p=%2F&amp;mode=list" target="_blank" rel="noopener">https://cloud.tsinghua.edu.cn/d/674208019e314311ab5c/?p=%2F&amp;mode=list</a></p><p>(è¿™é‡Œå°†æ¨¡å‹å…¨éƒ¨ä¸‹è½½è‡³<code>/root/huggingface</code>ä¸‹)</p><h3 id="åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå®‰è£…ä¾èµ–"><a href="#åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå®‰è£…ä¾èµ–" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå®‰è£…ä¾èµ–"></a>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå®‰è£…ä¾èµ–</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">conda create -n py310_dtglm python=3.10.12</span><br><span class="line">conda activate py310_dtglm</span><br><span class="line"></span><br><span class="line">pip install --use-pep517 -r requirements.txt -i https://mirror.baidu.com/pypi/simple</span><br><span class="line">pip install --use-pep517 -r requirements_api.txt -i https://mirror.baidu.com/pypi/simple</span><br><span class="line">pip install --use-pep517 -r requirements_webui.txt -i https://mirror.baidu.com/pypi/simple</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹é…ç½®ã€æ¨¡å‹è·¯å¾„"><a href="#ä¿®æ”¹é…ç½®ã€æ¨¡å‹è·¯å¾„" class="headerlink" title="ä¿®æ”¹é…ç½®ã€æ¨¡å‹è·¯å¾„"></a>ä¿®æ”¹é…ç½®ã€æ¨¡å‹è·¯å¾„</h3><p>å¤åˆ¶é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python copy_config_example.py</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><p><strong>Â·</strong> <font color="gold">model_config.py</font></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">MODEL_ROOT_PATH = <span class="string">"/root/huggingface"</span></span><br><span class="line"></span><br><span class="line">MODEL_PATH = &#123;</span><br><span class="line">    <span class="string">"embed_model"</span>: &#123;</span><br><span class="line">...</span><br><span class="line">        <span class="string">"m3e-base"</span>: <span class="string">"/root/huggingface/m3e-base"</span>, <span class="comment"># ä¿®æ”¹m3eæ¨¡å‹è·¯å¾„</span></span><br><span class="line">...</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> add all supported llm models</span></span><br><span class="line">    <span class="string">"llm_model"</span>: &#123;</span><br><span class="line">...</span><br><span class="line">        <span class="string">"chatglm2-6b"</span>: <span class="string">"/root/huggingface/chatglm2-6b"</span>, <span class="comment"># ä¿®æ”¹chatglm2-6bæ¨¡å‹è·¯å¾„</span></span><br><span class="line">...</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">EMBEDDING_MODEL = <span class="string">"m3e-base"</span> <span class="comment"># å¯ä»¥å°è¯•æœ€æ–°çš„åµŒå…¥å¼sotaæ¨¡å‹ï¼šbge-large-zh-v1.5</span></span><br><span class="line">LLM_MODEL = <span class="string">"chatglm2-6b"</span></span><br></pre></td></tr></table></figure><a id="more"></a><p><strong>Â·</strong> <font color="gold">server_config.py</font></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># webui.py server</span></span><br><span class="line">WEBUI_SERVER = &#123;</span><br><span class="line">    <span class="string">"host"</span>: DEFAULT_BIND_HOST,</span><br><span class="line">    <span class="string">"port"</span>: <span class="number">8501</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># api.py server</span></span><br><span class="line">API_SERVER = &#123;</span><br><span class="line">    <span class="string">"host"</span>: DEFAULT_BIND_HOST,</span><br><span class="line">    <span class="string">"port"</span>: <span class="number">7861</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># fastchat openai_api server</span></span><br><span class="line">FSCHAT_OPENAI_API = &#123;</span><br><span class="line">    <span class="string">"host"</span>: DEFAULT_BIND_HOST,</span><br><span class="line">    <span class="string">"port"</span>: <span class="number">20000</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">FSCHAT_MODEL_WORKERS = &#123;</span><br><span class="line">    <span class="string">"default"</span>: &#123;</span><br><span class="line">        <span class="string">"host"</span>: DEFAULT_BIND_HOST,</span><br><span class="line">        <span class="string">"port"</span>: <span class="number">20002</span>,</span><br><span class="line">        <span class="string">"device"</span>: LLM_DEVICE,</span><br><span class="line">        <span class="string">"infer_turbo"</span>: <span class="literal">False</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment"># model_workerå¤šå¡åŠ è½½éœ€è¦é…ç½®çš„å‚æ•°</span></span><br><span class="line">        <span class="string">"gpus"</span>: <span class="string">"0,1"</span>, <span class="comment"># ä½¿ç”¨çš„GPUï¼Œä»¥strçš„æ ¼å¼æŒ‡å®šï¼Œå¦‚"0,1"ï¼Œå¦‚å¤±æ•ˆè¯·ä½¿ç”¨CUDA_VISIBLE_DEVICES="0,1"ç­‰å½¢å¼æŒ‡å®š</span></span><br><span class="line">        <span class="string">"num_gpus"</span>: <span class="number">2</span>, <span class="comment"># ä½¿ç”¨GPUçš„æ•°é‡</span></span><br><span class="line">        <span class="string">"max_gpu_memory"</span>: <span class="string">"20GiB"</span>, <span class="comment"># æ¯ä¸ªGPUå ç”¨çš„æœ€å¤§æ˜¾å­˜</span></span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">"zhipu-api"</span>: &#123; <span class="comment"># è¯·ä¸ºæ¯ä¸ªè¦è¿è¡Œçš„åœ¨çº¿APIè®¾ç½®ä¸åŒçš„ç«¯å£</span></span><br><span class="line">        <span class="string">"port"</span>: <span class="number">21001</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># fastchat controller server</span></span><br><span class="line">FSCHAT_CONTROLLER = &#123;</span><br><span class="line">    <span class="string">"host"</span>: DEFAULT_BIND_HOST,</span><br><span class="line">    <span class="string">"port"</span>: <span class="number">20001</span>,</span><br><span class="line">    <span class="string">"dispatch_method"</span>: <span class="string">"shortest_queue"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–é»˜è®¤çŸ¥è¯†åº“"><a href="#åˆå§‹åŒ–é»˜è®¤çŸ¥è¯†åº“" class="headerlink" title="åˆå§‹åŒ–é»˜è®¤çŸ¥è¯†åº“"></a>åˆå§‹åŒ–é»˜è®¤çŸ¥è¯†åº“</h3><p>æ ·ä¾‹çŸ¥è¯†åº“æ–‡ä»¶ä½ç½®ï¼š<code>knowledge_base/samples/content/test.txt</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python init_database.py --recreate-vs</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨é¡¹ç›®"><a href="#å¯åŠ¨é¡¹ç›®" class="headerlink" title="å¯åŠ¨é¡¹ç›®"></a>å¯åŠ¨é¡¹ç›®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python startup.py -a</span><br></pre></td></tr></table></figure><p><img src="/2023/10/24/LangChain + ChatGLM2-6Bçš„æœ¬åœ°çŸ¥è¯†é—®ç­”åº“/A.png" alt></p><h3 id="é€šè¿‡fastapiæ¥å£æ·»åŠ çŸ¥è¯†åº“"><a href="#é€šè¿‡fastapiæ¥å£æ·»åŠ çŸ¥è¯†åº“" class="headerlink" title="é€šè¿‡fastapiæ¥å£æ·»åŠ çŸ¥è¯†åº“"></a>é€šè¿‡fastapiæ¥å£æ·»åŠ çŸ¥è¯†åº“</h3><p><code>http://host:7861/knowledge_base/upload_docs</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -X 'POST' \</span><br><span class="line">  'http://host:7861/knowledge_base/upload_docs' \</span><br><span class="line">  -H 'accept: application/json' \</span><br><span class="line">  -H 'Content-Type: multipart/form-data' \</span><br><span class="line">  -F 'to_vector_store=true' \</span><br><span class="line">  -F 'override=false' \</span><br><span class="line">  -F 'not_refresh_vs_cache=false' \</span><br><span class="line">  -F 'chunk_size=250' \</span><br><span class="line">  -F 'chunk_overlap=50' \</span><br><span class="line">  -F 'zh_title_enhance=true' \</span><br><span class="line">  -F 'files=@åˆ†ä½“å¼Må½•AIæ™ºèƒ½åˆ†æè®¾å¤‡å»ºè®¾æ–¹æ¡ˆ.docx;type=application/vnd.openxmlformats-officedocument.wordprocessingml.document' \</span><br><span class="line">  -F 'knowledge_base_name=ç…çŠ' \</span><br><span class="line">  -F 'docs='</span><br></pre></td></tr></table></figure><p><img src="/2023/10/24/LangChain + ChatGLM2-6Bçš„æœ¬åœ°çŸ¥è¯†é—®ç­”åº“/B.png" alt></p><h3 id="é€‰æ‹©çŸ¥è¯†åº“é—®ç­”"><a href="#é€‰æ‹©çŸ¥è¯†åº“é—®ç­”" class="headerlink" title="é€‰æ‹©çŸ¥è¯†åº“é—®ç­”"></a>é€‰æ‹©çŸ¥è¯†åº“é—®ç­”</h3><p><img src="/2023/10/24/LangChain + ChatGLM2-6Bçš„æœ¬åœ°çŸ¥è¯†é—®ç­”åº“/C.png" alt></p><p><img src="/2023/10/24/LangChain + ChatGLM2-6Bçš„æœ¬åœ°çŸ¥è¯†é—®ç­”åº“/D.png" alt></p><h2 id="ä»£ç è°ƒæ•´"><a href="#ä»£ç è°ƒæ•´" class="headerlink" title="ä»£ç è°ƒæ•´"></a>ä»£ç è°ƒæ•´</h2><h3 id="ç™¾å·å¤§æ¨¡å‹æ¥å…¥"><a href="#ç™¾å·å¤§æ¨¡å‹æ¥å…¥" class="headerlink" title="ç™¾å·å¤§æ¨¡å‹æ¥å…¥"></a>ç™¾å·å¤§æ¨¡å‹æ¥å…¥</h3><p>è°ƒæ•´<code>./configs/model_config.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"llm_model"</span>: &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">'baichuan-13b-chat'</span>:<span class="string">'/home/Baichuan2-main/baichuan-inc/Baichuan2-13B-Chat'</span>,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># LLM åç§°</span></span><br><span class="line">LLM_MODEL = <span class="string">"baichuan-13b-chat"</span></span><br></pre></td></tr></table></figure><h3 id="æ¥å£æµå¼è¾“å‡º"><a href="#æ¥å£æµå¼è¾“å‡º" class="headerlink" title="æ¥å£æµå¼è¾“å‡º"></a>æ¥å£æµå¼è¾“å‡º</h3><p>å®‰è£…sse_starlette</p><p><code>pip install sse-starlette -i https://mirror.baidu.com/pypi/simple</code></p><p>è¿›å…¥<code>./chat/*.py</code>ï¼Œä¿®æ”¹æ¥å£</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sse_starlette.sse <span class="keyword">import</span> EventSourceResponse</span><br><span class="line">...</span><br><span class="line"><span class="keyword">return</span> EventSourceResponse(chat_iterator(query=query,</span><br><span class="line">                                         history=history,</span><br><span class="line">                                         model_name=model_name,</span><br><span class="line">                                         prompt_name=prompt_name))</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*æ³¨é‡Šå†…å®¹ */</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;åŸé¡¹ç›®Githubï¼š&lt;a href=&quot;https://github.com/imClumsyPanda/langchain-ChatGLM&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/imClumsyPanda/langchain-ChatGLM&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;é¡¹ç›®éƒ¨ç½²&quot;&gt;&lt;a href=&quot;#é¡¹ç›®éƒ¨ç½²&quot; class=&quot;headerlink&quot; title=&quot;é¡¹ç›®éƒ¨ç½²&quot;&gt;&lt;/a&gt;é¡¹ç›®éƒ¨ç½²&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; &lt;font color=&quot;gold&quot;&gt;v 0.2.6&lt;/font&gt;&lt;/p&gt;
&lt;h3 id=&quot;æœºå™¨é…ç½®ï¼š&quot;&gt;&lt;a href=&quot;#æœºå™¨é…ç½®ï¼š&quot; class=&quot;headerlink&quot; title=&quot;æœºå™¨é…ç½®ï¼š&quot;&gt;&lt;/a&gt;æœºå™¨é…ç½®ï¼š&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; &lt;font color=&quot;gold&quot;&gt;python ç¯å¢ƒï¼šanaconda3 + python3.10.12&lt;/font&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; &lt;font color=&quot;gold&quot;&gt;GPUï¼šRTX3090*2 + CUDA11.7&lt;/font&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; &lt;font color=&quot;gold&quot;&gt;torchï¼š2.0.1ï¼ˆCUDAæœªå‡è‡³12ï¼‰&lt;/font&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; &lt;font color=&quot;gold&quot;&gt;condaï¼špy310_dtglm&lt;/font&gt;&lt;/p&gt;
&lt;h3 id=&quot;æ¨¡å‹ä¸‹è½½&quot;&gt;&lt;a href=&quot;#æ¨¡å‹ä¸‹è½½&quot; class=&quot;headerlink&quot; title=&quot;æ¨¡å‹ä¸‹è½½&quot;&gt;&lt;/a&gt;æ¨¡å‹ä¸‹è½½&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; &lt;font color=&quot;gold&quot;&gt;m3e&lt;/font&gt; &lt;a href=&quot;https://huggingface.co/moka-ai/m3e-base/tree/main&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://huggingface.co/moka-ai/m3e-base/tree/main&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; &lt;font color=&quot;gold&quot;&gt;chatglm2-6b&lt;/font&gt; &lt;a href=&quot;https://huggingface.co/THUDM/chatglm2-6b/tree/main&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://huggingface.co/THUDM/chatglm2-6b/tree/main&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;chatglmæ¸…åæº &lt;a href=&quot;https://cloud.tsinghua.edu.cn/d/674208019e314311ab5c/?p=%2F&amp;amp;mode=list&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://cloud.tsinghua.edu.cn/d/674208019e314311ab5c/?p=%2F&amp;amp;mode=list&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;(è¿™é‡Œå°†æ¨¡å‹å…¨éƒ¨ä¸‹è½½è‡³&lt;code&gt;/root/huggingface&lt;/code&gt;ä¸‹)&lt;/p&gt;
&lt;h3 id=&quot;åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå®‰è£…ä¾èµ–&quot;&gt;&lt;a href=&quot;#åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå®‰è£…ä¾èµ–&quot; class=&quot;headerlink&quot; title=&quot;åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå®‰è£…ä¾èµ–&quot;&gt;&lt;/a&gt;åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå®‰è£…ä¾èµ–&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;conda create -n py310_dtglm python=3.10.12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;conda activate py310_dtglm&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install --use-pep517 -r requirements.txt -i https://mirror.baidu.com/pypi/simple&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install --use-pep517 -r requirements_api.txt -i https://mirror.baidu.com/pypi/simple&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install --use-pep517 -r requirements_webui.txt -i https://mirror.baidu.com/pypi/simple&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;ä¿®æ”¹é…ç½®ã€æ¨¡å‹è·¯å¾„&quot;&gt;&lt;a href=&quot;#ä¿®æ”¹é…ç½®ã€æ¨¡å‹è·¯å¾„&quot; class=&quot;headerlink&quot; title=&quot;ä¿®æ”¹é…ç½®ã€æ¨¡å‹è·¯å¾„&quot;&gt;&lt;/a&gt;ä¿®æ”¹é…ç½®ã€æ¨¡å‹è·¯å¾„&lt;/h3&gt;&lt;p&gt;å¤åˆ¶é…ç½®æ–‡ä»¶&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;python copy_config_example.py&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; &lt;font color=&quot;gold&quot;&gt;model_config.py&lt;/font&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;MODEL_ROOT_PATH = &lt;span class=&quot;string&quot;&gt;&quot;/root/huggingface&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MODEL_PATH = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;embed_model&quot;&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;m3e-base&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;/root/huggingface/m3e-base&quot;&lt;/span&gt;, &lt;span class=&quot;comment&quot;&gt;# ä¿®æ”¹m3eæ¨¡å‹è·¯å¾„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# &lt;span class=&quot;doctag&quot;&gt;TODO:&lt;/span&gt; add all supported llm models&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;llm_model&quot;&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;chatglm2-6b&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;/root/huggingface/chatglm2-6b&quot;&lt;/span&gt;, &lt;span class=&quot;comment&quot;&gt;# ä¿®æ”¹chatglm2-6bæ¨¡å‹è·¯å¾„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;EMBEDDING_MODEL = &lt;span class=&quot;string&quot;&gt;&quot;m3e-base&quot;&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;# å¯ä»¥å°è¯•æœ€æ–°çš„åµŒå…¥å¼sotaæ¨¡å‹ï¼šbge-large-zh-v1.5&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LLM_MODEL = &lt;span class=&quot;string&quot;&gt;&quot;chatglm2-6b&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="GPT" scheme="http://yoursite.com/categories/GPT/"/>
    
    
    <category term="langchain-chatchat" scheme="http://yoursite.com/tags/langchain-chatchat/"/>
    
    <category term="chat-glm" scheme="http://yoursite.com/tags/chat-glm/"/>
    
    <category term="baichuan" scheme="http://yoursite.com/tags/baichuan/"/>
    
  </entry>
  
  <entry>
    <title>Nebula3é›†ç¾¤ç‰ˆæ–°æ—§ç‰ˆæœ¬å¤šå¼€</title>
    <link href="http://yoursite.com/2023/09/28/Nebula3%E9%9B%86%E7%BE%A4%E7%89%88%E7%89%88%E6%9C%AC%E5%A4%9A%E5%BC%80/"/>
    <id>http://yoursite.com/2023/09/28/Nebula3%E9%9B%86%E7%BE%A4%E7%89%88%E7%89%88%E6%9C%AC%E5%A4%9A%E5%BC%80/</id>
    <published>2023-09-28T02:10:10.000Z</published>
    <updated>2023-11-03T09:32:18.875Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><font color="gold"><strong>Â·</strong> ç³»ç»Ÿï¼šCentOS7</font><font color="gold"><strong>Â·</strong> å·²æœ‰nebulaç‰ˆæœ¬ï¼š2.6.1ï¼ˆå¼€æºç¤¾åŒºç‰ˆï¼‰</font><font color="gold"><strong>Â·</strong> å·²æœ‰nebula-consoleç‰ˆæœ¬ï¼š2.6.0</font><font color="gold"><strong>Â·</strong> å·²æœ‰nebula-graph-studioç‰ˆæœ¬ï¼š3.2.3</font><font color="gold"><strong>Â·</strong> å¤šå¼€nebulaç‰ˆæœ¬ï¼š3.6.0ï¼ˆå¼€æºç¤¾åŒºç‰ˆï¼‰</font><font color="gold"><strong>Â·</strong> å¤šå¼€nebula-graph-studioç‰ˆæœ¬ï¼š3.2.3</font><font color="gold"><strong>Â·</strong> å¤šå¼€nebula-consoleç‰ˆæœ¬ï¼š3.6.0</font><h2 id="é›†ç¾¤éƒ¨ç½²"><a href="#é›†ç¾¤éƒ¨ç½²" class="headerlink" title="é›†ç¾¤éƒ¨ç½²"></a>é›†ç¾¤éƒ¨ç½²</h2><p><strong>Â·</strong> å‚è€ƒå•æœºéƒ¨ç½²æ–¹å¼ï¼Œå¯¹é…ç½®æ–‡ä»¶<code>--meta_server_addrs</code>åšæ‰©å±•ï¼Œæ·»åŠ metaæœºå™¨</p><p><strong>Â·</strong> åŒºåˆ†2.6.1ç‰ˆæœ¬å·²è¢«å ç”¨çš„ç«¯å£ï¼Œæ‰¾åˆ°é…ç½®æ–‡ä»¶é»˜è®¤çš„<code>9559</code>ã€<code>19559</code>ã€<code>9669</code>ã€<code>19669</code>ã€<code>9779</code>ã€<code>19779</code>ç«¯å£ï¼Œä¿®æ”¹ä¸º<code>8559</code>ã€<code>18559</code>ã€<code>8669</code>ã€<code>18669</code>ã€<code>8779</code>ã€<code>18779</code></p><p><strong>Â·</strong> å¯åŠ¨é›†ç¾¤</p><p><strong>Â·</strong> é…ç½®nebula-graph-studioé»˜è®¤ç«¯å£ä¸º<code>7002</code></p><p><font color="gold"><strong>Â·</strong> æ³¨</font>ï¼šåŒå¼€nebulaåä½¿ç”¨åŒç‰ˆæœ¬nebula-graph-studioå³ä½¿æ›´æ¢äº†ç«¯å£ï¼Œä¹Ÿä¸èƒ½åŒæ—¶è¿è¡Œï¼Œå¯ä»¥å®‰è£…nebula-consoleæ¥åŒæ—¶å¯åŠ¨nebulaæ§åˆ¶å°</p><p><code>chmod 111 nebula-console</code></p><p><code>./nebula-console --addr &lt;host&gt; --port 9669 -u root -p nebula</code></p><p><code>./nebula-console --addr &lt;host&gt; --port 8669 -u root -p nebula</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;script src=&quot;\assets\js\APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;font color=&quot;gold&quot;&gt;&lt;strong&gt;Â·&lt;/strong&gt; ç³»ç»Ÿï¼šCentOS7&lt;/font&gt;

&lt;font color=&quot;gold&quot;&gt;&lt;strong&gt;Â·&lt;/str</summary>
      
    
    
    
    <category term="BigData" scheme="http://yoursite.com/categories/BigData/"/>
    
    
    <category term="database" scheme="http://yoursite.com/tags/database/"/>
    
    <category term="nebula" scheme="http://yoursite.com/tags/nebula/"/>
    
  </entry>
  
  <entry>
    <title>Nebula3å•æœºç‰ˆå¿«é€Ÿå®‰è£…</title>
    <link href="http://yoursite.com/2023/09/27/Nebula3%E5%8D%95%E6%9C%BA%E7%89%88%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85/"/>
    <id>http://yoursite.com/2023/09/27/Nebula3%E5%8D%95%E6%9C%BA%E7%89%88%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85/</id>
    <published>2023-09-27T08:12:31.000Z</published>
    <updated>2023-10-24T02:28:41.838Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><font color="gold"><strong>Â·</strong> ç³»ç»Ÿï¼šCentOS7</font><font color="gold"><strong>Â·</strong> nebulaç‰ˆæœ¬ï¼š3.6.0ï¼ˆå¼€æºç¤¾åŒºç‰ˆï¼‰</font><font color="gold"><strong>Â·</strong> nebula-graph-studioç‰ˆæœ¬ï¼š3.2.3</font><h2 id="å•æœºéƒ¨ç½²"><a href="#å•æœºéƒ¨ç½²" class="headerlink" title="å•æœºéƒ¨ç½²"></a>å•æœºéƒ¨ç½²</h2><h3 id="taråŒ…æºç ä¸‹è½½"><a href="#taråŒ…æºç ä¸‹è½½" class="headerlink" title="taråŒ…æºç ä¸‹è½½"></a>taråŒ…æºç ä¸‹è½½</h3><p><code>wget https://oss-cdn.nebula-graph.com.cn/package/3.6.0/nebula-graph-3.6.0.el7.x86_64.tar.gz</code></p><h3 id="è§£å‹å¹¶é‡å‘½å"><a href="#è§£å‹å¹¶é‡å‘½å" class="headerlink" title="è§£å‹å¹¶é‡å‘½å"></a>è§£å‹å¹¶é‡å‘½å</h3><p><code>tar -xvzf nebula-graph-3.6.0.el7.x86_64.tar.gz</code></p><p><code>mv nebula-graph-3.6.0.el7.x86_64 nebula</code></p><h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p><code>cd nebula/etc</code></p><p><code>mv nebula-graphd.conf.default nebula-graphd.conf</code></p><p><code>mv nebula-metad.conf.default nebula-metad.conf</code></p><p><code>mv nebula-storaged.conf nebula-storaged.conf</code></p><p>ä¿®æ”¹å¯¹åº”æ–‡ä»¶å­˜å‚¨ä½ç½®ã€èŠ‚ç‚¹ipåœ°å€ï¼Œé›†ç¾¤åŒç†</p><a id="more"></a><p><strong>ç¤ºä¾‹ï¼š</strong></p><p><strong>Â·</strong> <code>nebula-graphd.conf</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">########## basics ##########</span><br><span class="line"># Whether to run as a daemon process</span><br><span class="line">--daemonize=true</span><br><span class="line"># The file to host the process id</span><br><span class="line">--pid_file=pids/nebula-graphd.pid</span><br><span class="line"># Whether to enable optimizer</span><br><span class="line">--enable_optimizer=true</span><br><span class="line"># The default charset when a space is created</span><br><span class="line">--default_charset=utf8</span><br><span class="line"># The default collate when a space is created</span><br><span class="line">--default_collate=utf8_bin</span><br><span class="line"># Whether to use the configuration obtained from the configuration file</span><br><span class="line">--local_config=true</span><br><span class="line"></span><br><span class="line">########## logging ##########</span><br><span class="line"># The directory to host logging files</span><br><span class="line">--log_dir=/home/nebula/graph/logs</span><br><span class="line"># Log level, 0, 1, 2, 3 for INFO, WARNING, ERROR, FATAL respectively</span><br><span class="line">--minloglevel=0</span><br><span class="line"># Verbose log level, 1, 2, 3, 4, the higher of the level, the more verbose of the logging</span><br><span class="line">--v=0</span><br><span class="line"># Maximum seconds to buffer the log messages</span><br><span class="line">--logbufsecs=0</span><br><span class="line"># Whether to redirect stdout and stderr to separate output files</span><br><span class="line">--redirect_stdout=true</span><br><span class="line"># Destination filename of stdout and stderr, which will also reside in log_dir.</span><br><span class="line">--stdout_log_file=graphd-stdout.log</span><br><span class="line">--stderr_log_file=graphd-stderr.log</span><br><span class="line"># Copy log messages at or above this level to stderr in addition to logfiles. The numbers of severity levels INFO, WARNING, ERROR, and FATAL are 0, 1, 2, and 3, respectively.</span><br><span class="line">--stderrthreshold=3</span><br><span class="line"># wether logging files&apos; name contain time stamp.</span><br><span class="line">--timestamp_in_logfile_name=true</span><br><span class="line">########## query ##########</span><br><span class="line"># Whether to treat partial success as an error.</span><br><span class="line"># This flag is only used for Read-only access, and Modify access always treats partial success as an error.</span><br><span class="line">--accept_partial_success=false</span><br><span class="line"># Maximum sentence length, unit byte</span><br><span class="line">--max_allowed_query_size=4194304</span><br><span class="line"></span><br><span class="line">########## networking ##########</span><br><span class="line"># Comma separated Meta Server Addresses</span><br><span class="line">--meta_server_addrs=192.168.9.103:9559</span><br><span class="line"># Local IP used to identify the nebula-graphd process.</span><br><span class="line"># Change it to an address other than loopback if the service is distributed or</span><br><span class="line"># will be accessed remotely.</span><br><span class="line">--local_ip=192.168.9.103</span><br><span class="line"># Network device to listen on</span><br><span class="line">--listen_netdev=any</span><br><span class="line"># Port to listen on</span><br><span class="line">--port=9669</span><br><span class="line"># To turn on SO_REUSEPORT or not</span><br><span class="line">--reuse_port=false</span><br><span class="line"># Backlog of the listen socket, adjust this together with net.core.somaxconn</span><br><span class="line">--listen_backlog=1024</span><br><span class="line"># The number of seconds Nebula service waits before closing the idle connections</span><br><span class="line">--client_idle_timeout_secs=28800</span><br><span class="line"># The number of seconds before idle sessions expire</span><br><span class="line"># The range should be in [1, 604800]</span><br><span class="line">--session_idle_timeout_secs=28800</span><br><span class="line"># The number of threads to accept incoming connections</span><br><span class="line">--num_accept_threads=1</span><br><span class="line"># The number of networking IO threads, 0 for # of CPU cores</span><br><span class="line">--num_netio_threads=0</span><br><span class="line"># Max active connections for all networking threads. 0 means no limit.</span><br><span class="line"># Max connections for each networking thread = num_max_connections / num_netio_threads</span><br><span class="line">--num_max_connections=0</span><br><span class="line"># The number of threads to execute user queries, 0 for # of CPU cores</span><br><span class="line">--num_worker_threads=0</span><br><span class="line"># HTTP service ip</span><br><span class="line">--ws_ip=0.0.0.0</span><br><span class="line"># HTTP service port</span><br><span class="line">--ws_http_port=19669</span><br><span class="line"># storage client timeout</span><br><span class="line">--storage_client_timeout_ms=60000</span><br><span class="line"># slow query threshold in us</span><br><span class="line">--slow_query_threshold_us=200000</span><br><span class="line"># Port to listen on Meta with HTTP protocol, it corresponds to ws_http_port in metad&apos;s configuration file</span><br><span class="line">--ws_meta_http_port=19559</span><br><span class="line"></span><br><span class="line">########## authentication ##########</span><br><span class="line"># Enable authorization</span><br><span class="line">--enable_authorize=false</span><br><span class="line"># User login authentication type, password for nebula authentication, ldap for ldap authentication, cloud for cloud authentication</span><br><span class="line">--auth_type=password</span><br><span class="line"></span><br><span class="line">########## memory ##########</span><br><span class="line"># System memory high watermark ratio, cancel the memory checking when the ratio greater than 1.0</span><br><span class="line">--system_memory_high_watermark_ratio=0.8</span><br><span class="line"></span><br><span class="line">########## metrics ##########</span><br><span class="line">--enable_space_level_metrics=false</span><br><span class="line"></span><br><span class="line">########## experimental feature ##########</span><br><span class="line"># if use experimental features</span><br><span class="line">--enable_experimental_feature=false</span><br><span class="line"></span><br><span class="line"># if use balance data feature, only work if enable_experimental_feature is true</span><br><span class="line">--enable_data_balance=true</span><br><span class="line"></span><br><span class="line"># enable udf, written in c++ only for now</span><br><span class="line">--enable_udf=true</span><br><span class="line"></span><br><span class="line"># set the directory where the .so files of udf are stored, when enable_udf is true</span><br><span class="line">--udf_path=/home/nebula/dev/nebula/udf/</span><br><span class="line"></span><br><span class="line">########## session ##########</span><br><span class="line"># Maximum number of sessions that can be created per IP and per user</span><br><span class="line">--max_sessions_per_ip_per_user=300</span><br><span class="line"></span><br><span class="line">########## memory tracker ##########</span><br><span class="line"># trackable memory ratio (trackable_memory / (total_memory - untracked_reserved_memory) )</span><br><span class="line">--memory_tracker_limit_ratio=0.8</span><br><span class="line"># untracked reserved memory in Mib</span><br><span class="line">--memory_tracker_untracked_reserved_memory_mb=50</span><br><span class="line"></span><br><span class="line"># enable log memory tracker stats periodically</span><br><span class="line">--memory_tracker_detail_log=false</span><br><span class="line"># log memory tacker stats interval in milliseconds</span><br><span class="line">--memory_tracker_detail_log_interval_ms=60000</span><br><span class="line"></span><br><span class="line"># enable memory background purge (if jemalloc is used)</span><br><span class="line">--memory_purge_enabled=true</span><br><span class="line"># memory background purge interval in seconds</span><br><span class="line">--memory_purge_interval_seconds=10</span><br><span class="line"></span><br><span class="line">########## performance optimization ##########</span><br><span class="line"># The max job size in multi job mode</span><br><span class="line">--max_job_size=1</span><br><span class="line"># The min batch size for handling dataset in multi job mode, only enabled when max_job_size is greater than 1</span><br><span class="line">--min_batch_size=8192</span><br><span class="line"># if true, return directly without go through RPC</span><br><span class="line">--optimize_appendvertices=false</span><br><span class="line"># number of paths constructed by each thread</span><br><span class="line">--path_batch_size=10000</span><br></pre></td></tr></table></figure><p><strong>Â·</strong> <code>nebula-metad.conf</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">########## basics ##########</span><br><span class="line"># Whether to run as a daemon process</span><br><span class="line">--daemonize=true</span><br><span class="line"># The file to host the process id</span><br><span class="line">--pid_file=pids/nebula-metad.pid</span><br><span class="line"></span><br><span class="line">########## logging ##########</span><br><span class="line"># The directory to host logging files</span><br><span class="line">--log_dir=/home/nebula/meta/logs</span><br><span class="line"># Log level, 0, 1, 2, 3 for INFO, WARNING, ERROR, FATAL respectively</span><br><span class="line">--minloglevel=0</span><br><span class="line"># Verbose log level, 1, 2, 3, 4, the higher of the level, the more verbose of the logging</span><br><span class="line">--v=0</span><br><span class="line"># Maximum seconds to buffer the log messages</span><br><span class="line">--logbufsecs=0</span><br><span class="line"># Whether to redirect stdout and stderr to separate output files</span><br><span class="line">--redirect_stdout=true</span><br><span class="line"># Destination filename of stdout and stderr, which will also reside in log_dir.</span><br><span class="line">--stdout_log_file=metad-stdout.log</span><br><span class="line">--stderr_log_file=metad-stderr.log</span><br><span class="line"># Copy log messages at or above this level to stderr in addition to logfiles. The numbers of severity levels INFO, WARNING, ERROR, and FATAL are 0, 1, 2, and 3, respectively.</span><br><span class="line">--stderrthreshold=3</span><br><span class="line"># wether logging files&apos; name contain time stamp, If Using logrotate to rotate logging files, than should set it to true.</span><br><span class="line">--timestamp_in_logfile_name=true</span><br><span class="line"></span><br><span class="line">########## networking ##########</span><br><span class="line"># Comma separated Meta Server addresses</span><br><span class="line">--meta_server_addrs=192.168.9.103:9559</span><br><span class="line"># Local IP used to identify the nebula-metad process.</span><br><span class="line"># Change it to an address other than loopback if the service is distributed or</span><br><span class="line"># will be accessed remotely.</span><br><span class="line">--local_ip=192.168.9.103</span><br><span class="line"># Meta daemon listening port</span><br><span class="line">--port=9559</span><br><span class="line"># HTTP service ip</span><br><span class="line">--ws_ip=0.0.0.0</span><br><span class="line"># HTTP service port</span><br><span class="line">--ws_http_port=19559</span><br><span class="line"># Port to listen on Storage with HTTP protocol, it corresponds to ws_http_port in storage&apos;s configuration file</span><br><span class="line">--ws_storage_http_port=19779</span><br><span class="line"></span><br><span class="line">########## storage ##########</span><br><span class="line"># Root data path, here should be only single path for metad</span><br><span class="line">--data_path=/home/nebula/data/meta</span><br><span class="line"></span><br><span class="line">########## Misc #########</span><br><span class="line"># The default number of parts when a space is created</span><br><span class="line">--default_parts_num=100</span><br><span class="line"># The default replica factor when a space is created</span><br><span class="line">--default_replica_factor=1</span><br><span class="line"></span><br><span class="line">--heartbeat_interval_secs=10</span><br><span class="line">--agent_heartbeat_interval_secs=60</span><br></pre></td></tr></table></figure><p><strong>Â·</strong> <code>nebula-metad.conf</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">########## basics ##########</span><br><span class="line"># Whether to run as a daemon process</span><br><span class="line">--daemonize=true</span><br><span class="line"># The file to host the process id</span><br><span class="line">--pid_file=pids/nebula-storaged.pid</span><br><span class="line"># Whether to use the configuration obtained from the configuration file</span><br><span class="line">--local_config=true</span><br><span class="line"></span><br><span class="line">########## logging ##########</span><br><span class="line"># The directory to host logging files</span><br><span class="line">--log_dir=/home/nebula/storage/logs</span><br><span class="line"># Log level, 0, 1, 2, 3 for INFO, WARNING, ERROR, FATAL respectively</span><br><span class="line">--minloglevel=0</span><br><span class="line"># Verbose log level, 1, 2, 3, 4, the higher of the level, the more verbose of the logging</span><br><span class="line">--v=0</span><br><span class="line"># Maximum seconds to buffer the log messages</span><br><span class="line">--logbufsecs=0</span><br><span class="line"># Whether to redirect stdout and stderr to separate output files</span><br><span class="line">--redirect_stdout=true</span><br><span class="line"># Destination filename of stdout and stderr, which will also reside in log_dir.</span><br><span class="line">--stdout_log_file=storaged-stdout.log</span><br><span class="line">--stderr_log_file=storaged-stderr.log</span><br><span class="line"># Copy log messages at or above this level to stderr in addition to logfiles. The numbers of severity levels INFO, WARNING, ERROR, and FATAL are 0, 1, 2, and 3, respectively.</span><br><span class="line">--stderrthreshold=3</span><br><span class="line"># Wether logging files&apos; name contain time stamp.</span><br><span class="line">--timestamp_in_logfile_name=true</span><br><span class="line"></span><br><span class="line">########## networking ##########</span><br><span class="line"># Comma separated Meta server addresses</span><br><span class="line">--meta_server_addrs=192.168.9.103:9559</span><br><span class="line"># Local IP used to identify the nebula-storaged process.</span><br><span class="line"># Change it to an address other than loopback if the service is distributed or</span><br><span class="line"># will be accessed remotely.</span><br><span class="line">--local_ip=192.168.9.103</span><br><span class="line"># Storage daemon listening port</span><br><span class="line">--port=9779</span><br><span class="line"># HTTP service ip</span><br><span class="line">--ws_ip=0.0.0.0</span><br><span class="line"># HTTP service port</span><br><span class="line">--ws_http_port=19779</span><br><span class="line"># heartbeat with meta service</span><br><span class="line">--heartbeat_interval_secs=10</span><br><span class="line"></span><br><span class="line">######### Raft #########</span><br><span class="line"># Raft election timeout</span><br><span class="line">--raft_heartbeat_interval_secs=30</span><br><span class="line"># RPC timeout for raft client (ms)</span><br><span class="line">--raft_rpc_timeout_ms=500</span><br><span class="line">## recycle Raft WAL</span><br><span class="line">--wal_ttl=14400</span><br><span class="line"></span><br><span class="line">########## Disk ##########</span><br><span class="line"># Root data path. Split by comma. e.g. --data_path=/disk1/path1/,/disk2/path2/</span><br><span class="line"># One path per Rocksdb instance.</span><br><span class="line">--data_path=/home/nebula/data/storage</span><br><span class="line"></span><br><span class="line"># Minimum reserved bytes of each data path</span><br><span class="line">--minimum_reserved_bytes=268435456</span><br><span class="line"></span><br><span class="line"># The default reserved bytes for one batch operation</span><br><span class="line">--rocksdb_batch_size=4096</span><br><span class="line"># The default block cache size used in BlockBasedTable.</span><br><span class="line"># The unit is MB.</span><br><span class="line">--rocksdb_block_cache=4</span><br><span class="line"># The type of storage engine, `rocksdb&apos;, `memory&apos;, etc.</span><br><span class="line">--engine_type=rocksdb</span><br><span class="line"></span><br><span class="line"># Compression algorithm, options: no,snappy,lz4,lz4hc,zlib,bzip2,zstd</span><br><span class="line"># For the sake of binary compatibility, the default value is snappy.</span><br><span class="line"># Recommend to use:</span><br><span class="line">#   * lz4 to gain more CPU performance, with the same compression ratio with snappy</span><br><span class="line">#   * zstd to occupy less disk space</span><br><span class="line">#   * lz4hc for the read-heavy write-light scenario</span><br><span class="line">--rocksdb_compression=lz4</span><br><span class="line"></span><br><span class="line"># Set different compressions for different levels</span><br><span class="line"># For example, if --rocksdb_compression is snappy,</span><br><span class="line"># &quot;no:no:lz4:lz4::zstd&quot; is identical to &quot;no:no:lz4:lz4:snappy:zstd:snappy&quot;</span><br><span class="line"># In order to disable compression for level 0/1, set it to &quot;no:no&quot;</span><br><span class="line">--rocksdb_compression_per_level=</span><br><span class="line"></span><br><span class="line"># Whether or not to enable rocksdb&apos;s statistics, disabled by default</span><br><span class="line">--enable_rocksdb_statistics=false</span><br><span class="line"></span><br><span class="line"># Statslevel used by rocksdb to collection statistics, optional values are</span><br><span class="line">#   * kExceptHistogramOrTimers, disable timer stats, and skip histogram stats</span><br><span class="line">#   * kExceptTimers, Skip timer stats</span><br><span class="line">#   * kExceptDetailedTimers, Collect all stats except time inside mutex lock AND time spent on compression.</span><br><span class="line">#   * kExceptTimeForMutex, Collect all stats except the counters requiring to get time inside the mutex lock.</span><br><span class="line">#   * kAll, Collect all stats</span><br><span class="line">--rocksdb_stats_level=kExceptHistogramOrTimers</span><br><span class="line"></span><br><span class="line"># Whether or not to enable rocksdb&apos;s prefix bloom filter, enabled by default.</span><br><span class="line">--enable_rocksdb_prefix_filtering=true</span><br><span class="line"># Whether or not to enable rocksdb&apos;s whole key bloom filter, disabled by default.</span><br><span class="line">--enable_rocksdb_whole_key_filtering=false</span><br><span class="line"></span><br><span class="line">############## rocksdb Options ##############</span><br><span class="line"># rocksdb DBOptions in json, each name and value of option is a string, given as &quot;option_name&quot;:&quot;option_value&quot; separated by comma</span><br><span class="line">--rocksdb_db_options=&#123;&#125;</span><br><span class="line"># rocksdb ColumnFamilyOptions in json, each name and value of option is string, given as &quot;option_name&quot;:&quot;option_value&quot; separated by comma</span><br><span class="line">--rocksdb_column_family_options=&#123;&quot;write_buffer_size&quot;:&quot;67108864&quot;,&quot;max_write_buffer_number&quot;:&quot;4&quot;,&quot;max_bytes_for_level_base&quot;:&quot;268435456&quot;&#125;</span><br><span class="line"># rocksdb BlockBasedTableOptions in json, each name and value of option is string, given as &quot;option_name&quot;:&quot;option_value&quot; separated by comma</span><br><span class="line">--rocksdb_block_based_table_options=&#123;&quot;block_size&quot;:&quot;8192&quot;&#125;</span><br><span class="line"></span><br><span class="line">############### misc ####################</span><br><span class="line"># Whether turn on query in multiple thread</span><br><span class="line">--query_concurrently=true</span><br><span class="line"># Whether remove outdated space data</span><br><span class="line">--auto_remove_invalid_space=true</span><br><span class="line"># Network IO threads number</span><br><span class="line">--num_io_threads=16</span><br><span class="line"># Max active connections for all networking threads. 0 means no limit.</span><br><span class="line"># Max connections for each networking thread = num_max_connections / num_netio_threads</span><br><span class="line">--num_max_connections=0</span><br><span class="line"># Worker threads number to handle request</span><br><span class="line">--num_worker_threads=32</span><br><span class="line"># Maximum subtasks to run admin jobs concurrently</span><br><span class="line">--max_concurrent_subtasks=10</span><br><span class="line"># The rate limit in bytes when leader synchronizes snapshot data</span><br><span class="line">--snapshot_part_rate_limit=10485760</span><br><span class="line"># The amount of data sent in each batch when leader synchronizes snapshot data</span><br><span class="line">--snapshot_batch_size=1048576</span><br><span class="line"># The rate limit in bytes when leader synchronizes rebuilding index</span><br><span class="line">--rebuild_index_part_rate_limit=4194304</span><br><span class="line"># The amount of data sent in each batch when leader synchronizes rebuilding index</span><br><span class="line">--rebuild_index_batch_size=1048576</span><br><span class="line"></span><br><span class="line">########## memory tracker ##########</span><br><span class="line"># trackable memory ratio (trackable_memory / (total_memory - untracked_reserved_memory) )</span><br><span class="line">--memory_tracker_limit_ratio=0.8</span><br><span class="line"># untracked reserved memory in Mib</span><br><span class="line">--memory_tracker_untracked_reserved_memory_mb=50</span><br><span class="line"></span><br><span class="line"># enable log memory tracker stats periodically</span><br><span class="line">--memory_tracker_detail_log=false</span><br><span class="line"># log memory tacker stats interval in milliseconds</span><br><span class="line">--memory_tracker_detail_log_interval_ms=60000</span><br><span class="line"></span><br><span class="line"># enable memory background purge (if jemalloc is used)</span><br><span class="line">--memory_purge_enabled=true</span><br><span class="line"># memory background purge interval in seconds</span><br><span class="line">--memory_purge_interval_seconds=10</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h3><p>å›åˆ°nebulaæ ¹ç›®å½•</p><p><code>cd ..</code></p><p>æ‰§è¡Œå¯åŠ¨è„šæœ¬</p><p><code>./scripts/nebula.service start all</code></p><p>æŸ¥çœ‹æœåŠ¡çŠ¶æ€</p><p><code>./scripts/nebula.service status all</code></p><p>é‡å¯æœåŠ¡</p><p><code>./scripts/nebula.service restart all</code></p><p>å…³é—­æœåŠ¡</p><p><code>./scripts/nebula.service stop all</code></p><h2 id="nebula-graph-studioéƒ¨ç½²"><a href="#nebula-graph-studioéƒ¨ç½²" class="headerlink" title="nebula-graph-studioéƒ¨ç½²"></a>nebula-graph-studioéƒ¨ç½²</h2><p>v3.2.3ä¸‹è½½åœ°å€ï¼ˆå…è´¹ä½¿ç”¨å›¾æ¢ç´¢çš„æœ€é«˜ç¤¾åŒºç‰ˆæœ¬ï¼‰</p><p><a href="https://github.com/vesoft-inc/nebula-studio/releases/tag/v3.2.3" target="_blank" rel="noopener">https://github.com/vesoft-inc/nebula-studio/releases/tag/v3.2.3</a></p><p>æºç å®‰è£…åï¼Œè¿›å…¥å¯¹åº”ç›®å½•ï¼Œæ‰§è¡Œå¯åŠ¨è„šæœ¬</p><p><code>./service</code></p><p><img src="/2023/09/27/Nebula3å•æœºç‰ˆå¿«é€Ÿå®‰è£…/A.png" alt></p><p><img src="/2023/09/27/Nebula3å•æœºç‰ˆå¿«é€Ÿå®‰è£…/B.png" alt></p>]]></content>
    
    
    <summary type="html">&lt;font color=&quot;gold&quot;&gt;&lt;strong&gt;Â·&lt;/strong&gt; ç³»ç»Ÿï¼šCentOS7&lt;/font&gt;

&lt;font color=&quot;gold&quot;&gt;&lt;strong&gt;Â·&lt;/strong&gt; nebulaç‰ˆæœ¬ï¼š3.6.0ï¼ˆå¼€æºç¤¾åŒºç‰ˆï¼‰&lt;/font&gt;

&lt;font color=&quot;gold&quot;&gt;&lt;strong&gt;Â·&lt;/strong&gt; nebula-graph-studioç‰ˆæœ¬ï¼š3.2.3&lt;/font&gt;

&lt;h2 id=&quot;å•æœºéƒ¨ç½²&quot;&gt;&lt;a href=&quot;#å•æœºéƒ¨ç½²&quot; class=&quot;headerlink&quot; title=&quot;å•æœºéƒ¨ç½²&quot;&gt;&lt;/a&gt;å•æœºéƒ¨ç½²&lt;/h2&gt;&lt;h3 id=&quot;taråŒ…æºç ä¸‹è½½&quot;&gt;&lt;a href=&quot;#taråŒ…æºç ä¸‹è½½&quot; class=&quot;headerlink&quot; title=&quot;taråŒ…æºç ä¸‹è½½&quot;&gt;&lt;/a&gt;taråŒ…æºç ä¸‹è½½&lt;/h3&gt;&lt;p&gt;&lt;code&gt;wget https://oss-cdn.nebula-graph.com.cn/package/3.6.0/nebula-graph-3.6.0.el7.x86_64.tar.gz&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;è§£å‹å¹¶é‡å‘½å&quot;&gt;&lt;a href=&quot;#è§£å‹å¹¶é‡å‘½å&quot; class=&quot;headerlink&quot; title=&quot;è§£å‹å¹¶é‡å‘½å&quot;&gt;&lt;/a&gt;è§£å‹å¹¶é‡å‘½å&lt;/h3&gt;&lt;p&gt;&lt;code&gt;tar -xvzf nebula-graph-3.6.0.el7.x86_64.tar.gz&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;mv nebula-graph-3.6.0.el7.x86_64 nebula&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;ä¿®æ”¹é…ç½®æ–‡ä»¶&quot;&gt;&lt;a href=&quot;#ä¿®æ”¹é…ç½®æ–‡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;ä¿®æ”¹é…ç½®æ–‡ä»¶&quot;&gt;&lt;/a&gt;ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/h3&gt;&lt;p&gt;&lt;code&gt;cd nebula/etc&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;mv nebula-graphd.conf.default nebula-graphd.conf&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;mv nebula-metad.conf.default nebula-metad.conf&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;mv nebula-storaged.conf nebula-storaged.conf&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹å¯¹åº”æ–‡ä»¶å­˜å‚¨ä½ç½®ã€èŠ‚ç‚¹ipåœ°å€ï¼Œé›†ç¾¤åŒç†&lt;/p&gt;</summary>
    
    
    
    <category term="BigData" scheme="http://yoursite.com/categories/BigData/"/>
    
    
    <category term="database" scheme="http://yoursite.com/tags/database/"/>
    
    <category term="nebula" scheme="http://yoursite.com/tags/nebula/"/>
    
  </entry>
  
  <entry>
    <title>paddleDetection Demo</title>
    <link href="http://yoursite.com/2023/08/31/paddleDetection%20Demo/"/>
    <id>http://yoursite.com/2023/08/31/paddleDetection%20Demo/</id>
    <published>2023-08-31T04:20:20.000Z</published>
    <updated>2024-01-25T09:14:54.938Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><h2 id="PPHuman"><a href="#PPHuman" class="headerlink" title="PPHuman"></a>PPHuman</h2><h3 id="è¡Œäººå±æ€§è¯†åˆ«"><a href="#è¡Œäººå±æ€§è¯†åˆ«" class="headerlink" title="è¡Œäººå±æ€§è¯†åˆ«"></a>è¡Œäººå±æ€§è¯†åˆ«</h3><h4 id="è¡Œäººå±æ€§"><a href="#è¡Œäººå±æ€§" class="headerlink" title="è¡Œäººå±æ€§"></a>è¡Œäººå±æ€§</h4><p>cfgï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">crop_thresh:</span> <span class="number">0.5</span></span><br><span class="line"><span class="attr">attr_thresh:</span> <span class="number">0.5</span></span><br><span class="line"><span class="attr">kpt_thresh:</span> <span class="number">0.2</span></span><br><span class="line"><span class="attr">visual:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">warmup_frame:</span> <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="attr">DET:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/mot_ppyoloe_l_36e_pipeline.zip</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">MOT:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/mot_ppyoloe_l_36e_pipeline.zip</span></span><br><span class="line">  <span class="attr">tracker_config:</span> <span class="string">/exp/work/video/PaddleDetection/deploy/pipeline/config/tracker_config.yml</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">skip_frame_num:</span> <span class="number">-1</span> <span class="comment"># preferably no more than 3</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="attr">KPT:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/dark_hrnet_w32_256x192.zip</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">ATTR:</span></span><br><span class="line">  <span class="attr">model_dir:</span>  <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/PPLCNet_x1_0_person_attribute_945_infer.zip</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">8</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>cliï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/cache/cfg_human.yml --device=gpu --video_file=demo_input/human.mp4 --output_dir=demo_output/</span><br></pre></td></tr></table></figure><p><img src="/2023/08/31/paddleDetection Demo/è¡Œäººå±æ€§.gif" alt></p><a id="more"></a><h3 id="è¡Œäººè¡Œä¸ºè¯†åˆ«"><a href="#è¡Œäººè¡Œä¸ºè¯†åˆ«" class="headerlink" title="è¡Œäººè¡Œä¸ºè¯†åˆ«"></a>è¡Œäººè¡Œä¸ºè¯†åˆ«</h3><h4 id="è·Œå€’"><a href="#è·Œå€’" class="headerlink" title="è·Œå€’"></a>è·Œå€’</h4><p>cfgï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">crop_thresh:</span> <span class="number">0.5</span></span><br><span class="line"><span class="attr">kpt_thresh:</span> <span class="number">0.2</span></span><br><span class="line"><span class="attr">visual:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">warmup_frame:</span> <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="attr">MOT:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/mot_ppyoloe_s_36e_pipeline.zip</span></span><br><span class="line">  <span class="attr">tracker_config:</span> <span class="string">/exp/work/video/PaddleDetection/deploy/pipeline/config/tracker_config.yml</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">KPT:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/dark_hrnet_w32_256x192.zip</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">SKELETON_ACTION:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/STGCN.zip</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">max_frames:</span> <span class="number">50</span></span><br><span class="line">  <span class="attr">display_frames:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">coord_size:</span> <span class="string">[384,</span> <span class="number">512</span><span class="string">]</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>cliï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/cache/cfg_fall.yml --device=gpu --video_file=demo_input/fall.mp4 --output_dir=demo_output/</span><br></pre></td></tr></table></figure><p><img src="/2023/08/31/paddleDetection Demo/è·Œå€’.gif" alt></p><h4 id="æ¥æ‰“ç”µè¯"><a href="#æ¥æ‰“ç”µè¯" class="headerlink" title="æ¥æ‰“ç”µè¯"></a>æ¥æ‰“ç”µè¯</h4><p>cfgï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">crop_thresh:</span> <span class="number">0.5</span></span><br><span class="line"><span class="attr">kpt_thresh:</span> <span class="number">0.2</span></span><br><span class="line"><span class="attr">visual:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">warmup_frame:</span> <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="attr">MOT:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/mot_ppyoloe_s_36e_pipeline.zip</span></span><br><span class="line">  <span class="attr">tracker_config:</span> <span class="string">/exp/work/video/PaddleDetection/deploy/pipeline/config/tracker_config.yml</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="attr">ID_BASED_CLSACTION:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/PPHGNet_tiny_calling_halfbody.zip</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">8</span></span><br><span class="line">  <span class="attr">threshold:</span> <span class="number">0.8</span></span><br><span class="line">  <span class="attr">display_frames:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">skip_frame_num:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="attr">KPT:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/dark_hrnet_w32_256x192.zip</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">8</span></span><br></pre></td></tr></table></figure><p>cliï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/cache/cfg_call.yml --device=gpu --video_file=demo_input/call.mp4 --output_dir=demo_output/</span><br></pre></td></tr></table></figure><p><img src="/2023/08/31/paddleDetection Demo/æ¥æ‰“ç”µè¯.gif" alt></p><h4 id="å¸çƒŸ"><a href="#å¸çƒŸ" class="headerlink" title="å¸çƒŸ"></a>å¸çƒŸ</h4><p>cfgï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">crop_thresh:</span> <span class="number">0.5</span></span><br><span class="line"><span class="attr">kpt_thresh:</span> <span class="number">0.2</span></span><br><span class="line"><span class="attr">visual:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">warmup_frame:</span> <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="attr">MOT:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/mot_ppyoloe_s_36e_pipeline.zip</span></span><br><span class="line">  <span class="attr">tracker_config:</span> <span class="string">/exp/work/video/PaddleDetection/deploy/pipeline/config/tracker_config.yml</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="attr">ID_BASED_DETACTION:</span></span><br><span class="line">  <span class="attr">model_dir:</span>  <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/ppyoloe_crn_s_80e_smoking_visdrone.zip</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">8</span></span><br><span class="line">  <span class="attr">threshold:</span> <span class="number">0.6</span></span><br><span class="line">  <span class="attr">display_frames:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">skip_frame_num:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="attr">KPT:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/dark_hrnet_w32_256x192.zip</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">8</span></span><br></pre></td></tr></table></figure><p>cliï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/cache/cfg_smoke.yml --device=gpu --video_file=demo_input/smoke.mp4 --output_dir=demo_output/</span><br></pre></td></tr></table></figure><p><img src="/2023/08/31/paddleDetection Demo/å¸çƒŸ.gif" style="zoom:150%;"></p><h4 id="æ‰“æ¶"><a href="#æ‰“æ¶" class="headerlink" title="æ‰“æ¶"></a>æ‰“æ¶</h4><p>cfgï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">crop_thresh:</span> <span class="number">0.5</span></span><br><span class="line"><span class="attr">kpt_thresh:</span> <span class="number">0.2</span></span><br><span class="line"><span class="attr">visual:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">warmup_frame:</span> <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="attr">MOT:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/mot_ppyoloe_s_36e_pipeline.zip</span></span><br><span class="line">  <span class="attr">tracker_config:</span> <span class="string">/exp/work/video/PaddleDetection/deploy/pipeline/config/tracker_config.yml</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="attr">KPT:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/dark_hrnet_w32_256x192.zip</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">VIDEO_ACTION:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://videotag.bj.bcebos.com/PaddleVideo-release2.3/ppTSM_fight.zip</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">frame_len:</span> <span class="number">8</span></span><br><span class="line">  <span class="attr">sample_freq:</span> <span class="number">7</span></span><br><span class="line">  <span class="attr">short_size:</span> <span class="number">340</span></span><br><span class="line">  <span class="attr">target_size:</span> <span class="number">320</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>cliï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/cache/cfg_fight.yml --device=gpu --video_file=demo_input/fight.mp4 --output_dir=demo_output/</span><br></pre></td></tr></table></figure><p><img src="/2023/08/31/paddleDetection Demo/æ‰“æ¶.gif" alt></p><h4 id="è¡Œäººè¿›å…¥"><a href="#è¡Œäººè¿›å…¥" class="headerlink" title="è¡Œäººè¿›å…¥"></a>è¡Œäººè¿›å…¥</h4><p>cfgï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">crop_thresh:</span> <span class="number">0.5</span></span><br><span class="line"><span class="attr">visual:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">warmup_frame:</span> <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="attr">MOT:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/mot_ppyoloe_l_36e_pipeline.zip</span></span><br><span class="line">  <span class="attr">tracker_config:</span> <span class="string">/exp/work/video/PaddleDetection/backend/pp_config/tracker_config.yml</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">skip_frame_num:</span> <span class="number">-1</span> <span class="comment"># preferably no more than 3</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>cliï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/cache/cfg_entrance.yml --region_type=bottom --do_entrance_counting --device=gpu --video_file=demo_input/entrance.mp4 --output_dir=demo_output/</span><br></pre></td></tr></table></figure><p><img src="/2023/08/31/paddleDetection Demo/è¡Œäººè¿›å…¥.gif" alt></p><h4 id="ç¦åŒº"><a href="#ç¦åŒº" class="headerlink" title="ç¦åŒº"></a>ç¦åŒº</h4><p>cfgï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">crop_thresh:</span> <span class="number">0.5</span></span><br><span class="line"><span class="attr">visual:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">warmup_frame:</span> <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="attr">MOT:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/mot_ppyoloe_l_36e_pipeline.zip</span></span><br><span class="line">  <span class="attr">tracker_config:</span> <span class="string">/exp/work/video/PaddleDetection/backend/pp_config/tracker_config.yml</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">skip_frame_num:</span> <span class="number">-1</span> <span class="comment"># preferably no more than 3</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>cliï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/cache/cfg_entrance.yml --do_break_in_counting=true --region_type=custom --region_polygon 355 700 1100 700 915 900 50 900 --device=gpu --video_file=demo_input/forb.mp4 --output_dir=demo_output/</span><br></pre></td></tr></table></figure><p><img src="/2023/08/31/paddleDetection Demo/ç¦åŒº.gif" alt></p><h2 id="PPVehicle"><a href="#PPVehicle" class="headerlink" title="PPVehicle"></a>PPVehicle</h2><h3 id="è½¦è¾†å±æ€§è¯†åˆ«"><a href="#è½¦è¾†å±æ€§è¯†åˆ«" class="headerlink" title="è½¦è¾†å±æ€§è¯†åˆ«"></a>è½¦è¾†å±æ€§è¯†åˆ«</h3><h4 id="è½¦è¾†å±æ€§"><a href="#è½¦è¾†å±æ€§" class="headerlink" title="è½¦è¾†å±æ€§"></a>è½¦è¾†å±æ€§</h4><p>cfgï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">crop_thresh:</span> <span class="number">0.5</span></span><br><span class="line"><span class="attr">visual:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">warmup_frame:</span> <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="attr">DET:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/mot_ppyoloe_s_36e_ppvehicle.zip</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">MOT:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/mot_ppyoloe_s_36e_ppvehicle.zip</span></span><br><span class="line">  <span class="attr">tracker_config:</span> <span class="string">/exp/work/video/PaddleDetection/backend/pp_config/tracker_config.yml</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">skip_frame_num:</span> <span class="number">3</span> <span class="comment"># preferably no more than 3</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="attr">VEHICLE_PLATE:</span></span><br><span class="line">  <span class="attr">det_model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/ch_PP-OCRv3_det_infer.tar.gz</span></span><br><span class="line">  <span class="attr">det_limit_side_len:</span> <span class="number">736</span></span><br><span class="line">  <span class="attr">det_limit_type:</span> <span class="string">"min"</span></span><br><span class="line">  <span class="attr">rec_model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/ch_PP-OCRv3_rec_infer.tar.gz</span></span><br><span class="line">  <span class="attr">rec_image_shape:</span> <span class="string">[3,</span> <span class="number">48</span><span class="string">,</span> <span class="number">320</span><span class="string">]</span></span><br><span class="line">  <span class="attr">rec_batch_num:</span> <span class="number">6</span></span><br><span class="line">  <span class="attr">word_dict_path:</span> <span class="string">/exp/work/video/PaddleDetection/deploy/pipeline/ppvehicle/rec_word_dict.txt</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="attr">VEHICLE_ATTR:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/vehicle_attribute_model.zip</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">8</span></span><br><span class="line">  <span class="attr">color_threshold:</span> <span class="number">0.5</span></span><br><span class="line">  <span class="attr">type_threshold:</span> <span class="number">0.5</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="attr">LANE_SEG:</span></span><br><span class="line">  <span class="attr">lane_seg_config:</span> <span class="string">deploy/pipeline/config/lane_seg_config.yml</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/pp_lite_stdc2_bdd100k.zip</span></span><br></pre></td></tr></table></figure><p>cliï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/cache/cfg_car.yml --device=gpu --video_file=demo_input/car.mp4 --output_dir=demo_output/</span><br></pre></td></tr></table></figure><p><img src="/2023/08/31/paddleDetection Demo/è½¦è¾†å±æ€§.gif" alt></p><h3 id="è½¦è¾†è¡Œä¸ºè¯†åˆ«"><a href="#è½¦è¾†è¡Œä¸ºè¯†åˆ«" class="headerlink" title="è½¦è¾†è¡Œä¸ºè¯†åˆ«"></a>è½¦è¾†è¡Œä¸ºè¯†åˆ«</h3><h4 id="ç¦æ­¢åœè½¦"><a href="#ç¦æ­¢åœè½¦" class="headerlink" title="ç¦æ­¢åœè½¦"></a>ç¦æ­¢åœè½¦</h4><p>cfgï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">crop_thresh:</span> <span class="number">0.5</span></span><br><span class="line"><span class="attr">visual:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">warmup_frame:</span> <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="attr">MOT:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/mot_ppyoloe_s_36e_ppvehicle.zip</span></span><br><span class="line">  <span class="attr">tracker_config:</span> <span class="string">/exp/work/video/PaddleDetection/deploy/pipeline/config/tracker_config.yml</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="attr">VEHICLE_PLATE:</span></span><br><span class="line">  <span class="attr">det_model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/ch_PP-OCRv3_det_infer.tar.gz</span></span><br><span class="line">  <span class="attr">det_limit_side_len:</span> <span class="number">736</span></span><br><span class="line">  <span class="attr">det_limit_type:</span> <span class="string">"min"</span></span><br><span class="line">  <span class="attr">rec_model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/ch_PP-OCRv3_rec_infer.tar.gz</span></span><br><span class="line">  <span class="attr">rec_image_shape:</span> <span class="string">[3,</span> <span class="number">48</span><span class="string">,</span> <span class="number">320</span><span class="string">]</span></span><br><span class="line">  <span class="attr">rec_batch_num:</span> <span class="number">6</span></span><br><span class="line">  <span class="attr">word_dict_path:</span> <span class="string">/exp/work/video/PaddleDetection/deploy/pipeline/ppvehicle/rec_word_dict.txt</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>cliï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/cache/cfg_park.yml --region_type=custom --FLAGS.illegal_parking_time=5 --region_polygon 600 200 1400 200 1400 900 600 900 --device=gpu --video_file=demo_input/park.mp4 --output_dir=demo_output/</span><br></pre></td></tr></table></figure><p><img src="/2023/08/31/paddleDetection Demo/ç¦æ­¢åœè½¦.gif" alt></p><h2 id="äººè„¸è¯†åˆ«"><a href="#äººè„¸è¯†åˆ«" class="headerlink" title="äººè„¸è¯†åˆ«"></a>äººè„¸è¯†åˆ«</h2><h4 id="äººè„¸è¯†åˆ«-1"><a href="#äººè„¸è¯†åˆ«-1" class="headerlink" title="äººè„¸è¯†åˆ«"></a>äººè„¸è¯†åˆ«</h4><p>cfgï¼ˆéœ€paddleDetectioné›†æˆarcfaceï¼‰ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">crop_thresh:</span> <span class="number">0.5</span></span><br><span class="line"><span class="attr">attr_thresh:</span> <span class="number">0.5</span></span><br><span class="line"><span class="attr">kpt_thresh:</span> <span class="number">0.2</span></span><br><span class="line"><span class="attr">visual:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">warmup_frame:</span> <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="attr">FACE_DET:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="attr">FACE_REC:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><p>cliï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/cache/cfg_face.yml --device=gpu --video_file=demo_input/face.mp4 --output_dir=demo_output/</span><br></pre></td></tr></table></figure><p><img src="/2023/08/31/paddleDetection Demo/äººè„¸è¯†åˆ«.gif" style="zoom: 200%;"></p><h2 id="OCR"><a href="#OCR" class="headerlink" title="OCR"></a>OCR</h2><h3 id="è§†é¢‘OCR"><a href="#è§†é¢‘OCR" class="headerlink" title="è§†é¢‘OCR"></a>è§†é¢‘OCR</h3><p>cfgï¼ˆéœ€paddleDetectioné›†æˆpaddleOCRï¼‰ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">crop_thresh:</span> <span class="number">0.5</span></span><br><span class="line"><span class="attr">attr_thresh:</span> <span class="number">0.5</span></span><br><span class="line"><span class="attr">kpt_thresh:</span> <span class="number">0.2</span></span><br><span class="line"><span class="attr">visual:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">warmup_frame:</span> <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="attr">OCR:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>cliï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/cache/cfg_ocr.yml --device=gpu --video_file=demo_input/ocr.mp4 --output_dir=demo_output/</span><br></pre></td></tr></table></figure><p><img src="/2023/08/31/paddleDetection Demo/OCR.gif" alt></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;PPHuman&quot;&gt;&lt;a href=&quot;#PPHuman&quot; class=&quot;headerlink&quot; title=&quot;PPHuman&quot;&gt;&lt;/a&gt;PPHuman&lt;/h2&gt;&lt;h3 id=&quot;è¡Œäººå±æ€§è¯†åˆ«&quot;&gt;&lt;a href=&quot;#è¡Œäººå±æ€§è¯†åˆ«&quot; class=&quot;headerlink&quot; title=&quot;è¡Œäººå±æ€§è¯†åˆ«&quot;&gt;&lt;/a&gt;è¡Œäººå±æ€§è¯†åˆ«&lt;/h3&gt;&lt;h4 id=&quot;è¡Œäººå±æ€§&quot;&gt;&lt;a href=&quot;#è¡Œäººå±æ€§&quot; class=&quot;headerlink&quot; title=&quot;è¡Œäººå±æ€§&quot;&gt;&lt;/a&gt;è¡Œäººå±æ€§&lt;/h4&gt;&lt;p&gt;cfgï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;crop_thresh:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;attr_thresh:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;kpt_thresh:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0.2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;visual:&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;True&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;warmup_frame:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;50&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;DET:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;model_dir:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;https://bj.bcebos.com/v1/paddledet/models/pipeline/mot_ppyoloe_l_36e_pipeline.zip&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;batch_size:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;MOT:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;model_dir:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;https://bj.bcebos.com/v1/paddledet/models/pipeline/mot_ppyoloe_l_36e_pipeline.zip&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;tracker_config:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/exp/work/video/PaddleDetection/deploy/pipeline/config/tracker_config.yml&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;batch_size:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;skip_frame_num:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;# preferably no more than 3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;enable:&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;True&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;KPT:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;model_dir:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;https://bj.bcebos.com/v1/paddledet/models/pipeline/dark_hrnet_w32_256x192.zip&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;batch_size:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;ATTR:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;model_dir:&lt;/span&gt;  &lt;span class=&quot;string&quot;&gt;https://bj.bcebos.com/v1/paddledet/models/pipeline/PPLCNet_x1_0_person_attribute_945_infer.zip&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;batch_size:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;enable:&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;True&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;cliï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;python deploy/pipeline/pipeline.py --config deploy/pipeline/config/cache/cfg_human.yml --device=gpu --video_file=demo_input/human.mp4 --output_dir=demo_output/&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;/2023/08/31/paddleDetection Demo/è¡Œäººå±æ€§.gif&quot; alt&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://yoursite.com/categories/æ·±åº¦å­¦ä¹ /"/>
    
    
    <category term="paddlepaddle" scheme="http://yoursite.com/tags/paddlepaddle/"/>
    
    <category term="opencv" scheme="http://yoursite.com/tags/opencv/"/>
    
  </entry>
  
  <entry>
    <title>LiveGBSå›½æ ‡GB/T28181è§†é¢‘æµåª’ä½“å¹³å°</title>
    <link href="http://yoursite.com/2023/08/18/LiveGBS%E5%9B%BD%E6%A0%87GB-T28181%E8%A7%86%E9%A2%91%E6%B5%81%E5%AA%92%E4%BD%93%E5%B9%B3%E5%8F%B0/"/>
    <id>http://yoursite.com/2023/08/18/LiveGBS%E5%9B%BD%E6%A0%87GB-T28181%E8%A7%86%E9%A2%91%E6%B5%81%E5%AA%92%E4%BD%93%E5%B9%B3%E5%8F%B0/</id>
    <published>2023-08-18T08:34:45.000Z</published>
    <updated>2023-08-18T08:35:21.653Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><h2 id="è½¯ä»¶åŒ…ä¸‹è½½"><a href="#è½¯ä»¶åŒ…ä¸‹è½½" class="headerlink" title="è½¯ä»¶åŒ…ä¸‹è½½"></a>è½¯ä»¶åŒ…ä¸‹è½½</h2><p>LiveGBS GB28181æµåª’ä½“æœåŠ¡ä¸‹è½½åœ°å€ï¼š<a href="https://www.liveqing.com/docs/download/LiveGBS.html#%E7%89%88%E6%9C%AC%E4%B8%8B%E8%BD%BD" target="_blank" rel="noopener">https://www.liveqing.com/docs/download/LiveGBS.html#%E7%89%88%E6%9C%AC%E4%B8%8B%E8%BD%BD</a></p><p>é€‰æ‹©windowsç‰ˆæœ¬çš„<code>LiveGBS ä¿¡ä»¤æœåŠ¡</code>å’Œ<code>LiveGBS</code>æµåª’ä½“æœåŠ¡ï¼Œå…è´¹ç‰ˆæˆæƒå‘¨æœŸä¸º26å¤©ï¼Œå±Šæ—¶éœ€è¦æ‰‹åŠ¨æ›´æ–°è½¯ä»¶æœåŠ¡</p><p><img src="/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/A.png" style="zoom:80%;"></p><h2 id="å®‰è£…LiveGBS-GB28281"><a href="#å®‰è£…LiveGBS-GB28281" class="headerlink" title="å®‰è£…LiveGBS GB28281"></a>å®‰è£…LiveGBS GB28281</h2><p>è§£å‹ä¸‹è½½å¥½çš„è½¯ä»¶åŒ…ï¼Œåˆ†åˆ«å¯åŠ¨<code>LiveCMS.exe</code>å’Œ<code>LiveSMS.exe</code>ï¼Œå¦‚æœæœ‰é»˜è®¤ç«¯å£è¢«å ç”¨çš„æƒ…å†µå¯ä»¥ä¿®æ”¹å¯¹åº”çš„<code>livecms.ini</code>æˆ–<code>livesms.ini</code>é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘å°†LiveGBSçš„é»˜è®¤ç«¯å£ä»10000ä¿®æ”¹ä¸º10005</p><p>æˆåŠŸå¯åŠ¨ååå°å‡ºç°livecmså’Œlivesmsçš„å›¾æ ‡</p><p><img src="/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/B.png" alt></p><a id="more"></a><h3 id="é…ç½®LiveGBS"><a href="#é…ç½®LiveGBS" class="headerlink" title="é…ç½®LiveGBS"></a>é…ç½®LiveGBS</h3><p>è¿›å…¥<code>&lt;host&gt;:10005</code>ï¼Œç‚¹å‡»åŸºç¡€é…ç½®ï¼Œä¿®æ”¹ä¿¡ä»¤æœåŠ¡é…ç½®å’Œæµåª’ä½“æœåŠ¡é…ç½®</p><p><img src="/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/C.png" alt></p><p><img src="/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/D.png" alt></p><h3 id="é…ç½®è§†é¢‘è®¾å¤‡"><a href="#é…ç½®è§†é¢‘è®¾å¤‡" class="headerlink" title="é…ç½®è§†é¢‘è®¾å¤‡"></a>é…ç½®è§†é¢‘è®¾å¤‡</h3><p>è¿›å…¥ç½‘ç»œè¿æ¥ï¼Œé€‰æ‹©å¯¹åº”çš„ä»¥å¤ªç½‘ï¼Œå³é”®<code>å±æ€§</code>ï¼Œé€‰æ‹©<code>Internet åè®®ç‰ˆæœ¬ 4 (TCP/IPv4)</code>ï¼Œé€‰æ‹©<code>é«˜çº§</code>ï¼Œæ·»åŠ è¿‘ç«¯è®¾å¤‡å’Œæ‘„åƒå¤´çš„ç½‘æ®µ</p><p><img src="/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/E.png" alt></p><p>è¿›å…¥è®¾å¤‡IPï¼Œä¿®æ”¹å¯¹åº”çš„ç½‘ç»œé…ç½®ã€è¿‘ç«¯é…ç½®å’Œæ‘„åƒå¤´é…ç½®</p><p><img src="/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/F.png" alt></p><p><img src="/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/G.png" alt></p><p><img src="/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/H.png" alt></p><p>é…ç½®å®Œæˆä»¥åç‚¹å‡»ç”¨æˆ·<code>admin</code>ï¼Œé€‰æ‹©é‡å¯è®¾å¤‡</p><p><img src="/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/I.png" alt></p><h2 id="è§†é¢‘æ‹‰æµ"><a href="#è§†é¢‘æ‹‰æµ" class="headerlink" title="è§†é¢‘æ‹‰æµ"></a>è§†é¢‘æ‹‰æµ</h2><p>å›åˆ°<code>&lt;host&gt;:10005</code>ï¼Œæ­¤æ—¶å·²ç»å¯ä»¥è®¿é—®æ‘„åƒå¤´</p><p><img src="/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/J.png" alt></p><p>ç‚¹å‡»å›½æ ‡è®¾å¤‡ï¼ŒæŸ¥çœ‹é€šé“</p><p><img src="/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/K.png" alt></p><p>çœ‹åˆ°å·²ç»é…ç½®å¥½çš„æ‘„åƒå¤´ä¿¡æ¯</p><p><img src="/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/L.png" alt></p><p><img src="/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/M.png" alt></p><p>å¯ä»å³ä¸‹è§’è·å–è§†é¢‘æ‹‰æµ</p><p><img src="/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/N.png" alt></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;è½¯ä»¶åŒ…ä¸‹è½½&quot;&gt;&lt;a href=&quot;#è½¯ä»¶åŒ…ä¸‹è½½&quot; class=&quot;headerlink&quot; title=&quot;è½¯ä»¶åŒ…ä¸‹è½½&quot;&gt;&lt;/a&gt;è½¯ä»¶åŒ…ä¸‹è½½&lt;/h2&gt;&lt;p&gt;LiveGBS GB28181æµåª’ä½“æœåŠ¡ä¸‹è½½åœ°å€ï¼š&lt;a href=&quot;https://www.liveqing.com/docs/download/LiveGBS.html#%E7%89%88%E6%9C%AC%E4%B8%8B%E8%BD%BD&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.liveqing.com/docs/download/LiveGBS.html#%E7%89%88%E6%9C%AC%E4%B8%8B%E8%BD%BD&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é€‰æ‹©windowsç‰ˆæœ¬çš„&lt;code&gt;LiveGBS ä¿¡ä»¤æœåŠ¡&lt;/code&gt;å’Œ&lt;code&gt;LiveGBS&lt;/code&gt;æµåª’ä½“æœåŠ¡ï¼Œå…è´¹ç‰ˆæˆæƒå‘¨æœŸä¸º26å¤©ï¼Œå±Šæ—¶éœ€è¦æ‰‹åŠ¨æ›´æ–°è½¯ä»¶æœåŠ¡&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/A.png&quot; style=&quot;zoom:80%;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;å®‰è£…LiveGBS-GB28281&quot;&gt;&lt;a href=&quot;#å®‰è£…LiveGBS-GB28281&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…LiveGBS GB28281&quot;&gt;&lt;/a&gt;å®‰è£…LiveGBS GB28281&lt;/h2&gt;&lt;p&gt;è§£å‹ä¸‹è½½å¥½çš„è½¯ä»¶åŒ…ï¼Œåˆ†åˆ«å¯åŠ¨&lt;code&gt;LiveCMS.exe&lt;/code&gt;å’Œ&lt;code&gt;LiveSMS.exe&lt;/code&gt;ï¼Œå¦‚æœæœ‰é»˜è®¤ç«¯å£è¢«å ç”¨çš„æƒ…å†µå¯ä»¥ä¿®æ”¹å¯¹åº”çš„&lt;code&gt;livecms.ini&lt;/code&gt;æˆ–&lt;code&gt;livesms.ini&lt;/code&gt;é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘å°†LiveGBSçš„é»˜è®¤ç«¯å£ä»10000ä¿®æ”¹ä¸º10005&lt;/p&gt;
&lt;p&gt;æˆåŠŸå¯åŠ¨ååå°å‡ºç°livecmså’Œlivesmsçš„å›¾æ ‡&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2023/08/18/LiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°/B.png&quot; alt&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="è®¡ç®—æœºè§†è§‰" scheme="http://yoursite.com/categories/è®¡ç®—æœºè§†è§‰/"/>
    
    
    <category term="LiveGBS" scheme="http://yoursite.com/tags/LiveGBS/"/>
    
  </entry>
  
  <entry>
    <title>paddleDetection-è§†é¢‘OCR</title>
    <link href="http://yoursite.com/2023/08/14/paddleDetection-%E8%A7%86%E9%A2%91OCR/"/>
    <id>http://yoursite.com/2023/08/14/paddleDetection-%E8%A7%86%E9%A2%91OCR/</id>
    <published>2023-08-14T03:15:55.000Z</published>
    <updated>2023-08-29T09:18:54.671Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><h2 id="PPOCR-V4"><a href="#PPOCR-V4" class="headerlink" title="PPOCR_V4"></a>PPOCR_V4</h2><p>å®‰è£…ç™¾åº¦æœ€æ–°ppocr_v4åº“ï¼Œä½¿ç”¨è™šæ‹Ÿç¯å¢ƒä¸ºpy39_vioï¼Œæœ¬è™šæ‹Ÿç¯å¢ƒä¸å¯ä¸äººè„¸è¯†åˆ«ï¼ˆpy38_arcfaceï¼‰å…¼å®¹ï¼ˆopencvç‰ˆæœ¬ä¸å…¼å®¹ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install paddleocr --user -i https://mirror.baidu.com/pypi/simple</span><br></pre></td></tr></table></figure><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p><code>cfg_utils.py</code>æ–°å¢cfg<code>--ocr</code>ï¼Œè®¾ç½®Trueä¸ºå¼€å¯ï¼Œé»˜è®¤False</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">parser.add_argument(</span><br><span class="line">    <span class="string">"--ocr"</span>,</span><br><span class="line">    type=bool,</span><br><span class="line">    default=<span class="literal">False</span>,</span><br><span class="line">    help=<span class="string">"use paddlepaddle-ocr"</span>)</span><br></pre></td></tr></table></figure><p><code>pipeline.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> python.visualize <span class="keyword">import</span> visualize_box_mask, visualize_attr, visualize_pose, visualize_action, visualize_vehicleplate, visualize_vehiclepress, visualize_lane, visualize_vehicle_retrograde, visualize_ocr</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PipePredictor</span><span class="params">(object)</span>:</span>  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, args, cfg, is_video=True, multi_camera=False)</span>:</span></span><br><span class="line">    self.ocr = args.ocr</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">visualize_video</span><span class="params">(self,</span></span></span><br><span class="line"><span class="function"><span class="params">                    image_rgb,</span></span></span><br><span class="line"><span class="function"><span class="params">                    result,</span></span></span><br><span class="line"><span class="function"><span class="params">                    collector,</span></span></span><br><span class="line"><span class="function"><span class="params">                    frame_id,</span></span></span><br><span class="line"><span class="function"><span class="params">                    fps,</span></span></span><br><span class="line"><span class="function"><span class="params">                    entrance=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                    records=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                    center_traj=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                    do_illegal_parking_recognition=False,</span></span></span><br><span class="line"><span class="function"><span class="params">                    illegal_parking_dict=None)</span>:</span></span><br><span class="line">    image = cv2.cvtColor(image_rgb, cv2.COLOR_RGB2BGR)</span><br><span class="line">    mot_res = copy.deepcopy(result.get(<span class="string">'mot'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.ocr:</span><br><span class="line">        lock.acquire() <span class="comment"># åŠ é”ï¼ŒpaddleOCRæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„</span></span><br><span class="line">        ocr_result = ocr.ocr(image, cls=<span class="literal">True</span>)[<span class="number">0</span>]</span><br><span class="line">        lock.release()</span><br><span class="line">        ocr_boxes = [line[<span class="number">0</span>] <span class="keyword">for</span> line <span class="keyword">in</span> ocr_result]</span><br><span class="line">        ocr_txts = [line[<span class="number">1</span>][<span class="number">0</span>] <span class="keyword">for</span> line <span class="keyword">in</span> ocr_result]</span><br><span class="line">        ocr_scores = [line[<span class="number">1</span>][<span class="number">1</span>] <span class="keyword">for</span> line <span class="keyword">in</span> ocr_result]</span><br><span class="line">        </span><br><span class="line">        image = visualize_ocr(image, ocr_boxes, ocr_txts, ocr_scores)</span><br></pre></td></tr></table></figure><p><code>visualize.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">visualize_ocr</span><span class="params">(im, boxes, texts, score)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(im, str):</span><br><span class="line">        im = Image.open(im)</span><br><span class="line">        im = np.ascontiguousarray(np.copy(im))</span><br><span class="line">        im = cv2.cvtColor(im, cv2.COLOR_RGB2BGR)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        im = np.ascontiguousarray(np.copy(im))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ›å»ºé€æ˜å›¾å±‚ï¼Œä¸ºå›¾åƒæ·»åŠ æ–‡å­—æ°´å°</span></span><br><span class="line">    im = Image.fromarray(im)</span><br><span class="line">    im = im.convert(<span class="string">'RGBA'</span>)</span><br><span class="line">    im_canvas = Image.new(<span class="string">'RGBA'</span>, im.size, (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, res <span class="keyword">in</span> enumerate(texts):</span><br><span class="line">        <span class="keyword">if</span> boxes <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            box = boxes[i]</span><br><span class="line">            text = res</span><br><span class="line">            <span class="keyword">if</span> text == <span class="string">""</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            text_scale = max(<span class="number">1.0</span>, int(box[<span class="number">2</span>][<span class="number">1</span>] - box[<span class="number">1</span>][<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">            draw = ImageDraw.Draw(im_canvas)</span><br><span class="line">            draw.text(</span><br><span class="line">                (box[<span class="number">0</span>][<span class="number">0</span>], box[<span class="number">0</span>][<span class="number">1</span>]),</span><br><span class="line">                text,</span><br><span class="line">                font=ImageFont.truetype(font_file, size=int(text_scale)),</span><br><span class="line">                fill=(<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">85</span>)) <span class="comment"># ç¬¬å››ä½æ˜¯é€æ˜åº¦</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                draw.rectangle(</span><br><span class="line">                    ((box[<span class="number">0</span>][<span class="number">0</span>], box[<span class="number">0</span>][<span class="number">1</span>]), (box[<span class="number">2</span>][<span class="number">0</span>], box[<span class="number">2</span>][<span class="number">1</span>])),</span><br><span class="line">                    fill=<span class="literal">None</span>,</span><br><span class="line">                    outline=(<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>),</span><br><span class="line">                    width=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">except</span> ValueError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¤åˆå›¾å±‚</span></span><br><span class="line">    im = Image.alpha_composite(im, im_canvas)</span><br><span class="line">    im = im.convert(<span class="string">'RGB'</span>)</span><br><span class="line">    <span class="comment"># è¿˜åŸè¿ç»­å­˜å‚¨æ•°ç»„</span></span><br><span class="line">    im = np.ascontiguousarray(np.copy(im))</span><br><span class="line">    <span class="keyword">return</span> im</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><p>åœ¨<code>deploy/pipeline/config</code>ä¸‹åˆ›å»ºè§†é¢‘ocrçš„ymlæ–‡ä»¶<code>infer_cfg_ppocr.yml</code>ï¼Œå†™å…¥åŸºæœ¬å‚æ•°</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">crop_thresh:</span> <span class="number">0.5</span></span><br><span class="line"><span class="attr">visual:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">warmup_frame:</span> <span class="number">50</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/infer_cfg_ppocr.yml --device=gpu --video_file=demo_input/car_t1.mp4 --output_dir=demo_output --ocr=True</span><br></pre></td></tr></table></figure><p><img src="/2023/08/14/paddleDetection-è§†é¢‘OCR/A.png" alt></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;PPOCR-V4&quot;&gt;&lt;a href=&quot;#PPOCR-V4&quot; class=&quot;headerlink&quot; title=&quot;PPOCR_V4&quot;&gt;&lt;/a&gt;PPOCR_V4&lt;/h2&gt;&lt;p&gt;å®‰è£…ç™¾åº¦æœ€æ–°ppocr_v4åº“ï¼Œä½¿ç”¨è™šæ‹Ÿç¯å¢ƒä¸ºpy39_vioï¼Œæœ¬è™šæ‹Ÿç¯å¢ƒä¸å¯ä¸äººè„¸è¯†åˆ«ï¼ˆpy38_arcfaceï¼‰å…¼å®¹ï¼ˆopencvç‰ˆæœ¬ä¸å…¼å®¹ï¼‰&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;pip install paddleocr --user -i https://mirror.baidu.com/pypi/simple&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;ä»£ç &quot;&gt;&lt;a href=&quot;#ä»£ç &quot; class=&quot;headerlink&quot; title=&quot;ä»£ç &quot;&gt;&lt;/a&gt;ä»£ç &lt;/h2&gt;&lt;p&gt;&lt;code&gt;cfg_utils.py&lt;/code&gt;æ–°å¢cfg&lt;code&gt;--ocr&lt;/code&gt;ï¼Œè®¾ç½®Trueä¸ºå¼€å¯ï¼Œé»˜è®¤False&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;parser.add_argument(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;--ocr&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    type=bool,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    default=&lt;span class=&quot;literal&quot;&gt;False&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    help=&lt;span class=&quot;string&quot;&gt;&quot;use paddlepaddle-ocr&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;pipeline.py&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; python.visualize &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; visualize_box_mask, visualize_attr, visualize_pose, visualize_action, visualize_vehicleplate, visualize_vehiclepress, visualize_lane, visualize_vehicle_retrograde, visualize_ocr&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PipePredictor&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(object)&lt;/span&gt;:&lt;/span&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self, args, cfg, is_video=True, multi_camera=False)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    	self.ocr = args.ocr&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;visualize_video&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;                    image_rgb,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;                    result,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;                    collector,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;                    frame_id,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;                    fps,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;                    entrance=None,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;                    records=None,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;                    center_traj=None,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;                    do_illegal_parking_recognition=False,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;                    illegal_parking_dict=None)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    image = cv2.cvtColor(image_rgb, cv2.COLOR_RGB2BGR)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mot_res = copy.deepcopy(result.get(&lt;span class=&quot;string&quot;&gt;&#39;mot&#39;&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; self.ocr:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        lock.acquire() &lt;span class=&quot;comment&quot;&gt;# åŠ é”ï¼ŒpaddleOCRæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ocr_result = ocr.ocr(image, cls=&lt;span class=&quot;literal&quot;&gt;True&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        lock.release()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ocr_boxes = [line[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; line &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; ocr_result]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ocr_txts = [line[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;][&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; line &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; ocr_result]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ocr_scores = [line[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;][&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; line &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; ocr_result]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        image = visualize_ocr(image, ocr_boxes, ocr_txts, ocr_scores)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;visualize.py&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;visualize_ocr&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(im, boxes, texts, score)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; isinstance(im, str):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        im = Image.open(im)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        im = np.ascontiguousarray(np.copy(im))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        im = cv2.cvtColor(im, cv2.COLOR_RGB2BGR)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        im = np.ascontiguousarray(np.copy(im))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# åˆ›å»ºé€æ˜å›¾å±‚ï¼Œä¸ºå›¾åƒæ·»åŠ æ–‡å­—æ°´å°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    im = Image.fromarray(im)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    im = im.convert(&lt;span class=&quot;string&quot;&gt;&#39;RGBA&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    im_canvas = Image.new(&lt;span class=&quot;string&quot;&gt;&#39;RGBA&#39;&lt;/span&gt;, im.size, (&lt;span class=&quot;number&quot;&gt;255&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;255&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;255&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i, res &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; enumerate(texts):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; boxes &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            box = boxes[i]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            text = res&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; text == &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            text_scale = max(&lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;, int(box[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;][&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] - box[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;][&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            draw = ImageDraw.Draw(im_canvas)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            draw.text(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                (box[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;][&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;], box[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;][&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                text,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                font=ImageFont.truetype(font_file, size=int(text_scale)),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                fill=(&lt;span class=&quot;number&quot;&gt;255&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;255&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;85&lt;/span&gt;)) &lt;span class=&quot;comment&quot;&gt;# ç¬¬å››ä½æ˜¯é€æ˜åº¦&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                draw.rectangle(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    ((box[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;][&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;], box[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;][&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]), (box[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;][&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;], box[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;][&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;])),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    fill=&lt;span class=&quot;literal&quot;&gt;None&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    outline=(&lt;span class=&quot;number&quot;&gt;255&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;255&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    width=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;except&lt;/span&gt; ValueError:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;pass&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# å¤åˆå›¾å±‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    im = Image.alpha_composite(im, im_canvas)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    im = im.convert(&lt;span class=&quot;string&quot;&gt;&#39;RGB&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# è¿˜åŸè¿ç»­å­˜å‚¨æ•°ç»„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    im = np.ascontiguousarray(np.copy(im))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; im&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="OCR" scheme="http://yoursite.com/tags/OCR/"/>
    
    <category term="paddlepaddle" scheme="http://yoursite.com/tags/paddlepaddle/"/>
    
  </entry>
  
  <entry>
    <title>paddleDetection:OpenCVæ£€æµ‹æ¡†è½¬ä¸­æ–‡</title>
    <link href="http://yoursite.com/2023/08/09/paddleDetection-OpenCV%E6%A3%80%E6%B5%8B%E6%A1%86%E8%BD%AC%E4%B8%AD%E6%96%87/"/>
    <id>http://yoursite.com/2023/08/09/paddleDetection-OpenCV%E6%A3%80%E6%B5%8B%E6%A1%86%E8%BD%AC%E4%B8%AD%E6%96%87/</id>
    <published>2023-08-09T08:29:45.000Z</published>
    <updated>2024-01-25T09:20:13.155Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><font color="gold">æ³¨ï¼šOpenCVä¸èƒ½ç›´æ¥æ˜¾ç¤ºä¸­æ–‡ï¼Œé€šè¿‡PILè½¬æ¢ä¼šæŸå¤±ä¸€éƒ¨åˆ†ç®—åŠ›æ€§èƒ½</font><p><img src="/2023/08/09/paddleDetection-OpenCVæ£€æµ‹æ¡†è½¬ä¸­æ–‡/A.png" alt></p><h2 id="ä¿®æ”¹æºç ï¼ˆå¯è§†åŒ–ï¼‰"><a href="#ä¿®æ”¹æºç ï¼ˆå¯è§†åŒ–ï¼‰" class="headerlink" title="ä¿®æ”¹æºç ï¼ˆå¯è§†åŒ–ï¼‰"></a>ä¿®æ”¹æºç ï¼ˆå¯è§†åŒ–ï¼‰</h2><p><code>./deploy/python/visualize.py</code></p><h3 id="å¢åŠ å¯¼å…¥å­—ä½“åº“å’Œå­—ä½“æ–‡ä»¶"><a href="#å¢åŠ å¯¼å…¥å­—ä½“åº“å’Œå­—ä½“æ–‡ä»¶" class="headerlink" title="å¢åŠ å¯¼å…¥å­—ä½“åº“å’Œå­—ä½“æ–‡ä»¶"></a>å¢åŠ å¯¼å…¥å­—ä½“åº“å’Œå­—ä½“æ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFile, ImageFont</span><br><span class="line"></span><br><span class="line">font_file = <span class="string">'/exp/work/video/PaddleDetection/deploy/pipeline/SourceHanSansCN-Medium.otf'</span></span><br></pre></td></tr></table></figure><h3 id="visualize-attr"><a href="#visualize-attr" class="headerlink" title="visualize_attr"></a>visualize_attr</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">visualize_attr</span><span class="params">(im, results, boxes=None, is_mtmct=False)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(im, str):</span><br><span class="line">        im = Image.open(im)</span><br><span class="line">        im = np.ascontiguousarray(np.copy(im))</span><br><span class="line">        im = cv2.cvtColor(im, cv2.COLOR_RGB2BGR)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        im = np.ascontiguousarray(np.copy(im))</span><br><span class="line"></span><br><span class="line">    line_inter = im.shape[<span class="number">0</span>] / <span class="number">40.</span></span><br><span class="line">    text_scale = max(<span class="number">0.5</span>, im.shape[<span class="number">0</span>] / <span class="number">100.</span>)</span><br><span class="line">    <span class="comment"># å°†nparrayå›¾åƒè½¬PILå›¾åƒ</span></span><br><span class="line">    im = Image.fromarray(im)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, res <span class="keyword">in</span> enumerate(results):</span><br><span class="line">        print(i, res)</span><br><span class="line">        <span class="keyword">if</span> boxes <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            text_w = <span class="number">3</span></span><br><span class="line">            text_h = <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> is_mtmct:</span><br><span class="line">            box = boxes[i]  <span class="comment"># multi camera, bbox shape is x,y, w,h</span></span><br><span class="line">            text_w = int(box[<span class="number">0</span>]) + <span class="number">3</span></span><br><span class="line">            text_h = int(box[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            box = boxes[i]  <span class="comment"># single camera, bbox shape is 0, 0, x,y, w,h</span></span><br><span class="line">            text_w = int(box[<span class="number">2</span>]) + <span class="number">3</span></span><br><span class="line">            text_h = int(box[<span class="number">3</span>])</span><br><span class="line">        <span class="keyword">for</span> text <span class="keyword">in</span> res:</span><br><span class="line">            text_h += int(line_inter)</span><br><span class="line">            text_loc = (text_w, text_h)</span><br><span class="line">            <span class="comment"># å†™å…¥</span></span><br><span class="line">            draw = ImageDraw.Draw(im)</span><br><span class="line">            draw.text(</span><br><span class="line">                text_loc,</span><br><span class="line">                text,</span><br><span class="line">                font=ImageFont.truetype(font_file, size=int(text_scale)), <span class="comment"># å­—ä½“ä½ç½®</span></span><br><span class="line">                fill=(<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line">    <span class="comment"># è¿˜åŸè¿ç»­å­˜å‚¨æ•°ç»„</span></span><br><span class="line">    im = np.ascontiguousarray(np.copy(im))</span><br><span class="line">    <span class="keyword">return</span> im</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="visualize-vehicleplate"><a href="#visualize-vehicleplate" class="headerlink" title="visualize_vehicleplate"></a>visualize_vehicleplate</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">visualize_vehicleplate</span><span class="params">(im, results, boxes=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(im, str):</span><br><span class="line">        im = Image.open(im)</span><br><span class="line">        im = np.ascontiguousarray(np.copy(im))</span><br><span class="line">        im = cv2.cvtColor(im, cv2.COLOR_RGB2BGR)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        im = np.ascontiguousarray(np.copy(im))</span><br><span class="line"></span><br><span class="line">    text_scale = max(<span class="number">1.0</span>, im.shape[<span class="number">0</span>] / <span class="number">400.</span>)</span><br><span class="line">    line_inter = im.shape[<span class="number">0</span>] / <span class="number">40.</span></span><br><span class="line">    <span class="comment"># å°†nparrayå›¾åƒè½¬PILå›¾åƒ</span></span><br><span class="line">    im = Image.fromarray(im)</span><br><span class="line">    <span class="keyword">for</span> i, res <span class="keyword">in</span> enumerate(results):</span><br><span class="line">        <span class="keyword">if</span> boxes <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            text_w = <span class="number">3</span></span><br><span class="line">            text_h = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            box = boxes[i]</span><br><span class="line">            text = res</span><br><span class="line">            <span class="keyword">if</span> text == <span class="string">""</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            text_w = int(box[<span class="number">2</span>])</span><br><span class="line">            text_h = int(box[<span class="number">5</span>] + box[<span class="number">3</span>])</span><br><span class="line">            text_loc = (text_w, text_h)</span><br><span class="line">            <span class="comment"># å†™å…¥</span></span><br><span class="line">            draw = ImageDraw.Draw(im)</span><br><span class="line">            draw.text(</span><br><span class="line">                text_loc,</span><br><span class="line">                text,</span><br><span class="line">                font=ImageFont.truetype(font_file, size=int(text_scale)), <span class="comment"># å­—ä½“ä½ç½®</span></span><br><span class="line">                fill=(<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line">    <span class="comment"># è¿˜åŸè¿ç»­å­˜å‚¨æ•°ç»„</span></span><br><span class="line">    im = np.ascontiguousarray(np.copy(im))</span><br><span class="line">    <span class="keyword">return</span> im</span><br></pre></td></tr></table></figure><h3 id="visualize-action"><a href="#visualize-action" class="headerlink" title="visualize_action"></a>visualize_action</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">visualize_action</span><span class="params">(im,</span></span></span><br><span class="line"><span class="function"><span class="params">                     mot_boxes,</span></span></span><br><span class="line"><span class="function"><span class="params">                     action_visual_collector=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                     action_text=<span class="string">""</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                     video_action_score=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                     video_action_text=<span class="string">""</span>)</span>:</span></span><br><span class="line">    im = cv2.imread(im) <span class="keyword">if</span> isinstance(im, str) <span class="keyword">else</span> im</span><br><span class="line">    im_h, im_w = im.shape[:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    text_scale = max(<span class="number">1</span>, im.shape[<span class="number">1</span>] / <span class="number">40.</span>)</span><br><span class="line">    text_thickness = <span class="number">2</span></span><br><span class="line">    <span class="comment"># å°†nparrayå›¾åƒè½¬PILå›¾åƒ</span></span><br><span class="line">    im = Image.fromarray(im)</span><br><span class="line">    <span class="keyword">if</span> action_visual_collector:</span><br><span class="line">        id_action_dict = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> collector, action_type <span class="keyword">in</span> zip(action_visual_collector, action_text):</span><br><span class="line">            id_detected = collector.get_visualize_ids()</span><br><span class="line">            <span class="keyword">for</span> pid <span class="keyword">in</span> id_detected:</span><br><span class="line">                id_action_dict[pid] = id_action_dict.get(pid, [])</span><br><span class="line">                id_action_dict[pid].append(action_type)</span><br><span class="line">        <span class="keyword">for</span> mot_box <span class="keyword">in</span> mot_boxes:</span><br><span class="line">            <span class="comment"># mot_box is a format with [mot_id, class, score, xmin, ymin, w, h] </span></span><br><span class="line">            <span class="keyword">if</span> mot_box[<span class="number">0</span>] <span class="keyword">in</span> id_action_dict:</span><br><span class="line">                text_position = (int(mot_box[<span class="number">3</span>] + mot_box[<span class="number">5</span>] * <span class="number">0.75</span>),</span><br><span class="line">                                 int(mot_box[<span class="number">4</span>] - <span class="number">10</span>))</span><br><span class="line">                display_text = <span class="string">', '</span>.join(id_action_dict[mot_box[<span class="number">0</span>]])</span><br><span class="line"></span><br><span class="line">                draw = ImageDraw.Draw(im)</span><br><span class="line">                draw.text(</span><br><span class="line">                    text_position,</span><br><span class="line">                    display_text,</span><br><span class="line">                    font=ImageFont.truetype(size=int(text_scale)),  <span class="comment"># å­—ä½“ä½ç½®</span></span><br><span class="line">                    fill=(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> video_action_score:</span><br><span class="line">        draw = ImageDraw.Draw(im)</span><br><span class="line">        draw.text(</span><br><span class="line">            (int(im_w / <span class="number">2</span>), int(<span class="number">15</span> * text_scale) + <span class="number">5</span>),</span><br><span class="line">            video_action_text + <span class="string">': %.2f'</span> % video_action_score,</span><br><span class="line">            font=ImageFont.truetype(font_file, size=int(text_scale)),  <span class="comment"># å­—ä½“ä½ç½®</span></span><br><span class="line">            fill=(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line">    <span class="comment"># è¿˜åŸè¿ç»­å­˜å‚¨æ•°ç»„</span></span><br><span class="line">    im = np.ascontiguousarray(np.copy(im))</span><br><span class="line">    <span class="keyword">return</span> im</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹æºç ï¼ˆå±æ€§ï¼‰"><a href="#ä¿®æ”¹æºç ï¼ˆå±æ€§ï¼‰" class="headerlink" title="ä¿®æ”¹æºç ï¼ˆå±æ€§ï¼‰"></a>ä¿®æ”¹æºç ï¼ˆå±æ€§ï¼‰</h2><p>ä¿®æ”¹å¯¹åº”ä¸­æ–‡æ¨¡å—</p><p><code>./deploy/pipeline/</code></p><ul><li>pipeline.py</li></ul><p><code>./deploy/pipeline/ppvehicle</code></p><ul><li>vehicle_attr.py</li><li>vehicle_plate.py</li></ul><p><code>./deploy/pipeline/pphuman</code></p><ul><li>attr_infer.py</li></ul><h2 id="æ‰§è¡Œè„šæœ¬"><a href="#æ‰§è¡Œè„šæœ¬" class="headerlink" title="æ‰§è¡Œè„šæœ¬"></a>æ‰§è¡Œè„šæœ¬</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> pphuman</span><br><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/infer_cfg_pphuman.yml --video_file=demo_input/act1.mp4 --device=gpu --output_dir=demo_output</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ppvehicle</span><br><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/infer_cfg_ppvehicle.yml --video_file=demo_input/car_t1.mp4 --device=gpu --output_dir=demo_output</span><br></pre></td></tr></table></figure><p><img src="/2023/08/09/paddleDetection-OpenCVæ£€æµ‹æ¡†è½¬ä¸­æ–‡/B.png" alt></p>]]></content>
    
    
    <summary type="html">&lt;font color=&quot;gold&quot;&gt;æ³¨ï¼šOpenCVä¸èƒ½ç›´æ¥æ˜¾ç¤ºä¸­æ–‡ï¼Œé€šè¿‡PILè½¬æ¢ä¼šæŸå¤±ä¸€éƒ¨åˆ†ç®—åŠ›æ€§èƒ½&lt;/font&gt;

&lt;p&gt;&lt;img src=&quot;/2023/08/09/paddleDetection-OpenCVæ£€æµ‹æ¡†è½¬ä¸­æ–‡/A.png&quot; alt&gt;&lt;/p&gt;
&lt;h2 id=&quot;ä¿®æ”¹æºç ï¼ˆå¯è§†åŒ–ï¼‰&quot;&gt;&lt;a href=&quot;#ä¿®æ”¹æºç ï¼ˆå¯è§†åŒ–ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;ä¿®æ”¹æºç ï¼ˆå¯è§†åŒ–ï¼‰&quot;&gt;&lt;/a&gt;ä¿®æ”¹æºç ï¼ˆå¯è§†åŒ–ï¼‰&lt;/h2&gt;&lt;p&gt;&lt;code&gt;./deploy/python/visualize.py&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;å¢åŠ å¯¼å…¥å­—ä½“åº“å’Œå­—ä½“æ–‡ä»¶&quot;&gt;&lt;a href=&quot;#å¢åŠ å¯¼å…¥å­—ä½“åº“å’Œå­—ä½“æ–‡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;å¢åŠ å¯¼å…¥å­—ä½“åº“å’Œå­—ä½“æ–‡ä»¶&quot;&gt;&lt;/a&gt;å¢åŠ å¯¼å…¥å­—ä½“åº“å’Œå­—ä½“æ–‡ä»¶&lt;/h3&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; PIL &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; Image, ImageDraw, ImageFile, ImageFont&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;font_file = &lt;span class=&quot;string&quot;&gt;&#39;/exp/work/video/PaddleDetection/deploy/pipeline/SourceHanSansCN-Medium.otf&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;visualize-attr&quot;&gt;&lt;a href=&quot;#visualize-attr&quot; class=&quot;headerlink&quot; title=&quot;visualize_attr&quot;&gt;&lt;/a&gt;visualize_attr&lt;/h3&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;visualize_attr&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(im, results, boxes=None, is_mtmct=False)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; isinstance(im, str):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        im = Image.open(im)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        im = np.ascontiguousarray(np.copy(im))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        im = cv2.cvtColor(im, cv2.COLOR_RGB2BGR)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        im = np.ascontiguousarray(np.copy(im))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    line_inter = im.shape[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] / &lt;span class=&quot;number&quot;&gt;40.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    text_scale = max(&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;, im.shape[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] / &lt;span class=&quot;number&quot;&gt;100.&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# å°†nparrayå›¾åƒè½¬PILå›¾åƒ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    im = Image.fromarray(im)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i, res &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; enumerate(results):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        print(i, res)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; boxes &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            text_w = &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            text_h = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;elif&lt;/span&gt; is_mtmct:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            box = boxes[i]  &lt;span class=&quot;comment&quot;&gt;# multi camera, bbox shape is x,y, w,h&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            text_w = int(box[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]) + &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            text_h = int(box[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            box = boxes[i]  &lt;span class=&quot;comment&quot;&gt;# single camera, bbox shape is 0, 0, x,y, w,h&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            text_w = int(box[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;]) + &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            text_h = int(box[&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; text &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; res:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            text_h += int(line_inter)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            text_loc = (text_w, text_h)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;# å†™å…¥&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            draw = ImageDraw.Draw(im)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            draw.text(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                text_loc,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                text,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                font=ImageFont.truetype(font_file, size=int(text_scale)), &lt;span class=&quot;comment&quot;&gt;# å­—ä½“ä½ç½®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                fill=(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;255&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;255&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# è¿˜åŸè¿ç»­å­˜å‚¨æ•°ç»„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    im = np.ascontiguousarray(np.copy(im))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; im&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://yoursite.com/categories/æ·±åº¦å­¦ä¹ /"/>
    
    
    <category term="paddlepaddle" scheme="http://yoursite.com/tags/paddlepaddle/"/>
    
    <category term="opencv" scheme="http://yoursite.com/tags/opencv/"/>
    
  </entry>
  
  <entry>
    <title>arcface_paddle</title>
    <link href="http://yoursite.com/2023/08/08/arcface-paddle/"/>
    <id>http://yoursite.com/2023/08/08/arcface-paddle/</id>
    <published>2023-08-08T09:12:11.000Z</published>
    <updated>2023-08-09T10:03:27.504Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><h3 id="GPUï¼ˆç‰©ç†ï¼‰"><a href="#GPUï¼ˆç‰©ç†ï¼‰" class="headerlink" title="GPUï¼ˆç‰©ç†ï¼‰"></a>GPUï¼ˆç‰©ç†ï¼‰</h3><ul><li><p>NVIDIA 3090*2</p></li><li><p>æ˜¾å¡é©±åŠ¨ 515.43.04</p></li><li><p>CUDAç‰ˆæœ¬ 11.7</p></li><li><p>CUDAtoolkit (cuda_11.7.0_515.43.04_linux)</p></li><li><p>cuDNN (v8.4.1)</p></li><li><p><font color="gold">paddlepaddle å¤šå¡è®­ç»ƒéœ€è¦NCLLæ”¯æŒ</font> (ncll v2.12.12 cuda11.7)</p></li></ul><h3 id="paddlepaddleç‰ˆæœ¬"><a href="#paddlepaddleç‰ˆæœ¬" class="headerlink" title="paddlepaddleç‰ˆæœ¬"></a>paddlepaddleç‰ˆæœ¬</h3><ul><li>paddlepaddle-gpu==2.2.0rc0ï¼ˆè™šæ‹Ÿç¯å¢ƒcuda11.2ï¼‰</li></ul><h3 id="pythonç¯å¢ƒ"><a href="#pythonç¯å¢ƒ" class="headerlink" title="pythonç¯å¢ƒ"></a>pythonç¯å¢ƒ</h3><ul><li><p>CentOS7.9</p></li><li><p>anaconda3</p></li><li><p>python3.8</p></li></ul><h2 id="anacondaå®‰è£…insightface"><a href="#anacondaå®‰è£…insightface" class="headerlink" title="anacondaå®‰è£…insightface"></a>anacondaå®‰è£…insightface</h2><p><font color="gold">é‡è¦ï¼špillowç‰ˆæœ¬å»ºè®®é€‰æ‹©9.5 å¦åˆ™è¿‡é«˜ä¼šå¯¼è‡´å®‰è£…insightfaceæŠ¥é”™</font> ï¼ˆé”™è¯¯åŸå› ï¼špillow10ç§»é™¤äº†getsizeæ–¹æ³•ï¼Œéœ€è¦ä¿®æ”¹å¯¹åº”ä½ç½®æºç ä¸º<code>getbbox</code>æˆ– <code>getlength</code>ï¼‰</p><p>å‘Šè­¦ä¿¡æ¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tools/test_recognition.py:<span class="number">627</span>: DeprecationWarning: getsize <span class="keyword">is</span> deprecated <span class="keyword">and</span> will be removed <span class="keyword">in</span> Pillow <span class="number">10</span> (<span class="number">2023</span><span class="number">-07</span><span class="number">-01</span>). Use getbbox <span class="keyword">or</span> getlength instead.</span><br><span class="line">  tw = font.getsize(text)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><h4 id="ç¯å¢ƒå®‰è£…"><a href="#ç¯å¢ƒå®‰è£…" class="headerlink" title="ç¯å¢ƒå®‰è£…"></a>ç¯å¢ƒå®‰è£…</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> .</span></span><br><span class="line">conda install paddlepaddle-gpu==2.2.0rc0 cudatoolkit=11.2 -c https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/Paddle/ -c conda-forge</span><br><span class="line"><span class="meta">#</span><span class="bash"> insightface</span></span><br><span class="line">pip install -r requirements.txt -i https://mirror.baidu.com/pypi/simple</span><br><span class="line"><span class="meta">#</span><span class="bash"> insightface/recongition/arcface_paddle/</span></span><br><span class="line">pip install -r requirement.txt -i https://mirror.baidu.com/pypi/simple</span><br><span class="line"><span class="meta">#</span><span class="bash"> insightface-paddle</span></span><br><span class="line">pip install insightface-paddle -i https://mirror.baidu.com/pypi/simple</span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="è·å–æ•°æ®é›†"><a href="#è·å–æ•°æ®é›†" class="headerlink" title="è·å–æ•°æ®é›†"></a>è·å–æ•°æ®é›†</h4><p><a href="https://github.com/deepinsight/insightface/tree/master/recognition/_datasets_" target="_blank" rel="noopener">https://github.com/deepinsight/insightface/tree/master/recognition/_datasets_</a></p><ul><li>MS1M_v2: MS1M-ArcFace</li><li>MS1M_v3: MS1M-RetinaFace</li></ul><p>ä» MXNet æ ¼å¼æ•°æ®é›†æŠ½å–å›¾åƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python tools/mx_recordio_2_images.py --root_dir ms1m-retinaface-t1/ --output_dir MS1M_v3/</span><br></pre></td></tr></table></figure><p>æ•°æ®æŠ½å–å®Œæˆåï¼Œæ ¼å¼å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MS1M_v3</span><br><span class="line">|_ images</span><br><span class="line">|  |_ 00000001.jpg</span><br><span class="line">|  |_ ...</span><br><span class="line">|  |_ 05179510.jpg</span><br><span class="line">|_ label.txt</span><br><span class="line">|_ agedb_30.bin</span><br><span class="line">|_ cfp_ff.bin</span><br><span class="line">|_ cfp_fp.bin</span><br><span class="line">|_ lfw.bin</span><br></pre></td></tr></table></figure><p>æ ‡ç­¾æ•°æ®æ ¼å¼å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å›¾åƒè·¯å¾„ä¸æ ‡ç­¾çš„åˆ†éš”ç¬¦: &quot;\t&quot;</span><br><span class="line"># ä»¥ä¸‹æ˜¯ label.txt æ¯è¡Œçš„æ ¼å¼</span><br><span class="line">images/00000001.jpg 0</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="æ¨¡å‹è®­ç»ƒ"><a href="#æ¨¡å‹è®­ç»ƒ" class="headerlink" title="æ¨¡å‹è®­ç»ƒ"></a>æ¨¡å‹è®­ç»ƒ</h4><p>ä½¿ç”¨åŒå¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CUDA_VISIBLE_DEVICES=0,1</span><br></pre></td></tr></table></figure><p>è®­ç»ƒè„šæœ¬<code>scripts/train_static.sh</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é™çº§scipy,scipyç‰ˆæœ¬è¿‡é«˜ä¼šæŠ¥é”™</span></span><br><span class="line">pip install scipy==1.7.1 -i https://mirror.baidu.com/pypi/simple</span><br></pre></td></tr></table></figure><p>è®­ç»ƒé™æ€æ¨¡å‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">python -m paddle.distributed.launch --gpus=1 tools/train.py \</span><br><span class="line">    --config_file configs/ms1mv3_r50.py \</span><br><span class="line">    --is_static True \</span><br><span class="line">    --backbone FresResNet50 \</span><br><span class="line">    --classifier LargeScaleClassifier \</span><br><span class="line">    --embedding_size 512 \</span><br><span class="line">    --model_parallel True \</span><br><span class="line">    --dropout 0.0 \</span><br><span class="line">    --sample_ratio 0.1 \</span><br><span class="line">    --loss ArcFace \</span><br><span class="line">    --batch_size 64 \</span><br><span class="line">    --dataset MS1M_v3 \</span><br><span class="line">    --num_classes 93431 \</span><br><span class="line">    --data_dir MS1M_v3/ \</span><br><span class="line">    --label_file MS1M_v3/label.txt \</span><br><span class="line">    --is_bin False \</span><br><span class="line">    --log_interval_step 100 \</span><br><span class="line">    --validation_interval_step 2000 \</span><br><span class="line">    --fp16 True \</span><br><span class="line">    --use_dynamic_loss_scaling True \</span><br><span class="line">    --init_loss_scaling 27648.0 \</span><br><span class="line">    --num_workers 8 \</span><br><span class="line">    --train_unit 'epoch' \</span><br><span class="line">    --warmup_num 0 \</span><br><span class="line">    --train_num 25 \</span><br><span class="line">    --decay_boundaries "10,16,22" \</span><br><span class="line">    --output MS1M_v3_arcface_static_0.1</span><br></pre></td></tr></table></figure><p><font color="red">3090å•å¡å®¹æ˜“çˆ†æ˜¾å­˜</font> batch_sizeå¯ç”±128è°ƒæ•´è‡³64ï¼Œæˆ–å¼€å¯å¤šå¡è®­ç»ƒï¼Œéœ€ncll</p><p>æ¨¡å‹è¯„ä»·<code>sh scripts/validation_static.sh</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">python tools/validation.py \</span><br><span class="line">    --is_static True \</span><br><span class="line">    --backbone FresResNet50 \</span><br><span class="line">    --embedding_size 512 \</span><br><span class="line">    --checkpoint_dir MS1M_v3_arcface_static_0.1/FresResNet50/24 \</span><br><span class="line">    --data_dir MS1M_v3/ \</span><br><span class="line">    --val_targets lfw,cfp_fp,agedb_30 \</span><br><span class="line">    --batch_size 64</span><br></pre></td></tr></table></figure><p>æ¨¡å‹å¯¼å‡º<code>sh scripts/export_static.sh</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python tools/export.py \</span><br><span class="line">    --is_static True \</span><br><span class="line">    --export_type paddle \</span><br><span class="line">    --backbone FresResNet50 \</span><br><span class="line">    --embedding_size 512 \</span><br><span class="line">    --checkpoint_dir MS1M_v3_arcface_static_0.1/FresResNet50/24 \</span><br><span class="line">    --output_dir MS1M_v3_arcface_static_0.1/FresResNet50/exported_model</span><br></pre></td></tr></table></figure><p>æ¨¡å‹æ¨ç†<code>sh scripts/inference.sh</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python tools/inference.py \</span><br><span class="line">    --export_type paddle \</span><br><span class="line">    --model_file MS1M_v3_arcface_static_0.1/FresResNet50/exported_model/FresResNet50.pdmodel \</span><br><span class="line">    --params_file MS1M_v3_arcface_static_0.1/FresResNet50/exported_model/FresResNet50.pdiparams \</span><br><span class="line">    --image_path MS1M_v3/images/00000001.jpg</span><br></pre></td></tr></table></figure><h4 id="æ„å»ºäººåƒç´¢å¼•"><a href="#æ„å»ºäººåƒç´¢å¼•" class="headerlink" title="æ„å»ºäººåƒç´¢å¼•"></a>æ„å»ºäººåƒç´¢å¼•</h4><ul><li>å»ºç«‹å›¾åƒæ–‡ä»¶å¤¹</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fridends</span><br><span class="line">|_ gallery</span><br><span class="line">|  |_ Chandler</span><br><span class="line">|      |_ Chandler01.jpg</span><br><span class="line">|      |_ ...</span><br><span class="line">|      |_ Chandler50.jpg</span><br><span class="line">|  |_ ...</span><br><span class="line">|  |_ Ross</span><br><span class="line">|      |_ Ross01.jpg</span><br><span class="line">|      |_ ...</span><br><span class="line">|      |_ Ross50.jpg</span><br><span class="line">|_ label.txt</span><br></pre></td></tr></table></figure><ul><li>å»ºç«‹ç´¢å¼•æ–‡ä»¶<code>label.txt</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">./Chandler/Chandler00037.jpgChandler</span><br><span class="line">./Chandler/Chandler00021.pngChandler</span><br><span class="line">./Chandler/Chandler00040.jpgChandler</span><br><span class="line">./Chandler/Chandler00041.jpgChandler</span><br><span class="line">./Chandler/Chandler00004.pngChandler</span><br><span class="line">./Chandler/Chandler00034.pngChandler</span><br><span class="line">./Chandler/Chandler00008.pngChandler</span><br><span class="line">...</span><br><span class="line">./Ross/Ross00016.jpgRoss</span><br><span class="line">./Ross/Ross00022.jpgRoss</span><br><span class="line">./Ross/Ross00019.jpgRoss</span><br><span class="line">./Ross/Ross00024.jpgRoss</span><br><span class="line">./Ross/Ross00001.jpgRoss</span><br><span class="line">./Ross/Ross00039.jpgRoss</span><br><span class="line">./Ross/Ross00038.jpgRoss</span><br><span class="line">./Ross/Ross00017.jpgRoss</span><br><span class="line">./Ross/Ross00034.jpgRoss</span><br><span class="line">./Ross/Ross00002.pngRoss</span><br></pre></td></tr></table></figure><ul><li>æ„å»ºç´¢å¼•</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insightfacepaddle --build_index ./demo/friends/index.bin --img_dir ./demo/friends/gallery --label ./demo/friends/gallery/label.txt</span><br></pre></td></tr></table></figure><h4 id="æ£€æµ‹å›¾ç‰‡"><a href="#æ£€æµ‹å›¾ç‰‡" class="headerlink" title="æ£€æµ‹å›¾ç‰‡"></a>æ£€æµ‹å›¾ç‰‡</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python tools/test_recognition.py --det --rec --index=./demo/friends/index.bin --input=./test/æµ‹è¯•2.jpg --output=./output</span><br></pre></td></tr></table></figure><p><img src="/2023/08/08/arcface-paddle/A.png" alt></p><h4 id="é¢„æµ‹å›¾ç‰‡"><a href="#é¢„æµ‹å›¾ç‰‡" class="headerlink" title="é¢„æµ‹å›¾ç‰‡"></a>é¢„æµ‹å›¾ç‰‡</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python tools/test_recognition.py --det --rec --index=./demo/friends/index.bin --input=./test/æµ‹è¯•2.jpg --output=./output</span><br></pre></td></tr></table></figure><p><img src="/2023/08/08/arcface-paddle/B.png" alt></p><h4 id="é¢„æµ‹è§†é¢‘"><a href="#é¢„æµ‹è§†é¢‘" class="headerlink" title="é¢„æµ‹è§†é¢‘"></a>é¢„æµ‹è§†é¢‘</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python tools/test_recognition.py --det --rec --index=./demo/friends/index.bin --input=./test/mp4v.mp4 --output=./output</span><br></pre></td></tr></table></figure><h4 id="pythonè„šæœ¬"><a href="#pythonè„šæœ¬" class="headerlink" title="pythonè„šæœ¬"></a>pythonè„šæœ¬</h4><p>è„šæœ¬å°è£…ä½ç½®ï¼šarcface_paddle/python</p><ul><li>æ„å»ºç´¢å¼•</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> insightface_paddle <span class="keyword">as</span> face</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">parser = face.parser()</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">args.build_index = <span class="string">"./demo/friends/index.bin"</span></span><br><span class="line">args.img_dir = <span class="string">"./demo/friends/gallery"</span></span><br><span class="line">args.label = <span class="string">"./demo/friends/gallery/label.txt"</span></span><br><span class="line">predictor = face.InsightFace(args)</span><br><span class="line">predictor.build_index()</span><br></pre></td></tr></table></figure><ul><li>è§†é¢‘</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> insightface_paddle <span class="keyword">as</span> face</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">PR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line"></span><br><span class="line">parser = face.parser()</span><br><span class="line">args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">args.det = <span class="literal">True</span></span><br><span class="line">args.rec = <span class="literal">True</span></span><br><span class="line">args.index = os.path.join(PR, <span class="string">"demo/friends/index.bin"</span>)</span><br><span class="line">args.output = os.path.join(PR, <span class="string">"output"</span>)</span><br><span class="line">input_path = os.path.join(PR, <span class="string">"test/MP4V.mp4"</span>)</span><br><span class="line"></span><br><span class="line">predictor = face.InsightFace(args)</span><br><span class="line">res = predictor.predict(input_path, print_info=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> res:</span><br><span class="line">    print(_.get(<span class="string">'labels'</span>))</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒ&quot;&gt;&lt;/a&gt;ç¯å¢ƒ&lt;/h2&gt;&lt;h3 id=&quot;GPUï¼ˆç‰©ç†ï¼‰&quot;&gt;&lt;a href=&quot;#GPUï¼ˆç‰©ç†ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;GPUï¼ˆç‰©ç†ï¼‰&quot;&gt;&lt;/a&gt;GPUï¼ˆç‰©ç†ï¼‰&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;NVIDIA 3090*2&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æ˜¾å¡é©±åŠ¨ 515.43.04&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;CUDAç‰ˆæœ¬ 11.7&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;CUDAtoolkit (cuda_11.7.0_515.43.04_linux)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;cuDNN (v8.4.1)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;font color=&quot;gold&quot;&gt;paddlepaddle å¤šå¡è®­ç»ƒéœ€è¦NCLLæ”¯æŒ&lt;/font&gt; (ncll v2.12.12 cuda11.7)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;paddlepaddleç‰ˆæœ¬&quot;&gt;&lt;a href=&quot;#paddlepaddleç‰ˆæœ¬&quot; class=&quot;headerlink&quot; title=&quot;paddlepaddleç‰ˆæœ¬&quot;&gt;&lt;/a&gt;paddlepaddleç‰ˆæœ¬&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;paddlepaddle-gpu==2.2.0rc0ï¼ˆè™šæ‹Ÿç¯å¢ƒcuda11.2ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;pythonç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#pythonç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;pythonç¯å¢ƒ&quot;&gt;&lt;/a&gt;pythonç¯å¢ƒ&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;CentOS7.9&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;anaconda3&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;python3.8&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;anacondaå®‰è£…insightface&quot;&gt;&lt;a href=&quot;#anacondaå®‰è£…insightface&quot; class=&quot;headerlink&quot; title=&quot;anacondaå®‰è£…insightface&quot;&gt;&lt;/a&gt;anacondaå®‰è£…insightface&lt;/h2&gt;&lt;p&gt;&lt;font color=&quot;gold&quot;&gt;é‡è¦ï¼špillowç‰ˆæœ¬å»ºè®®é€‰æ‹©9.5 å¦åˆ™è¿‡é«˜ä¼šå¯¼è‡´å®‰è£…insightfaceæŠ¥é”™&lt;/font&gt; ï¼ˆé”™è¯¯åŸå› ï¼špillow10ç§»é™¤äº†getsizeæ–¹æ³•ï¼Œéœ€è¦ä¿®æ”¹å¯¹åº”ä½ç½®æºç ä¸º&lt;code&gt;getbbox&lt;/code&gt;æˆ– &lt;code&gt;getlength&lt;/code&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;å‘Šè­¦ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;tools/test_recognition.py:&lt;span class=&quot;number&quot;&gt;627&lt;/span&gt;: DeprecationWarning: getsize &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; deprecated &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; will be removed &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; Pillow &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt; (&lt;span class=&quot;number&quot;&gt;2023&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-07&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-01&lt;/span&gt;). Use getbbox &lt;span class=&quot;keyword&quot;&gt;or&lt;/span&gt; getlength instead.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  tw = font.getsize(text)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;ç¯å¢ƒå®‰è£…&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒå®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒå®‰è£…&quot;&gt;&lt;/a&gt;ç¯å¢ƒå®‰è£…&lt;/h4&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; .&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;conda install paddlepaddle-gpu==2.2.0rc0 cudatoolkit=11.2 -c https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/Paddle/ -c conda-forge&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; insightface&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install -r requirements.txt -i https://mirror.baidu.com/pypi/simple&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; insightface/recongition/arcface_paddle/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install -r requirement.txt -i https://mirror.baidu.com/pypi/simple&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; insightface-paddle&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install insightface-paddle -i https://mirror.baidu.com/pypi/simple&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://yoursite.com/categories/æ·±åº¦å­¦ä¹ /"/>
    
    
    <category term="paddlepaddle" scheme="http://yoursite.com/tags/paddlepaddle/"/>
    
  </entry>
  
  <entry>
    <title>paddleDetectionå‰ç½®</title>
    <link href="http://yoursite.com/2023/08/07/paddleDetection%E5%89%8D%E7%BD%AE/"/>
    <id>http://yoursite.com/2023/08/07/paddleDetection%E5%89%8D%E7%BD%AE/</id>
    <published>2023-08-07T08:20:53.000Z</published>
    <updated>2024-01-25T08:50:19.855Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><h3 id="GPU"><a href="#GPU" class="headerlink" title="GPU"></a>GPU</h3><ul><li><p>NVIDIA 3090*2</p></li><li><p>æ˜¾å¡é©±åŠ¨ 515.43.04</p></li><li><p>CUDAç‰ˆæœ¬ 11.7</p></li><li><p>CUDAtoolkit (cuda_11.7.0_515.43.04_linux)</p></li><li><p>cuDNN (v8.4.1)</p></li><li><p><font color="gold">paddlepaddle å¤šå¡è®­ç»ƒéœ€è¦NCLLæ”¯æŒ</font> (ncll v2.12.12 cuda11.7)</p></li></ul><h3 id="paddlepaddleç‰ˆæœ¬"><a href="#paddlepaddleç‰ˆæœ¬" class="headerlink" title="paddlepaddleç‰ˆæœ¬"></a>paddlepaddleç‰ˆæœ¬</h3><ul><li>v2.4.2</li></ul><h3 id="paddleDetectionç‰ˆæœ¬"><a href="#paddleDetectionç‰ˆæœ¬" class="headerlink" title="paddleDetectionç‰ˆæœ¬"></a>paddleDetectionç‰ˆæœ¬</h3><ul><li>v2.6.0</li></ul><h3 id="pythonç¯å¢ƒ"><a href="#pythonç¯å¢ƒ" class="headerlink" title="pythonç¯å¢ƒ"></a>pythonç¯å¢ƒ</h3><ul><li><p>CentOS7.9</p></li><li><p>anaconda3</p></li><li><p>python3.8</p></li></ul><h2 id="æ™®é€šè§†é¢‘å¤„ç†"><a href="#æ™®é€šè§†é¢‘å¤„ç†" class="headerlink" title="æ™®é€šè§†é¢‘å¤„ç†"></a>æ™®é€šè§†é¢‘å¤„ç†</h2><font color="gold">h264æ ¼å¼è§†é¢‘è¢«opencvè§£æå¸§ç‡è¶…è¿‡65535æŠ¥é”™</font><p>æºç ï¼š</p><p><code>./deploy/pipeline/pipeline.py</code> predict_video</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">out_path = os.path.join(self.output_dir, video_out_name + <span class="string">".mp4"</span>)</span><br><span class="line">fourcc = cv2.VideoWriter_fourcc(* <span class="string">'mp4v'</span>)</span><br><span class="line">writer = cv2.VideoWriter(out_path, fourcc, fps, (width, height))</span><br></pre></td></tr></table></figure><p>è¾“å…¥ï¼šcv2.VideoCapture()</p><p>è¾“å‡ºï¼šcv2.VideoWriter(ï¼‰</p><p>æœ¬GPUæ¨¡å¼ä¸‹å¯¹æ—¶é•¿5åˆ†é’Ÿçš„è¡Œäººæ£€æµ‹è§†é¢‘å¤„ç†æ—¶é—´çº¦20åˆ†é’Ÿï¼ˆé«˜ç²¾åº¦æ¨¡å‹ï¼‰ï¼Œè§†é¢‘ä½“ç§¯å¢å¤§13å€ï¼ˆ100M-&gt;1.3Gï¼‰</p><a id="more"></a><h2 id="è§†é¢‘æµ"><a href="#è§†é¢‘æµ" class="headerlink" title="è§†é¢‘æµ"></a>è§†é¢‘æµ</h2><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><ol><li><p>h264æ ¼å¼å­˜åœ¨é—®é¢˜ï¼ˆéœ€è¦é‡æ–°ç¼–è¯‘opencvï¼‰ï¼Œå®æ—¶å¸§æ•°è¿‡é«˜ï¼ˆ&gt;65535ï¼‰cv2.VideoWriteræŠ¥é”™ï¼Œæ— æ³•ä¿å­˜è§†é¢‘</p><p>é—®é¢˜åŸå› ï¼š<code>libx264</code>åŸºäº<code>GPL</code>ï¼Œ<code>ffmpeg</code>ç¼–ç å™¨è¦ä½¿ç”¨<code>libx264</code>ï¼Œå¿…é¡»<code>--enable-gpl</code>ï¼Œè€Œ<code>opencv</code>ä½¿ç”¨çš„æ˜¯<code>MIT</code>è®¸å¯</p></li><li><p>å¦‚æœè§†é¢‘æµä¼ è¾“åŠ è½½è¾ƒæ…¢ï¼Œè·å–ä¸åˆ°è§†é¢‘æŠ¥é”™(ä¿®æ”¹<code>pipeline.py</code> predict_video)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrameQueueEmptyException</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="string">"""An Exception for check frame queue"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, time)</span>:</span></span><br><span class="line">        self.time = time</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">f"<span class="subst">&#123;self.time&#125;</span>ç§’æ— æ³•è·å–frameé˜Ÿåˆ—ï¼Œè¯·æ£€æŸ¥æ‘„åƒå¤´æ˜¯å¦æ­£å¸¸è¿è½¬"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">    <span class="keyword">if</span> framequeue.empty():</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        print(<span class="string">f"Couldn't catch framequeue for <span class="subst">&#123;i&#125;</span> seconds"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">raise</span> FrameQueueEmptyException</span><br></pre></td></tr></table></figure></li></ol><h3 id="æ‘„åƒå¤´-amp-åº”ç”¨"><a href="#æ‘„åƒå¤´-amp-åº”ç”¨" class="headerlink" title="æ‘„åƒå¤´ &amp; åº”ç”¨"></a>æ‘„åƒå¤´ &amp; åº”ç”¨</h3><p>ä»¥<code>liveCMS</code>åº”ç”¨ä¸ºä¾‹ï¼ˆå›½æ ‡è®¾å¤‡è§æ–‡æ¡£ï¼šLiveGBSå›½æ ‡GB-T28181è§†é¢‘æµåª’ä½“å¹³å°ï¼‰</p><p>æ¯26å¤©éœ€æ›´æ–°ä¸€æ¬¡</p><ul><li><p>liveCMSåº”ç”¨å®‰è£…åœ¨<code>192.168.9.165</code>æœºå™¨</p></li><li><p>å›½æ ‡è®¾å¤‡æœåŠ¡ç«¯å£ï¼š<code>192.168.9.165:10005</code>è´¦å·ï¼š<code>admin</code>ï¼Œå¯†ç ï¼š<code>A12345678</code></p></li><li><p>è¿‘ç«¯è®¾å¤‡åœ°å€ï¼š<code>192.168.9.207</code></p></li><li><p>è®¾å¤‡ä¸»æ¿ipï¼š<code>192.168.177.177</code>è´¦æˆ·ï¼š<code>root</code>ï¼Œå¯†ç ï¼š<code>admin</code></p></li><li><p>æ‘„åƒå¤´è®¾å¤‡åœ°å€ï¼š<code>192.168.1.131</code>ã€<code>192.168.1.133</code></p></li></ul><h3 id="æ‘„åƒå¤´æ¨æµ"><a href="#æ‘„åƒå¤´æ¨æµ" class="headerlink" title="æ‘„åƒå¤´æ¨æµ"></a>æ‘„åƒå¤´æ¨æµ</h3><p>æ‘„åƒå¤´æ¨æµapiï¼š<code>http://&lt;livecms_host&gt;:&lt;ip&gt;/api/v1/stream/list</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"StreamCount"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">"Streams"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"AudioEnable"</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">"CDN"</span>: <span class="string">""</span>,</span><br><span class="line">      <span class="attr">"CascadeSize"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"ChannelID"</span>: <span class="string">"34020000001320000131"</span>,</span><br><span class="line">      <span class="attr">"ChannelName"</span>: <span class="string">"192.168.1.131"</span>,</span><br><span class="line">      <span class="attr">"CloudRecord"</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">"DeviceID"</span>: <span class="string">"34020000002000000207"</span>,</span><br><span class="line">      <span class="attr">"Duration"</span>: <span class="number">20520</span>,</span><br><span class="line">      <span class="attr">"FLV"</span>: <span class="string">"http://192.168.9.165:10005/sms/34020000002020000001/flv/hls/34020000002000000207_34020000001320000131.flv"</span>,</span><br><span class="line">      <span class="attr">"HLS"</span>: <span class="string">"http://192.168.9.165:10005/sms/34020000002020000001/hls/34020000002000000207_34020000001320000131/live.m3u8"</span>,</span><br><span class="line">      <span class="attr">"InBitRate"</span>: <span class="number">914</span>,</span><br><span class="line">      <span class="attr">"InBytes"</span>: <span class="number">2196788210</span>,</span><br><span class="line">      <span class="attr">"NumOutputs"</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">"Ondemand"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"OutBytes"</span>: <span class="number">2308731853</span>,</span><br><span class="line">      <span class="attr">"RTMP"</span>: <span class="string">"rtmp://192.168.9.165:11935/hls/34020000002000000207_34020000001320000131"</span>,</span><br><span class="line">      <span class="attr">"RTPCount"</span>: <span class="number">2049812</span>,</span><br><span class="line">      <span class="attr">"RTPLostCount"</span>: <span class="number">3526</span>,</span><br><span class="line">      <span class="attr">"RTPLostRate"</span>: <span class="number">0.6256656017039404</span>,</span><br><span class="line">      <span class="attr">"RTSP"</span>: <span class="string">"rtsp://192.168.9.165:554/34020000002000000207_34020000001320000131"</span>,</span><br><span class="line">      <span class="attr">"RecordStartAt"</span>: <span class="string">""</span>,</span><br><span class="line">      <span class="attr">"RelaySize"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"SMSID"</span>: <span class="string">"34020000002020000001"</span>,</span><br><span class="line">      <span class="attr">"SnapURL"</span>: <span class="string">"/sms/34020000002020000001/snap/34020000002000000207/34020000001320000131.jpg?t=1690332332290541800"</span>,</span><br><span class="line">      <span class="attr">"SourceAudioCodecName"</span>: <span class="string">"aac"</span>,</span><br><span class="line">      <span class="attr">"SourceAudioSampleRate"</span>: <span class="number">8000</span>,</span><br><span class="line">      <span class="attr">"SourceVideoCodecName"</span>: <span class="string">"h264"</span>,</span><br><span class="line">      <span class="attr">"SourceVideoFrameRate"</span>: <span class="number">30</span>,</span><br><span class="line">      <span class="attr">"SourceVideoHeight"</span>: <span class="number">720</span>,</span><br><span class="line">      <span class="attr">"SourceVideoWidth"</span>: <span class="number">1280</span>,</span><br><span class="line">      <span class="attr">"StartAt"</span>: <span class="string">"2023-07-26 08:45:30"</span>,</span><br><span class="line">      <span class="attr">"StreamID"</span>: <span class="string">"stream:34020000002000000207:34020000001320000131"</span>,</span><br><span class="line">      <span class="attr">"Transport"</span>: <span class="string">"UDP"</span>,</span><br><span class="line">      <span class="attr">"VideoFrameCount"</span>: <span class="number">605632</span>,</span><br><span class="line">      <span class="attr">"WEBRTC"</span>: <span class="string">"webrtc://192.168.9.165:10005/sms/34020000002020000001/rtc/34020000002000000207_34020000001320000131"</span>,</span><br><span class="line">      <span class="attr">"WS_FLV"</span>: <span class="string">"ws://192.168.9.165:10005/sms/34020000002020000001/ws-flv/hls/34020000002000000207_34020000001320000131.flv"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰§è¡ŒpaddleDetection-â€“rtstæŒ‡ä»¤"><a href="#æ‰§è¡ŒpaddleDetection-â€“rtstæŒ‡ä»¤" class="headerlink" title="æ‰§è¡ŒpaddleDetection â€“rtstæŒ‡ä»¤"></a>æ‰§è¡ŒpaddleDetection â€“rtstæŒ‡ä»¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/examples/infer_cfg_human_attr.yml --rtsp http://192.168.9.165:10005/sms/34020000002020000001/flv/hls/34020000002000000207_34020000001320000131.flv --device=gpu</span><br></pre></td></tr></table></figure><h3 id="è§£å†³rtspè§†é¢‘æµä¸­æ–­é—®é¢˜ï¼ˆæ ·ä¾‹ï¼‰"><a href="#è§£å†³rtspè§†é¢‘æµä¸­æ–­é—®é¢˜ï¼ˆæ ·ä¾‹ï¼‰" class="headerlink" title="è§£å†³rtspè§†é¢‘æµä¸­æ–­é—®é¢˜ï¼ˆæ ·ä¾‹ï¼‰"></a>è§£å†³rtspè§†é¢‘æµä¸­æ–­é—®é¢˜ï¼ˆæ ·ä¾‹ï¼‰</h3><p><code>pipline.py - class PipePredictor</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.rtsp = args.rtsp</span><br></pre></td></tr></table></figure><p><code>pipline.py - predict_video</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    flag = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> framequeue.empty():</span><br><span class="line">        ...</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> self.rtsp:</span><br><span class="line">            count = <span class="number">1</span></span><br><span class="line">            capture = cv2.VideoCapture(video_file)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                fps = int(capture.get(cv2.CAP_PROP_FPS))</span><br><span class="line">            <span class="keyword">except</span> OverflowError:</span><br><span class="line">                fps = <span class="number">20</span></span><br><span class="line">            frame_count = int(capture.get(cv2.CAP_PROP_FRAME_COUNT))</span><br><span class="line">            print(<span class="string">"restart camera fps: %d, frame_count: %d"</span> % (fps, frame_count))</span><br><span class="line"></span><br><span class="line">            framequeue = queue.Queue(<span class="number">10</span>)</span><br><span class="line">            thread = threading.Thread(</span><br><span class="line">                target=self.capturevideo, args=(capture, framequeue, execute_time))</span><br><span class="line">            thread.start()</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> framequeue.empty():</span><br><span class="line">                    time.sleep(<span class="number">1</span>)</span><br><span class="line">                    print(<span class="string">f"Couldn't catch framequeue for <span class="subst">&#123;count&#125;</span> seconds"</span>)</span><br><span class="line">                    count += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">if</span> count == <span class="number">11</span>:</span><br><span class="line">                        flag = <span class="literal">True</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">if</span> self.dbconfig:</span><br><span class="line">                <span class="keyword">if</span> self.dbconfig.rtsp:</span><br><span class="line">                    frame_thread_ = threading.Thread(</span><br><span class="line">                        target=self.video_composition, args=(self.frame_dir, self.out_path, video_fps)</span><br><span class="line">                    )</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> os.listdir(os.path.dirname(self.out_path)):</span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">not</span> self.frame_flag:</span><br><span class="line">                            frame_thread_.start()</span><br><span class="line">        <span class="keyword">if</span> flag:</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨Pythonè„šæœ¬"><a href="#ä½¿ç”¨Pythonè„šæœ¬" class="headerlink" title="ä½¿ç”¨Pythonè„šæœ¬"></a>ä½¿ç”¨Pythonè„šæœ¬</h2><h3 id="pipeline-pipeline-py"><a href="#pipeline-pipeline-py" class="headerlink" title="pipeline/pipeline.py"></a>pipeline/pipeline.py</h3><p>åœ¨å¯¹åº”configæ–‡ä»¶ä¸­å°†MOTçš„<code>tracker_config</code>ä¿®æ”¹ä¸ºç»å¯¹è·¯å¾„</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">MOT:</span></span><br><span class="line">  <span class="attr">model_dir:</span> <span class="string">https://bj.bcebos.com/v1/paddledet/models/pipeline/mot_ppyoloe_l_36e_pipeline.zip</span></span><br><span class="line">  <span class="attr">tracker_config:</span> <span class="string">/exp/work/video/PaddleDetection/deploy/pipeline/config/tracker_config.yml</span></span><br><span class="line">  <span class="attr">batch_size:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>pipeline.py</code>å¯åŠ¨è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    paddle.enable_static()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># parse params from command</span></span><br><span class="line">    parser = argsparser()</span><br><span class="line">    FLAGS = parser.parse_args()</span><br><span class="line">    FLAGS.device = <span class="string">'gpu'</span></span><br><span class="line">    FLAGS.config = <span class="string">'/exp/work/video/PaddleDetection/deploy/pipeline/config/examples/infer_cfg_human_attr.yml'</span></span><br><span class="line">    FLAGS.video_file = <span class="string">'/exp/work/video/PaddleDetection/demo_input/t2.mp4'</span></span><br><span class="line">    FLAGS.output_dir = <span class="string">'/exp/work/video/PaddleDetection/demo_output/'</span></span><br><span class="line">    FLAGS.device = FLAGS.device.upper()</span><br><span class="line">    <span class="keyword">assert</span> FLAGS.device <span class="keyword">in</span> [<span class="string">'CPU'</span>, <span class="string">'GPU'</span>, <span class="string">'XPU'</span>, <span class="string">'NPU'</span></span><br><span class="line">                            ], <span class="string">"device should be CPU, GPU, XPU or NPU"</span></span><br><span class="line"></span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>cfg_utils.py</code> argsparserï¼›parse_argsï¼Œä¿®æ”¹å’Œæ³¨é‡Šæ‰configä½œä¸ºå¿…è¦æ¡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_args</span><span class="params">(self, argv=None)</span>:</span></span><br><span class="line">    args = super(ArgsParser, self).parse_args(argv)</span><br><span class="line">    <span class="comment"># assert args.config is not None, \</span></span><br><span class="line">    <span class="comment">#     "Please specify --config=configure_file_path."</span></span><br><span class="line">    args.opt = self._parse_opt(args.opt)</span><br><span class="line">    <span class="keyword">return</span> args</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">parser.add_argument(</span><br><span class="line">    <span class="string">"--config"</span>,</span><br><span class="line">    type=str,</span><br><span class="line">    default=<span class="literal">None</span>,</span><br><span class="line">    help=(<span class="string">"Path of configure"</span>),</span><br><span class="line">    required=<span class="literal">False</span>) <span class="comment"># True â€”â€”&gt; False</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨è„šæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python pipeline.py</span><br></pre></td></tr></table></figure><p>æˆ–å°†å…¶å°è£…ä¸ºæ¥å£</p><h3 id="python-infer-py"><a href="#python-infer-py" class="headerlink" title="python/infer.py"></a>python/infer.py</h3><p>å¯¼å‡ºé¢„æµ‹æ¨¡å‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å‡ºYOLOv3æ£€æµ‹æ¨¡å‹</span></span><br><span class="line">python tools/export_model.py -c configs/yolov3/yolov3_darknet53_270e_coco.yml --output_dir=./inference_model \</span><br><span class="line"> -o weights=https://paddledet.bj.bcebos.com/models/yolov3_darknet53_270e_coco.pdparams</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å‡ºHigherHRNet(bottom-up)å…³é”®ç‚¹æ£€æµ‹æ¨¡å‹</span></span><br><span class="line">python tools/export_model.py -c configs/keypoint/higherhrnet/higherhrnet_hrnet_w32_512.yml -o weights=https://paddledet.bj.bcebos.com/models/keypoint/higherhrnet_hrnet_w32_512.pdparams</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å‡ºHRNet(top-down)å…³é”®ç‚¹æ£€æµ‹æ¨¡å‹</span></span><br><span class="line">python tools/export_model.py -c configs/keypoint/hrnet/hrnet_w32_384x288.yml -o weights=https://paddledet.bj.bcebos.com/models/keypoint/hrnet_w32_384x288.pdparams</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å‡ºFairMOTå¤šç›®æ ‡è·Ÿè¸ªæ¨¡å‹</span></span><br><span class="line">python tools/export_model.py -c configs/mot/fairmot/fairmot_dla34_30e_1088x608.yml -o weights=https://paddledet.bj.bcebos.com/models/mot/fairmot_dla34_30e_1088x608.pdparams</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å‡ºByteTrackå¤šç›®æ ‡è·Ÿè¸ªæ¨¡å‹(ç›¸å½“äºåªå¯¼å‡ºæ£€æµ‹å™¨)</span></span><br><span class="line">python tools/export_model.py -c configs/mot/bytetrack/detector/ppyoloe_crn_l_36e_640x640_mot17half.yml -o weights=https://paddledet.bj.bcebos.com/models/mot/ppyoloe_crn_l_36e_640x640_mot17half.pdparams</span><br></pre></td></tr></table></figure><p>é¢„æµ‹</p><p>ä¿®æ”¹<code>deploy/python/infer.py</code>å¯åŠ¨è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    paddle.enable_static()</span><br><span class="line">    parser = argsparser()</span><br><span class="line">    FLAGS = parser.parse_args()</span><br><span class="line">    FLAGS.device = <span class="string">'gpu'</span></span><br><span class="line">    FLAGS.video_file = <span class="string">'/exp/work/video/PaddleDetection/demo_input/t2.mp4'</span></span><br><span class="line">    FLAGS.output_dir = <span class="string">'/exp/work/video/PaddleDetection/demo_output/'</span></span><br><span class="line">    FLAGS.model_dir = <span class="string">'/exp/work/video/PaddleDetection/inference_model/yolov3_darknet53_270e_coco'</span></span><br><span class="line">    print_arguments(FLAGS)</span><br><span class="line">    FLAGS.device = FLAGS.device.upper()</span><br><span class="line">    <span class="keyword">assert</span> FLAGS.device <span class="keyword">in</span> [<span class="string">'CPU'</span>, <span class="string">'GPU'</span>, <span class="string">'XPU'</span>, <span class="string">'NPU'</span></span><br><span class="line">                            ], <span class="string">"device should be CPU, GPU, XPU or NPU"</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">not</span> FLAGS.use_gpu, <span class="string">"use_gpu has been deprecated, please use --device"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">not</span> (</span><br><span class="line">        FLAGS.enable_mkldnn == <span class="literal">False</span> <span class="keyword">and</span> FLAGS.enable_mkldnn_bfloat16 == <span class="literal">True</span></span><br><span class="line">    ), <span class="string">'To enable mkldnn bfloat, please turn on both enable_mkldnn and enable_mkldnn_bfloat16'</span></span><br><span class="line"></span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="pp-human"><a href="#pp-human" class="headerlink" title="pp-human"></a>pp-human</h2><p>è¡Œäººæ£€æµ‹æ¨¡å—ï¼Œå¯¹åº”é…ç½®æ–‡ä»¶ä½ç½®ï¼š<code>deploy/pipeline/config/examples/infer_cfg_pphuman.yml</code></p><p>é€šè¿‡å‘½ä»¤å¯åŠ¨æ£€æµ‹è„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/examples/infer_cfg_human_attr.yml --device=gpu --video_file=demo_input/t1.mp4 --output_dir=demo_output/</span><br></pre></td></tr></table></figure><p><img src="/2023/08/07/paddleDetectionå‰ç½®/PaddleDetectionå‰ç½®/A.png" alt></p><h2 id="pp-vehicle"><a href="#pp-vehicle" class="headerlink" title="pp-vehicle"></a>pp-vehicle</h2><p>è½¦è¾†æ£€æµ‹æ¨¡å—ï¼Œå¯¹åº”é…ç½®æ–‡ä»¶ä½ç½®ï¼š<code>deploy/pipeline/config/examples/infer_cfg_ppvehicle.yml</code></p><p>é€šè¿‡å‘½ä»¤å¯åŠ¨æ£€æµ‹è„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deploy/pipeline/pipeline.py --config deploy/pipeline/config/infer_cfg_ppvehicle.yml --video_file=demo_input/car.mp4 --device=gpu --output_dir=demo_output</span><br></pre></td></tr></table></figure><p><img src="/2023/08/07/paddleDetectionå‰ç½®/PaddleDetectionå‰ç½®/B.png" alt></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒ&quot;&gt;&lt;/a&gt;ç¯å¢ƒ&lt;/h2&gt;&lt;h3 id=&quot;GPU&quot;&gt;&lt;a href=&quot;#GPU&quot; class=&quot;headerlink&quot; title=&quot;GPU&quot;&gt;&lt;/a&gt;GPU&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;NVIDIA 3090*2&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æ˜¾å¡é©±åŠ¨ 515.43.04&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;CUDAç‰ˆæœ¬ 11.7&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;CUDAtoolkit (cuda_11.7.0_515.43.04_linux)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;cuDNN (v8.4.1)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;font color=&quot;gold&quot;&gt;paddlepaddle å¤šå¡è®­ç»ƒéœ€è¦NCLLæ”¯æŒ&lt;/font&gt; (ncll v2.12.12 cuda11.7)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;paddlepaddleç‰ˆæœ¬&quot;&gt;&lt;a href=&quot;#paddlepaddleç‰ˆæœ¬&quot; class=&quot;headerlink&quot; title=&quot;paddlepaddleç‰ˆæœ¬&quot;&gt;&lt;/a&gt;paddlepaddleç‰ˆæœ¬&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;v2.4.2&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;paddleDetectionç‰ˆæœ¬&quot;&gt;&lt;a href=&quot;#paddleDetectionç‰ˆæœ¬&quot; class=&quot;headerlink&quot; title=&quot;paddleDetectionç‰ˆæœ¬&quot;&gt;&lt;/a&gt;paddleDetectionç‰ˆæœ¬&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;v2.6.0&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;pythonç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#pythonç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;pythonç¯å¢ƒ&quot;&gt;&lt;/a&gt;pythonç¯å¢ƒ&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;CentOS7.9&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;anaconda3&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;python3.8&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;æ™®é€šè§†é¢‘å¤„ç†&quot;&gt;&lt;a href=&quot;#æ™®é€šè§†é¢‘å¤„ç†&quot; class=&quot;headerlink&quot; title=&quot;æ™®é€šè§†é¢‘å¤„ç†&quot;&gt;&lt;/a&gt;æ™®é€šè§†é¢‘å¤„ç†&lt;/h2&gt;&lt;font color=&quot;gold&quot;&gt;h264æ ¼å¼è§†é¢‘è¢«opencvè§£æå¸§ç‡è¶…è¿‡65535æŠ¥é”™&lt;/font&gt;

&lt;p&gt;æºç ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;./deploy/pipeline/pipeline.py&lt;/code&gt; predict_video&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;out_path = os.path.join(self.output_dir, video_out_name + &lt;span class=&quot;string&quot;&gt;&quot;.mp4&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fourcc = cv2.VideoWriter_fourcc(* &lt;span class=&quot;string&quot;&gt;&#39;mp4v&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;writer = cv2.VideoWriter(out_path, fourcc, fps, (width, height))&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¾“å…¥ï¼šcv2.VideoCapture()&lt;/p&gt;
&lt;p&gt;è¾“å‡ºï¼šcv2.VideoWriter(ï¼‰&lt;/p&gt;
&lt;p&gt;æœ¬GPUæ¨¡å¼ä¸‹å¯¹æ—¶é•¿5åˆ†é’Ÿçš„è¡Œäººæ£€æµ‹è§†é¢‘å¤„ç†æ—¶é—´çº¦20åˆ†é’Ÿï¼ˆé«˜ç²¾åº¦æ¨¡å‹ï¼‰ï¼Œè§†é¢‘ä½“ç§¯å¢å¤§13å€ï¼ˆ100M-&amp;gt;1.3Gï¼‰&lt;/p&gt;</summary>
    
    
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://yoursite.com/categories/æ·±åº¦å­¦ä¹ /"/>
    
    
    <category term="paddlepaddle" scheme="http://yoursite.com/tags/paddlepaddle/"/>
    
    <category term="opencv" scheme="http://yoursite.com/tags/opencv/"/>
    
  </entry>
  
  <entry>
    <title>æ­å»ºnebula-CentOSé›†ç¾¤ï¼ˆæé€Ÿç‰ˆï¼‰</title>
    <link href="http://yoursite.com/2023/07/10/%E6%90%AD%E5%BB%BAnebula-CentOS%E9%9B%86%E7%BE%A4%EF%BC%88%E6%9E%81%E9%80%9F%E7%89%88%EF%BC%89/"/>
    <id>http://yoursite.com/2023/07/10/%E6%90%AD%E5%BB%BAnebula-CentOS%E9%9B%86%E7%BE%A4%EF%BC%88%E6%9E%81%E9%80%9F%E7%89%88%EF%BC%89/</id>
    <published>2023-07-10T01:05:06.000Z</published>
    <updated>2023-08-10T01:38:30.425Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><ul><li>ç³»ç»Ÿ</li></ul><p>CentOS7.9</p><ul><li>æœºå™¨</li></ul><p>ä¸‰å°ï¼Œåˆ†åˆ«ä¸º<code>nebula01</code>ã€<code>nebula02</code>ã€<code>nebula03</code>ã€</p><ul><li>å®‰è£…ä½ç½®</li></ul><p><code>/usr/local</code></p><ul><li>nebulaç‰ˆæœ¬</li></ul><p><code>2.6.1</code></p><ul><li>nebula-graph-studioç‰ˆæœ¬</li></ul><p><code>3.2.3</code></p><h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h2><ul><li>ä¸‹è½½<code>tar.gz</code>æ–‡ä»¶</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local</span><br><span class="line">wget https://oss-cdn.nebula-graph.com.cn/package/2.6.1/nebula-graph-2.6.1.el7.x86_64.tar.gz</span><br><span class="line">wget https://oss-cdn.nebula-graph.com.cn/nebula-graph-studio/3.2.3/nebula-graph-studio-3.2.3.x86_64.tar.gz</span><br></pre></td></tr></table></figure><ul><li>è§£å‹ç¼©å¹¶é‡å‘½åæ–‡ä»¶</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf nebula-graph-2.6.1.el7.x86_64.tar.gz &amp;&amp; mv nebula-graph-2.6.1.el7.x86_64 nebula</span><br><span class="line">tar -zxvf nebula-graph-studio-3.2.3.x86_64.tar.gz &amp;&amp; mv nebula-graph-studio-3.2.3.x86_64 nebula-graph-studio</span><br></pre></td></tr></table></figure><ul><li>å¤åˆ¶é…ç½®æ–‡ä»¶</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd nebula/etc</span><br><span class="line">cp nebula-graphd.conf.default nebula-graphd.conf</span><br><span class="line">cp nebula-metad.conf.default nebula-metad.conf</span><br><span class="line">cp nebula-storaged.conf.default nebula-storaged.conf</span><br></pre></td></tr></table></figure><a id="more"></a><ul><li>ä¿®æ”¹é…ç½®æ–‡ä»¶</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nebula-graphd.conf</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="comment"># The directory to host logging files</span></span><br><span class="line"><span class="string">--log_dir=/data/nebula/logs</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="comment"># Comma separated Meta Server Addresses</span></span><br><span class="line"><span class="string">--meta_server_addrs=nebula01:9559,nebula02:9559,nebula03:9559</span></span><br><span class="line"><span class="comment"># Local IP used to identify the nebula-graphd process.</span></span><br><span class="line"><span class="comment"># Change it to an address other than loopback if the service is distributed or</span></span><br><span class="line"><span class="comment"># will be accessed remotely.</span></span><br><span class="line"><span class="string">--local_ip=nebula01</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nebula-metad.conf</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="comment"># The directory to host logging files</span></span><br><span class="line"><span class="string">--log_dir=/data/nebula/logs</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="comment"># Comma separated Meta Server addresses</span></span><br><span class="line"><span class="string">--meta_server_addrs=nebula01:9559,nebula02:9559,nebula03:9559</span></span><br><span class="line"><span class="comment"># Local IP used to identify the nebula-metad process.</span></span><br><span class="line"><span class="comment"># Change it to an address other than loopback if the service is distributed or</span></span><br><span class="line"><span class="comment"># will be accessed remotely.</span></span><br><span class="line"><span class="string">--local_ip=nebula01</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="comment"># Root data path, here should be only single path for metad</span></span><br><span class="line"><span class="string">--data_path=/data/nebula/meta</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nebula-storaged.conf</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="comment"># The directory to host logging files</span></span><br><span class="line"><span class="string">--log_dir=/data/nebula/logs</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="comment"># Comma separated Meta server addresses</span></span><br><span class="line"><span class="string">--meta_server_addrs=nebula01:9559,nebula02:9559,nebula03:9559</span></span><br><span class="line"><span class="comment"># Local IP used to identify the nebula-storaged process.</span></span><br><span class="line"><span class="comment"># Change it to an address other than loopback if the service is distributed or</span></span><br><span class="line"><span class="comment"># will be accessed remotely.</span></span><br><span class="line"><span class="string">--local_ip=nebula01</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="comment"># Root data path. Split by comma. e.g. --data_path=/disk1/path1/,/disk2/path2/</span></span><br><span class="line"><span class="comment"># One path per Rocksdb instance.</span></span><br><span class="line"><span class="string">--data_path=/data/nebula/storage</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><ul><li>åˆ†å‘nebulaæ–‡ä»¶ï¼Œå¹¶ä¿®æ”¹å¯¹åº”çš„<code>--local_ip</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ../..</span><br><span class="line">scp -r nebula nebula02:`pwd`/</span><br><span class="line">scp -r nebula nebula03:`pwd`/</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨é›†ç¾¤</li></ul><p><font color="gold">æ³¨ï¼š</font>å› ä¸ºmetaæœºå™¨é€‰æ‹©äº†nebula01ã€02ã€03å…±ä¸‰å°æœºå™¨ï¼Œå¯åŠ¨æ—¶éœ€è¦å°†ä¸‰å°åŒæ—¶æ‰§è¡Œå‘½ä»¤æ‹‰èµ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nebula/scripts/nebula.service start all</span><br></pre></td></tr></table></figure><ul><li>æ£€æŸ¥é›†ç¾¤çŠ¶æ€</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nebula/scripts/nebula.service status all</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[INFO] nebula-metad(de03025): Running as 24680, Listening on 9559 </span><br><span class="line">[INFO] nebula-graphd(de03025): Running as 25453, Listening on 9669 </span><br><span class="line">[INFO] nebula-storaged(de03025): Running as 24787, Listening on 9779</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶<code>nebula</code>æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆ<code>cluster.id</code>æ–‡ä»¶ï¼Œé›†ç¾¤æˆåŠŸå¯åŠ¨</p><ul><li>å¯åŠ¨nebula-graph-studio</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd nebula-graph-studio</span><br><span class="line">nohup ./server &amp;</span><br></pre></td></tr></table></figure><p><img src="/2023/07/10/æ­å»ºnebula-CentOSé›†ç¾¤ï¼ˆæé€Ÿç‰ˆï¼‰/A.png" alt></p><p><font color="gold">æ³¨ï¼š</font>åŒæ ·å¯ç”¨äºé›†ç¾¤æ•°æ®æ¢å¤ï¼ˆ<code>/data</code>ä¸‹çš„æ•°æ®å·²å¤‡ä»½ï¼‰</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ç¯å¢ƒå‡†å¤‡&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒå‡†å¤‡&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒå‡†å¤‡&quot;&gt;&lt;/a&gt;ç¯å¢ƒå‡†å¤‡&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ç³»ç»Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;CentOS7.9&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœºå™¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‰å°ï¼Œåˆ†åˆ«ä¸º&lt;code&gt;nebula01&lt;/code&gt;ã€&lt;code&gt;nebula02&lt;/code&gt;ã€&lt;code&gt;nebula03&lt;/code&gt;ã€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®‰è£…ä½ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;/usr/local&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;nebulaç‰ˆæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;2.6.1&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;nebula-graph-studioç‰ˆæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;3.2.3&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;å¿«é€Ÿå¼€å§‹&quot;&gt;&lt;a href=&quot;#å¿«é€Ÿå¼€å§‹&quot; class=&quot;headerlink&quot; title=&quot;å¿«é€Ÿå¼€å§‹&quot;&gt;&lt;/a&gt;å¿«é€Ÿå¼€å§‹&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ä¸‹è½½&lt;code&gt;tar.gz&lt;/code&gt;æ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cd /usr/local&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wget https://oss-cdn.nebula-graph.com.cn/package/2.6.1/nebula-graph-2.6.1.el7.x86_64.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wget https://oss-cdn.nebula-graph.com.cn/nebula-graph-studio/3.2.3/nebula-graph-studio-3.2.3.x86_64.tar.gz&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;è§£å‹ç¼©å¹¶é‡å‘½åæ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;tar -zxvf nebula-graph-2.6.1.el7.x86_64.tar.gz &amp;amp;&amp;amp; mv nebula-graph-2.6.1.el7.x86_64 nebula&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tar -zxvf nebula-graph-studio-3.2.3.x86_64.tar.gz &amp;amp;&amp;amp; mv nebula-graph-studio-3.2.3.x86_64 nebula-graph-studio&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;å¤åˆ¶é…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cd nebula/etc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cp nebula-graphd.conf.default nebula-graphd.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cp nebula-metad.conf.default nebula-metad.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cp nebula-storaged.conf.default nebula-storaged.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="BigData" scheme="http://yoursite.com/categories/BigData/"/>
    
    
    <category term="database" scheme="http://yoursite.com/tags/database/"/>
    
    <category term="nebua" scheme="http://yoursite.com/tags/nebua/"/>
    
  </entry>
  
  <entry>
    <title>Nebula-Sparkå’Œå›¾ç®—æ³•</title>
    <link href="http://yoursite.com/2023/03/24/Nebula-Spark/"/>
    <id>http://yoursite.com/2023/03/24/Nebula-Spark/</id>
    <published>2023-03-24T06:34:47.000Z</published>
    <updated>2024-01-08T07:52:12.236Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><h2 id="Nebula-Spark-Connector"><a href="#Nebula-Spark-Connector" class="headerlink" title="Nebula Spark Connector"></a>Nebula Spark Connector</h2><p>ä¸‹è½½åœ°å€&amp;å®˜æ–¹æ–‡æ¡£ï¼šã€<a href="https://github.com/vesoft-inc/nebula-spark-connector" target="_blank" rel="noopener">https://github.com/vesoft-inc/nebula-spark-connector</a>ã€‘</p><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p><strong>Â·</strong> nebulaï¼š<font color="orange">2.6.1</font><br><strong>Â·</strong> hadoopï¼š<font color="orange">2.7</font><br><strong>Â·</strong> sparkï¼š<font color="orange">2.4.7</font><br><strong>Â·</strong> pysparkï¼š<font color="orange">2.4.7</font><br><strong>Â·</strong> pythonï¼š<font color="orange">3.7.16</font><br><strong>Â·</strong> nebula-spark-connectorï¼š<font color="orange">2.6.1</font></p><h3 id="ç¼–è¯‘æ‰“åŒ…nebula-spark-connector"><a href="#ç¼–è¯‘æ‰“åŒ…nebula-spark-connector" class="headerlink" title="ç¼–è¯‘æ‰“åŒ…nebula-spark-connector"></a>ç¼–è¯‘æ‰“åŒ…nebula-spark-connector</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> nebula-spark-connector-2.6.1/nebula-spark-connector</span><br><span class="line">$ mvn clean package -Dmaven.test.skip=<span class="literal">true</span> -Dgpg.skip -Dmaven.javadoc.skip=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>æˆåŠŸååœ¨<code>nebula-spark-connector/target/</code> ç›®å½•ä¸‹å¾—åˆ° <code>nebula-spark-connector-2.6.1.jar</code>æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(base) [root@root target]<span class="comment"># ll</span></span><br><span class="line">total 106792</span><br><span class="line">drwxr-xr-x 3 root root        17 Mar 11 14:14 classes</span><br><span class="line">-rw-r--r-- 1 root root         1 Mar 11 14:14 classes.-497386701.timestamp</span><br><span class="line">-rw-r--r-- 1 root root         1 Mar 11 14:14 classes.timestamp</span><br><span class="line">-rw-r--r-- 1 root root     30701 Mar 11 14:15 jacoco.exec</span><br><span class="line">drwxr-xr-x 2 root root        28 Mar 11 14:15 maven-archiver</span><br><span class="line">-rw-r--r-- 1 root root 108375457 Mar 11 14:16 nebula-spark-connector-2.6.1.jar</span><br><span class="line">-rw-r--r-- 1 root root    583482 Mar 11 14:16 nebula-spark-connector-2.6.1-javadoc.jar</span><br><span class="line">-rw-r--r-- 1 root root     36358 Mar 11 14:16 nebula-spark-connector-2.6.1-sources.jar</span><br><span class="line">-rw-r--r-- 1 root root    315392 Mar 11 14:15 original-nebula-spark-connector-2.6.1.jar</span><br><span class="line">drwxr-xr-x 4 root root        37 Mar 11 14:15 site</span><br></pre></td></tr></table></figure><h3 id="PySpark-è¯»å–-NebulaGraph-æ•°æ®"><a href="#PySpark-è¯»å–-NebulaGraph-æ•°æ®" class="headerlink" title="PySpark è¯»å– NebulaGraph æ•°æ®"></a>PySpark è¯»å– NebulaGraph æ•°æ®</h3><p>ä» <code>metaAddress</code> ä¸º <code>&quot;metad0:9559&quot;</code> çš„ Nebula Graph ä¸­è¯»å–æ•´ä¸ª tag ä¸‹çš„æ•°æ®ä¸ºä¸€ä¸ª dataframeï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">df = spark.read.format(</span><br><span class="line">  <span class="string">"com.vesoft.nebula.connector.NebulaDataSource"</span>).option(</span><br><span class="line">    <span class="string">"type"</span>, <span class="string">"vertex"</span>).option(</span><br><span class="line">    <span class="string">"spaceName"</span>, <span class="string">"basketballplayer"</span>).option(</span><br><span class="line">    <span class="string">"label"</span>, <span class="string">"player"</span>).option(</span><br><span class="line">    <span class="string">"returnCols"</span>, <span class="string">"name,age"</span>).option(</span><br><span class="line">    <span class="string">"metaAddress"</span>, <span class="string">"metad0:9559"</span>).option(</span><br><span class="line">    <span class="string">"partitionNumber"</span>, <span class="number">1</span>).load()</span><br></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥åƒè¿™æ · <code>show</code> è¿™ä¸ª dataframeï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.show(n=<span class="number">2</span>)</span><br><span class="line">+---------+--------------+---+</span><br><span class="line">|_vertexId|          name|age|</span><br><span class="line">+---------+--------------+---+</span><br><span class="line">|player105|   Danny Green| <span class="number">31</span>|</span><br><span class="line">|player109|Tiago Splitter| <span class="number">34</span>|</span><br><span class="line">+---------+--------------+---+</span><br><span class="line">only showing top <span class="number">2</span> rows</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="PySpark-å†™-NebulaGraph-æ•°æ®"><a href="#PySpark-å†™-NebulaGraph-æ•°æ®" class="headerlink" title="PySpark å†™ NebulaGraph æ•°æ®"></a>PySpark å†™ NebulaGraph æ•°æ®</h3><p>é»˜è®¤ä¸æŒ‡å®šçš„æƒ…å†µä¸‹ <code>writeMode</code> æ˜¯ <code>insert</code>ï¼š</p><h4 id="å†™å…¥ç‚¹"><a href="#å†™å…¥ç‚¹" class="headerlink" title="å†™å…¥ç‚¹"></a>å†™å…¥ç‚¹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">df.write.format(<span class="string">"com.vesoft.nebula.connector.NebulaDataSource"</span>).option(</span><br><span class="line">    <span class="string">"type"</span>, <span class="string">"vertex"</span>).option(</span><br><span class="line">    <span class="string">"spaceName"</span>, <span class="string">"basketballplayer"</span>).option(</span><br><span class="line">    <span class="string">"label"</span>, <span class="string">"player"</span>).option(</span><br><span class="line">    <span class="string">"vidPolicy"</span>, <span class="string">""</span>).option(</span><br><span class="line">    <span class="string">"vertexField"</span>, <span class="string">"_vertexId"</span>).option(</span><br><span class="line">    <span class="string">"batch"</span>, <span class="number">1</span>).option(</span><br><span class="line">    <span class="string">"metaAddress"</span>, <span class="string">"metad0:9559"</span>).option(</span><br><span class="line">    <span class="string">"graphAddress"</span>, <span class="string">"graphd1:9669"</span>).option(</span><br><span class="line">    <span class="string">"passwd"</span>, <span class="string">"nebula"</span>).option(</span><br><span class="line">    <span class="string">"user"</span>, <span class="string">"root"</span>).save()</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤ç‚¹"><a href="#åˆ é™¤ç‚¹" class="headerlink" title="åˆ é™¤ç‚¹"></a>åˆ é™¤ç‚¹</h4><p>å¦‚æœæƒ³æŒ‡å®š <code>delete</code> æˆ–è€… <code>update</code> çš„éé»˜è®¤å†™å…¥æ¨¡å¼ï¼Œå¢åŠ  <code>writeMode</code> çš„é…ç½®ï¼Œæ¯”å¦‚ <code>delete</code> çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">df.write.format(<span class="string">"com.vesoft.nebula.connector.NebulaDataSource"</span>).option(</span><br><span class="line">    <span class="string">"type"</span>, <span class="string">"vertex"</span>).option(</span><br><span class="line">    <span class="string">"spaceName"</span>, <span class="string">"basketballplayer"</span>).option(</span><br><span class="line">    <span class="string">"label"</span>, <span class="string">"player"</span>).option(</span><br><span class="line">    <span class="string">"vidPolicy"</span>, <span class="string">""</span>).option(</span><br><span class="line">    <span class="string">"vertexField"</span>, <span class="string">"_vertexId"</span>).option(</span><br><span class="line">    <span class="string">"batch"</span>, <span class="number">1</span>).option(</span><br><span class="line">    <span class="string">"metaAddress"</span>, <span class="string">"metad0:9559"</span>).option(</span><br><span class="line">    <span class="string">"graphAddress"</span>, <span class="string">"graphd1:9669"</span>).option(</span><br><span class="line">    <span class="string">"passwd"</span>, <span class="string">"nebula"</span>).option(</span><br><span class="line">    <span class="string">"writeMode"</span>, <span class="string">"delete"</span>).option(</span><br><span class="line">    <span class="string">"user"</span>, <span class="string">"root"</span>).save()</span><br></pre></td></tr></table></figure><h4 id="å†™å…¥è¾¹"><a href="#å†™å…¥è¾¹" class="headerlink" title="å†™å…¥è¾¹"></a>å†™å…¥è¾¹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">df.write.format(<span class="string">"com.vesoft.nebula.connector.NebulaDataSource"</span>)\</span><br><span class="line">    .mode(<span class="string">"overwrite"</span>)\</span><br><span class="line">    .option(<span class="string">"srcPolicy"</span>, <span class="string">""</span>)\</span><br><span class="line">    .option(<span class="string">"dstPolicy"</span>, <span class="string">""</span>)\</span><br><span class="line">    .option(<span class="string">"metaAddress"</span>, <span class="string">"metad0:9559"</span>)\</span><br><span class="line">    .option(<span class="string">"graphAddress"</span>, <span class="string">"graphd:9669"</span>)\</span><br><span class="line">    .option(<span class="string">"user"</span>, <span class="string">"root"</span>)\</span><br><span class="line">    .option(<span class="string">"passwd"</span>, <span class="string">"nebula"</span>)\</span><br><span class="line">    .option(<span class="string">"type"</span>, <span class="string">"edge"</span>)\</span><br><span class="line">    .option(<span class="string">"spaceName"</span>, <span class="string">"basketballplayer"</span>)\</span><br><span class="line">    .option(<span class="string">"label"</span>, <span class="string">"server"</span>)\</span><br><span class="line">    .option(<span class="string">"srcVertexField"</span>, <span class="string">"srcid"</span>)\</span><br><span class="line">    .option(<span class="string">"dstVertexField"</span>, <span class="string">"dstid"</span>)\</span><br><span class="line">    .option(<span class="string">"rankField"</span>, <span class="string">""</span>)\</span><br><span class="line">    .option(<span class="string">"batch"</span>, <span class="number">100</span>)\</span><br><span class="line">    .option(<span class="string">"writeMode"</span>, <span class="string">"insert"</span>).save()   <span class="comment"># delete to delete edge, update to update edge</span></span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤è¾¹"><a href="#åˆ é™¤è¾¹" class="headerlink" title="åˆ é™¤è¾¹"></a>åˆ é™¤è¾¹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">df.write.format(<span class="string">"com.vesoft.nebula.connector.NebulaDataSource"</span>)\</span><br><span class="line">    .mode(<span class="string">"overwrite"</span>)\</span><br><span class="line">    .option(<span class="string">"srcPolicy"</span>, <span class="string">""</span>)\</span><br><span class="line">    .option(<span class="string">"dstPolicy"</span>, <span class="string">""</span>)\</span><br><span class="line">    .option(<span class="string">"metaAddress"</span>, <span class="string">"metad0:9559"</span>)\</span><br><span class="line">    .option(<span class="string">"graphAddress"</span>, <span class="string">"graphd:9669"</span>)\</span><br><span class="line">    .option(<span class="string">"user"</span>, <span class="string">"root"</span>)\</span><br><span class="line">    .option(<span class="string">"passwd"</span>, <span class="string">"nebula"</span>)\</span><br><span class="line">    .option(<span class="string">"type"</span>, <span class="string">"edge"</span>)\</span><br><span class="line">    .option(<span class="string">"spaceName"</span>, <span class="string">"basketballplayer"</span>)\</span><br><span class="line">    .option(<span class="string">"label"</span>, <span class="string">"server"</span>)\</span><br><span class="line">    .option(<span class="string">"srcVertexField"</span>, <span class="string">"srcid"</span>)\</span><br><span class="line">    .option(<span class="string">"dstVertexField"</span>, <span class="string">"dstid"</span>)\</span><br><span class="line">    .option(<span class="string">"randkField"</span>, <span class="string">""</span>)\</span><br><span class="line">    .option(<span class="string">"batch"</span>, <span class="number">100</span>)\</span><br><span class="line">    .option(<span class="string">"writeMode"</span>, <span class="string">"delete"</span>).save()   <span class="comment"># delete to delete edge, update to update edge</span></span><br></pre></td></tr></table></figure><h3 id="å…³äº-PySpark-è¯»å†™çš„-option"><a href="#å…³äº-PySpark-è¯»å†™çš„-option" class="headerlink" title="å…³äº PySpark è¯»å†™çš„ option"></a>å…³äº PySpark è¯»å†™çš„ option</h3><p>å¯¹äºå…¶ä»–çš„ optionï¼Œæ¯”å¦‚åˆ é™¤ç‚¹çš„æ—¶å€™çš„ <code>withDeleteEdge</code> å¯ä»¥å‚è€ƒ [nebula/connector/NebulaOptions.scala</p><p>](<a href="https://github.com/vesoft-inc/nebula-spark-connector/blob/master/nebula-spark-connector/src/main/scala/com/vesoft/nebula/connector/NebulaOptions.scala" target="_blank" rel="noopener">https://github.com/vesoft-inc/nebula-spark-connector/blob/master/nebula-spark-connector/src/main/scala/com/vesoft/nebula/connector/NebulaOptions.scala</a>) çš„å­—ç¬¦ä¸²é…ç½®å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒçš„å­—ç¬¦ä¸²å®šä¹‰å­—æ®µæ˜¯ <code>deleteEdge</code> ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** write config */</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">RATE_LIMIT</span>: <span class="type">String</span>   = <span class="string">"rateLimit"</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">VID_POLICY</span>: <span class="type">String</span>   = <span class="string">"vidPolicy"</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">SRC_POLICY</span>: <span class="type">String</span>   = <span class="string">"srcPolicy"</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">DST_POLICY</span>: <span class="type">String</span>   = <span class="string">"dstPolicy"</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">VERTEX_FIELD</span>         = <span class="string">"vertexField"</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">SRC_VERTEX_FIELD</span>     = <span class="string">"srcVertexField"</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">DST_VERTEX_FIELD</span>     = <span class="string">"dstVertexField"</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">RANK_FIELD</span>           = <span class="string">"randkField"</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">BATCH</span>: <span class="type">String</span>        = <span class="string">"batch"</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">VID_AS_PROP</span>: <span class="type">String</span>  = <span class="string">"vidAsProp"</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">SRC_AS_PROP</span>: <span class="type">String</span>  = <span class="string">"srcAsProp"</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">DST_AS_PROP</span>: <span class="type">String</span>  = <span class="string">"dstAsProp"</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">RANK_AS_PROP</span>: <span class="type">String</span> = <span class="string">"rankAsProp"</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">WRITE_MODE</span>: <span class="type">String</span>   = <span class="string">"writeMode"</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">DELETE_EDGE</span>: <span class="type">String</span>  = <span class="string">"deleteEdge"</span></span><br></pre></td></tr></table></figure><h2 id="PySpark-è°ƒç”¨-Nebula-Spark-Connector"><a href="#PySpark-è°ƒç”¨-Nebula-Spark-Connector" class="headerlink" title="PySpark è°ƒç”¨ Nebula Spark Connector"></a>PySpark è°ƒç”¨ Nebula Spark Connector</h2><h3 id="Pycharm"><a href="#Pycharm" class="headerlink" title="Pycharm"></a>Pycharm</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥SparkSessionã€findsparkè‡ªåŠ¨è·å–$&#123;SPARK_HOME&#125;ï¼Œå®šä¹‰è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> findspark</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">"HADOOP_CONF_DIR"</span>] = <span class="string">"/exp/server/hadoop-2.7.7/etc/hadoop"</span></span><br><span class="line">os.environ[<span class="string">"YARN_CONF_DIR"</span>] = <span class="string">"/exp/server/hadoop-2.7.7/etc/hadoop"</span></span><br><span class="line">os.environ[<span class="string">"SPARK_HOME"</span>] = <span class="string">"/exp/server/spark-2.4.7-bin-hadoop2.7"</span></span><br><span class="line">os.environ[<span class="string">"PYSPARK_PYTHON"</span>] = <span class="string">"/root/anaconda3/envs/pyspark38/bin/python"</span></span><br><span class="line">os.environ[<span class="string">"PYSPARK_DRIVER_PYTHON"</span>] = <span class="string">"/root/anaconda3/envs/pyspark38/bin/python"</span></span><br><span class="line">findspark.init()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºSparkSessionå¯¹è±¡ï¼Œå¯¼å…¥targetä¸‹çš„jaråŒ…</span></span><br><span class="line">spark = SparkSession.builder.config(</span><br><span class="line">    <span class="string">"spark.jars"</span>,</span><br><span class="line">    <span class="string">"/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar"</span>).config(</span><br><span class="line">    <span class="string">"spark.driver.extraClassPath"</span>,</span><br><span class="line">    <span class="string">"/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar"</span>).appName(</span><br><span class="line">    <span class="string">"nebula-connector"</span>).getOrCreate()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–nebula-graphæ•°æ®</span></span><br><span class="line"><span class="comment"># read vertex</span></span><br><span class="line">df_tag = spark.read.format(</span><br><span class="line">    <span class="string">"com.vesoft.nebula.connector.NebulaDataSource"</span>).option(</span><br><span class="line">    <span class="string">"sep"</span>, <span class="string">"\t"</span>).option(</span><br><span class="line">    <span class="string">"type"</span>, <span class="string">"vertex"</span>).option(</span><br><span class="line">    <span class="string">"spaceName"</span>, <span class="string">"space"</span>).option(</span><br><span class="line">    <span class="string">"label"</span>, <span class="string">"tag"</span>).option(</span><br><span class="line">    <span class="string">"returnCols"</span>, <span class="string">""</span>).option(</span><br><span class="line">    <span class="string">"metaAddress"</span>, <span class="string">"metahost:9559"</span>).option(</span><br><span class="line">    <span class="string">"partitionNumber"</span>, <span class="number">1</span>).load()</span><br><span class="line"></span><br><span class="line"><span class="comment"># read edge</span></span><br><span class="line">df_edge = spark.read.format(</span><br><span class="line">    <span class="string">"com.vesoft.nebula.connector.NebulaDataSource"</span>).option(</span><br><span class="line">    <span class="string">"sep"</span>, <span class="string">"\t"</span>).option(</span><br><span class="line">    <span class="string">"type"</span>, <span class="string">"edge"</span>).option(</span><br><span class="line">    <span class="string">"spaceName"</span>, <span class="string">"space"</span>).option(</span><br><span class="line">    <span class="string">"label"</span>, <span class="string">"edge"</span>).option(</span><br><span class="line">    <span class="string">"returnCols"</span>, <span class="string">""</span>).option(</span><br><span class="line">    <span class="string">"metaAddress"</span>, <span class="string">"metahost:9559"</span>).option(</span><br><span class="line">    <span class="string">"partitionNumber"</span>, <span class="number">1</span>).load()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™å›nebula-graph</span></span><br><span class="line"><span class="comment"># write vertex</span></span><br><span class="line">df_tag.write.format(<span class="string">"com.vesoft.nebula.connector.NebulaDataSource"</span>).option(</span><br><span class="line">    <span class="string">"type"</span>, <span class="string">"vertex"</span>).option(</span><br><span class="line">    <span class="string">"spaceName"</span>, <span class="string">"space"</span>).option(</span><br><span class="line">    <span class="string">"label"</span>, <span class="string">"tag"</span>).option(</span><br><span class="line">    <span class="string">"vidPolicy"</span>, <span class="string">""</span>).option(</span><br><span class="line">    <span class="string">"vertexField"</span>, <span class="string">"_vertexId"</span>).option(</span><br><span class="line">    <span class="string">"batch"</span>, <span class="number">1</span>).option(</span><br><span class="line">    <span class="string">"metaAddress"</span>, <span class="string">"metahost:9559"</span>).option(</span><br><span class="line">    <span class="string">"graphAddress"</span>, <span class="string">"graphhost:9669"</span>).option(</span><br><span class="line">    <span class="string">"passwd"</span>, <span class="string">"nebula"</span>).option(</span><br><span class="line">    <span class="string">"writeMode"</span>, <span class="string">"update"</span>).option(</span><br><span class="line">    <span class="string">"user"</span>, <span class="string">"root"</span>).save()</span><br><span class="line"></span><br><span class="line">df_tag.show()</span><br><span class="line">df_edge.show()</span><br></pre></td></tr></table></figure><h3 id="Spark-submit"><a href="#Spark-submit" class="headerlink" title="Spark-submit"></a>Spark-submit</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;SPARK_HOME&#125;</span>/bin/spark-submit --master <span class="built_in">local</span>[*] \</span><br><span class="line">--deploy-mode client  \</span><br><span class="line">--jars file:/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar \</span><br><span class="line">/exp/work/pyspark/nebula/nebula_reader.py</span><br></pre></td></tr></table></figure><h2 id="NebulaAlgorithm"><a href="#NebulaAlgorithm" class="headerlink" title="NebulaAlgorithm"></a>NebulaAlgorithm</h2><p>ä¸‹è½½åœ°å€&amp;å®˜æ–¹æ–‡æ¡£ï¼šã€&lt;<a href="https://github.com/vesoft-inc/nebula-algorithmã€‘" target="_blank" rel="noopener">https://github.com/vesoft-inc/nebula-algorithmã€‘</a></p><h3 id="ç¯å¢ƒ-1"><a href="#ç¯å¢ƒ-1" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p><strong>Â·</strong> nebulaï¼š<font color="orange">2.6.1</font><br><strong>Â·</strong> hadoopï¼š<font color="orange">2.7</font><br><strong>Â·</strong> sparkï¼š<font color="orange">2.4.7</font><br><strong>Â·</strong> pysparkï¼š<font color="orange">2.4.7</font><br><strong>Â·</strong> pythonï¼š<font color="orange">3.7.16</font><br><strong>Â·</strong> nebula-spark-connectorï¼š<font color="orange">2.6.1</font><br><strong>Â·</strong> nebula-algorithmï¼š<font color="orange">2.6.1</font></p><h3 id="ç¼–è¯‘æ‰“åŒ…nebula-spark-connector-1"><a href="#ç¼–è¯‘æ‰“åŒ…nebula-spark-connector-1" class="headerlink" title="ç¼–è¯‘æ‰“åŒ…nebula-spark-connector"></a>ç¼–è¯‘æ‰“åŒ…nebula-spark-connector</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> nebula-algorithm-2.6.1/nebula-algorithm</span><br><span class="line">$ mvn clean package -Dgpg.skip -Dmaven.javadoc.skip=<span class="literal">true</span> -Dmaven.test.skip=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>æˆåŠŸååœ¨<code>nebula-algorithm/target/</code> ç›®å½•ä¸‹å¾—åˆ° <code>nebula-algorithm-2.6.1.jar</code>æ–‡ä»¶</p><h2 id="PySpark-è°ƒç”¨-Nebula-Algorithm"><a href="#PySpark-è°ƒç”¨-Nebula-Algorithm" class="headerlink" title="PySpark è°ƒç”¨ Nebula Algorithm"></a>PySpark è°ƒç”¨ Nebula Algorithm</h2><h3 id="Pycharm-1"><a href="#Pycharm-1" class="headerlink" title="Pycharm"></a>Pycharm</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> findspark</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession, DataFrame</span><br><span class="line"><span class="keyword">from</span> pyspark.sql.functions <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pyspark.sql.window <span class="keyword">import</span> Window</span><br><span class="line"><span class="keyword">from</span> py4j.java_gateway <span class="keyword">import</span> java_import</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">"HADOOP_CONF_DIR"</span>] = <span class="string">"/exp/server/hadoop-2.7.7/etc/hadoop"</span></span><br><span class="line">os.environ[<span class="string">"YARN_CONF_DIR"</span>] = <span class="string">"/exp/server/hadoop-2.7.7/etc/hadoop"</span></span><br><span class="line">os.environ[<span class="string">"SPARK_HOME"</span>] = <span class="string">"/exp/server/spark-2.4.7-bin-hadoop2.7"</span></span><br><span class="line">os.environ[<span class="string">"PYSPARK_PYTHON"</span>] = <span class="string">"/root/anaconda3/envs/pyspark37/bin/python"</span></span><br><span class="line">os.environ[<span class="string">"PYSPARK_DRIVER_PYTHON"</span>] = <span class="string">"/root/anaconda3/envs/pyspark37/bin/python"</span></span><br><span class="line">findspark.init()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.config(</span><br><span class="line">    <span class="string">"spark.jars"</span>,</span><br><span class="line">    <span class="string">"/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar"</span>).config(</span><br><span class="line">    <span class="string">"spark.driver.extraClassPath"</span>,</span><br><span class="line">    <span class="string">"/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar"</span>).config(</span><br><span class="line">    <span class="string">"spark.jars"</span>,</span><br><span class="line">    <span class="string">"/exp/work/pyspark/nebula-algorithm/nebula-algorithm/target/nebula-algorithm-2.6.1.jar"</span>).config(</span><br><span class="line">    <span class="string">"spark.driver.extraClassPath"</span>,</span><br><span class="line">    <span class="string">"/exp/work/pyspark/nebula-algorithm/nebula-algorithm/target/nebula-algorithm-2.6.1.jar"</span>).appName(</span><br><span class="line">    <span class="string">"nebula-connector"</span>).getOrCreate()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># spark = SparkSession.builder.appName("PageRankExample").getOrCreate()</span></span><br><span class="line">jspark = spark._jsparkSession</span><br><span class="line"></span><br><span class="line"><span class="comment"># import "com.vesoft.nebula.algorithm.config.SparkConfig"</span></span><br><span class="line">java_import(spark._jvm, <span class="string">"com.vesoft.nebula.algorithm.config.SparkConfig"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># import "com.vesoft.nebula.algorithm.config.PRConfig"</span></span><br><span class="line">java_import(spark._jvm, <span class="string">"com.vesoft.nebula.algorithm.config.PRConfig"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># import "com.vesoft.nebula.algorithm.lib.PageRankAlgo"</span></span><br><span class="line">java_import(spark._jvm, <span class="string">"com.vesoft.nebula.algorithm.lib.PageRankAlgo"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†stringç±»å‹vidè½¬intç±»å‹vid</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_string_id_to_long_id</span><span class="params">(df)</span>:</span></span><br><span class="line">    df = df.drop(<span class="string">"display_desc"</span>).drop(<span class="string">"creation_time"</span>)</span><br><span class="line">    src_id_df = df.select(<span class="string">"_srcId"</span>).withColumnRenamed(<span class="string">"_srcId"</span>, <span class="string">"id"</span>)</span><br><span class="line">    dst_id_df = df.select(<span class="string">"_dstId"</span>).withColumnRenamed(<span class="string">"_dstId"</span>, <span class="string">"id"</span>)</span><br><span class="line">    id_df = src_id_df.union(dst_id_df).distinct()</span><br><span class="line">    encode_id = id_df.withColumn(<span class="string">"encodedId"</span>, dense_rank().over(Window.orderBy(<span class="string">"id"</span>)))</span><br><span class="line">    <span class="comment"># encode_id.write.option("header", True).csv("file:///tmp/encodeId.csv")</span></span><br><span class="line">    src_join_df = df.join(encode_id, df._srcId == encode_id.id) \</span><br><span class="line">        .drop(<span class="string">"_srcId"</span>) \</span><br><span class="line">        .drop(<span class="string">"id"</span>) \</span><br><span class="line">        .withColumnRenamed(<span class="string">"encodedId"</span>, <span class="string">"_srcId"</span>)</span><br><span class="line"></span><br><span class="line">    df_sv = df.join(encode_id, df._srcId == encode_id.id) \</span><br><span class="line">        .drop(<span class="string">"_srcId"</span>) \</span><br><span class="line">        .drop(<span class="string">"_rank"</span>) \</span><br><span class="line">        .drop(<span class="string">"_dstId"</span>) \</span><br><span class="line">        .withColumnRenamed(<span class="string">"id"</span>, <span class="string">"src_vid"</span>) \</span><br><span class="line">        .withColumnRenamed(<span class="string">"encodedId"</span>, <span class="string">"_srcId"</span>)</span><br><span class="line"></span><br><span class="line">    df_dv = src_join_df.join(encode_id, src_join_df._dstId == encode_id.id) \</span><br><span class="line">        .drop(<span class="string">"_dstId"</span>) \</span><br><span class="line">        .drop(<span class="string">"_rank"</span>) \</span><br><span class="line">        .drop(<span class="string">"degree"</span>) \</span><br><span class="line">        .withColumnRenamed(<span class="string">"encodedId"</span>, <span class="string">"_dstId"</span>) \</span><br><span class="line">        .withColumnRenamed(<span class="string">"_srcID"</span>, <span class="string">"_src"</span>) \</span><br><span class="line">        .withColumnRenamed(<span class="string">"id"</span>, <span class="string">"dst_vid"</span>)</span><br><span class="line"></span><br><span class="line">    dst_join_df = src_join_df.join(encode_id, src_join_df._dstId == encode_id.id) \</span><br><span class="line">        .drop(<span class="string">"_dstId"</span>) \</span><br><span class="line">        .drop(<span class="string">"_rank"</span>) \</span><br><span class="line">        .drop(<span class="string">"degree"</span>) \</span><br><span class="line">        .withColumnRenamed(<span class="string">"encodedId"</span>, <span class="string">"_dstId"</span>).drop(<span class="string">"id"</span>)</span><br><span class="line"></span><br><span class="line">    df_v = df_dv.join(df_sv, df_dv._src == df_sv._srcId).drop(<span class="string">"_src"</span>)</span><br><span class="line">    <span class="keyword">return</span> dst_join_df, df_v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df = spark.read.format(</span><br><span class="line">    <span class="string">"com.vesoft.nebula.connector.NebulaDataSource"</span>).option(</span><br><span class="line">    <span class="comment"># "sep", "\t").option(</span></span><br><span class="line">    <span class="string">"type"</span>, <span class="string">"edge"</span>).option(</span><br><span class="line">    <span class="string">"spaceName"</span>, <span class="string">"DWD_GRAPH_LY_V3_2023"</span>).option(</span><br><span class="line">    <span class="string">"label"</span>, <span class="string">"edge_phone"</span>).option(</span><br><span class="line">    <span class="string">"returnCols"</span>, <span class="string">""</span>).option(</span><br><span class="line">    <span class="string">"metaAddress"</span>, <span class="string">"192.168.100.45:9559"</span>).option(</span><br><span class="line">    <span class="string">"partitionNumber"</span>, <span class="number">1</span>).load()</span><br><span class="line"></span><br><span class="line">df.orderBy(<span class="string">"creation_time"</span>).show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df_int, df_v = convert_string_id_to_long_id(df)</span><br><span class="line">prConfig = spark._jvm.PRConfig(<span class="number">1</span>, <span class="number">0.8</span>)</span><br><span class="line">prResult = spark._jvm.PageRankAlgo.apply(jspark, df_int._jdf, prConfig, <span class="literal">False</span>)</span><br><span class="line">df_v.show(<span class="number">20</span>, <span class="literal">False</span>)</span><br><span class="line">prResult.show(<span class="number">20</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†jdfè½¬df</span></span><br><span class="line">prResult = prResult.toDF()</span><br><span class="line">pagerank_df = DataFrame(prResult, spark)</span><br><span class="line">pagerank_df.sort(col(<span class="string">"pagerank"</span>).desc()).show(<span class="number">60</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> PYSPARK (pyspark=2.4.7, python=3.7)</span></span><br><span class="line"><span class="comment"># conda activate pyspark37</span></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> SPARK-SUBMIT</span></span><br><span class="line"><span class="comment"># $&#123;SPARK_HOME&#125;/bin/spark-submit --master local[*] \</span></span><br><span class="line"><span class="comment"># --deploy-mode client \</span></span><br><span class="line"><span class="comment"># --driver-class-path file:/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar \</span></span><br><span class="line"><span class="comment"># --driver-class-path file:/exp/work/pyspark/nebula-algorithm/nebula-algorithm/target/nebula-algorithm-2.6.1.jar \</span></span><br><span class="line"><span class="comment"># --jars file:/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar \</span></span><br><span class="line"><span class="comment"># --jars file:/exp/work/pyspark/nebula-algorithm/nebula-algorithm/target/nebula-algorithm-2.6.1.jar \</span></span><br><span class="line"><span class="comment"># /exp/work/pyspark/nebula/pagerank.py</span></span><br></pre></td></tr></table></figure><h3 id="Spark-submit-1"><a href="#Spark-submit-1" class="headerlink" title="Spark-submit"></a>Spark-submit</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;SPARK_HOME&#125;</span>/bin/spark-submit --master <span class="built_in">local</span>[*] \</span><br><span class="line">--deploy-mode client \</span><br><span class="line">--driver-class-path file:/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar \</span><br><span class="line">--driver-class-path file:/exp/work/pyspark/nebula-algorithm/nebula-algorithm/target/nebula-algorithm-2.6.1.jar \</span><br><span class="line">--jars file:/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar \</span><br><span class="line">--jars file:/exp/work/pyspark/nebula-algorithm/nebula-algorithm/target/nebula-algorithm-2.6.1.jar \</span><br><span class="line">/exp/work/pyspark/nebula/pagerank.py</span><br></pre></td></tr></table></figure><h3 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line">ssh://root@192.168.100.43:22/root/anaconda3/envs/pyspark37/bin/python -u /exp/work/pyspark/nebula/pagerank.py</span><br><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding in [jar:file:/exp/work/pyspark/nebula-algorithm/nebula-algorithm/target/nebula-algorithm-2.6.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding in [jar:file:/exp/server/spark-2.4.7-bin-hadoop2.7/jars/slf4j-log4j12-1.7.16.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.</span><br><span class="line">SLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]</span><br><span class="line">23/03/24 14:42:29 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br><span class="line">Setting default log level to &quot;WARN&quot;.</span><br><span class="line">To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).</span><br><span class="line">+--------------------+--------------------+-----+-------------+------------+</span><br><span class="line">|              _srcId|              _dstId|_rank|creation_time|display_desc|</span><br><span class="line">+--------------------+--------------------+-----+-------------+------------+</span><br><span class="line">|dwd_accounttelegr...|dwd_phone66802018560|    0|   1678692201|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone12366827389|    0|   1678692201|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone86151162...|    0|   1678692201|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone79653470394|    0|   1678692210|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone99890918...|    0|   1678692210|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone99890535...|    0|   1678692210|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone85620578...|    0|   1678692210|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone99899666...|    0|   1678692210|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone88802607465|    0|   1678692219|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone62831556...|    0|   1678692228|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone95965067...|    0|   1678692228|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone85595212324|    0|   1678692228|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone86132873...|    0|   1678692279|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone63948774...|    0|   1678692279|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone85590645678|    0|   1678692279|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone63948229...|    0|   1678692288|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone99899913...|    0|   1678692288|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone99890302...|    0|   1678692288|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone99890986...|    0|   1678692288|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">|dwd_accounttelegr...|dwd_phone16728042478|    0|   1678692297|  æ³¨å†Œæ‰‹æœºå·|</span><br><span class="line">+--------------------+--------------------+-----+-------------+------------+</span><br><span class="line">only showing top 20 rows</span><br><span class="line"></span><br><span class="line">23/03/24 14:42:39 WARN window.WindowExec: No Partition Defined for Window operation! Moving all data to a single partition, this can cause serious performance degradation.</span><br><span class="line">23/03/24 14:42:39 WARN window.WindowExec: No Partition Defined for Window operation! Moving all data to a single partition, this can cause serious performance degradation.</span><br><span class="line">[Stage 3:&gt;                  (0 + 1) / 1][Stage 4:&gt;                  (0 + 1) / 1]23/03/24 14:42:49 WARN storage.BlockManager: Block rdd_29_0 already exists on this machine; not re-adding it</span><br><span class="line">23/03/24 14:42:50 WARN window.WindowExec: No Partition Defined for Window operation! Moving all data to a single partition, this can cause serious performance degradation.</span><br><span class="line">23/03/24 14:42:50 WARN window.WindowExec: No Partition Defined for Window operation! Moving all data to a single partition, this can cause serious performance degradation.</span><br><span class="line">23/03/24 14:42:50 WARN window.WindowExec: No Partition Defined for Window operation! Moving all data to a single partition, this can cause serious performance degradation.</span><br><span class="line">+----------------------+------+---------------------------------+------+</span><br><span class="line">|dst_vid               |_dstId|src_vid                          |_srcId|</span><br><span class="line">+----------------------+------+---------------------------------+------+</span><br><span class="line">|dwd_phone8613951884225|18141 |dwd_accountctrip1187326021       |1     |</span><br><span class="line">|dwd_phone8618705166775|19486 |dwd_accountctrip18705166775      |2     |</span><br><span class="line">|dwd_phone8613006584273|17582 |dwd_accountctripM2295153681      |3     |</span><br><span class="line">|dwd_phone8615668271999|18526 |dwd_accountctripM2494074526      |4     |</span><br><span class="line">|dwd_phone8616653556969|18757 |dwd_accountctripM2682271769      |5     |</span><br><span class="line">|dwd_phone8613562835888|17938 |dwd_accountctripM3011519721      |6     |</span><br><span class="line">|dwd_phone8618506413343|19344 |dwd_accountctripM4761127290      |7     |</span><br><span class="line">|dwd_phone8618112957512|19178 |dwd_accountctripM4915141465      |8     |</span><br><span class="line">|dwd_phone8615119464037|18222 |dwd_accountctripM548327259       |9     |</span><br><span class="line">|dwd_phone8613123368388|17719 |dwd_accountctripM601536478       |10    |</span><br><span class="line">|dwd_phone8617605442050|18905 |dwd_accountctrip_WeChat2269232661|11    |</span><br><span class="line">|dwd_phone8613123368388|17719 |dwd_accountdidi101108284         |12    |</span><br><span class="line">|dwd_phone8616653556969|18757 |dwd_accountdidi1641492054156     |13    |</span><br><span class="line">|dwd_phone8615851895366|18609 |dwd_accountdidi1746082933402     |14    |</span><br><span class="line">|dwd_phone8617561929739|18889 |dwd_accountdidi17598416475664    |15    |</span><br><span class="line">|dwd_phone8615119464037|18222 |dwd_accountdidi25441524          |16    |</span><br><span class="line">|dwd_phone8613006584273|17582 |dwd_accountdidi2881218873540     |17    |</span><br><span class="line">|dwd_phone8613951884225|18141 |dwd_accountdidi3099925           |18    |</span><br><span class="line">|dwd_phone8618600764544|19397 |dwd_accountdidi486186360832      |19    |</span><br><span class="line">|dwd_phone8618705166775|19486 |dwd_accountdidi772722            |20    |</span><br><span class="line">+----------------------+------+---------------------------------+------+</span><br><span class="line">only showing top 20 rows</span><br><span class="line"></span><br><span class="line">+-----+------------------+</span><br><span class="line">|_id  |pagerank          |</span><br><span class="line">+-----+------------------+</span><br><span class="line">|19021|1.1105466561585526|</span><br><span class="line">|9831 |0.8884373249268421|</span><br><span class="line">|5354 |0.8884373249268421|</span><br><span class="line">|4926 |0.8884373249268421|</span><br><span class="line">|21377|1.1105466561585526|</span><br><span class="line">|14609|1.1105466561585526|</span><br><span class="line">|11852|1.1105466561585526|</span><br><span class="line">|8390 |0.8884373249268421|</span><br><span class="line">|10837|0.8884373249268421|</span><br><span class="line">|4992 |0.8884373249268421|</span><br><span class="line">|20894|1.1105466561585526|</span><br><span class="line">|21780|1.1105466561585526|</span><br><span class="line">|1813 |0.8884373249268421|</span><br><span class="line">|9025 |0.8884373249268421|</span><br><span class="line">|14554|1.1105466561585526|</span><br><span class="line">|1780 |0.8884373249268421|</span><br><span class="line">|16132|1.1105466561585526|</span><br><span class="line">|22467|1.1105466561585526|</span><br><span class="line">|2117 |0.8884373249268421|</span><br><span class="line">|16321|1.1105466561585526|</span><br><span class="line">+-----+------------------+</span><br><span class="line">only showing top 20 rows</span><br><span class="line"></span><br><span class="line">+-----+------------------+</span><br><span class="line">|_id  |pagerank          |</span><br><span class="line">+-----+------------------+</span><br><span class="line">|18222|3.331639968475657 |</span><br><span class="line">|19178|2.8874213060122367|</span><br><span class="line">|19486|2.8874213060122367|</span><br><span class="line">|12765|1.9989839810853947|</span><br><span class="line">|13332|1.9989839810853947|</span><br><span class="line">|13505|1.9989839810853947|</span><br><span class="line">|17582|1.9989839810853947|</span><br><span class="line">|18889|1.776874649853684 |</span><br><span class="line">|19176|1.776874649853684 |</span><br><span class="line">|12470|1.776874649853684 |</span><br><span class="line">|19397|1.5547653186219736|</span><br><span class="line">|18141|1.5547653186219736|</span><br><span class="line">|11750|1.5547653186219736|</span><br><span class="line">|18555|1.5547653186219736|</span><br><span class="line">|13216|1.5547653186219736|</span><br><span class="line">|18905|1.5547653186219736|</span><br><span class="line">|17688|1.5547653186219736|</span><br><span class="line">|19734|1.5547653186219736|</span><br><span class="line">|12768|1.5547653186219736|</span><br><span class="line">|18609|1.5547653186219736|</span><br><span class="line">|18347|1.332655987390263 |</span><br><span class="line">|19473|1.332655987390263 |</span><br><span class="line">|12007|1.332655987390263 |</span><br><span class="line">|12100|1.332655987390263 |</span><br><span class="line">|16268|1.332655987390263 |</span><br><span class="line">|19298|1.332655987390263 |</span><br><span class="line">|23258|1.332655987390263 |</span><br><span class="line">|17938|1.332655987390263 |</span><br><span class="line">|20042|1.332655987390263 |</span><br><span class="line">|12639|1.332655987390263 |</span><br><span class="line">|13309|1.332655987390263 |</span><br><span class="line">|12739|1.332655987390263 |</span><br><span class="line">|18037|1.332655987390263 |</span><br><span class="line">|18757|1.332655987390263 |</span><br><span class="line">|18344|1.332655987390263 |</span><br><span class="line">|12461|1.332655987390263 |</span><br><span class="line">|20037|1.332655987390263 |</span><br><span class="line">|13754|1.332655987390263 |</span><br><span class="line">|18864|1.332655987390263 |</span><br><span class="line">|21713|1.332655987390263 |</span><br><span class="line">|16872|1.332655987390263 |</span><br><span class="line">|15710|1.332655987390263 |</span><br><span class="line">|12229|1.332655987390263 |</span><br><span class="line">|19183|1.332655987390263 |</span><br><span class="line">|17928|1.332655987390263 |</span><br><span class="line">|19118|1.332655987390263 |</span><br><span class="line">|20243|1.332655987390263 |</span><br><span class="line">|12223|1.332655987390263 |</span><br><span class="line">|23219|1.332655987390263 |</span><br><span class="line">|12529|1.332655987390263 |</span><br><span class="line">|20865|1.332655987390263 |</span><br><span class="line">|16538|1.332655987390263 |</span><br><span class="line">|13253|1.332655987390263 |</span><br><span class="line">|13329|1.332655987390263 |</span><br><span class="line">|13198|1.332655987390263 |</span><br><span class="line">|17719|1.332655987390263 |</span><br><span class="line">|14661|1.1105466561585526|</span><br><span class="line">|18584|1.1105466561585526|</span><br><span class="line">|12532|1.1105466561585526|</span><br><span class="line">|20466|1.1105466561585526|</span><br><span class="line">+-----+------------------+</span><br><span class="line">only showing top 60 rows</span><br></pre></td></tr></table></figure><h3 id="å°è£…å¹¶å†™å›nebula-graphå®ä¾‹"><a href="#å°è£…å¹¶å†™å›nebula-graphå®ä¾‹" class="headerlink" title="å°è£…å¹¶å†™å›nebula-graphå®ä¾‹"></a>å°è£…å¹¶å†™å›nebula-graphå®ä¾‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> findspark</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession, DataFrame</span><br><span class="line"><span class="keyword">from</span> pyspark.sql.functions <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pyspark.sql.window <span class="keyword">import</span> Window</span><br><span class="line"><span class="keyword">from</span> py4j.java_gateway <span class="keyword">import</span> java_import</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> nebula_config</span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> environment variables</span></span><br><span class="line">os.environ[<span class="string">"HADOOP_CONF_DIR"</span>] = <span class="string">"/exp/server/hadoop-2.7.7/etc/hadoop"</span></span><br><span class="line">os.environ[<span class="string">"YARN_CONF_DIR"</span>] = <span class="string">"/exp/server/hadoop-2.7.7/etc/hadoop"</span></span><br><span class="line">os.environ[<span class="string">"SPARK_HOME"</span>] = <span class="string">"/exp/server/spark-2.4.7-bin-hadoop2.7"</span></span><br><span class="line">os.environ[<span class="string">"PYSPARK_PYTHON"</span>] = <span class="string">"/root/anaconda3/envs/pyspark37/bin/python"</span></span><br><span class="line">os.environ[<span class="string">"PYSPARK_DRIVER_PYTHON"</span>] = <span class="string">"/root/anaconda3/envs/pyspark37/bin/python"</span></span><br><span class="line">findspark.init()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageRank</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    pagerank</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.df = <span class="literal">None</span></span><br><span class="line">        self.dfc = <span class="literal">None</span></span><br><span class="line">        self.tag = <span class="literal">None</span></span><br><span class="line">        self.id_df = <span class="literal">None</span></span><br><span class="line">        self.df_int = <span class="literal">None</span></span><br><span class="line">        self.encode_id = <span class="literal">None</span></span><br><span class="line">        self.src_id_df = <span class="literal">None</span></span><br><span class="line">        self.dst_id_df = <span class="literal">None</span></span><br><span class="line">        self.src_join_df = <span class="literal">None</span></span><br><span class="line">        self.dst_join_df = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> spark object with nebula-spark-connector &amp; nebula-algorithm</span></span><br><span class="line">        self.spark = SparkSession.builder.appName(</span><br><span class="line">            <span class="string">"pagerank"</span>)\</span><br><span class="line">            .master(</span><br><span class="line">            <span class="string">"local[*]"</span>)\</span><br><span class="line">            .config(</span><br><span class="line">            <span class="string">"spark.jars"</span>,</span><br><span class="line">            <span class="string">"/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar"</span>)\</span><br><span class="line">            .config(</span><br><span class="line">            <span class="string">"spark.driver.extraClassPath"</span>,</span><br><span class="line">            <span class="string">"/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar"</span>)\</span><br><span class="line">            .config(</span><br><span class="line">            <span class="string">"spark.jars"</span>,</span><br><span class="line">            <span class="string">"/exp/work/pyspark/nebula-algorithm/nebula-algorithm/target/nebula-algorithm-2.6.1.jar"</span>)\</span><br><span class="line">            .config(</span><br><span class="line">            <span class="string">"spark.driver.extraClassPath"</span>,</span><br><span class="line">            <span class="string">"/exp/work/pyspark/nebula-algorithm/nebula-algorithm/target/nebula-algorithm-2.6.1.jar"</span>)\</span><br><span class="line">            .getOrCreate()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> java import</span></span><br><span class="line">        self.jspark = self.spark._jsparkSession</span><br><span class="line"></span><br><span class="line">        <span class="comment"># import "com.vesoft.nebula.algorithm.config.SparkConfig"</span></span><br><span class="line">        java_import(self.spark._jvm, <span class="string">"com.vesoft.nebula.algorithm.config.SparkConfig"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># import "com.vesoft.nebula.algorithm.config.PRConfig"</span></span><br><span class="line">        java_import(self.spark._jvm, <span class="string">"com.vesoft.nebula.algorithm.config.PRConfig"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># import "com.vesoft.nebula.algorithm.lib.PageRankAlgo"</span></span><br><span class="line">        java_import(self.spark._jvm, <span class="string">"com.vesoft.nebula.algorithm.lib.PageRankAlgo"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_tag</span><span class="params">(self, tag: list)</span>:</span></span><br><span class="line">        self.tag = tag</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exe</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.sdf_create()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> covert fixed_string vid 2 long vid</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">convert</span><span class="params">(self, df)</span>:</span></span><br><span class="line">        self.df = df.drop(<span class="string">"creation_time"</span>)</span><br><span class="line">        self.src_id_df = self.df.select(<span class="string">"_srcId"</span>).withColumnRenamed(<span class="string">"_srcId"</span>, <span class="string">"id"</span>)</span><br><span class="line">        self.dst_id_df = self.df.select(<span class="string">"_dstId"</span>).withColumnRenamed(<span class="string">"_dstId"</span>, <span class="string">"id"</span>)</span><br><span class="line">        self.id_df = self.src_id_df.union(self.dst_id_df).distinct()</span><br><span class="line">        self.encode_id = self.id_df.withColumn(<span class="string">"encodedId"</span>, dense_rank().over(Window.orderBy(<span class="string">"id"</span>)))</span><br><span class="line">        self.src_join_df = self.df.join(self.encode_id, self.df._srcId == self.encode_id.id) \</span><br><span class="line">            .drop(<span class="string">"_srcId"</span>) \</span><br><span class="line">            .drop(<span class="string">"id"</span>) \</span><br><span class="line">            .withColumnRenamed(<span class="string">"encodedId"</span>, <span class="string">"_srcId"</span>)</span><br><span class="line"></span><br><span class="line">        self.dst_join_df = self.src_join_df.join(self.encode_id, self.src_join_df._dstId == self.encode_id.id) \</span><br><span class="line">            .drop(<span class="string">"_dstId"</span>) \</span><br><span class="line">            .drop(<span class="string">"_rank"</span>) \</span><br><span class="line">            .drop(<span class="string">"degree"</span>) \</span><br><span class="line">            .withColumnRenamed(<span class="string">"encodedId"</span>, <span class="string">"_dstId"</span>).drop(<span class="string">"id"</span>)</span><br><span class="line">        <span class="comment"># self.dst_join_df.write.option("header", True).csv("file:/exp/work/pyspark/nebula/pr_file/1.csv")</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> sdf build by nebula_reader</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sdf_create</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(self.tag)):</span><br><span class="line">            self.dfc = self.spark.read.format(</span><br><span class="line">                <span class="string">"com.vesoft.nebula.connector.NebulaDataSource"</span>).option(</span><br><span class="line">                <span class="string">"type"</span>, <span class="string">"edge"</span>).option(</span><br><span class="line">                <span class="string">"spaceName"</span>, nebula_config.get(<span class="string">"space"</span>)).option(</span><br><span class="line">                <span class="string">"label"</span>, <span class="string">f"<span class="subst">&#123;self.tag[i]&#125;</span>"</span>).option(</span><br><span class="line">                <span class="string">"returnCols"</span>, <span class="string">"creation_time"</span>).option(</span><br><span class="line">                <span class="string">"metaAddress"</span>, nebula_config.get(<span class="string">"metaAddress"</span>)).option(</span><br><span class="line">                <span class="string">"partitionNumber"</span>, nebula_config.get(<span class="string">"partitionNumber"</span>)).load()</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">                self.df = self.dfc</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.df = self.df.unionByName(self.dfc)</span><br><span class="line"></span><br><span class="line">        self.convert(self.df)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> NEBULA-READER</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nebula_reader</span><span class="params">(sth, tag)</span>:</span></span><br><span class="line">    dataframe = sth.spark.read.format(</span><br><span class="line">        <span class="string">"com.vesoft.nebula.connector.NebulaDataSource"</span>).option(</span><br><span class="line">        <span class="string">"type"</span>, <span class="string">"vertex"</span>).option(</span><br><span class="line">        <span class="string">"spaceName"</span>, nebula_config.get(<span class="string">"space"</span>)).option(</span><br><span class="line">        <span class="string">"label"</span>, <span class="string">f"<span class="subst">&#123;tag&#125;</span>"</span>).option(</span><br><span class="line">        <span class="string">"returnCols"</span>, <span class="string">"pagerank"</span>).option(</span><br><span class="line">        <span class="string">"metaAddress"</span>, nebula_config.get(<span class="string">"metaAddress"</span>)).option(</span><br><span class="line">        <span class="string">"partitionNumber"</span>, nebula_config.get(<span class="string">"partitionNumber"</span>)).load().drop(<span class="string">"pagerank"</span>)</span><br><span class="line">    <span class="keyword">return</span> dataframe</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> UPDATE NEBULA-GRAPH</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nebula_writer</span><span class="params">(tag, dataframe)</span>:</span></span><br><span class="line">    dataframe.write.format(<span class="string">"com.vesoft.nebula.connector.NebulaDataSource"</span>).option(</span><br><span class="line">        <span class="string">"type"</span>, <span class="string">"vertex"</span>).option(</span><br><span class="line">        <span class="string">"spaceName"</span>, nebula_config.get(<span class="string">"space"</span>)).option(</span><br><span class="line">        <span class="string">"label"</span>, <span class="string">f"<span class="subst">&#123;tag&#125;</span>"</span>).option(</span><br><span class="line">        <span class="string">"vidPolicy"</span>, <span class="string">""</span>).option(</span><br><span class="line">        <span class="string">"vertexField"</span>, <span class="string">"_vertexId"</span>).option(</span><br><span class="line">        <span class="string">"writeMode"</span>, <span class="string">"update"</span>).option(</span><br><span class="line">        <span class="string">"batch"</span>, nebula_config.get(<span class="string">"batch"</span>)).option(</span><br><span class="line">        <span class="string">"metaAddress"</span>, nebula_config.get(<span class="string">"metaAddress"</span>)).option(</span><br><span class="line">        <span class="string">"graphAddress"</span>, nebula_config.get(<span class="string">"graphAddress"</span>)).option(</span><br><span class="line">        <span class="string">"passwd"</span>, nebula_config.get(<span class="string">"passwd"</span>)).option(</span><br><span class="line">        <span class="string">"user"</span>, nebula_config.get(<span class="string">"user"</span>)).save()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> process data</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">(tag: list, *args)</span>:</span></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> algorithm object</span></span><br><span class="line">    obj = PageRank()</span><br><span class="line">    obj.set_tag(tag)</span><br><span class="line">    obj.exe()</span><br><span class="line"></span><br><span class="line">    encode_id = obj.encode_id</span><br><span class="line">    df_int = obj.dst_join_df</span><br><span class="line">    df_spark = df_int</span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> nebula-algorithm</span></span><br><span class="line">    config = obj.spark._jvm.PRConfig(<span class="number">1</span>, <span class="number">0.8</span>)</span><br><span class="line">    result = obj.spark._jvm.PageRankAlgo.apply(obj.jspark, df_spark._jdf, config, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> jdf to sdf</span></span><br><span class="line">    result = result.toDF()</span><br><span class="line">    algo_df = DataFrame(result, obj.spark)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> long vid mapping fixed_string vid</span></span><br><span class="line">    df = encode_id.join(algo_df, encode_id.encodedId == algo_df._id) \</span><br><span class="line">        .drop(<span class="string">"encodedId"</span>) \</span><br><span class="line">        .drop(<span class="string">"_id"</span>) \</span><br><span class="line">        .withColumnRenamed(<span class="string">"id"</span>, <span class="string">"_vertexId"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> arg <span class="keyword">in</span> args:</span><br><span class="line">        df_ = nebula_reader(obj, arg)</span><br><span class="line">        df_ = df_.join(df, df_._vertexId == df._vertexId, <span class="string">"leftsemi"</span>)</span><br><span class="line">        df__ = df.join(df_, df._vertexId == df_._vertexId, <span class="string">"leftsemi"</span>)</span><br><span class="line">        nebula_writer(arg, df__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    process([<span class="string">"edge_phone"</span>], <span class="string">"dwd_phone"</span>, <span class="string">"dwd_account"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> PYSPARK (pyspark=2.4.7, python=3.7)</span></span><br><span class="line"><span class="comment"># conda activate pyspark37</span></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> SPARK-SUBMIT</span></span><br><span class="line"><span class="comment"># $&#123;SPARK_HOME&#125;/bin/spark-submit --master local[*] \</span></span><br><span class="line"><span class="comment"># --deploy-mode client \</span></span><br><span class="line"><span class="comment"># --driver-class-path file:/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar \</span></span><br><span class="line"><span class="comment"># --driver-class-path file:/exp/work/pyspark/nebula-algorithm/nebula-algorithm/target/nebula-algorithm-2.6.1.jar \</span></span><br><span class="line"><span class="comment"># --jars file:/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar \</span></span><br><span class="line"><span class="comment"># --jars file:/exp/work/pyspark/nebula-algorithm/nebula-algorithm/target/nebula-algorithm-2.6.1.jar \</span></span><br><span class="line"><span class="comment"># /exp/work/pyspark/nebula/pagerank.py</span></span><br></pre></td></tr></table></figure><h3 id="fastapiæ¥å£å®ä¾‹"><a href="#fastapiæ¥å£å®ä¾‹" class="headerlink" title="fastapiæ¥å£å®ä¾‹"></a>fastapiæ¥å£å®ä¾‹</h3><p><code>`</code>python<br>import os</p><p>import findspark</p><h1 id="from-pyspark-sql-import-SparkSession"><a href="#from-pyspark-sql-import-SparkSession" class="headerlink" title="from pyspark.sql import SparkSession"></a>from pyspark.sql import SparkSession</h1><p>from pyspark.sql import DataFrame<br>from pyspark.sql.functions import *<br>from typing import List<br>from fastapi import FastAPI, Query<br>from fastapi.middleware.cors import CORSMiddleware<br>from pydantic import BaseModel</p><p>from config import nebula_config, pagerank_dict<br>from algorithm.pagerank import PageRank<br>from algorithm.louvain import Louvain</p><p>app_router = FastAPI(docs_url=None, redoc_url=None)</p><h1 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h1><p>origins = [<br>    â€œ*â€<br>]</p><p>app_router.add_middleware(<br>    CORSMiddleware,<br>    allow_origins=origins,<br>    allow_credentials=True,<br>    allow_methods=[â€œ<em>â€œ],<br>    allow_headers=[â€œ</em>â€œ]<br>)</p><p>class NebulaAlgorithm(BaseModel):<br>    algo: str<br>    tag_list: List[str]</p><p>algorithm_dict = {<br>    â€œpagerankâ€: PageRank(),<br>    â€œlouvainâ€: Louvain()<br>}</p><p>@app_router.post(â€œ/nebula/algoâ€)<br>async def nebula_algorithm(<br>        args: NebulaAlgorithm<br>):</p><pre><code># TODO: algorithm objecttags = []for line in args.tag_list:    for item in pagerank_dict.get(line):        tags.append(item)algo = algorithm_dict.get(args.algo)obj = algoobj.set_tag(tags)obj.exe()# TODO: nebula-algorithmencode_id = obj.encode_iddf_int = obj.dst_join_dfif algo.__doc__.strip() == &apos;pagerank&apos;:    if len(tags) == 1:        df_spark = df_int    else:        df_pd = df_int.toPandas()        values = df_pd.values.tolist()        columns = df_pd.columns.tolist()        df_spark = obj.spark.createDataFrame(values, columns)    config = obj.spark._jvm.PRConfig(1, 0.8)    result = obj.spark._jvm.PageRankAlgo.apply(obj.jspark, df_spark._jdf, config, False)elif algo.__doc__.strip() == &apos;louvain&apos;:    if len(tags) == 1:        df_spark = df_int    else:        df_pd = df_int.toPandas()        values = df_pd.values.tolist()        columns = df_pd.columns.tolist()        df_spark = obj.spark.createDataFrame(values, columns)    config = obj.spark._jvm.LouvainConfig(20, 10, 0.5)    result = obj.spark._jvm.LouvainAlgo.apply(obj.jspark, df_spark._jdf, config, False)else:    return# TODO: jdf to sdfresult = result.toDF()algo_df = DataFrame(result, obj.spark)# TODO: long vid mapping fixed_string viddf = encode_id.join(algo_df, encode_id.encodedId == algo_df._id) \    .drop(&quot;encodedId&quot;) \    .drop(&quot;_id&quot;) \    .withColumnRenamed(&quot;id&quot;, &quot;_vertexId&quot;)df.show()</code></pre><p>if <strong>name</strong> == â€œ<strong>main</strong>â€œ:<br>    import uvicorn<br>    uvicorn.run(app=â€main:app_routerâ€, reload=True, host=â€™0.0.0.0â€™, port=7792)</p><h1 id="TODO-PYSPARK-pyspark-2-4-7-python-3-7"><a href="#TODO-PYSPARK-pyspark-2-4-7-python-3-7" class="headerlink" title="TODO: PYSPARK (pyspark=2.4.7, python=3.7)"></a>TODO: PYSPARK (pyspark=2.4.7, python=3.7)</h1><h1 id="conda-activate-pyspark37"><a href="#conda-activate-pyspark37" class="headerlink" title="conda activate pyspark37"></a>conda activate pyspark37</h1><h1 id="TODO-SPARK-SUBMIT"><a href="#TODO-SPARK-SUBMIT" class="headerlink" title="TODO: SPARK-SUBMIT"></a>TODO: SPARK-SUBMIT</h1><h1 id="SPARK-HOME-bin-spark-submit-â€“master-local"><a href="#SPARK-HOME-bin-spark-submit-â€“master-local" class="headerlink" title="${SPARK_HOME}/bin/spark-submit â€“master local[*] \"></a>${SPARK_HOME}/bin/spark-submit â€“master local[*] \</h1><h1 id="â€“deploy-mode-client"><a href="#â€“deploy-mode-client" class="headerlink" title="â€“deploy-mode client \"></a>â€“deploy-mode client \</h1><h1 id="â€“driver-class-path-file-exp-work-pyspark-nebula-spark-connector-nebula-spark-connector-target-nebula-spark-connector-2-6-1-jar"><a href="#â€“driver-class-path-file-exp-work-pyspark-nebula-spark-connector-nebula-spark-connector-target-nebula-spark-connector-2-6-1-jar" class="headerlink" title="â€“driver-class-path file:/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar \"></a>â€“driver-class-path file:/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar \</h1><h1 id="â€“driver-class-path-file-exp-work-pyspark-nebula-algorithm-nebula-algorithm-target-nebula-algorithm-2-6-1-jar"><a href="#â€“driver-class-path-file-exp-work-pyspark-nebula-algorithm-nebula-algorithm-target-nebula-algorithm-2-6-1-jar" class="headerlink" title="â€“driver-class-path file:/exp/work/pyspark/nebula-algorithm/nebula-algorithm/target/nebula-algorithm-2.6.1.jar \"></a>â€“driver-class-path file:/exp/work/pyspark/nebula-algorithm/nebula-algorithm/target/nebula-algorithm-2.6.1.jar \</h1><h1 id="â€“jars-file-exp-work-pyspark-nebula-spark-connector-nebula-spark-connector-target-nebula-spark-connector-2-6-1-jar"><a href="#â€“jars-file-exp-work-pyspark-nebula-spark-connector-nebula-spark-connector-target-nebula-spark-connector-2-6-1-jar" class="headerlink" title="â€“jars file:/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar \"></a>â€“jars file:/exp/work/pyspark/nebula-spark-connector/nebula-spark-connector/target/nebula-spark-connector-2.6.1.jar \</h1><h1 id="â€“jars-file-exp-work-pyspark-nebula-algorithm-nebula-algorithm-target-nebula-algorithm-2-6-1-jar"><a href="#â€“jars-file-exp-work-pyspark-nebula-algorithm-nebula-algorithm-target-nebula-algorithm-2-6-1-jar" class="headerlink" title="â€“jars file:/exp/work/pyspark/nebula-algorithm/nebula-algorithm/target/nebula-algorithm-2.6.1.jar \"></a>â€“jars file:/exp/work/pyspark/nebula-algorithm/nebula-algorithm/target/nebula-algorithm-2.6.1.jar \</h1><h1 id="exp-work-pyspark-nebula-main-py"><a href="#exp-work-pyspark-nebula-main-py" class="headerlink" title="/exp/work/pyspark/nebula/main.py"></a>/exp/work/pyspark/nebula/main.py</h1>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Nebula-Spark-Connector&quot;&gt;&lt;a href=&quot;#Nebula-Spark-Connector&quot; class=&quot;headerlink&quot; title=&quot;Nebula Spark Connector&quot;&gt;&lt;/a&gt;Nebula Spark Connector&lt;/h2&gt;&lt;p&gt;ä¸‹è½½åœ°å€&amp;amp;å®˜æ–¹æ–‡æ¡£ï¼šã€&lt;a href=&quot;https://github.com/vesoft-inc/nebula-spark-connector&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/vesoft-inc/nebula-spark-connector&lt;/a&gt;ã€‘&lt;/p&gt;
&lt;h3 id=&quot;ç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒ&quot;&gt;&lt;/a&gt;ç¯å¢ƒ&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; nebulaï¼š&lt;font color=&quot;orange&quot;&gt;2.6.1&lt;/font&gt;&lt;br&gt;&lt;strong&gt;Â·&lt;/strong&gt; hadoopï¼š&lt;font color=&quot;orange&quot;&gt;2.7&lt;/font&gt;&lt;br&gt;&lt;strong&gt;Â·&lt;/strong&gt; sparkï¼š&lt;font color=&quot;orange&quot;&gt;2.4.7&lt;/font&gt;&lt;br&gt;&lt;strong&gt;Â·&lt;/strong&gt; pysparkï¼š&lt;font color=&quot;orange&quot;&gt;2.4.7&lt;/font&gt;&lt;br&gt;&lt;strong&gt;Â·&lt;/strong&gt; pythonï¼š&lt;font color=&quot;orange&quot;&gt;3.7.16&lt;/font&gt;&lt;br&gt;&lt;strong&gt;Â·&lt;/strong&gt; nebula-spark-connectorï¼š&lt;font color=&quot;orange&quot;&gt;2.6.1&lt;/font&gt;&lt;/p&gt;
&lt;h3 id=&quot;ç¼–è¯‘æ‰“åŒ…nebula-spark-connector&quot;&gt;&lt;a href=&quot;#ç¼–è¯‘æ‰“åŒ…nebula-spark-connector&quot; class=&quot;headerlink&quot; title=&quot;ç¼–è¯‘æ‰“åŒ…nebula-spark-connector&quot;&gt;&lt;/a&gt;ç¼–è¯‘æ‰“åŒ…nebula-spark-connector&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ &lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; nebula-spark-connector-2.6.1/nebula-spark-connector&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ mvn clean package -Dmaven.test.skip=&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt; -Dgpg.skip -Dmaven.javadoc.skip=&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆåŠŸååœ¨&lt;code&gt;nebula-spark-connector/target/&lt;/code&gt; ç›®å½•ä¸‹å¾—åˆ° &lt;code&gt;nebula-spark-connector-2.6.1.jar&lt;/code&gt;æ–‡ä»¶&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;(base) [root@root target]&lt;span class=&quot;comment&quot;&gt;# ll&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;total 106792&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;drwxr-xr-x 3 root root        17 Mar 11 14:14 classes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r-- 1 root root         1 Mar 11 14:14 classes.-497386701.timestamp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r-- 1 root root         1 Mar 11 14:14 classes.timestamp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r-- 1 root root     30701 Mar 11 14:15 jacoco.exec&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;drwxr-xr-x 2 root root        28 Mar 11 14:15 maven-archiver&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r-- 1 root root 108375457 Mar 11 14:16 nebula-spark-connector-2.6.1.jar&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r-- 1 root root    583482 Mar 11 14:16 nebula-spark-connector-2.6.1-javadoc.jar&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r-- 1 root root     36358 Mar 11 14:16 nebula-spark-connector-2.6.1-sources.jar&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-rw-r--r-- 1 root root    315392 Mar 11 14:15 original-nebula-spark-connector-2.6.1.jar&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;drwxr-xr-x 4 root root        37 Mar 11 14:15 site&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;PySpark-è¯»å–-NebulaGraph-æ•°æ®&quot;&gt;&lt;a href=&quot;#PySpark-è¯»å–-NebulaGraph-æ•°æ®&quot; class=&quot;headerlink&quot; title=&quot;PySpark è¯»å– NebulaGraph æ•°æ®&quot;&gt;&lt;/a&gt;PySpark è¯»å– NebulaGraph æ•°æ®&lt;/h3&gt;&lt;p&gt;ä» &lt;code&gt;metaAddress&lt;/code&gt; ä¸º &lt;code&gt;&amp;quot;metad0:9559&amp;quot;&lt;/code&gt; çš„ Nebula Graph ä¸­è¯»å–æ•´ä¸ª tag ä¸‹çš„æ•°æ®ä¸ºä¸€ä¸ª dataframeï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;df = spark.read.format(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;com.vesoft.nebula.connector.NebulaDataSource&quot;&lt;/span&gt;).option(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;vertex&quot;&lt;/span&gt;).option(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;spaceName&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;basketballplayer&quot;&lt;/span&gt;).option(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;label&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;player&quot;&lt;/span&gt;).option(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;returnCols&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;name,age&quot;&lt;/span&gt;).option(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;metaAddress&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;metad0:9559&quot;&lt;/span&gt;).option(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;partitionNumber&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;).load()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶åå¯ä»¥åƒè¿™æ · &lt;code&gt;show&lt;/code&gt; è¿™ä¸ª dataframeï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;df.show(n=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+---------+--------------+---+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|_vertexId|          name|age|&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+---------+--------------+---+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|player105|   Danny Green| &lt;span class=&quot;number&quot;&gt;31&lt;/span&gt;|&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|player109|Tiago Splitter| &lt;span class=&quot;number&quot;&gt;34&lt;/span&gt;|&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+---------+--------------+---+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;only showing top &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; rows&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="BigData" scheme="http://yoursite.com/categories/BigData/"/>
    
    
    <category term="nebula" scheme="http://yoursite.com/tags/nebula/"/>
    
    <category term="spark" scheme="http://yoursite.com/tags/spark/"/>
    
    <category term="å›¾ç®—æ³•" scheme="http://yoursite.com/tags/å›¾ç®—æ³•/"/>
    
  </entry>
  
  <entry>
    <title>ElasticSearchç¯å¢ƒæ­å»º</title>
    <link href="http://yoursite.com/2023/02/16/ElasticSearch%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <id>http://yoursite.com/2023/02/16/ElasticSearch%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</id>
    <published>2023-02-16T03:16:07.000Z</published>
    <updated>2023-03-24T06:52:51.416Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><p>* é…åˆnebulaå…¨æ–‡æ£€ç´¢æµ‹è¯•ç¯å¢ƒè€Œæ­å»ºçš„eså•æœºç¯å¢ƒ</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="ä¸‹è½½åœ°å€"><a href="#ä¸‹è½½åœ°å€" class="headerlink" title="ä¸‹è½½åœ°å€"></a>ä¸‹è½½åœ°å€</h3><p>ã€<a href="https://www.elastic.co/cn/downloads/elasticsearch#ga-release" target="_blank" rel="noopener">https://www.elastic.co/cn/downloads/elasticsearch#ga-release</a>ã€‘ (æˆ–å‰å¾€elasticä¸­æ–‡ç¤¾åŒºä¸‹è½½ä¸­å¿ƒã€<a href="https://elasticsearch.cn/download/" target="_blank" rel="noopener">https://elasticsearch.cn/download/</a>ã€‘)</p><ul><li>é€‰æ‹©linuxç‰ˆæœ¬</li></ul><p><img src="/2023/02/16/ElasticSearchç¯å¢ƒæ­å»º/A.png" alt></p><h3 id="å®‰è£…ES"><a href="#å®‰è£…ES" class="headerlink" title="å®‰è£…ES"></a>å®‰è£…ES</h3><ul><li>è§£å‹ç¼©</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> tar xf elasticsearch-7.14.2-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºesç”¨æˆ·</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> useradd es &amp;&amp; passwd es</span><br></pre></td></tr></table></figure><ul><li>æ›´å</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> mv elasticsearch-7.14.2 elasticsearch</span><br></pre></td></tr></table></figure><ul><li>èµ‹äºˆesç”¨æˆ·æƒé™</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> chown -R es:es elasticsearch</span><br></pre></td></tr></table></figure><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><pre><code>* å¯ä½¿ç”¨esè‡ªå¸¦çš„javaç¯å¢ƒï¼šES_JAVA_HOME</code></pre><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> vim /etc/profile</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ES_JAVA_HOME</span></span><br><span class="line"><span class="built_in">export</span> ES_JAVA_HOME=/data/elasticsearch/jdk/</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$ES_JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> /etc/profile</span></span><br></pre></td></tr></table></figure><ul><li>elasticsearch config</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> elasticsearch/config</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim elasticsearch.yml</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">node.name:</span> <span class="string">node-1</span>                          <span class="comment">##èŠ‚ç‚¹åç§°</span></span><br><span class="line"><span class="attr">path.data:</span> <span class="string">/usr/local/elasticsearch/data</span>        <span class="comment">##æ•°æ®å­˜æ”¾è·¯å¾„</span></span><br><span class="line"><span class="attr">path.logs:</span> <span class="string">/usr/local/elasticsearch/logs</span>        <span class="comment">##æ—¥å¿—å­˜æ”¾è·¯å¾„ </span></span><br><span class="line"><span class="attr">bootstrap.memory_lock:</span> <span class="literal">true</span>                <span class="comment">##é¿å…esä½¿ç”¨swapäº¤æ¢åˆ†åŒº</span></span><br><span class="line"><span class="attr">indices.requests.cache.size:</span> <span class="number">5</span><span class="string">%</span>            <span class="comment">##ç¼“å­˜é…ç½®</span></span><br><span class="line"><span class="attr">indices.queries.cache.size:</span> <span class="number">10</span><span class="string">%</span>            <span class="comment">##ç¼“å­˜é…ç½®</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">192.168</span><span class="number">.80</span><span class="number">.128</span>               <span class="comment">##æœ¬æœºIP</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span>                            <span class="comment">##é»˜è®¤ç«¯å£</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> <span class="string">["node-1"]</span>   <span class="comment">##è®¾ç½®ç¬¦åˆä¸»èŠ‚ç‚¹æ¡ä»¶çš„èŠ‚ç‚¹çš„ä¸»æœºåæˆ– IP åœ°å€æ¥å¼•å¯¼å¯åŠ¨é›†ç¾¤</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span>                    <span class="comment">##è·¨åŸŸ</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">"*"</span></span><br></pre></td></tr></table></figure><ul><li>å°†å½“å‰ç”¨æˆ·è½¯ç¡¬é™åˆ¶è°ƒå¤§</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/security/limits.conf</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">es</span> <span class="string">soft</span> <span class="string">nofile</span> <span class="number">65535</span></span><br><span class="line"><span class="string">es</span> <span class="string">hard</span> <span class="string">nofile</span> <span class="number">65537</span></span><br><span class="line"><span class="string">es</span> <span class="string">soft</span> <span class="string">memlock</span> <span class="string">unlimited</span></span><br><span class="line"><span class="string">es</span> <span class="string">hard</span> <span class="string">memlock</span> <span class="string">unlimited</span></span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹vm.max_map_countå†…å­˜</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vm.max_map_count=655360</span></span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> su es</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ../bin</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./elasticsearch -d</span></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="Kibana"><a href="#Kibana" class="headerlink" title="Kibana"></a>Kibana</h2><h3 id="ä¸‹è½½åœ°å€-1"><a href="#ä¸‹è½½åœ°å€-1" class="headerlink" title="ä¸‹è½½åœ°å€"></a>ä¸‹è½½åœ°å€</h3><p>[<a href="https://elasticsearch.cn/download/]" target="_blank" rel="noopener">https://elasticsearch.cn/download/]</a></p><ul><li>é€‰æ‹©å’Œesç›¸åŒç‰ˆæœ¬</li></ul><h3 id="å®‰è£…kibana"><a href="#å®‰è£…kibana" class="headerlink" title="å®‰è£…kibana"></a>å®‰è£…kibana</h3><ul><li>è§£å‹ç¼©</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tar -zxvf kibana-7.14.2-linux-x86_64.tar.gz</span></span><br></pre></td></tr></table></figure><ul><li>æ›´å</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mv kibana-7.14.2-linux-x86_64 kibana</span></span><br></pre></td></tr></table></figure><h3 id="é…ç½®-1"><a href="#é…ç½®-1" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd kibana</span><br><span class="line">vim config/kibana.yml</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port:</span> <span class="number">5601</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">"0.0.0.0"</span></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> <span class="string">"http://192.168.80.128:9200"</span></span><br><span class="line"><span class="attr">kibana.index:</span> <span class="string">".kibana"</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹/etc/sudoersæ–‡ä»¶ï¼Œè¿›å…¥è¶…çº§ç”¨æˆ·, ç»™äºˆesç”¨æˆ·å†™æƒé™</span></span><br><span class="line">(base) [root@localhost kibana]# chmod u+w /etc/sudoers</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç¼–è¾‘/etc/sudoersæ–‡ä»¶</span></span><br><span class="line">(base) [root@localhost kibana]# vim /etc/sudoers</span><br><span class="line"><span class="meta">#</span><span class="bash"> èµ‹äºˆesç”¨æˆ·æƒé™</span></span><br><span class="line">es    ALL=(ALL)       ALL</span><br><span class="line">(base) [root@localhost kibana]# chmod u-w /etc/sudoers</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ’¤é”€esç”¨æˆ·æ–‡ä»¶å†™æƒé™</span></span><br><span class="line">(base) [root@localhost kibana]# sudo chown -R es:es /usr/local/kibana</span><br><span class="line">(base) [root@localhost kibana]# su es</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨-1"><a href="#å¯åŠ¨-1" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[es@localhost kibana]$ cd bin</span><br><span class="line">[es@localhost bin]$ ./kibana</span><br></pre></td></tr></table></figure><ul><li>è¿›å…¥kibana</li></ul><p><code>http:192.168.80.128:5601</code></p><p><img src="/2023/02/16/ElasticSearchç¯å¢ƒæ­å»º/B.png" alt></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;* é…åˆnebulaå…¨æ–‡æ£€ç´¢æµ‹è¯•ç¯å¢ƒè€Œæ­å»ºçš„eså•æœºç¯å¢ƒ&lt;/p&gt;
&lt;h2 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h2&gt;&lt;h3 id=&quot;ä¸‹è½½åœ°å€&quot;&gt;&lt;a href=&quot;#ä¸‹è½½åœ°å€&quot; class=&quot;headerlink&quot; title=&quot;ä¸‹è½½åœ°å€&quot;&gt;&lt;/a&gt;ä¸‹è½½åœ°å€&lt;/h3&gt;&lt;p&gt;ã€&lt;a href=&quot;https://www.elastic.co/cn/downloads/elasticsearch#ga-release&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.elastic.co/cn/downloads/elasticsearch#ga-release&lt;/a&gt;ã€‘ (æˆ–å‰å¾€elasticä¸­æ–‡ç¤¾åŒºä¸‹è½½ä¸­å¿ƒã€&lt;a href=&quot;https://elasticsearch.cn/download/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://elasticsearch.cn/download/&lt;/a&gt;ã€‘)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€‰æ‹©linuxç‰ˆæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/2023/02/16/ElasticSearchç¯å¢ƒæ­å»º/A.png&quot; alt&gt;&lt;/p&gt;
&lt;h3 id=&quot;å®‰è£…ES&quot;&gt;&lt;a href=&quot;#å®‰è£…ES&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…ES&quot;&gt;&lt;/a&gt;å®‰è£…ES&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;è§£å‹ç¼©&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt; tar xf elasticsearch-7.14.2-linux-x86_64.tar.gz&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºesç”¨æˆ·&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt; useradd es &amp;amp;&amp;amp; passwd es&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;æ›´å&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt; mv elasticsearch-7.14.2 elasticsearch&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;èµ‹äºˆesç”¨æˆ·æƒé™&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt; chown -R es:es elasticsearch&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;é…ç½®&quot;&gt;&lt;a href=&quot;#é…ç½®&quot; class=&quot;headerlink&quot; title=&quot;é…ç½®&quot;&gt;&lt;/a&gt;é…ç½®&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;* å¯ä½¿ç”¨esè‡ªå¸¦çš„javaç¯å¢ƒï¼šES_JAVA_HOME
&lt;/code&gt;&lt;/pre&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt; vim /etc/profile&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# ES_JAVA_HOME&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; ES_JAVA_HOME=/data/elasticsearch/jdk/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; PATH=&lt;span class=&quot;variable&quot;&gt;$ES_JAVA_HOME&lt;/span&gt;/bin:&lt;span class=&quot;variable&quot;&gt;$PATH&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; &lt;span class=&quot;built_in&quot;&gt;source&lt;/span&gt; /etc/profile&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;elasticsearch config&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; &lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; elasticsearch/config&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; vim elasticsearch.yml&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;node.name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;node-1&lt;/span&gt;                          &lt;span class=&quot;comment&quot;&gt;##èŠ‚ç‚¹åç§°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;path.data:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/usr/local/elasticsearch/data&lt;/span&gt;        &lt;span class=&quot;comment&quot;&gt;##æ•°æ®å­˜æ”¾è·¯å¾„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;path.logs:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/usr/local/elasticsearch/logs&lt;/span&gt;        &lt;span class=&quot;comment&quot;&gt;##æ—¥å¿—å­˜æ”¾è·¯å¾„ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;bootstrap.memory_lock:&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;                &lt;span class=&quot;comment&quot;&gt;##é¿å…esä½¿ç”¨swapäº¤æ¢åˆ†åŒº&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;indices.requests.cache.size:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;%&lt;/span&gt;            &lt;span class=&quot;comment&quot;&gt;##ç¼“å­˜é…ç½®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;indices.queries.cache.size:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;%&lt;/span&gt;            &lt;span class=&quot;comment&quot;&gt;##ç¼“å­˜é…ç½®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;network.host:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.80&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.128&lt;/span&gt;               &lt;span class=&quot;comment&quot;&gt;##æœ¬æœºIP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;http.port:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;9200&lt;/span&gt;                            &lt;span class=&quot;comment&quot;&gt;##é»˜è®¤ç«¯å£&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;cluster.initial_master_nodes:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;[&quot;node-1&quot;]&lt;/span&gt;   &lt;span class=&quot;comment&quot;&gt;##è®¾ç½®ç¬¦åˆä¸»èŠ‚ç‚¹æ¡ä»¶çš„èŠ‚ç‚¹çš„ä¸»æœºåæˆ– IP åœ°å€æ¥å¼•å¯¼å¯åŠ¨é›†ç¾¤&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;http.cors.enabled:&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;                    &lt;span class=&quot;comment&quot;&gt;##è·¨åŸŸ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;http.cors.allow-origin:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;*&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;å°†å½“å‰ç”¨æˆ·è½¯ç¡¬é™åˆ¶è°ƒå¤§&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; vim /etc/security/limits.conf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;es&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;soft&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nofile&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;65535&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;es&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;hard&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nofile&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;65537&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;es&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;soft&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;memlock&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;unlimited&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;es&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;hard&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;memlock&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;unlimited&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;ä¿®æ”¹vm.max_map_countå†…å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;vim /etc/sysctl.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;vm.max_map_count=655360&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;å¯åŠ¨&quot;&gt;&lt;a href=&quot;#å¯åŠ¨&quot; class=&quot;headerlink&quot; title=&quot;å¯åŠ¨&quot;&gt;&lt;/a&gt;å¯åŠ¨&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; su es&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; &lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; ../bin&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; ./elasticsearch -d&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="BigData" scheme="http://yoursite.com/categories/BigData/"/>
    
    
    <category term="elastic search" scheme="http://yoursite.com/tags/elastic-search/"/>
    
  </entry>
  
  <entry>
    <title>Spark-SQL</title>
    <link href="http://yoursite.com/2022/12/08/Spark-SQL/"/>
    <id>http://yoursite.com/2022/12/08/Spark-SQL/</id>
    <published>2022-12-08T08:50:52.000Z</published>
    <updated>2022-12-09T08:58:34.011Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><h2 id="SparkSQL"><a href="#SparkSQL" class="headerlink" title="SparkSQL"></a>SparkSQL</h2><p><strong>SparkSQL</strong>æ˜¯sparkçš„ä¸€ä¸ªç”¨äºå¤„ç†æµ·é‡<strong>ç»“æ„åŒ–æ•°æ®</strong>çš„æ¨¡å—</p><ul><li>æ”¯æŒSQLè¯­è¨€</li><li>è‡ªåŠ¨ä¼˜åŒ–</li><li>æ€§èƒ½å¼º</li><li>å…¼å®¹HIVE</li><li>APIæµç¨‹ç®€å•</li><li>æ”¯æŒæ ‡å‡†åŒ–JDBCå’ŒODBCè¿æ¥</li><li>â€¦</li></ul><h3 id="SparkSQLæ•°æ®æŠ½è±¡"><a href="#SparkSQLæ•°æ®æŠ½è±¡" class="headerlink" title="SparkSQLæ•°æ®æŠ½è±¡"></a>SparkSQLæ•°æ®æŠ½è±¡</h3><ul><li><p><strong><font color="orange">Pandas Â· DataFrame</font></strong></p><p><strong><font color="orange">Â·</font></strong> äºŒç»´è¡¨æ•°æ®ç»“æ„</p><p><strong><font color="orange">Â·</font></strong> å•æœºï¼ˆæœ¬åœ°ï¼‰é›†åˆ</p></li><li><p><strong><font color="orange">SparkCore Â· RDD</font></strong></p><p><strong><font color="orange">Â·</font></strong> æ— æ ‡å‡†æ•°æ®ç»“æ„</p><p><strong><font color="orange">Â·</font></strong> åˆ†å¸ƒå¼ï¼ˆåˆ†åŒºï¼‰é›†åˆ</p></li><li><p><strong><font color="orange">SparkSQL Â· DataFrame</font></strong></p><p><strong><font color="orange">Â·</font></strong> äºŒç»´è¡¨æ•°æ®ç»“æ„</p><p><strong><font color="orange">Â·</font></strong> åˆ†å¸ƒå¼ï¼ˆåˆ†åŒºï¼‰é›†åˆ</p></li></ul><h3 id="SparkSessionå¯¹è±¡"><a href="#SparkSessionå¯¹è±¡" class="headerlink" title="SparkSessionå¯¹è±¡"></a>SparkSessionå¯¹è±¡</h3><p>RDDç¨‹åºçš„æ‰§è¡Œå…¥å£å¯¹è±¡ï¼š<strong>SparkContext</strong></p><p>åœ¨Spark2.0ä»¥åï¼Œæ¨å‡ºäº†<strong>SparkSession</strong>å¯¹è±¡ï¼Œæ¥ä½œä¸ºSparkç¼–ç çš„ç»Ÿä¸€å…¥å£å¯¹è±¡ã€‚<strong>SparkSession</strong>ï¼š</p><ul><li>ç”¨äºSparkSQLç¼–ç¨‹ï¼Œä½œä¸ºå…¥å£å¯¹è±¡</li><li>ç”¨äºSparkCoreç¼–ç¨‹ï¼Œé€šè¿‡SparkSessionå¯¹è±¡è·å–SparkContext</li></ul><p>æ„å»ºSparkSessionå¯¹è±¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡builderæ–¹æ³•æ¥æ„å»ºSparkSessionå¯¹è±¡</span></span><br><span class="line"><span class="comment"># appNameï¼šè®¾ç½®ç¨‹åºåç§°</span></span><br><span class="line"><span class="comment"># configï¼šé…ç½®å¸¸ç”¨å±æ€§</span></span><br><span class="line"><span class="comment"># getOrCreateï¼šå®Œæˆåˆ›å»ºSparkSessionå¯¹è±¡</span></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).config(<span class="string">"spark.sql.shuffle.partitions"</span>, <span class="string">"4"</span>).getOrCreate()</span><br></pre></td></tr></table></figure><p>é€šè¿‡SparkSesionå¯¹è±¡è·å–SparkContextå¯¹è±¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).config(<span class="string">"spark.sql.shuffle.partitions"</span>, <span class="string">"4"</span>).getOrCreate()</span><br><span class="line"></span><br><span class="line">sc = spark.sparkContext</span><br></pre></td></tr></table></figure><a id="more"></a><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).config(<span class="string">"spark.sql.shuffle.partitions"</span>, <span class="string">"4"</span>).getOrCreate()</span><br><span class="line"></span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">df1 = spark.read.csv(<span class="string">"hdfs://master:8020/input/pip_file.txt"</span>, sep=<span class="string">','</span>, header=<span class="literal">False</span>)</span><br><span class="line">df2 = df1.toDF(<span class="string">"id"</span>, <span class="string">"package"</span>, <span class="string">"version"</span>)</span><br><span class="line">df2.printSchema()         <span class="comment"># è¡¨ç»“æ„</span></span><br><span class="line">df2.show()                <span class="comment"># å±•ç¤ºè¡¨</span></span><br><span class="line">df2.createTempView(<span class="string">"pip"</span>) <span class="comment"># åˆ›å»º"pip"è¡¨,ä¿å­˜åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment"># SQLé£æ ¼</span></span><br><span class="line">spark.sql(<span class="string">"""</span></span><br><span class="line"><span class="string">SELECT * FROM pip WHERE package='pyspark'</span></span><br><span class="line"><span class="string">"""</span>).show</span><br><span class="line"><span class="comment"># DSLé£æ ¼</span></span><br><span class="line">df2.where(<span class="string">"package='pyspark'"</span>).limit(<span class="number">5</span>).show()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line"> |-- id: string (nullable = true)</span><br><span class="line"> |-- package: string (nullable = true)</span><br><span class="line"> |-- version: string (nullable = true)</span><br><span class="line"></span><br><span class="line">+---+-------------+--------+</span><br><span class="line">| id|      package| version|</span><br><span class="line">+---+-------------+--------+</span><br><span class="line">|  1|        flask|   1.1.4|</span><br><span class="line">|  2|      fastapi|  0.78.0|</span><br><span class="line">|  3|         h5py|  2.10.0|</span><br><span class="line">|  4|        keras|   2.6.0|</span><br><span class="line">|  5|        jieba|  0.42.1|</span><br><span class="line">|  6|        numpy|  1.23.3|</span><br><span class="line">|  7|opencv-python|4.6.0.66|</span><br><span class="line">|  8|       pandas|   1.4.3|</span><br><span class="line">|  9|       pillow|   9.2.0|</span><br><span class="line">| 10|         py4j|0.10.9.5|</span><br><span class="line">| 11|      pyspark|   3.3.1|</span><br><span class="line">| 12|      sklearn|     0.0|</span><br><span class="line">| 13|   tensorfolw|   2.6.2|</span><br><span class="line">| 14|     requests|  2.28.1|</span><br><span class="line">| 15|        redis|   3.5.3|</span><br><span class="line">+---+-------------+--------+</span><br><span class="line"></span><br><span class="line">+---+-------+-------+</span><br><span class="line">| id|package|version|</span><br><span class="line">+---+-------+-------+</span><br><span class="line">| 11|pyspark|  3.3.1|</span><br><span class="line">+---+-------+-------+</span><br><span class="line"></span><br><span class="line">+---+-------+-------+</span><br><span class="line">| id|package|version|</span><br><span class="line">+---+-------+-------+</span><br><span class="line">| 11|pyspark|  3.3.1|</span><br><span class="line">+---+-------+-------+</span><br></pre></td></tr></table></figure><h2 id="DataFrame"><a href="#DataFrame" class="headerlink" title="DataFrame"></a>DataFrame</h2><h3 id="DataFrameçš„ç»„æˆ"><a href="#DataFrameçš„ç»„æˆ" class="headerlink" title="DataFrameçš„ç»„æˆ"></a>DataFrameçš„ç»„æˆ</h3><p>DataFrameæ˜¯ä¸€ä¸ªäºŒç»´è¡¨ç»“æ„ï¼Œåœ¨ç»“æ„å±‚é¢ï¼š</p><ul><li>StructureTypeå¯¹è±¡æè¿°æ•´ä¸ªDataFrameçš„è¡¨ç»“æ„</li><li>StructFieldå¯¹è±¡æè¿°ä¸€ä¸ªåˆ—çš„ä¿¡æ¯</li></ul><p>åœ¨æ•°æ®å±‚é¢ï¼š</p><ul><li>Rowå¯¹è±¡è®°å½•ä¸€è¡Œæ•°æ®</li><li>Columnå¯¹è±¡è®°å½•ä¸€åˆ—æ•°æ®å¹¶åŒ…å«åˆ—çš„ä¿¡æ¯</li></ul><h3 id="DataFrameçš„æ„å»º"><a href="#DataFrameçš„æ„å»º" class="headerlink" title="DataFrameçš„æ„å»º"></a>DataFrameçš„æ„å»º</h3><h4 id="RDDè½¬æ¢"><a href="#RDDè½¬æ¢" class="headerlink" title="RDDè½¬æ¢"></a>RDDè½¬æ¢</h4><p>DataFrameå¯¹è±¡å¯ä»¥ä»RDDè½¬æ¢è€Œæ¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = spark.createDataFrame(rdd, schema=[<span class="string">'id'</span>, <span class="string">'package'</span>])</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">rdd = sc.textFile(<span class="string">"hdfs://master:8020/input/pip_file.txt"</span>).map(<span class="keyword">lambda</span> x: x.split(<span class="string">","</span>)).map(<span class="keyword">lambda</span> x:(int(x[<span class="number">0</span>]), x[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">df = spark.createDataFrame(rdd, schema=[<span class="string">'id'</span>, <span class="string">'package'</span>])</span><br><span class="line">df.printSchema()</span><br><span class="line">df.show(<span class="number">10</span>, <span class="literal">False</span>) <span class="comment"># è¾“å‡ºå‰åè¡Œæ•°æ®ï¼Œè¦å…¨éƒ¨æ˜¾ç¤ºé»˜è®¤è®¾ç½®ä¸ºTrue</span></span><br><span class="line">df.createOrReplaceTempView(<span class="string">"pip"</span>)</span><br><span class="line">spark.sql(<span class="string">"SELECT * FROM pip WHERE id &lt; 5"</span>).show()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line"> |-- id: long (nullable = true)</span><br><span class="line"> |-- package: string (nullable = true)</span><br><span class="line"></span><br><span class="line">+---+-------------+</span><br><span class="line">|id |package      |</span><br><span class="line">+---+-------------+</span><br><span class="line">|1  |flask        |</span><br><span class="line">|2  |fastapi      |</span><br><span class="line">|3  |h5py         |</span><br><span class="line">|4  |keras        |</span><br><span class="line">|5  |jieba        |</span><br><span class="line">|6  |numpy        |</span><br><span class="line">|7  |opencv-python|</span><br><span class="line">|8  |pandas       |</span><br><span class="line">|9  |pillow       |</span><br><span class="line">|10 |py4j         |</span><br><span class="line">+---+-------------+</span><br><span class="line">only showing top 10 rows</span><br><span class="line"></span><br><span class="line">+---+-------+</span><br><span class="line">| id|package|</span><br><span class="line">+---+-------+</span><br><span class="line">|  1|  flask|</span><br><span class="line">|  2|fastapi|</span><br><span class="line">|  3|   h5py|</span><br><span class="line">|  4|  keras|</span><br><span class="line">+---+-------+</span><br></pre></td></tr></table></figure><h4 id="StructType"><a href="#StructType" class="headerlink" title="StructType"></a>StructType</h4><p>é€šè¿‡StructTypeå¯¹è±¡æ¥å®šä¹‰DataFrameçš„è¡¨ç»“æ„ï¼Œè½¬æ¢RDD</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥StructTypeå¯¹è±¡å’Œç±»å‹</span></span><br><span class="line"><span class="keyword">from</span> pyspark.sql.types <span class="keyword">import</span> StructType, StringType, IntegerType</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰è¡¨ç»“æ„</span></span><br><span class="line">schema = StructType().add(<span class="string">"id"</span>, IntegerType(), nullable=<span class="literal">True</span>).add(<span class="string">"package"</span>, StringType(), nullable=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">from</span> pyspark.sql.types <span class="keyword">import</span> StructType, StringType, IntegerType</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">rdd = sc.textFile(<span class="string">"hdfs://master:8020/input/pip_file.txt"</span>).map(<span class="keyword">lambda</span> x: x.split(<span class="string">","</span>)).map(<span class="keyword">lambda</span> x:(int(x[<span class="number">0</span>]), x[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">schema = StructType().add(<span class="string">"id"</span>, IntegerType(), nullable=<span class="literal">True</span>).add(<span class="string">"package"</span>, StringType(), nullable=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">df = spark.createDataFrame(rdd, schema=schema)</span><br><span class="line">df.printSchema()</span><br><span class="line">df.show()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line"> |-- id: integer (nullable = true)</span><br><span class="line"> |-- package: string (nullable = true)</span><br><span class="line"></span><br><span class="line">+---+-------------+</span><br><span class="line">| id|      package|</span><br><span class="line">+---+-------------+</span><br><span class="line">|  1|        flask|</span><br><span class="line">|  2|      fastapi|</span><br><span class="line">|  3|         h5py|</span><br><span class="line">|  4|        keras|</span><br><span class="line">|  5|        jieba|</span><br><span class="line">|  6|        numpy|</span><br><span class="line">|  7|opencv-python|</span><br><span class="line">|  8|       pandas|</span><br><span class="line">|  9|       pillow|</span><br><span class="line">| 10|         py4j|</span><br><span class="line">| 11|      pyspark|</span><br><span class="line">| 12|      sklearn|</span><br><span class="line">| 13|   tensorfolw|</span><br><span class="line">| 14|     requests|</span><br><span class="line">| 15|        redis|</span><br><span class="line">+---+-------------+</span><br></pre></td></tr></table></figure><h4 id="toDF"><a href="#toDF" class="headerlink" title="toDF"></a>toDF</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">from</span> pyspark.sql.types <span class="keyword">import</span> StructType, StringType, IntegerType</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">rdd = sc.textFile(<span class="string">"hdfs://master:8020/input/pip_file.txt"</span>).map(<span class="keyword">lambda</span> x: x.split(<span class="string">","</span>)).map(<span class="keyword">lambda</span> x:(int(x[<span class="number">0</span>]), x[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># toDFå¿«é€Ÿæ„å»ºDataFrame</span></span><br><span class="line"><span class="comment"># å¯¹åˆ—ç±»å‹ä¸æ•æ„Ÿï¼Œé»˜è®¤stringç±»å‹</span></span><br><span class="line">df1 = rdd.toDF([<span class="string">"id"</span>, <span class="string">"package"</span>])</span><br><span class="line">df1.printSchema()</span><br><span class="line">df1.show(<span class="number">5</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®schemaé€šè¿‡toDFæ„å»ºDataFrame</span></span><br><span class="line">schema = StructType().add(<span class="string">"id"</span>, IntegerType(), nullable=<span class="literal">True</span>).add(<span class="string">"package"</span>, StringType(), nullable=<span class="literal">True</span>)</span><br><span class="line">df2 = rdd.toDF(schema=schema)</span><br><span class="line">df2.printSchema()</span><br><span class="line">df2.show(<span class="number">5</span>, <span class="literal">False</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line"> |-- id: long (nullable = true)</span><br><span class="line"> |-- package: string (nullable = true)</span><br><span class="line"></span><br><span class="line">+---+-------+</span><br><span class="line">|id |package|</span><br><span class="line">+---+-------+</span><br><span class="line">|1  |flask  |</span><br><span class="line">|2  |fastapi|</span><br><span class="line">|3  |h5py   |</span><br><span class="line">|4  |keras  |</span><br><span class="line">|5  |jieba  |</span><br><span class="line">+---+-------+</span><br><span class="line">only showing top 5 rows</span><br><span class="line"></span><br><span class="line">root</span><br><span class="line"> |-- id: integer (nullable = true)</span><br><span class="line"> |-- package: string (nullable = true)</span><br><span class="line"></span><br><span class="line">+---+-------+</span><br><span class="line">|id |package|</span><br><span class="line">+---+-------+</span><br><span class="line">|1  |flask  |</span><br><span class="line">|2  |fastapi|</span><br><span class="line">|3  |h5py   |</span><br><span class="line">|4  |keras  |</span><br><span class="line">|5  |jieba  |</span><br><span class="line">+---+-------+</span><br><span class="line">only showing top 5 rows</span><br></pre></td></tr></table></figure><h4 id="Pandas"><a href="#Pandas" class="headerlink" title="Pandas"></a>Pandas</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">pddf = pd.DataFrame(</span><br><span class="line">&#123;</span><br><span class="line">        <span class="string">"id"</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">        <span class="string">"package"</span>: [<span class="string">"flask"</span>, <span class="string">"fastapi"</span>, <span class="string">"h5py"</span>],</span><br><span class="line">        <span class="string">"version"</span>: [<span class="string">"1.1.4"</span>, <span class="string">"0.78.0"</span>, <span class="string">"2.10.0"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">df = spark.createDataFrame(pddf)</span><br><span class="line">df.printSchema()</span><br><span class="line">df.show()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line"> |-- id: long (nullable = true)</span><br><span class="line"> |-- package: string (nullable = true)</span><br><span class="line"> |-- version: string (nullable = true)</span><br><span class="line"></span><br><span class="line">+---+-------+-------+</span><br><span class="line">| id|package|version|</span><br><span class="line">+---+-------+-------+</span><br><span class="line">|  1|  flask|  1.1.4|</span><br><span class="line">|  2|fastapi| 0.78.0|</span><br><span class="line">|  3|   h5py| 2.10.0|</span><br><span class="line">+---+-------+-------+</span><br></pre></td></tr></table></figure><h3 id="é€šè¿‡æ–‡ä»¶æ„å»ºDataFrame"><a href="#é€šè¿‡æ–‡ä»¶æ„å»ºDataFrame" class="headerlink" title="é€šè¿‡æ–‡ä»¶æ„å»ºDataFrame"></a>é€šè¿‡æ–‡ä»¶æ„å»ºDataFrame</h3><h4 id="text"><a href="#text" class="headerlink" title="text"></a>text</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sparksession.read.format(<span class="string">"text|csv|json|jdbc|..."</span>).option(<span class="string">"K"</span>, <span class="string">"V"</span>).schema(StructType|String).load(<span class="string">"æ–‡ä»¶è·¯å¾„ï¼Œæ”¯æŒæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå’ŒHDFS"</span>)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">from</span> pyspark.sql.types <span class="keyword">import</span> StructType, StringType</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºStructTypeï¼Œtextæ•°æ®æºï¼Œè¯»å–æ•°æ®çš„ç‰¹ç‚¹æ˜¯å°†ä¸€æ•´è¡Œå½“ä½œä¸€åˆ—æ¥è¯»å–ï¼Œé»˜è®¤åˆ—åä¸ºvalueï¼Œç±»å‹ä¸ºstring</span></span><br><span class="line">schema = StructType().add(<span class="string">"data"</span>, StringType(), nullable=<span class="literal">True</span>)</span><br><span class="line">df = spark.read.format(<span class="string">"text"</span>).schema(schema=schema).load(<span class="string">"hdfs://master:8020/input/pip_file.txt"</span>)</span><br><span class="line">df.printSchema()</span><br><span class="line">df.show()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line"> |-- data: string (nullable = true)</span><br><span class="line"></span><br><span class="line">+--------------------+</span><br><span class="line">|                data|</span><br><span class="line">+--------------------+</span><br><span class="line">|       1,flask,1.1.4|</span><br><span class="line">|    2,fastapi,0.78.0|</span><br><span class="line">|       3,h5py,2.10.0|</span><br><span class="line">|       4,keras,2.6.0|</span><br><span class="line">|      5,jieba,0.42.1|</span><br><span class="line">|      6,numpy,1.23.3|</span><br><span class="line">|7,opencv-python,4...|</span><br><span class="line">|      8,pandas,1.4.3|</span><br><span class="line">|      9,pillow,9.2.0|</span><br><span class="line">|    10,py4j,0.10.9.5|</span><br><span class="line">|    11,pyspark,3.3.1|</span><br><span class="line">|      12,sklearn,0.0|</span><br><span class="line">| 13,tensorfolw,2.6.2|</span><br><span class="line">|  14,requests,2.28.1|</span><br><span class="line">|      15,redis,3.5.3|</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure><h4 id="json"><a href="#json" class="headerlink" title="json"></a>json</h4><p>jsonæ–‡ä»¶è‡ªå¸¦ä¸€å®šæ•°æ®ç»“æ„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">df = spark.read.format(<span class="string">"json"</span>).load(<span class="string">"hdfs://master:8020/input/pip_file.json"</span>)</span><br><span class="line">df.printSchema()</span><br><span class="line">df.show()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line"> |-- id: long (nullable = true)</span><br><span class="line"> |-- package: string (nullable = true)</span><br><span class="line"> |-- version: string (nullable = true)</span><br><span class="line"></span><br><span class="line">+---+-------+-------+</span><br><span class="line">| id|package|version|</span><br><span class="line">+---+-------+-------+</span><br><span class="line">|  1|  flask|  1.1.4|</span><br><span class="line">|  2|fastapi| 0.78.0|</span><br><span class="line">|  3|   h5py| 2.10.0|</span><br><span class="line">|  4|  keras|  2.6.0|</span><br><span class="line">|  5|  jieba| 0.42.1|</span><br><span class="line">+---+-------+-------+</span><br></pre></td></tr></table></figure><h4 id="csv"><a href="#csv" class="headerlink" title="csv"></a>csv</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡.optionæŒ‡å®šå±æ€§</span></span><br><span class="line">df = spark.read.format(<span class="string">"csv"</span>).option(<span class="string">"sep"</span>, <span class="string">";"</span>).option(<span class="string">"header"</span>, <span class="literal">True</span>).option(<span class="string">"encoding"</span>, <span class="string">"utf-8"</span>).schema(<span class="string">"id INT, package STRING, version STRING"</span>).load(<span class="string">"hdfs://master:8020/input/pip_file.csv"</span>)</span><br><span class="line">df.printSchema()</span><br><span class="line">df.show()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line"> |-- id: integer (nullable = true)</span><br><span class="line"> |-- package: string (nullable = true)</span><br><span class="line"> |-- version: string (nullable = true)</span><br><span class="line"></span><br><span class="line">+---+-------------+--------+</span><br><span class="line">| id|      package| version|</span><br><span class="line">+---+-------------+--------+</span><br><span class="line">|  1|        flask|   1.1.4|</span><br><span class="line">|  2|      fastapi|  0.78.0|</span><br><span class="line">|  3|         h5py|  2.10.0|</span><br><span class="line">|  4|        keras|   2.6.0|</span><br><span class="line">|  5|        jieba|  0.42.1|</span><br><span class="line">|  6|        numpy|  1.23.3|</span><br><span class="line">|  7|opencv-python|4.6.0.66|</span><br><span class="line">|  8|       pandas|   1.4.3|</span><br><span class="line">|  9|       pillow|   9.2.0|</span><br><span class="line">| 10|         py4j|0.10.9.5|</span><br><span class="line">| 11|      pyspark|   3.3.1|</span><br><span class="line">| 12|      sklearn|     0.0|</span><br><span class="line">| 13|   tensorfolw|   2.6.2|</span><br><span class="line">| 14|     requests|  2.28.1|</span><br><span class="line">| 15|        redis|   3.5.3|</span><br><span class="line">+---+-------------+--------+</span><br></pre></td></tr></table></figure><h4 id="parquet"><a href="#parquet" class="headerlink" title="parquet"></a>parquet</h4><p>parquetæ˜¯sparkä¸­å¸¸ç”¨çš„ä¸€ç§åˆ—ç¤ºå­˜å‚¨æ–‡ä»¶æ ¼å¼</p><ul><li>å†…ç½®schemaï¼ˆåˆ—åï¼Œåˆ—ç±»å‹ï¼Œæ˜¯å¦ä¸ºç©ºï¼‰</li><li>å­˜å‚¨æ˜¯ä»¥åˆ—ä½œä¸ºå­˜å‚¨æ ¼å¼</li><li>å­˜å‚¨æ˜¯åºåˆ—åŒ–å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ï¼ˆæœ‰å‹ç¼©å±æ€§ä½“ç§¯å°ï¼‰</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡.optionæŒ‡å®šå±æ€§</span></span><br><span class="line">df = spark.read.format(<span class="string">"parquet"</span>).load(<span class="string">"hdfs://master:8020/input/suers.parquet"</span>)</span><br><span class="line">df.printSchema()</span><br><span class="line">df.show()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line"> |-- name: string (nullable = true)</span><br><span class="line"> |-- favorite_color: string (nullable = true)</span><br><span class="line"> |-- favorite_numbers: array (nullable = true)</span><br><span class="line"> |    |-- element: integer (containsNull = true)</span><br><span class="line"></span><br><span class="line">+------+--------------+----------------+</span><br><span class="line">|  name|favorite_color|favorite_numbers|</span><br><span class="line">+------+--------------+----------------+</span><br><span class="line">|Alyssa|          null|  [3, 9, 15, 20]|</span><br><span class="line">|   Ben|           red|              []|</span><br><span class="line">+------+--------------+----------------+</span><br></pre></td></tr></table></figure><h3 id="DataFrameç¼–ç¨‹"><a href="#DataFrameç¼–ç¨‹" class="headerlink" title="DataFrameç¼–ç¨‹"></a>DataFrameç¼–ç¨‹</h3><p>DataFrameæ”¯æŒä¸¤ç§ç¼–ç¨‹é£æ ¼</p><ul><li><p><strong>DSLé£æ ¼</strong></p><p>è¢«ç§°ä¸ºé¢†åŸŸç‰¹å®šè¯­è¨€ï¼Œæ˜¯DataFrameçš„ç‰¹æœ‰API</p></li><li><p><strong>SQLé£æ ¼</strong></p><p>ä½¿ç”¨SQLè¯­å¥æ¥ç›´æ¥å¤„ç†DataFrame</p></li></ul><h4 id="DSLé£æ ¼"><a href="#DSLé£æ ¼" class="headerlink" title="DSLé£æ ¼"></a>DSLé£æ ¼</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">df = spark.read.format(<span class="string">"csv"</span>).schema(<span class="string">"id INT, package STRING, version STRING"</span>).load(<span class="string">"hdfs://master:8020/input/pip_file.txt"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–Columå¯¹è±¡</span></span><br><span class="line">id_colum = df[<span class="string">'id'</span>]</span><br><span class="line">package_colum = df[<span class="string">'package'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># DSLé£æ ¼</span></span><br><span class="line"><span class="comment"># select API</span></span><br><span class="line">df.select([<span class="string">'id'</span>, <span class="string">'package'</span>]).show()       <span class="comment"># list</span></span><br><span class="line">df.select(<span class="string">'id'</span>, <span class="string">'package'</span>).show()         <span class="comment"># å¯å˜å‚æ•°</span></span><br><span class="line">df.select(id_colum, package_colum).show() <span class="comment"># Columå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># filter API</span></span><br><span class="line">df.filter(<span class="string">'id &lt; 5'</span>).show()</span><br><span class="line">df.filter(df[<span class="string">'id'</span>] &lt; <span class="number">5</span>).show()            <span class="comment"># Columå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># where API</span></span><br><span class="line">df.where(<span class="string">'id &lt; 5'</span>).show()</span><br><span class="line">df.where(df[<span class="string">'id'</span>] &lt; <span class="number">5</span>).show()             <span class="comment"># Columå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># groupBy API</span></span><br><span class="line">df.groupBy(<span class="string">'package'</span>).count().show()</span><br><span class="line">df.groupBy(df[<span class="string">'package'</span>]).count().show()  <span class="comment"># Columå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿”å›å€¼ä¸æ˜¯DataFrameï¼Œè€Œæ˜¯GroupedDataå¯¹è±¡</span></span><br><span class="line"><span class="comment"># æ˜¯ä¸€ä¸ªæœ‰åˆ†ç»„å…³ç³»çš„æ•°æ®ç»“æ„ï¼Œæä¾›APIåšåˆ†ç»„èšåˆ</span></span><br><span class="line"><span class="comment"># SQLï¼šgroup byåæ¥èšåˆï¼šsumã€avgã€countã€minã€max</span></span><br><span class="line"><span class="comment"># GroupedDataç±»ä¼¼äºSQLåˆ†ç»„åçš„æ•°æ®ç»“æ„ï¼ŒåŒæ ·æ‹¥æœ‰ä¸Šè¿°5ç§èšåˆæ–¹æ³•</span></span><br><span class="line"><span class="comment"># GroupedDataè°ƒç”¨èšåˆæ–¹æ³•åï¼Œè¿”å›å€¼ä¾æ—§æ˜¯DataFrameå¯¹è±¡</span></span><br><span class="line"><span class="comment"># GroupedDataåªæ˜¯ä¸€ä¸ªä¸­è½¬å¯¹è±¡ï¼Œæœ€ç»ˆè¿˜æ˜¯è¦è·å¾—DataFrameå¯¹è±¡</span></span><br><span class="line">r = df.groupBy(<span class="string">'package'</span>)</span><br><span class="line">print(r.sum().show(), r.avg().show(), r.count().show(), r.min().show(), r.max().show())</span><br></pre></td></tr></table></figure><h4 id="SQLé£æ ¼"><a href="#SQLé£æ ¼" class="headerlink" title="SQLé£æ ¼"></a>SQLé£æ ¼</h4><p>ä½¿ç”¨SQLé£æ ¼ï¼Œéœ€è¦å°†DataFrameæå‰æ³¨å†Œæˆè¡¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df.createTempView(<span class="string">"pip"</span>)            <span class="comment"># æ³¨å†Œä¸€ä¸ªä¸´æ—¶è§†å›¾ï¼ˆè¡¨ï¼‰</span></span><br><span class="line">df.createOrReplaceTempView(<span class="string">"pip"</span>)   <span class="comment"># æ³¨å†Œä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œå¦‚æœå·²å­˜åœ¨åˆ™è¿›è¡Œæ›¿æ¢</span></span><br><span class="line">df.createGlobalTempView(<span class="string">"pip"</span>)      <span class="comment"># æ³¨å†Œä¸€ä¸ªå…¨å±€è¡¨</span></span><br></pre></td></tr></table></figure><ul><li><p><strong>å…¨å±€è¡¨</strong>ï¼šå¯è·¨SparkSessionå¯¹è±¡ä½¿ç”¨ï¼Œåœ¨ä¸€ä¸ªç¨‹åºå†…çš„å¤šä¸ªSparkSessionä¸­å‡å¯è°ƒç”¨ï¼ŒæŸ¥è¯¢æ—¶å¸¦ä¸Šå‰ç¼€<code>global_temp</code></p></li><li><p><strong>ä¸´æ—¶è¡¨</strong>ï¼šä»…åœ¨å½“å‰SparkSessionä¸­å¯ç”¨</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">df = spark.read.format(<span class="string">"csv"</span>).schema(<span class="string">"id INT, package STRING, version STRING"</span>).load(<span class="string">"hdfs://master:8020/input/pip_file.txt"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨å†Œä¸´æ—¶è¡¨</span></span><br><span class="line">df.createTempView(<span class="string">"pip"</span>)</span><br><span class="line">df.createOrReplaceTempView(<span class="string">"pip"</span>)</span><br><span class="line">df.createGlobalTempView(<span class="string">"pip_2"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡SparkSession SQL APIæ‰§è¡Œsqlè¯­å¥</span></span><br><span class="line">spark.sql(<span class="string">"SELECT package, COUNT(*) AS cnt FROM pip GROUP BY package"</span>).show()</span><br><span class="line">spark.sql(<span class="string">"SELECT package, COUNT(*) AS cnt FROM global_temp.pip_2 GROUP BY package"</span>).show()</span><br></pre></td></tr></table></figure><h3 id="pyspark-sql-functions"><a href="#pyspark-sql-functions" class="headerlink" title="pyspark.sql.functions"></a>pyspark.sql.functions</h3><p>PySparkæä¾›çš„pyspark.sql.functionsåŒ…åŒ…å«ä¸€ç³»åˆ—å¯ä¾›SparkSQLä½¿ç”¨çš„è®¡ç®—å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> functions <span class="keyword">as</span> F</span><br></pre></td></tr></table></figure><p>å³å¯è°ƒç”¨Få¯¹è±¡è°ƒç”¨å‡½æ•°è¿›è¡Œè®¡ç®—ã€‚è¿™äº›åŠŸèƒ½å‡½æ•°çš„è¿”å›å€¼å¤§å¤šæ˜¯Columå¯¹è±¡</p><h3 id="WordCountç¤ºä¾‹"><a href="#WordCountç¤ºä¾‹" class="headerlink" title="WordCountç¤ºä¾‹"></a>WordCountç¤ºä¾‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> functions <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line"><span class="comment"># SQLé£æ ¼å¤„ç†</span></span><br><span class="line">rdd = sc.textFile(<span class="string">"hdfs://master:8020/input/words.txt"</span>).flatMap(<span class="keyword">lambda</span> x: x.split(<span class="string">" "</span>)).map(<span class="keyword">lambda</span> x: [x])</span><br><span class="line">df = rdd.toDF([<span class="string">"word"</span>])</span><br><span class="line">df.createTempView(<span class="string">"words"</span>)</span><br><span class="line">spark.sql(<span class="string">"SELECT word, COUNT(*) AS cnt FROM words GROUP BY word ORDER BY cnt DESC"</span>).show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># DSLé£æ ¼å¤„ç†</span></span><br><span class="line">df = spark.read.format(<span class="string">"text"</span>).load(<span class="string">"hdfs://master:8020/input/words.txt"</span>)</span><br><span class="line"><span class="comment"># withColumnæ–¹æ³•</span></span><br><span class="line"><span class="comment"># ï¼šå¯¹å·²å­˜åœ¨çš„åˆ—è¿›è¡Œæ“ä½œï¼Œè¿”å›ä¸ä¸€ä¸ªæ–°çš„åˆ—ï¼Œå¦‚æœåå­—å’Œä¹‹å‰ç›¸åŒåˆ™æ›¿æ¢ï¼Œå¦åˆ™æ–°å»ºåˆ—</span></span><br><span class="line">df.withColumn(<span class="string">"value"</span>, F.explode(F.split(df[<span class="string">'value'</span>], <span class="string">" "</span>))).show()</span><br><span class="line">df2 = df.withColumn(<span class="string">"value"</span>, F.explode(F.split(df[<span class="string">'value'</span>], <span class="string">" "</span>))).show()</span><br><span class="line">df2.groupBy(<span class="string">"value"</span>).count().show()</span><br><span class="line">df2.groupBy(<span class="string">"value"</span>).count().withColumnRenamed(<span class="string">"value"</span>, <span class="string">"name"</span>).withColumnRenamed(<span class="string">"count"</span>, <span class="string">"cnt"</span>).orderBy(<span class="string">"cnt"</span>, ascending=<span class="literal">False</span>).show()</span><br></pre></td></tr></table></figure><h2 id="SparkSQL-Shuffle"><a href="#SparkSQL-Shuffle" class="headerlink" title="SparkSQL Shuffle"></a>SparkSQL Shuffle</h2><p>spark.sql.shuffle.partitionså‚æ•°æ˜¯åœ¨spark sqlè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œshuffleç®—å­é˜¶æ®µé»˜è®¤çš„åˆ†åŒºæ•°æ˜¯200ä¸ªã€‚å¯¹äºé›†ç¾¤æ¨¡å¼ï¼Œ200è¾ƒä¸ºåˆé€‚ï¼Œå¦‚æœåœ¨localæ¨¡å¼ä¸‹è¿è¡Œï¼Œ200è¾ƒå¤šï¼Œä¼šåœ¨è°ƒåº¦ä¸Šå¸¦æ¥é¢å¤–çš„æŸè€—ï¼Œæ‰€ä»¥åœ¨localæ¨¡å¼ä¸‹å»ºè®®ä¿®æ”¹è¾ƒä½ï¼Œä¾‹å¦‚2/4/10ã€‚è¿™ä¸ªå‚æ•°å’ŒRDDä¸­è®¾ç½®å¹¶è¡Œåº¦çš„å‚æ•°ç›¸äº’ç‹¬ç«‹</p><p>å¯ä»¥æŒ‰ä¼˜å…ˆçº§åœ¨ä¸‰å¤„è®¾ç½®ï¼š</p><ul><li><p>ä»£ç è®¾ç½®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).config(<span class="string">"spark.sql.shuffle.partitions"</span>, <span class="string">"2"</span>).getOrCreate()</span><br></pre></td></tr></table></figure></li><li><p>å®¢æˆ·ç«¯å‚æ•°è®¾ç½®</p><p><code>bin/spark-submit --conf &quot;spark.sql.shuffle.partitions=100&quot;</code></p></li><li><p>é…ç½®æ–‡ä»¶è®¾ç½®</p><p><font color="#008080">conf/spark-defaults.conf</font> <code>spark.sql.shuffle.partitions 100</code></p></li></ul><h2 id="SparkSQLæ•°æ®æ¸…æ´—"><a href="#SparkSQLæ•°æ®æ¸…æ´—" class="headerlink" title="SparkSQLæ•°æ®æ¸…æ´—"></a>SparkSQLæ•°æ®æ¸…æ´—</h2><h3 id="æ•°æ®å»é‡API"><a href="#æ•°æ®å»é‡API" class="headerlink" title="æ•°æ®å»é‡API"></a>æ•°æ®å»é‡API</h3><p><strong>dropDuplicates</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DataFrame API</span></span><br><span class="line"><span class="comment"># ä¸è®¾ç½®å‚æ•°ï¼Œå¯¹å…¨å±€çš„åˆ—è”åˆèµ·æ¥è¿›è¡Œæ¯”è¾ƒï¼Œå»é™¤é‡å¤å€¼ï¼Œåªä¿ç•™ä¸€æ¡</span></span><br><span class="line">df.dropDuplicates().show()</span><br><span class="line">df.dropDuplicates([<span class="string">'id'</span>, <span class="string">'version'</span>]).show()</span><br></pre></td></tr></table></figure><h3 id="ç¼ºå¤±å€¼å¤„ç†API"><a href="#ç¼ºå¤±å€¼å¤„ç†API" class="headerlink" title="ç¼ºå¤±å€¼å¤„ç†API"></a>ç¼ºå¤±å€¼å¤„ç†API</h3><p><strong>dropna</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DataFrame API</span></span><br><span class="line"><span class="comment"># å¯¹ç¼ºå¤±å€¼çš„æ•°æ®è¿›è¡Œåˆ é™¤</span></span><br><span class="line"><span class="comment"># ä¸è®¾ç½®å‚æ•°ï¼Œåªè¦åˆ—ä¸­å­˜åœ¨nullå³åˆ é™¤æ•´è¡Œ</span></span><br><span class="line">df.dropna().show()</span><br><span class="line"><span class="comment"># tresh=3è¡¨ç¤ºï¼Œæœ€å°‘æ»¡è¶³3ä¸ªæœ‰æ•ˆåˆ—ï¼Œä¸æ»¡è¶³å³åˆ é™¤å½“å‰æ•°æ®</span></span><br><span class="line">df.dropna(thresh=<span class="number">3</span>).show()</span><br><span class="line">df.dropna(tresh=<span class="number">2</span>,subset[<span class="string">'id'</span>, <span class="string">'version'</span>]).show()</span><br></pre></td></tr></table></figure><p><strong>fillna</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DataFrame API</span></span><br><span class="line"><span class="comment"># å¯¹ç¼ºå¤±å€¼çš„æ•°æ®è¿›è¡Œå¡«å……</span></span><br><span class="line">df.fillna(<span class="string">"loss"</span>).show()</span><br><span class="line"><span class="comment"># å¯¹æŒ‡å®šåˆ—è¿›è¡Œå¡«å……</span></span><br><span class="line">df.fillna(<span class="string">"M/A"</span>, subset[<span class="string">'version'</span>]).show()</span><br><span class="line"><span class="comment"># æŒ‡å®šä¸€ä¸ªå­—å…¸ï¼Œå¯¹æ‰€æœ‰çš„åˆ—æä¾›å¡«å……ä¾æ®</span></span><br><span class="line">df.fillna(&#123;<span class="string">"id"</span>: <span class="string">"unknown"</span>, <span class="string">"package"</span>: <span class="string">"unknown"</span>, <span class="string">"version"</span>: <span class="string">"none"</span>&#125;).show()</span><br></pre></td></tr></table></figure><h2 id="DataFrameæ•°æ®å†™å‡º"><a href="#DataFrameæ•°æ®å†™å‡º" class="headerlink" title="DataFrameæ•°æ®å†™å‡º"></a>DataFrameæ•°æ®å†™å‡º</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># modeï¼šä¼ å…¥æ¨¡å¼ï¼Œappend-è¿½åŠ ï¼Œoverwrite-è¦†ç›–ï¼Œignore-å¿½ç•¥ï¼Œerror-é‡å¤å¼‚å¸¸ï¼ˆé»˜è®¤ï¼‰</span></span><br><span class="line"><span class="comment"># formatï¼šä¼ å…¥æ ¼å¼ï¼štext/csv/json/parquet/orc/avro/jdbc</span></span><br><span class="line"><span class="comment"># ï¼ˆtextæºä»…æ”¯æŒå•åˆ—dfå†™å‡ºï¼‰</span></span><br><span class="line"><span class="comment"># optionï¼šè®¾ç½®å±æ€§ï¼Œå¦‚.option("sep", ",")</span></span><br><span class="line"><span class="comment"># saveï¼šä¿å­˜è·¯å¾„ï¼Œæ”¯æŒæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå’ŒHDFS</span></span><br><span class="line">df.write.mode().format().option(K, V).save(PATH)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">from</span> pyspark.sql.types <span class="keyword">import</span> StructType, StringType, IntegerType</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> functions <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0. æ„å»ºæ‰§è¡Œç¯å¢ƒå…¥å£å¯¹è±¡SparkSession</span></span><br><span class="line">spark = SparkSession.builder.\</span><br><span class="line">    appName(<span class="string">"test"</span>).\</span><br><span class="line">    master(<span class="string">"local[*]"</span>).\</span><br><span class="line">    config(<span class="string">"spark.sql.shuffle.partitions"</span>, <span class="number">2</span>).\</span><br><span class="line">    getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. è¯»å–æ•°æ®é›†</span></span><br><span class="line">schema = StructType().add(<span class="string">"user_id"</span>, StringType(), nullable=<span class="literal">True</span>). \</span><br><span class="line">    add(<span class="string">"movie_id"</span>, IntegerType(), nullable=<span class="literal">True</span>). \</span><br><span class="line">    add(<span class="string">"rank"</span>, IntegerType(), nullable=<span class="literal">True</span>). \</span><br><span class="line">    add(<span class="string">"ts"</span>, StringType(), nullable=<span class="literal">True</span>)</span><br><span class="line">df = spark.read.format(<span class="string">"csv"</span>). \</span><br><span class="line">    option(<span class="string">"sep"</span>, <span class="string">"\t"</span>). \</span><br><span class="line">    option(<span class="string">"header"</span>, <span class="literal">False</span>). \</span><br><span class="line">    option(<span class="string">"encoding"</span>, <span class="string">"utf-8"</span>). \</span><br><span class="line">    schema(schema=schema). \</span><br><span class="line">    load(<span class="string">"hdfs://master:8020/input/u.data"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Write text å†™å‡º, åªèƒ½å†™å‡ºä¸€ä¸ªåˆ—çš„æ•°æ®, éœ€è¦å°†dfè½¬æ¢ä¸ºå•åˆ—df</span></span><br><span class="line">df.select(F.concat_ws(<span class="string">"---"</span>, <span class="string">"user_id"</span>, <span class="string">"movie_id"</span>, <span class="string">"rank"</span>, <span class="string">"ts"</span>)).\</span><br><span class="line">    write.\</span><br><span class="line">    mode(<span class="string">"overwrite"</span>).\</span><br><span class="line">    format(<span class="string">"text"</span>).\</span><br><span class="line">    save(<span class="string">"hdfs://master:8020/output/sql/text"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Write csv</span></span><br><span class="line">df.write.mode(<span class="string">"overwrite"</span>).\</span><br><span class="line">    format(<span class="string">"csv"</span>).\</span><br><span class="line">    option(<span class="string">"sep"</span>, <span class="string">";"</span>).\</span><br><span class="line">    option(<span class="string">"header"</span>, <span class="literal">True</span>).\</span><br><span class="line">    save(<span class="string">"hdfs://master:8020/output/sql/csv"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Write json</span></span><br><span class="line">df.write.mode(<span class="string">"overwrite"</span>).\</span><br><span class="line">    format(<span class="string">"json"</span>).\</span><br><span class="line">    save(<span class="string">"hdfs://master:8020/output/sql/json"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Write parquet</span></span><br><span class="line">df.write.mode(<span class="string">"overwrite"</span>).\</span><br><span class="line">    format(<span class="string">"parquet"</span>).\</span><br><span class="line">    save(<span class="string">"hdfs://master:8020/output/sql/parquet"</span>)</span><br></pre></td></tr></table></figure><h2 id="DataFrame-JDBC"><a href="#DataFrame-JDBC" class="headerlink" title="DataFrame JDBC"></a>DataFrame JDBC</h2><p>å°†mysqlåŒ…æ·»åŠ è¿›pyspark</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/anaconda3/envs/pyspark/lib/python3.8/site-packages/pyspark/jars/</span><br><span class="line">rz</span><br></pre></td></tr></table></figure><h3 id="DataFrameè¯»å†™æ•°æ®åº“"><a href="#DataFrameè¯»å†™æ•°æ®åº“" class="headerlink" title="DataFrameè¯»å†™æ•°æ®åº“"></a>DataFrameè¯»å†™æ•°æ®åº“</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†DataFrameé€šè¿‡JDBCå†™å…¥mysql</span></span><br><span class="line">df.write.mode(<span class="string">"overwrite"</span>).\</span><br><span class="line">format(<span class="string">"jdbc"</span>).\</span><br><span class="line">option(<span class="string">"url"</span>, <span class="string">"jdbc:mysql://master:3306/..."</span>).\</span><br><span class="line">option(<span class="string">"dbtable"</span>, <span class="string">"test"</span>).\</span><br><span class="line">option(<span class="string">"user"</span>, <span class="string">"root"</span>).\</span><br><span class="line">option(<span class="string">"password"</span>, <span class="string">"123456"</span>).\</span><br><span class="line">save()</span><br><span class="line"></span><br><span class="line"><span class="comment"># JDBCä¼šè‡ªåŠ¨å»ºè¡¨ï¼Œå› ä¸ºDataFrameä¸­å«æœ‰è¡¨ç»“æ„çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># è¯»mysql</span></span><br><span class="line">df = spark.read.format(<span class="string">"jdbc"</span>).\</span><br><span class="line">option(<span class="string">"url"</span>, <span class="string">"jdbc:mysql://master:3306/..."</span>).\</span><br><span class="line">option(<span class="string">"dbtable"</span>, <span class="string">"test"</span>).\</span><br><span class="line">option(<span class="string">"user"</span>, <span class="string">"root"</span>).\</span><br><span class="line">option(<span class="string">"password"</span>, <span class="string">"123456"</span>).\</span><br><span class="line">load()</span><br><span class="line"></span><br><span class="line">df.printSchema()</span><br><span class="line">df.show()</span><br></pre></td></tr></table></figure><h2 id="SparkSQLå‡½æ•°å®šä¹‰"><a href="#SparkSQLå‡½æ•°å®šä¹‰" class="headerlink" title="SparkSQLå‡½æ•°å®šä¹‰"></a>SparkSQLå‡½æ•°å®šä¹‰</h2><h3 id="SparkSQLå®šä¹‰UDFå‡½æ•°"><a href="#SparkSQLå®šä¹‰UDFå‡½æ•°" class="headerlink" title="SparkSQLå®šä¹‰UDFå‡½æ•°"></a>SparkSQLå®šä¹‰UDFå‡½æ•°</h3><p>SparkSQLæ¨¡å—è‡ªå¸¦å®ç°å…¬å…±æ–¹æ³•çš„ä½ç½®åœ¨pyspark.sql.functionsä¸­ï¼ŒåŒæ—¶SparkSQLå’ŒHiveä¸€æ ·æ”¯æŒè‡ªå®šä¹‰å‡½æ•°ï¼šUDFå’ŒUDAF</p><p>ç›®å‰pythonä»…æ”¯æŒSparkSQL UDFè‡ªå®šå‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨å†Œçš„UDFå¯ç”¨äºDSLå’ŒSQLé£æ ¼</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼ç”¨äºDSLé£æ ¼ï¼Œä¼ å‚å†…çš„åç§°ç”¨äºSQLé£æ ¼</span></span><br><span class="line"><span class="comment"># arg1ï¼šæ³¨å†Œçš„UDFåç§°ï¼Œä»…å¯ç”¨äºSQLé£æ ¼</span></span><br><span class="line"><span class="comment"># arg2ï¼šUDFå¤„ç†é€»è¾‘ï¼Œæ˜¯ä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment"># arg3ï¼šå£°æ˜UDFçš„è¿”å›å€¼ç±»å‹ï¼ŒUDFæ³¨å†Œæ—¶ï¼Œå¿…é¡»å£°æ˜è¿”å›å€¼ç±»å‹ï¼Œå¹¶ä¸”UDFçš„çœŸå®è¿”å›å€¼ä¸€å®šè¦å’Œå£°æ˜çš„è¿”å›å€¼ä¸€è‡´</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼å¯¹è±¡ï¼šæ˜¯ä¸€ä¸ªUDFå¯¹è±¡ï¼Œä»…å¯ç”¨äºDSLè¯­æ³•</span></span><br><span class="line"><span class="comment"># è¿™ç§æ–¹å¼å®šä¹‰çš„UDFï¼Œå¯ä»¥é€šè¿‡arg1çš„åç§°ç”¨äºSQLé£æ ¼ï¼Œé€šè¿‡è¿”å›å€¼å¯¹è±¡ç”¨äºDSLé£æ ¼</span></span><br><span class="line">sparksession.udf.register(arg1, arg2, arg3)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»…èƒ½ç”¨äºDSLé£æ ¼</span></span><br><span class="line">pyspark.sql.functions.udf</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">from</span> pyspark.sql.types <span class="keyword">import</span> IntegerType</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> functions <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).config(<span class="string">"spark.sql.shuffle.partitions"</span>, <span class="number">2</span>).getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]).map(<span class="keyword">lambda</span> x: [x])</span><br><span class="line">df = rdd.toDF([<span class="string">'num'</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sparksession.udf.register()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_ride_10</span><span class="params">(num)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> num * <span class="number">10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">udf1 = spark.udf.register(<span class="string">"udf1"</span>, num_ride_10, IntegerType())</span><br><span class="line"></span><br><span class="line"><span class="comment"># SQLé£æ ¼ä½¿ç”¨</span></span><br><span class="line"><span class="comment"># selectExprï¼šä»¥SELECTçš„è¡¨è¾¾å¼æ‰§è¡Œï¼ˆSQLå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line"><span class="comment"># æ™®é€šselectæ–¹æ³•æ¥å—æ™®é€šå­—ç¬¦ä¸²å­—æ®µåï¼Œæˆ–è€…è¿”å›å€¼æ˜¯Columnå¯¹è±¡çš„è®¡ç®—</span></span><br><span class="line">df.selectExpr(<span class="string">"udf1(num)"</span>).show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># DSLé£æ ¼</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼UDFå¯¹è±¡å¦‚æœä½œä¸ºæ–¹æ³•ä½¿ç”¨ï¼Œä¼ å…¥çš„å‚æ•°ä¸€å®šæ˜¯Columnå¯¹è±¡</span></span><br><span class="line">df.select(udf1(df[<span class="string">'num'</span>])).show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># pyspark.sql.functions.udf</span></span><br><span class="line">udf2 = F.udf(num_ride_10, IntegerType())</span><br><span class="line">df.select(udf2(df[<span class="string">'num'</span>])).show()</span><br><span class="line">df.selectExpr(<span class="string">"udf2(num)"</span>).show()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">+---------+</span><br><span class="line">|udf1(num)|</span><br><span class="line">+---------+</span><br><span class="line">|       10|</span><br><span class="line">|       20|</span><br><span class="line">|       30|</span><br><span class="line">|       40|</span><br><span class="line">|       50|</span><br><span class="line">|       60|</span><br><span class="line">|       70|</span><br><span class="line">|       80|</span><br><span class="line">|       90|</span><br><span class="line">|      100|</span><br><span class="line">+---------+</span><br><span class="line"></span><br><span class="line">+---------+</span><br><span class="line">|udf1(num)|</span><br><span class="line">+---------+</span><br><span class="line">|       10|</span><br><span class="line">|       20|</span><br><span class="line">|       30|</span><br><span class="line">|       40|</span><br><span class="line">|       50|</span><br><span class="line">|       60|</span><br><span class="line">|       70|</span><br><span class="line">|       80|</span><br><span class="line">|       90|</span><br><span class="line">|      100|</span><br><span class="line">+---------+</span><br><span class="line"></span><br><span class="line">+----------------+</span><br><span class="line">|num_ride_10(num)|</span><br><span class="line">+----------------+</span><br><span class="line">|              10|</span><br><span class="line">|              20|</span><br><span class="line">|              30|</span><br><span class="line">|              40|</span><br><span class="line">|              50|</span><br><span class="line">|              60|</span><br><span class="line">|              70|</span><br><span class="line">+----------------+</span><br></pre></td></tr></table></figure><h3 id="æ³¨å†Œè¿”å›å€¼ä¸ºæ•°ç»„ç±»å‹çš„UDF"><a href="#æ³¨å†Œè¿”å›å€¼ä¸ºæ•°ç»„ç±»å‹çš„UDF" class="headerlink" title="æ³¨å†Œè¿”å›å€¼ä¸ºæ•°ç»„ç±»å‹çš„UDF"></a>æ³¨å†Œè¿”å›å€¼ä¸ºæ•°ç»„ç±»å‹çš„UDF</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">from</span> pyspark.sql.types <span class="keyword">import</span> StringType, ArrayType</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> functions <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0. æ„å»ºæ‰§è¡Œç¯å¢ƒå…¥å£å¯¹è±¡SparkSession</span></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).config(<span class="string">"spark.sql.shuffle.partitions"</span>, <span class="number">2</span>).getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºä¸€ä¸ªRDD</span></span><br><span class="line">rdd = sc.parallelize([[<span class="string">"hadoop spark flink"</span>], [<span class="string">"hadoop flink java"</span>]])</span><br><span class="line">df = rdd.toDF([<span class="string">"line"</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨å†ŒUDF, UDFçš„æ‰§è¡Œå‡½æ•°å®šä¹‰</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">split_line</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> data.split(<span class="string">" "</span>)  <span class="comment"># è¿”å›å€¼æ˜¯ä¸€ä¸ªArrayå¯¹è±¡</span></span><br><span class="line"><span class="comment"># TODO1 æ–¹å¼1 æ„å»ºUDF</span></span><br><span class="line">udf2 = spark.udf.register(<span class="string">"udf1"</span>, split_line, ArrayType(StringType()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># DLSé£æ ¼</span></span><br><span class="line">df.select(udf2(df[<span class="string">'line'</span>])).show()</span><br><span class="line"><span class="comment"># SQLé£æ ¼</span></span><br><span class="line">df.createTempView(<span class="string">"lines"</span>)</span><br><span class="line">spark.sql(<span class="string">"SELECT udf1(line) FROM lines"</span>).show(truncate=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># TODO 2 æ–¹å¼2çš„å½¢å¼æ„å»ºUDF</span></span><br><span class="line">udf3 = F.udf(split_line, ArrayType(StringType()))</span><br><span class="line">df.select(udf3(df[<span class="string">'line'</span>])).show(truncate=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">+--------------------+</span><br><span class="line">|          udf1(line)|</span><br><span class="line">+--------------------+</span><br><span class="line">|[hadoop, spark, f...|</span><br><span class="line">|[hadoop, flink, j...|</span><br><span class="line">+--------------------+</span><br><span class="line"></span><br><span class="line">+----------------------+</span><br><span class="line">|udf1(line)            |</span><br><span class="line">+----------------------+</span><br><span class="line">|[hadoop, spark, flink]|</span><br><span class="line">|[hadoop, flink, java] |</span><br><span class="line">+----------------------+</span><br><span class="line"></span><br><span class="line">+----------------------+</span><br><span class="line">|split_line(line)      |</span><br><span class="line">+----------------------+</span><br><span class="line">|[hadoop, spark, flink]|</span><br><span class="line">|[hadoop, flink, java] |</span><br><span class="line">+----------------------+</span><br></pre></td></tr></table></figure><h3 id="æ³¨å†Œè¿”å›å€¼ä¸ºå­—å…¸ç±»å‹çš„UDF"><a href="#æ³¨å†Œè¿”å›å€¼ä¸ºå­—å…¸ç±»å‹çš„UDF" class="headerlink" title="æ³¨å†Œè¿”å›å€¼ä¸ºå­—å…¸ç±»å‹çš„UDF"></a>æ³¨å†Œè¿”å›å€¼ä¸ºå­—å…¸ç±»å‹çš„UDF</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">from</span> pyspark.sql.types <span class="keyword">import</span> StructType, StringType, IntegerType, ArrayType</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0. æ„å»ºæ‰§è¡Œç¯å¢ƒå…¥å£å¯¹è±¡SparkSession</span></span><br><span class="line">spark = SparkSession.builder.master(<span class="string">"local[*]"</span>).config(<span class="string">"spark.sql.shuffle.partitions"</span>, <span class="number">2</span>).getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡è®¾ æœ‰ä¸‰ä¸ªæ•°å­—  1 2 3  æˆ‘ä»¬ä¼ å…¥æ•°å­— ,è¿”å›æ•°å­—æ‰€åœ¨åºå·å¯¹åº”çš„ å­—æ¯ ç„¶åå’Œæ•°å­—ç»“åˆå½¢æˆdictè¿”å›</span></span><br><span class="line"><span class="comment"># æ¯”å¦‚ä¼ å…¥1 æˆ‘ä»¬è¿”å› &#123;"num":1, "letters": "a"&#125;</span></span><br><span class="line">rdd = sc.parallelize([[<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">3</span>]])</span><br><span class="line">df = rdd.toDF([<span class="string">"num"</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨å†ŒUDF</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">"num"</span>: data, <span class="string">"letters"</span>: string.ascii_letters[data]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">UDFçš„è¿”å›å€¼æ˜¯å­—å…¸çš„è¯, éœ€è¦ç”¨StructTypeæ¥æ¥æ”¶</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">udf1 = spark.udf.register(<span class="string">"udf1"</span>, process, StructType().add(<span class="string">"num"</span>, IntegerType(), nullable=<span class="literal">True</span>).\</span><br><span class="line">                          add(<span class="string">"letters"</span>, StringType(), nullable=<span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line">df.selectExpr(<span class="string">"udf1(num)"</span>).show(truncate=<span class="literal">False</span>)</span><br><span class="line">df.select(udf1(df[<span class="string">'num'</span>])).show(truncate=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+---------+</span><br><span class="line">|udf1(num)|</span><br><span class="line">+---------+</span><br><span class="line">|&#123;1, b&#125;   |</span><br><span class="line">|&#123;2, c&#125;   |</span><br><span class="line">|&#123;3, d&#125;   |</span><br><span class="line">+---------+</span><br><span class="line"></span><br><span class="line">+---------+</span><br><span class="line">|udf1(num)|</span><br><span class="line">+---------+</span><br><span class="line">|&#123;1, b&#125;   |</span><br><span class="line">|&#123;2, c&#125;   |</span><br><span class="line">|&#123;3, d&#125;   |</span><br><span class="line">+---------+</span><br></pre></td></tr></table></figure><h3 id="é€šè¿‡RDDæ¨¡æ‹ŸUDAF"><a href="#é€šè¿‡RDDæ¨¡æ‹ŸUDAF" class="headerlink" title="é€šè¿‡RDDæ¨¡æ‹ŸUDAF"></a>é€šè¿‡RDDæ¨¡æ‹ŸUDAF</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0. æ„å»ºæ‰§è¡Œç¯å¢ƒå…¥å£å¯¹è±¡SparkSession</span></span><br><span class="line">spark = SparkSession.builder.appName(<span class="string">"test"</span>).master(<span class="string">"local[*]"</span>).config(<span class="string">"spark.sql.shuffle.partitions"</span>, <span class="number">2</span>).getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], <span class="number">3</span>)</span><br><span class="line">df = rdd.map(<span class="keyword">lambda</span> x: [x]).toDF([<span class="string">'num'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠ˜ä¸­çš„æ–¹å¼ å°±æ˜¯ä½¿ç”¨RDDçš„mapPartitions ç®—å­æ¥å®Œæˆèšåˆæ“ä½œ</span></span><br><span class="line"><span class="comment"># å¦‚æœç”¨mapPartitions API å®ŒæˆUDAFèšåˆ, ä¸€å®šè¦å•åˆ†åŒº</span></span><br><span class="line">single_partition_rdd = df.rdd.repartition(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">(iter)</span>:</span></span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> iter:</span><br><span class="line">        sum += row[<span class="string">'num'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [sum]    <span class="comment"># ä¸€å®šè¦åµŒå¥—list, å› ä¸ºmapPartitionsæ–¹æ³•è¦æ±‚çš„è¿”å›å€¼æ˜¯listå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(single_partition_rdd.mapPartitions(process).collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[15]</span><br></pre></td></tr></table></figure><h2 id="SparkSQLçª—å£å‡½æ•°"><a href="#SparkSQLçª—å£å‡½æ•°" class="headerlink" title="SparkSQLçª—å£å‡½æ•°"></a>SparkSQLçª—å£å‡½æ•°</h2><h3 id="å¼€çª—å‡½æ•°"><a href="#å¼€çª—å‡½æ•°" class="headerlink" title="å¼€çª—å‡½æ•°"></a>å¼€çª—å‡½æ•°</h3><p>å¼€çª—å‡½æ•°çš„å¼•å…¥æ˜¯ä¸ºäº†æ—¢æ˜¾ç¤ºèšé›†å‰çš„æ•°æ®åˆæ˜¾ç¤ºèšé›†åçš„æ•°æ®ï¼Œå³åœ¨æ¯ä¸€è¡Œçš„æœ€åä¸€åˆ—æ·»åŠ èšåˆå‡½æ•°çš„ç»“æœ</p><p>å¼€çª—ç”¨äºä¸ºè¡Œä¸ºå®šä¹‰ä¸€ä¸ªçª—å£ï¼ˆè¿ç®—å°†è¦æ“ä½œçš„è¡Œä¸ºé›†åˆï¼‰ï¼Œå¯¹ä¸€ç»„å€¼è¿›è¡Œæ“ä½œï¼Œä¸éœ€è¦ä½¿ç”¨<font color="orange">GROUP BY</font>å­—å¥å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œèƒ½å¤Ÿåœ¨åŒä¸€è¡Œä¸­åŒæ—¶è¿”å›åŸºç¡€è¡Œçš„åˆ—å’Œèšåˆåˆ—</p><h3 id="èšåˆå‡½æ•°å’Œå¼€çª—å‡½æ•°"><a href="#èšåˆå‡½æ•°å’Œå¼€çª—å‡½æ•°" class="headerlink" title="èšåˆå‡½æ•°å’Œå¼€çª—å‡½æ•°"></a>èšåˆå‡½æ•°å’Œå¼€çª—å‡½æ•°</h3><ul><li><p>èšåˆå‡½æ•°æ˜¯å°†å¤šè¡Œå˜ä¸ºä¸€è¡Œï¼Œcountã€avgâ€¦ï¼›å¦‚æœè¦æ˜¾ç¤ºå…¶ä»–çš„åˆ—å¿…é¡»å°†åˆ—åŠ å…¥åˆ°<font color="orange">GROUP BY</font>ä¸­</p></li><li><p>å¼€çª—å‡½æ•°æ˜¯å°†ä¸€è¡Œå˜æˆå¤šè¡Œï¼Œå¯ä»¥ä¸ä½¿ç”¨<font color="orange">GROUP BY</font>ç›´æ¥æ˜¾ç¤ºæ‰€æœ‰æ•°æ®</p></li></ul><h3 id="å¼€çª—å‡½æ•°åˆ†ç±»"><a href="#å¼€çª—å‡½æ•°åˆ†ç±»" class="headerlink" title="å¼€çª—å‡½æ•°åˆ†ç±»"></a>å¼€çª—å‡½æ•°åˆ†ç±»</h3><ul><li>èšåˆå¼€çª—å‡½æ•°</li><li>æ’åºå¼€çª—å‡½æ•°</li><li>åˆ†åŒºç±»å‹NTILEçš„çª—å£å‡½æ•°</li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;SparkSQL&quot;&gt;&lt;a href=&quot;#SparkSQL&quot; class=&quot;headerlink&quot; title=&quot;SparkSQL&quot;&gt;&lt;/a&gt;SparkSQL&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;SparkSQL&lt;/strong&gt;æ˜¯sparkçš„ä¸€ä¸ªç”¨äºå¤„ç†æµ·é‡&lt;strong&gt;ç»“æ„åŒ–æ•°æ®&lt;/strong&gt;çš„æ¨¡å—&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒSQLè¯­è¨€&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨ä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;æ€§èƒ½å¼º&lt;/li&gt;
&lt;li&gt;å…¼å®¹HIVE&lt;/li&gt;
&lt;li&gt;APIæµç¨‹ç®€å•&lt;/li&gt;
&lt;li&gt;æ”¯æŒæ ‡å‡†åŒ–JDBCå’ŒODBCè¿æ¥&lt;/li&gt;
&lt;li&gt;â€¦&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;SparkSQLæ•°æ®æŠ½è±¡&quot;&gt;&lt;a href=&quot;#SparkSQLæ•°æ®æŠ½è±¡&quot; class=&quot;headerlink&quot; title=&quot;SparkSQLæ•°æ®æŠ½è±¡&quot;&gt;&lt;/a&gt;SparkSQLæ•°æ®æŠ½è±¡&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;&lt;font color=&quot;orange&quot;&gt;Pandas Â· DataFrame&lt;/font&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;font color=&quot;orange&quot;&gt;Â·&lt;/font&gt;&lt;/strong&gt; äºŒç»´è¡¨æ•°æ®ç»“æ„&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;font color=&quot;orange&quot;&gt;Â·&lt;/font&gt;&lt;/strong&gt; å•æœºï¼ˆæœ¬åœ°ï¼‰é›†åˆ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;&lt;font color=&quot;orange&quot;&gt;SparkCore Â· RDD&lt;/font&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;font color=&quot;orange&quot;&gt;Â·&lt;/font&gt;&lt;/strong&gt; æ— æ ‡å‡†æ•°æ®ç»“æ„&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;font color=&quot;orange&quot;&gt;Â·&lt;/font&gt;&lt;/strong&gt; åˆ†å¸ƒå¼ï¼ˆåˆ†åŒºï¼‰é›†åˆ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;&lt;font color=&quot;orange&quot;&gt;SparkSQL Â· DataFrame&lt;/font&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;font color=&quot;orange&quot;&gt;Â·&lt;/font&gt;&lt;/strong&gt; äºŒç»´è¡¨æ•°æ®ç»“æ„&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;font color=&quot;orange&quot;&gt;Â·&lt;/font&gt;&lt;/strong&gt; åˆ†å¸ƒå¼ï¼ˆåˆ†åŒºï¼‰é›†åˆ&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;SparkSessionå¯¹è±¡&quot;&gt;&lt;a href=&quot;#SparkSessionå¯¹è±¡&quot; class=&quot;headerlink&quot; title=&quot;SparkSessionå¯¹è±¡&quot;&gt;&lt;/a&gt;SparkSessionå¯¹è±¡&lt;/h3&gt;&lt;p&gt;RDDç¨‹åºçš„æ‰§è¡Œå…¥å£å¯¹è±¡ï¼š&lt;strong&gt;SparkContext&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨Spark2.0ä»¥åï¼Œæ¨å‡ºäº†&lt;strong&gt;SparkSession&lt;/strong&gt;å¯¹è±¡ï¼Œæ¥ä½œä¸ºSparkç¼–ç çš„ç»Ÿä¸€å…¥å£å¯¹è±¡ã€‚&lt;strong&gt;SparkSession&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨äºSparkSQLç¼–ç¨‹ï¼Œä½œä¸ºå…¥å£å¯¹è±¡&lt;/li&gt;
&lt;li&gt;ç”¨äºSparkCoreç¼–ç¨‹ï¼Œé€šè¿‡SparkSessionå¯¹è±¡è·å–SparkContext&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ„å»ºSparkSessionå¯¹è±¡ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; pyspark.sql &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; SparkSession&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# é€šè¿‡builderæ–¹æ³•æ¥æ„å»ºSparkSessionå¯¹è±¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# appNameï¼šè®¾ç½®ç¨‹åºåç§°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# configï¼šé…ç½®å¸¸ç”¨å±æ€§&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# getOrCreateï¼šå®Œæˆåˆ›å»ºSparkSessionå¯¹è±¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;spark = SparkSession.builder.appName(&lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt;).master(&lt;span class=&quot;string&quot;&gt;&quot;local[*]&quot;&lt;/span&gt;).config(&lt;span class=&quot;string&quot;&gt;&quot;spark.sql.shuffle.partitions&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;4&quot;&lt;/span&gt;).getOrCreate()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é€šè¿‡SparkSesionå¯¹è±¡è·å–SparkContextå¯¹è±¡ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; pyspark.sql &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; SparkSession&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;spark = SparkSession.builder.appName(&lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt;).master(&lt;span class=&quot;string&quot;&gt;&quot;local[*]&quot;&lt;/span&gt;).config(&lt;span class=&quot;string&quot;&gt;&quot;spark.sql.shuffle.partitions&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;4&quot;&lt;/span&gt;).getOrCreate()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sc = spark.sparkContext&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="BigData" scheme="http://yoursite.com/categories/BigData/"/>
    
    
    <category term="spark" scheme="http://yoursite.com/tags/spark/"/>
    
  </entry>
  
  <entry>
    <title>Spark-Core</title>
    <link href="http://yoursite.com/2022/12/07/Spark-Core/"/>
    <id>http://yoursite.com/2022/12/07/Spark-Core/</id>
    <published>2022-12-07T08:58:49.000Z</published>
    <updated>2022-12-08T09:05:29.171Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><h2 id="å¹¿æ’­å˜é‡"><a href="#å¹¿æ’­å˜é‡" class="headerlink" title="å¹¿æ’­å˜é‡"></a>å¹¿æ’­å˜é‡</h2><p>æœ¬åœ°å¯¹è±¡è¢«å‘é€åˆ°åŒä¸ªExecutorå†…æ¯ä¸ªåˆ†åŒºçš„å¤„ç†çº¿ç¨‹ä¸Šä½¿ç”¨ï¼Œè¿™æ ·æ¯ä¸ªåˆ†åŒºå®é™…ä¸Šå­˜æ”¾äº†é‡å¤çš„æ•°æ®ã€‚è€ŒExecutoræœ¬è´¨ä¸Šæ˜¯è¿›ç¨‹ï¼Œè¿›ç¨‹å†…èµ„æºå…±äº«ï¼Œæ²¡å¿…è¦å°†æœ¬åœ°å¯¹è±¡åˆ†å‘ç»™æ‰€æœ‰åˆ†åŒºï¼Œé€ æˆå†…å­˜æµªè´¹</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå°†æœ¬åœ°å¯¹è±¡è®¾ç½®ä¸ºå¹¿æ’­å˜é‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å°†æœ¬åœ°å¯¹è±¡æ ‡è®°ä¸ºå¹¿æ’­å˜é‡</span></span><br><span class="line">broadcast = sc.broadcast(var)</span><br><span class="line"><span class="comment"># 2.ä½¿ç”¨å¹¿æ’­å˜é‡ï¼Œä»broadcastå¯¹è±¡ä¸­å–å‡ºæœ¬åœ°å¯¹è±¡</span></span><br><span class="line">value = broadcast.value</span><br><span class="line"><span class="comment"># å½“ä¼ è¾“çš„æ˜¯å¹¿æ’­å¯¹è±¡æ—¶ï¼Œsparkä¼šåªç»™æ¯ä¸ªExecutoråˆ†å‘ä¸€ä»½æ•°æ®</span></span><br></pre></td></tr></table></figure><p>å½“æœ¬åœ°é›†åˆå¯¹è±¡å’Œåˆ†å¸ƒå¼é›†åˆå¯¹è±¡ï¼ˆRDDï¼‰è¿›è¡Œå…³è”æ—¶ï¼Œéœ€è¦å°†æœ¬åœ°é›†åˆå¯¹è±¡å°è£…ä¸ºå¹¿æ’­å˜é‡</p><ul><li>èŠ‚çœç½‘ç»œIOæ¬¡æ•°</li><li>é™ä½Executorå†…å­˜å ç”¨</li></ul><h2 id="ç´¯åŠ å™¨"><a href="#ç´¯åŠ å™¨" class="headerlink" title="ç´¯åŠ å™¨"></a>ç´¯åŠ å™¨</h2><p>å½“æ‰§è¡Œç´¯åŠ æ“ä½œæ—¶ï¼Œå„ä¸ªåˆ†åŒºç´¯åŠ è‡ªèº«çš„å†…å®¹</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sparkæä¾›ç´¯åŠ å™¨å˜é‡ï¼Œå‚æ•°æ˜¯åˆå§‹å€¼</span></span><br><span class="line">acmlt = sc.accumulator(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">acmlt = sc.accumulator(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">counts</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> acmlt</span><br><span class="line">    acmlt += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rdd1 = sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="number">3</span>)</span><br><span class="line">rdd2 = rdd1.map(counts)</span><br><span class="line">print(rdd2.collect())</span><br><span class="line">print(acmlt)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1, 2, 3]</span><br><span class="line">3</span><br></pre></td></tr></table></figure><p><font color="gold">æ³¨</font>ï¼šç´¯åŠ å™¨å¯èƒ½å› è¡€ç¼˜å…³ç³»å¯¼è‡´é‡å¤çš„ç´¯åŠ ï¼Œä¾‹å¦‚ä¸€ä¸ªRDDè¢«é‡Šæ”¾åç´¯åŠ å·²ç»å®Œæˆï¼Œæ­¤æ—¶å†ä½¿ç”¨è¯¥RDDå°†ä¼šå¯¼è‡´é‡å¤ç´¯åŠ ã€‚å¯é€šè¿‡cacheç¼“å­˜æœºåˆ¶æ¥è§£å†³</p><a id="more"></a> <h2 id="DAG"><a href="#DAG" class="headerlink" title="DAG"></a>DAG</h2><p>Sparkçš„æ ¸å¿ƒæ˜¯æ ¹æ®RDDæ¥å®ç°çš„ï¼ŒSpark Schedulerï¼ˆsparkä»»åŠ¡è°ƒåº¦ï¼‰æ˜¯sparkæ ¸å¿ƒå®ç°çš„é‡è¦ä¸€ç¯ï¼Œå…¶åŠŸèƒ½æ˜¯ç»„ç»‡å¤„ç†RDDä¸­æ¯ä¸ªåˆ†åŒºçš„æ•°æ®ï¼Œæ ¹æ®RDDçš„ä¾èµ–å…³ç³»æ„å»ºDAGæœ‰å‘æ— ç¯å›¾ï¼Œå†åŸºäºDAGåˆ’åˆ†Stageï¼Œå°†æ¯ä¸ªStageä¸­çš„ä»»åŠ¡å‘é€åˆ°æŒ‡å®šèŠ‚ç‚¹è¿è¡Œï¼Œåˆç†è§„åˆ’èµ„æºçš„åˆ©ç”¨</p><h3 id="DAGæ ‡å‡†å®šä¹‰"><a href="#DAGæ ‡å‡†å®šä¹‰" class="headerlink" title="DAGæ ‡å‡†å®šä¹‰"></a>DAGæ ‡å‡†å®šä¹‰</h3><p>æœ‰å‘æ— ç¯å›¾ï¼šæœ‰æ–¹å‘è€Œæ²¡æœ‰å½¢æˆé—­ç¯çš„æ‰§è¡Œæµç¨‹å›¾</p><ul><li>æœ‰å‘ï¼šå…·æœ‰æ‰§è¡Œæ–¹å‘</li><li>æ— ç¯ï¼šæ²¡æœ‰é—­ç¯</li></ul><h3 id="Actionç®—å­å’ŒJob"><a href="#Actionç®—å­å’ŒJob" class="headerlink" title="Actionç®—å­å’ŒJob"></a>Actionç®—å­å’ŒJob</h3><p>ä¸€ä¸ªActionä¼šäº§ç”Ÿä¸€ä¸ªDAGï¼Œå¦‚æœä»£ç ä¸­å­˜åœ¨3ä¸ªActionåˆ™ä¼šäº§ç”Ÿ3ä¸ªDAGï¼›</p><p>æ¯ä¸ªDAGåœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶äº§ç”Ÿä¸€ä¸ªJobï¼ˆåº”ç”¨ç¨‹åºå†…çš„å­ä»»åŠ¡ï¼‰</p><p><strong><font color="orange">1ä¸ªAction = 1ä¸ªDAG = 1ä¸ªJob</font></strong></p><p>è¿™æ ·çš„ä»£ç è¿è¡Œèµ·æ¥åœ¨sparkä¸­è¢«ç§°ä¸º<strong><font color="orange">Application</font></strong></p><h3 id="DAGå’Œåˆ†åŒº"><a href="#DAGå’Œåˆ†åŒº" class="headerlink" title="DAGå’Œåˆ†åŒº"></a>DAGå’Œåˆ†åŒº</h3><p>DAGçš„æœ€ç»ˆä½œç”¨æ˜¯ä¸ºäº†æ„å»ºsparkè¯¦ç»†æ‰§è¡Œçš„ç‰©ç†è®¡åˆ’ï¼Œç”±äºsparkæ˜¯åˆ†å¸ƒå¼å¤šåˆ†åŒºçš„ï¼Œæ‰€ä»¥DAGå’Œåˆ†åŒºé—´ä¹Ÿå…·æœ‰å…³è”</p><h3 id="DAGçš„å®½çª„ä¾èµ–å’Œé˜¶æ®µåˆ’åˆ†"><a href="#DAGçš„å®½çª„ä¾èµ–å’Œé˜¶æ®µåˆ’åˆ†" class="headerlink" title="DAGçš„å®½çª„ä¾èµ–å’Œé˜¶æ®µåˆ’åˆ†"></a>DAGçš„å®½çª„ä¾èµ–å’Œé˜¶æ®µåˆ’åˆ†</h3><p>åœ¨Spark RDDå‰åä¹‹é—´çš„è¡€ç¼˜å…³ç³»ï¼Œåˆ†ä¸ºï¼š</p><ul><li>çª„ä¾èµ–ï¼šçˆ¶RDDçš„ä¸€ä¸ªåˆ†åŒºï¼Œå°†å…¨éƒ¨æ•°æ®å‘é€ç»™å­RDDçš„ä¸€ä¸ªåˆ†åŒºï¼›</li><li>å®½ä¾èµ–ï¼šçˆ¶RDDçš„ä¸€ä¸ªåˆ†åŒºï¼Œå°†æ•°æ®å‘é€ç»™å­RDDçš„å¤šä¸ªåˆ†åŒºï¼Œåˆ«åï¼šshuffle</li></ul><p>å¯¹äºsparkï¼Œä¼šæ ¹æ®DAGï¼ŒæŒ‰ç…§å®½ä¾èµ–åˆ’åˆ†ä¸åŒçš„DAGé˜¶æ®µã€‚åˆ’åˆ†ä¾æ®ï¼šä»åå‘å‰ï¼Œæ¯é‡åˆ°å®½ä¾èµ–å°±åˆ’åˆ†å‡ºä¸€ä¸ªé˜¶æ®µï¼Œç§°ä¹‹ä¸ºstageã€‚åœ¨stageå†…éƒ¨ï¼Œä¸€å®šæ˜¯çª„ä¾èµ–</p><p><img src="/2022/12/07/Spark-Core/A.png" alt></p><h2 id="Sparkçš„å†…å­˜è¿­ä»£è®¡ç®—"><a href="#Sparkçš„å†…å­˜è¿­ä»£è®¡ç®—" class="headerlink" title="Sparkçš„å†…å­˜è¿­ä»£è®¡ç®—"></a>Sparkçš„å†…å­˜è¿­ä»£è®¡ç®—</h2><p>çª„ä¾èµ–åŒä¸€çº¿ç¨‹å†…èµ°ç®¡é“äº¤äº’ï¼Œè¿›å…¥å®½ä¾èµ–èµ°ç½‘ç»œIOäº¤äº’</p><p>Sparké»˜è®¤æ”¶åˆ°å…¨å±€å¹¶è¡Œåº¦çš„é™åˆ¶ï¼Œé™¤äº†ä¸ªåˆ«ç®—å­æœ‰ç‰¹æ®Šåˆ†åŒºçš„æƒ…å†µï¼Œå¤§éƒ¨åˆ†ç®—å­éƒ½ä¼šéµå¾ªå…¨å±€å¹¶è¡Œåº¦çš„è¦æ±‚æ¥åˆ’åˆ†è‡ªå·±çš„åˆ†åŒºæ•°ã€‚ä¾‹å¦‚å…¨å±€å¹¶è¡Œåº¦æ˜¯3ï¼Œå¤§éƒ¨åˆ†ç®—å­çš„é»˜è®¤åˆ†åŒºéƒ½æ˜¯3-&gt;ä¸å»ºè®®å†ç‹¬ç«‹é€šè¿‡argæ¥æŒ‡å®šåˆ†åŒºæ•°</p><h2 id="Sparkå¹¶è¡Œåº¦"><a href="#Sparkå¹¶è¡Œåº¦" class="headerlink" title="Sparkå¹¶è¡Œåº¦"></a>Sparkå¹¶è¡Œåº¦</h2><p>Sparkçš„å¹¶è¡Œï¼šåœ¨åŒä¸€æ—¶é—´å†…ï¼Œæœ‰å¤šå°‘taskåœ¨åŒæ—¶è¿è¡Œ</p><p>Sparkçš„å¹¶è¡Œåº¦ï¼šå¹¶è¡Œèƒ½åŠ›ï¼Œå½“è®¾ç½®ä¸º6ï¼Œå³å…±æœ‰6ä¸ªtaskåœ¨å¹¶è¡Œè¿è¡Œï¼ŒRDDçš„åˆ†åŒºè¢«è§„åˆ’ä¸º6ä¸ªåˆ†åŒº</p><p>Sparkå¹¶è¡Œåº¦è®¾ç½®ï¼ˆä¼˜å…ˆçº§ç”±é«˜åˆ°ä½ï¼‰ï¼š</p><ul><li>ä»£ç </li><li>å®¢æˆ·ç«¯å‚æ•°</li><li>é…ç½®æ–‡ä»¶</li><li>é»˜è®¤å€¼ï¼ˆ1ï¼‰ï¼Œå¹¶ä¸ä¼šå…¨éƒ¨ä»¥1æ¥è¿è¡Œï¼Œå¤šæ•°æƒ…å†µä¸‹åŸºäºè¯»å–æ–‡ä»¶çš„åˆ†ç‰‡æ•°é‡æ¥ä½œä¸ºé»˜è®¤å¹¶è¡Œåº¦</li></ul><p>å…¨å±€å¹¶è¡Œåº¦é…ç½®å‚æ•°ï¼š</p><p><code>spark.default.parallelism</code></p><ul><li>ä»£ç ä¸­è®¾ç½®ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conf = SparkConf()</span><br><span class="line">conf.set(<span class="string">"spark.default.parallelism"</span>, <span class="string">"100"</span>)</span><br></pre></td></tr></table></figure><ul><li><p>å®¢æˆ·ç«¯æäº¤å‚æ•°ä¸­è®¾ç½®<code>bin/spark-submit --conf &quot;spark.default.parallelism=100&quot;</code></p></li><li><p>é…ç½®æ–‡ä»¶<font color="#008080">conf/spark-defaults.conf</font>ä¸­è®¾ç½®<code>spark.default.parallelism 100</code></p></li></ul><p><font color="gold">æ³¨</font>ï¼šå…¨å±€å¹¶è¡Œåº¦æ˜¯æ¨èè®¾ç½®ï¼Œä¸è¦é’ˆå¯¹RDDæ›´æ”¹åˆ†åŒºï¼Œå¯èƒ½ä¼šå½±å“å†…å­˜è¿­ä»£ç®¡é“çš„æ„å»ºï¼Œæˆ–è€…äº§ç”Ÿé¢å¤–çš„shuffle</p><p>é’ˆå¯¹RDDå¹¶è¡Œåº¦çš„è®¾ç½®ï¼ˆä¸æ¨èï¼‰ï¼š</p><p><strong><font color="orange">Â·</font></strong> repartitionç®—å­</p><p><strong><font color="orange">Â·</font></strong> coalesceç®—å­</p><p><strong><font color="orange">Â·</font></strong> partitionByç®—å­</p><h3 id="è§„åˆ’Sparké›†ç¾¤å¹¶è¡Œåº¦"><a href="#è§„åˆ’Sparké›†ç¾¤å¹¶è¡Œåº¦" class="headerlink" title="è§„åˆ’Sparké›†ç¾¤å¹¶è¡Œåº¦"></a>è§„åˆ’Sparké›†ç¾¤å¹¶è¡Œåº¦</h3><p>è®¾ç½®ä¸ºCPUæ€»æ ¸å¿ƒçš„<strong><font color="orange">2~10å€</font></strong>ï¼ˆæˆ–æ›´é«˜ï¼‰* </p><p>æ¯”å¦‚é›†ç¾¤å¯ç”¨çš„CPUæ ¸å¿ƒæ•°é‡ä¸º100ä¸ªï¼Œå»ºè®®å¹¶è¡Œåº¦200~1000ï¼ˆç¡®ä¿æ˜¯CPUæ ¸å¿ƒçš„æ•´æ•°å€ï¼‰</p><ul><li><p>è®¾ç½®ä¸ºæœ€å°‘2å€ï¼š</p><p>CPUçš„ä¸€ä¸ªæ ¸å¿ƒåŒä¸€æ—¶é—´åªèƒ½åšä¸€ä»¶äº‹ï¼Œå½“æ‹¥æœ‰100ä¸ªæ ¸å¿ƒçš„æƒ…å†µä¸‹ï¼Œè®¾ç½®100å¹¶è¡Œåº¦ï¼Œèƒ½åˆ©ç”¨å…¨éƒ¨çš„CPUï¼Œä½†taskçš„å‹åŠ›ä¸å‡è¡¡ï¼Œä¸€æ—¦æŸä¸ªtaskå…ˆæ‰§è¡Œå®Œæ¯•ï¼Œä¼šå¯¼è‡´æŸä¸ªCPUæ ¸å¿ƒçš„ç©ºé—²ã€‚æ‰€ä»¥å°†taskå¹¶è¡Œåˆ†é…çš„æ•°é‡å¢å¤šï¼Œä¾‹å¦‚è®¾ç½®1000å¹¶è¡Œåº¦ï¼ŒåŒä¸€æ—¶é—´å†…æœ‰100ä¸ªtaskåœ¨è¿è¡Œï¼Œ900ä¸ªåœ¨ç­‰å¾…ï¼Œä½†å¯ä»¥ç¡®ä¿æŸä¸ªtaskè¿è¡Œå®Œæ¯•åä¼šä¸æ–­æœ‰taskè¡¥ä¸Šï¼Œä¸è®©CPUå¤„äºç©ºé—²çŠ¶æ€ï¼Œæœ€å¤§ç¨‹åº¦åˆ©ç”¨é›†ç¾¤çš„èµ„æº</p></li></ul><h2 id="Sparkä»»åŠ¡è°ƒåº¦"><a href="#Sparkä»»åŠ¡è°ƒåº¦" class="headerlink" title="Sparkä»»åŠ¡è°ƒåº¦"></a>Sparkä»»åŠ¡è°ƒåº¦</h2><h3 id="Sparkä»»åŠ¡ç”±Driverè¿›è¡Œè°ƒåº¦"><a href="#Sparkä»»åŠ¡ç”±Driverè¿›è¡Œè°ƒåº¦" class="headerlink" title="Sparkä»»åŠ¡ç”±Driverè¿›è¡Œè°ƒåº¦"></a>Sparkä»»åŠ¡ç”±Driverè¿›è¡Œè°ƒåº¦</h3><p>åŒ…æ‹¬ï¼š</p><ul><li>é€»è¾‘DAGäº§ç”Ÿ</li><li>åˆ†åŒºDAGäº§ç”Ÿ</li><li>åŸºäºåˆ†åŒºDAGæ„å»ºçº¿ç¨‹taskå¹¶åˆ’åˆ†</li><li>å°†taskåˆ†é…ç»™Executorå¹¶ç›‘æ§å…¶å·¥ä½œ</li></ul><h3 id="Sparkç¨‹åºè°ƒåº¦æµç¨‹"><a href="#Sparkç¨‹åºè°ƒåº¦æµç¨‹" class="headerlink" title="Sparkç¨‹åºè°ƒåº¦æµç¨‹"></a>Sparkç¨‹åºè°ƒåº¦æµç¨‹</h3><ul><li>æ„å»ºDriverï¼ˆ<font color="orange">Driver</font>ï¼‰</li><li>æ„å»ºSparkContextæ‰§è¡Œç¯å¢ƒå…¥å£å¯¹è±¡ï¼ˆ<font color="orange">Driver</font>ï¼‰</li><li>åŸºäºDAG schedulerè°ƒåº¦å™¨æ„å»ºé€»è¾‘taskåˆ†é…ï¼ˆ<font color="orange">Driver</font>ï¼‰</li><li>åŸºäºtask schedulerè°ƒåº¦å™¨å°†é€»è¾‘taskåˆ†é…åˆ°å„ä¸ªExecutorä¸Šæ‰§è¡Œå¹¶ç›‘æ§ï¼ˆ<font color="orange">Driver</font>ï¼‰</li><li>Workerï¼ˆExecutorï¼‰è¢«task schedulerç®¡ç†ç›‘æ§ï¼Œéµä»æŒ‡ä»¤å¹²æ´»å¹¶æ±‡æŠ¥è¿›åº¦ï¼ˆ<font color="orange">Worker</font>ï¼‰</li></ul><h3 id="Driverå†…éƒ¨ç»„ä»¶"><a href="#Driverå†…éƒ¨ç»„ä»¶" class="headerlink" title="Driverå†…éƒ¨ç»„ä»¶"></a>Driverå†…éƒ¨ç»„ä»¶</h3><ul><li><p><strong>DAGè°ƒåº¦å™¨</strong></p><p>å°†é€»è¾‘DAGè¿›è¡Œå¤„ç†ï¼Œæœ€ç»ˆå¾—åˆ°é€»è¾‘ä¸Šçš„taskåˆ’åˆ†</p></li><li><p><strong>Taskè°ƒåº¦å™¨</strong></p><p>åŸºäºDAGè°ƒåº¦å™¨çš„äº§å‡ºï¼Œæ¥è§„åˆ’è¿™äº›é€»è¾‘çš„taskåº”è¯¥åœ¨å“ªäº›ç‰©ç†çš„Executorä¸Šè¿è¡Œï¼Œä»¥åŠç›‘æ§å®ƒä»¬</p></li></ul><h3 id="å±‚çº§å…³ç³»æ¢³ç†"><a href="#å±‚çº§å…³ç³»æ¢³ç†" class="headerlink" title="å±‚çº§å…³ç³»æ¢³ç†"></a>å±‚çº§å…³ç³»æ¢³ç†</h3><ul><li>1ä¸ªsparkç¯å¢ƒå¯è¿è¡Œå¤šä¸ªApplicationï¼›</li><li>1ä¸ªä»£ç æˆåŠŸè¿è¡Œç”Ÿæˆä¸€ä¸ªApplicationï¼›</li><li>1ä¸ªApplicationå†…éƒ¨æœ‰å¤šä¸ªJobï¼›</li><li>1ä¸ªActionç®—å­äº§ç”Ÿ1ä¸ªJobï¼Œæ¯ä¸ªJobæœ‰è‡ªå·±çš„DAGæ‰§è¡Œå›¾ï¼›</li><li>1ä¸ªJobçš„DAGåŸºäºå®½çª„ä¾èµ–åˆ’åˆ†ä¸åŒçš„é˜¶æ®µï¼›</li><li>1ä¸ªé˜¶æ®µé‡ŒåŸºäºåˆ†åŒºæ•°é‡å½¢æˆå¤šä¸ªå¹¶è¡Œçš„å†…å­˜è¿­ä»£ç®¡é“ï¼›</li><li>1ä¸ªå†…å­˜è¿­ä»£ç®¡é“å½¢æˆ1ä¸ªtaskï¼ˆDAGè°ƒåº¦å™¨åˆ’åˆ†å°†Jobå†…åˆ’åˆ†å‡ºå…·ä½“çš„taskä»»åŠ¡ï¼Œ1ä¸ªJobè¢«åˆ’åˆ†å‡ºçš„taskåœ¨é€»è¾‘ä¸Šè¢«ç§°ä¸ºè¿™ä¸ªjobçš„tasksetï¼‰</li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å¹¿æ’­å˜é‡&quot;&gt;&lt;a href=&quot;#å¹¿æ’­å˜é‡&quot; class=&quot;headerlink&quot; title=&quot;å¹¿æ’­å˜é‡&quot;&gt;&lt;/a&gt;å¹¿æ’­å˜é‡&lt;/h2&gt;&lt;p&gt;æœ¬åœ°å¯¹è±¡è¢«å‘é€åˆ°åŒä¸ªExecutorå†…æ¯ä¸ªåˆ†åŒºçš„å¤„ç†çº¿ç¨‹ä¸Šä½¿ç”¨ï¼Œè¿™æ ·æ¯ä¸ªåˆ†åŒºå®é™…ä¸Šå­˜æ”¾äº†é‡å¤çš„æ•°æ®ã€‚è€ŒExecutoræœ¬è´¨ä¸Šæ˜¯è¿›ç¨‹ï¼Œè¿›ç¨‹å†…èµ„æºå…±äº«ï¼Œæ²¡å¿…è¦å°†æœ¬åœ°å¯¹è±¡åˆ†å‘ç»™æ‰€æœ‰åˆ†åŒºï¼Œé€ æˆå†…å­˜æµªè´¹&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼šå°†æœ¬åœ°å¯¹è±¡è®¾ç½®ä¸ºå¹¿æ’­å˜é‡&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 1.å°†æœ¬åœ°å¯¹è±¡æ ‡è®°ä¸ºå¹¿æ’­å˜é‡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;broadcast = sc.broadcast(var)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 2.ä½¿ç”¨å¹¿æ’­å˜é‡ï¼Œä»broadcastå¯¹è±¡ä¸­å–å‡ºæœ¬åœ°å¯¹è±¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;value = broadcast.value&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# å½“ä¼ è¾“çš„æ˜¯å¹¿æ’­å¯¹è±¡æ—¶ï¼Œsparkä¼šåªç»™æ¯ä¸ªExecutoråˆ†å‘ä¸€ä»½æ•°æ®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å½“æœ¬åœ°é›†åˆå¯¹è±¡å’Œåˆ†å¸ƒå¼é›†åˆå¯¹è±¡ï¼ˆRDDï¼‰è¿›è¡Œå…³è”æ—¶ï¼Œéœ€è¦å°†æœ¬åœ°é›†åˆå¯¹è±¡å°è£…ä¸ºå¹¿æ’­å˜é‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èŠ‚çœç½‘ç»œIOæ¬¡æ•°&lt;/li&gt;
&lt;li&gt;é™ä½Executorå†…å­˜å ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;ç´¯åŠ å™¨&quot;&gt;&lt;a href=&quot;#ç´¯åŠ å™¨&quot; class=&quot;headerlink&quot; title=&quot;ç´¯åŠ å™¨&quot;&gt;&lt;/a&gt;ç´¯åŠ å™¨&lt;/h2&gt;&lt;p&gt;å½“æ‰§è¡Œç´¯åŠ æ“ä½œæ—¶ï¼Œå„ä¸ªåˆ†åŒºç´¯åŠ è‡ªèº«çš„å†…å®¹&lt;/p&gt;
 &lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# sparkæä¾›ç´¯åŠ å™¨å˜é‡ï¼Œå‚æ•°æ˜¯åˆå§‹å€¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;acmlt = sc.accumulator(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;e.g.&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; pyspark &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; SparkConf, SparkContext&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;conf = SparkConf().setAppName(&lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt;).setMaster(&lt;span class=&quot;string&quot;&gt;&quot;local[*]&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sc = SparkContext(conf=conf)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;acmlt = sc.accumulator(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;counts&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(data)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;global&lt;/span&gt; acmlt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    acmlt += &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; data&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rdd1 = sc.parallelize([&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;], &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rdd2 = rdd1.map(counts)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(rdd2.collect())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(acmlt)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[1, 2, 3]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;font color=&quot;gold&quot;&gt;æ³¨&lt;/font&gt;ï¼šç´¯åŠ å™¨å¯èƒ½å› è¡€ç¼˜å…³ç³»å¯¼è‡´é‡å¤çš„ç´¯åŠ ï¼Œä¾‹å¦‚ä¸€ä¸ªRDDè¢«é‡Šæ”¾åç´¯åŠ å·²ç»å®Œæˆï¼Œæ­¤æ—¶å†ä½¿ç”¨è¯¥RDDå°†ä¼šå¯¼è‡´é‡å¤ç´¯åŠ ã€‚å¯é€šè¿‡cacheç¼“å­˜æœºåˆ¶æ¥è§£å†³&lt;/p&gt;</summary>
    
    
    
    <category term="BigData" scheme="http://yoursite.com/categories/BigData/"/>
    
    
    <category term="spark" scheme="http://yoursite.com/tags/spark/"/>
    
  </entry>
  
  <entry>
    <title>Pyspark-RDD</title>
    <link href="http://yoursite.com/2022/12/07/Pyspark-RDD/"/>
    <id>http://yoursite.com/2022/12/07/Pyspark-RDD/</id>
    <published>2022-12-07T05:45:49.000Z</published>
    <updated>2022-12-08T06:09:52.881Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><h2 id="RDD"><a href="#RDD" class="headerlink" title="RDD"></a>RDD</h2><p>RDDï¼ˆResilient Distributed Datasetï¼‰å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œæ˜¯sparkä¸­æœ€åŸºæœ¬çš„æ•°æ®æŠ½è±¡ï¼Œä»£è¡¨ä¸€ä¸ªä¸å¯å˜ã€å¯åˆ†åŒºã€å…¶ä¸­å…ƒç´ å¯å¹¶è¡Œè®¡ç®—çš„é›†åˆ</p><ul><li>Resilientï¼šRDDä¸­çš„æ•°æ®å¯å­˜å‚¨å†å†…å­˜æˆ–ç£ç›˜ä¸­</li><li>Distributedï¼šåˆ†å¸ƒå¼å­˜å‚¨æ•°æ®ï¼ˆè·¨æœºå™¨/è·¨è¿›ç¨‹ï¼‰ï¼Œç”¨äºåˆ†å¸ƒå¼è®¡ç®—</li><li>Datasetï¼šä¸€ä¸ªç”¨äºå­˜æ”¾æ•°æ®çš„æ•°æ®é›†åˆ</li></ul><h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h3><h4 id="åˆ†åŒº"><a href="#åˆ†åŒº" class="headerlink" title="åˆ†åŒº"></a>åˆ†åŒº</h4><p>RDDåˆ†åŒºæ˜¯RDDæ•°æ®å­˜å‚¨çš„æœ€å°å•ä½ï¼Œä¸€ä»½RDDæ•°æ®æœ¬è´¨ä¸Šåˆ†éš”æˆäº†å¤šä¸ªåˆ†åŒº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å­˜å‚¨9ä¸ªæ•°å­—ï¼Œè®¾ç«‹ä¸‰ä¸ªåˆ†åŒº</span></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>], <span class="number">3</span>)</span><br><span class="line">rdd.glom().collect()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[1,2,3],[4,5,6],[7,8,9]]</span><br></pre></td></tr></table></figure><h4 id="RDDæ–¹æ³•ä¼šä½œç”¨åœ¨å…¶æ‰€æœ‰æ–¹æ³•ä¸Š"><a href="#RDDæ–¹æ³•ä¼šä½œç”¨åœ¨å…¶æ‰€æœ‰æ–¹æ³•ä¸Š" class="headerlink" title="RDDæ–¹æ³•ä¼šä½œç”¨åœ¨å…¶æ‰€æœ‰æ–¹æ³•ä¸Š"></a>RDDæ–¹æ³•ä¼šä½œç”¨åœ¨å…¶æ‰€æœ‰æ–¹æ³•ä¸Š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd.map(<span class="keyword">lambda</span> x: x * <span class="number">10</span>).collect()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[10,20,30,40,50,60,70,80,90]</span><br></pre></td></tr></table></figure><h4 id="RDDä¹‹é—´å…·æœ‰ä¾èµ–å…³ç³»"><a href="#RDDä¹‹é—´å…·æœ‰ä¾èµ–å…³ç³»" class="headerlink" title="RDDä¹‹é—´å…·æœ‰ä¾èµ–å…³ç³»"></a>RDDä¹‹é—´å…·æœ‰ä¾èµ–å…³ç³»</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line">rdd1 = sc.textFile(<span class="string">"../test.text"</span>)</span><br><span class="line">rdd2 = rdd1.flatMap(<span class="keyword">lambda</span> x: x.split(<span class="string">' '</span>))</span><br><span class="line">rdd3 = rdd2.map(<span class="keyword">lambda</span> x: (x, <span class="number">1</span>))</span><br><span class="line">rdd4 = rdd3.reduceByKey(<span class="keyword">lambda</span> a, b: a+b)</span><br><span class="line">print(rdd4.collect())</span><br></pre></td></tr></table></figure><h4 id="Key-Valueå‹RDDå¯ä»¥æœ‰åˆ†åŒºå™¨"><a href="#Key-Valueå‹RDDå¯ä»¥æœ‰åˆ†åŒºå™¨" class="headerlink" title="Key-Valueå‹RDDå¯ä»¥æœ‰åˆ†åŒºå™¨"></a>Key-Valueå‹RDDå¯ä»¥æœ‰åˆ†åŒºå™¨</h4><p>KVå‹RDDï¼šRDDå†…å­˜å‚¨çš„æ•°æ®æ˜¯åªæœ‰ä¸¤ä¸ªå…ƒç´ çš„äºŒå…ƒå…ƒç»„</p><p>é»˜è®¤åˆ†åŒºå™¨ï¼šHashåˆ†åŒºè§„åˆ™ï¼Œä¹Ÿå¯æ‰‹åŠ¨è®¾ç½®åˆ†åŒºå™¨ï¼šrdd.partitionBy()æ–¹æ³•</p><p><font color="gold">æ³¨</font>ï¼šä¸æ˜¯æ‰€æœ‰RDDéƒ½æ˜¯KVå‹</p><h4 id="RDDçš„åˆ†åŒºè§„åˆ’ï¼šä¼šå°½é‡é è¿‘æ•°æ®æ‰€åœ¨çš„æœåŠ¡å™¨"><a href="#RDDçš„åˆ†åŒºè§„åˆ’ï¼šä¼šå°½é‡é è¿‘æ•°æ®æ‰€åœ¨çš„æœåŠ¡å™¨" class="headerlink" title="RDDçš„åˆ†åŒºè§„åˆ’ï¼šä¼šå°½é‡é è¿‘æ•°æ®æ‰€åœ¨çš„æœåŠ¡å™¨"></a>RDDçš„åˆ†åŒºè§„åˆ’ï¼šä¼šå°½é‡é è¿‘æ•°æ®æ‰€åœ¨çš„æœåŠ¡å™¨</h4><p>åœ¨åˆå§‹RDDè¯»å–æ•°æ®è§„åˆ’é˜¶æ®µï¼Œåˆ†åŒºä¼šå°½é‡è§„åˆ’åˆ°å­˜å‚¨æ•°æ®æ‰€åœ¨æœåŠ¡å™¨ï¼Œç›´æ¥è¯»å–æœ¬åœ°æ•°æ®ï¼Œé¿å…ä»ç½‘ç»œè¯»å–æ•°æ®</p><p>Sparkä¼šåœ¨ç¡®ä¿å¹¶è¡Œè®¡ç®—èƒ½åŠ›çš„å‰æä¸‹ï¼Œå°½é‡ç¡®ä¿æœ¬åœ°è¯»å–</p><h3 id="RDDåˆ›å»º"><a href="#RDDåˆ›å»º" class="headerlink" title="RDDåˆ›å»º"></a>RDDåˆ›å»º</h3><ul><li>é€šè¿‡å¹¶è¡ŒåŒ–é›†åˆåˆ›å»ºï¼ˆæœ¬åœ°å¯¹è±¡è½¬åŒ–ä¸ºåˆ†å¸ƒå¼RDDï¼‰</li><li>è¯»å–å¤–éƒ¨æ•°æ®æºï¼ˆè¯»æ–‡ä»¶ï¼‰</li></ul><h4 id="å¹¶è¡ŒåŒ–åˆ›å»º"><a href="#å¹¶è¡ŒåŒ–åˆ›å»º" class="headerlink" title="å¹¶è¡ŒåŒ–åˆ›å»º"></a>å¹¶è¡ŒåŒ–åˆ›å»º</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># arg1: é›†åˆå¯¹è±¡ï¼Œå¦‚ï¼šlist</span></span><br><span class="line"><span class="comment"># arg2ï¼šå¯é€‰ï¼ŒæŒ‡å®šåˆ†åŒºæ•°é‡</span></span><br><span class="line">rdd = SparkContext.parallelize(arg1, arg2)</span><br></pre></td></tr></table></figure><h4 id="è¯»å–æ–‡ä»¶"><a href="#è¯»å–æ–‡ä»¶" class="headerlink" title="è¯»å–æ–‡ä»¶"></a>è¯»å–æ–‡ä»¶</h4><p>é€šè¿‡textFile APIæ¥è¯»å–æœ¬åœ°æˆ–è€…hdfsçš„æ•°æ®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># arg1: æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment"># arg2ï¼šå¯é€‰ï¼Œæœ€å°åˆ†åŒºæ•°é‡</span></span><br><span class="line"><span class="comment"># å½“arg2è¶…å‡ºsparkå…è®¸èŒƒå›´ï¼Œå‚æ•°å¤±æ•ˆ</span></span><br><span class="line">SparkContext.textFile(arg1, arg2)</span><br></pre></td></tr></table></figure><p>é€šè¿‡wholeTextFile APIæ¥è¯»å–å°æ–‡ä»¶ï¼Œè¿™ä¸ªapiåå‘äºå°‘é‡åˆ†åŒºè¯»å–æ•°æ®ï¼Œæ˜¯pysparkåŸºäºå°æ–‡ä»¶çš„ä¼˜åŒ–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># arg1ï¼šæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment"># arg2ï¼šå¯é€‰ï¼Œæœ€å°åˆ†åŒºæ•°é‡</span></span><br><span class="line"><span class="comment"># å½“arg2è¶…å‡ºsparkå…è®¸èŒƒå›´ï¼Œå‚æ•°å¤±æ•ˆ</span></span><br><span class="line">SparkContext.wholeTextFiles(arg1, arg2)</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="RDDç®—å­"><a href="#RDDç®—å­" class="headerlink" title="RDDç®—å­"></a>RDDç®—å­</h3><p>æ–¹æ³•ã€å‡½æ•°ï¼šæœ¬åœ°å¯¹è±¡çš„API</p><p>ç®—å­ï¼šåˆ†å¸ƒå¼é›†åˆå¯¹è±¡çš„API</p><p>RDDçš„ç®—å­åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li><p>Transformationï¼šè½¬æ¢ç®—å­</p><p>è¿”å›å€¼ä»æ—§æ˜¯RDDçš„ç®—å­ï¼Œæ„å»ºæ‰§è¡Œè®¡åˆ’</p></li><li><p>Actionï¼šè¡ŒåŠ¨ç®—å­</p><p>è¿”å›å€¼ä¸å†æ˜¯RDDï¼Œä½¿æ‰§è¡Œè®¡åˆ’å¼€å§‹å·¥ä½œ</p></li></ul><h3 id="Transformationç®—å­"><a href="#Transformationç®—å­" class="headerlink" title="Transformationç®—å­"></a>Transformationç®—å­</h3><h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><p>å°†RDDçš„æ•°æ®ä¸€æ¡æ¡å¤„ç†ï¼ˆå¤„ç†é€»è¾‘åŸºäºmapç®—å­æ¥æ”¶çš„å¤„ç†å‡½æ•°ï¼‰ï¼Œè¿”å›æ–°çš„RDD</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd.map(func)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"TEST"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> data * <span class="number">10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(rdd.map(add).collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[10, 20, 30, 40, 50, 60]</span><br></pre></td></tr></table></figure><h4 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h4><p>å¯¹RDDæ‰§è¡Œmapæ“ä½œï¼Œæ¥ç€è¿›è¡Œè§£é™¤åµŒå¥—ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åµŒå¥—</span></span><br><span class="line">lst = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]]</span><br><span class="line"><span class="comment"># è§£é™¤åµŒå¥—</span></span><br><span class="line">lst = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="string">"hadoop spark hadoop"</span>, <span class="string">"spark hadoop hadoop"</span>, <span class="string">"hadoop flink spark"</span>])</span><br><span class="line"><span class="comment"># å¾—åˆ°æ‰€æœ‰çš„å•è¯, ç»„æˆRDD, flatMapçš„ä¼ å…¥å‚æ•° å’Œmapä¸€è‡´, å°±æ˜¯ç»™mapé€»è¾‘ç”¨çš„, è§£é™¤åµŒå¥—æ— éœ€é€»è¾‘(ä¼ å‚)</span></span><br><span class="line">rdd2 = rdd.flatMap(<span class="keyword">lambda</span> line: line.split(<span class="string">" "</span>))</span><br><span class="line">print(rdd2.collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&apos;hadoop&apos;, &apos;spark&apos;, &apos;hadoop&apos;, &apos;spark&apos;, &apos;hadoop&apos;, &apos;hadoop&apos;, &apos;hadoop&apos;, &apos;flink&apos;, &apos;spark&apos;]</span><br></pre></td></tr></table></figure><h4 id="reduceByKey"><a href="#reduceByKey" class="headerlink" title="reduceByKey"></a>reduceByKey</h4><p>é’ˆå¯¹KVå‹RDDè‡ªåŠ¨æŒ‰ç…§keyè¿›è¡Œåˆ†ç»„ï¼Œç„¶åæ ¹æ®æä¾›çš„èšåˆé€»è¾‘å®Œæˆç»„å†…æ•°æ®ï¼ˆvalueï¼‰èšåˆæ“ä½œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¥å—ä¸¤ä¸ªç±»å‹ä¸€è‡´çš„ä¼ å…¥å‚æ•°ï¼Œè¿”å›èšåˆå€¼</span></span><br><span class="line">rdd.reduceByKey(func)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([(<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">1</span>), (<span class="string">'a'</span>, <span class="number">1</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment"># reduceByKey å¯¹ç›¸åŒkey çš„æ•°æ®æ‰§è¡Œèšåˆç›¸åŠ </span></span><br><span class="line">print(rdd.reduceByKey(<span class="keyword">lambda</span> a, b: a + b).collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[(&apos;b&apos;, 2), (&apos;a&apos;, 3)]</span><br></pre></td></tr></table></figure><h4 id="mapValues"><a href="#mapValues" class="headerlink" title="mapValues"></a>mapValues</h4><p>é’ˆå¯¹äºŒå…ƒå…ƒç»„RDDï¼Œå¯¹å…¶å†…éƒ¨çš„äºŒå…ƒå…ƒç»„valueå€¼è¿›è¡Œmap</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¼ å…¥äºŒå…ƒå…ƒç»„çš„valueå€¼ï¼Œfuncåªå¯¹valueè¿›è¡Œå¤„ç†</span></span><br><span class="line">rdd.mapValues(func)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([(<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">1</span>), (<span class="string">'a'</span>, <span class="number">1</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment"># reduceByKey å¯¹ç›¸åŒkey çš„æ•°æ®æ‰§è¡Œèšåˆç›¸åŠ </span></span><br><span class="line">print(rdd.mapValues(<span class="keyword">lambda</span> x: x * <span class="number">10</span>).collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[(&apos;a&apos;, 10), (&apos;a&apos;, 10), (&apos;b&apos;, 10), (&apos;b&apos;, 10), (&apos;a&apos;, 10)]</span><br></pre></td></tr></table></figure><h4 id="groupBy"><a href="#groupBy" class="headerlink" title="groupBy"></a>groupBy</h4><p>å°†RDDçš„æ•°æ®è¿›è¡Œåˆ†ç»„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># funcè¦æ±‚ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå€¼ï¼Œç±»å‹ä¸åšè¦æ±‚ã€‚ç›¸åŒçš„è¿”å›å€¼å°†è¢«æ”¾å…¥åŒä¸€ä¸ªç»„ä¸­ã€‚</span></span><br><span class="line"><span class="comment"># åˆ†ç»„å®Œæˆåï¼Œæ¯ä¸€ä¸ªç»„æ˜¯ä¸€ä¸ªäºŒå…ƒå…ƒç»„ï¼Œkeyå°±æ˜¯è¿”å›å€¼ï¼Œæ‰€æœ‰åŒç»„æ•°æ®æ”¾å…¥ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ä¸­ä½œä¸ºvalue</span></span><br><span class="line">rdd.groupBy(func)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([(<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">2</span>), (<span class="string">'b'</span>, <span class="number">3</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡groupByå¯¹æ•°æ®è¿›è¡Œåˆ†ç»„</span></span><br><span class="line"><span class="comment"># groupByä¼ å…¥çš„å‡½æ•°çš„ æ„æ€æ˜¯: é€šè¿‡è¿™ä¸ªå‡½æ•°, ç¡®å®šæŒ‰ç…§è°æ¥åˆ†ç»„(è¿”å›è°å³å¯)</span></span><br><span class="line"><span class="comment"># åˆ†ç»„è§„åˆ™ å’ŒSQLæ˜¯ä¸€è‡´çš„, ä¹Ÿå°±æ˜¯ç›¸åŒçš„åœ¨ä¸€ä¸ªç»„(Hashåˆ†ç»„)</span></span><br><span class="line">result = rdd.groupBy(<span class="keyword">lambda</span> t: t[<span class="number">0</span>])</span><br><span class="line">print(result.map(<span class="keyword">lambda</span> t:(t[<span class="number">0</span>], list(t[<span class="number">1</span>]))).collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[(&apos;b&apos;, [(&apos;b&apos;, 1), (&apos;b&apos;, 2), (&apos;b&apos;, 3)]), (&apos;a&apos;, [(&apos;a&apos;, 1), (&apos;a&apos;, 1)])]</span><br></pre></td></tr></table></figure><h4 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h4><p>è¿‡æ»¤æ•°æ®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># funcè¿”å›å€¼ä¸ºTrueçš„å‚æ•°ä¿ç•™ï¼ŒFalseä¸¢å¼ƒ</span></span><br><span class="line">rdd.filter(func)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡Filterç®—å­, è¿‡æ»¤å¥‡æ•°</span></span><br><span class="line">result = rdd.filter(<span class="keyword">lambda</span> x: x % <span class="number">2</span> == <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">print(result.collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1, 3, 5]</span><br></pre></td></tr></table></figure><h4 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h4><p>å¯¹RDDæ•°æ®è¿›è¡Œå»é‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># argï¼šå»é‡åˆ†åŒºæ•°é‡ï¼Œä¸€èˆ¬çœç•¥</span></span><br><span class="line">rdd.distinct(arg)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># distinct è¿›è¡ŒRDDæ•°æ®å»é‡æ“ä½œ</span></span><br><span class="line">print(rdd.distinct().collect())</span><br><span class="line"></span><br><span class="line">rdd2 = sc.parallelize([(<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'a'</span>, <span class="number">3</span>)])</span><br><span class="line">print(rdd2.distinct().collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[2, 1, 3]</span><br><span class="line">[(&apos;a&apos;, 1), (&apos;a&apos;, 3)]</span><br></pre></td></tr></table></figure><h4 id="union"><a href="#union" class="headerlink" title="union"></a>union</h4><p>å°†ä¸¤ä¸ªRDDåˆå¹¶æˆä¸€ä¸ªRDDè¿”å›</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»…åˆå¹¶ï¼Œä¸ä¼šå»é‡</span></span><br><span class="line"><span class="comment"># å¯ä»¥åˆå¹¶ä¸åŒç±»å‹çš„RDD</span></span><br><span class="line">rdd.union(other_rdd)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd1 = sc.parallelize([<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>])</span><br><span class="line">rdd2 = sc.parallelize([<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"a"</span>])</span><br><span class="line"></span><br><span class="line">rdd3 = rdd1.union(rdd2)</span><br><span class="line">print(rdd3.collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1, 1, 3, 3, &apos;a&apos;, &apos;b&apos;, &apos;a&apos;]</span><br></pre></td></tr></table></figure><h4 id="join"><a href="#join" class="headerlink" title="join"></a>join</h4><p>å¯¹ä¸¤ä¸ªRDDæ‰§è¡ŒJOINæ“ä½œï¼ˆå¯å®ç°SQLçš„å†…/å¤–è¿æ¥ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># jionç®—å­åªèƒ½ç”¨äºäºŒå…ƒå…ƒç»„</span></span><br><span class="line">rdd.join(other_rdd)            <span class="comment"># å†…è¿æ¥</span></span><br><span class="line">rdd.leftOuterJoin(other_rdd)   <span class="comment"># å·¦å¤–è¿æ¥</span></span><br><span class="line">rdd.rightOuterJoin(other_rdd)  <span class="comment"># å³å¤–è¿æ¥</span></span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd1 = sc.parallelize([ (<span class="number">1001</span>, <span class="string">"zhangsan"</span>), (<span class="number">1002</span>, <span class="string">"lisi"</span>), (<span class="number">1003</span>, <span class="string">"wangwu"</span>), (<span class="number">1004</span>, <span class="string">"zhaoliu"</span>) ])</span><br><span class="line">rdd2 = sc.parallelize([ (<span class="number">1001</span>, <span class="string">"é”€å”®éƒ¨"</span>), (<span class="number">1002</span>, <span class="string">"ç§‘æŠ€éƒ¨"</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡joinç®—å­æ¥è¿›è¡Œrddä¹‹é—´çš„å…³è”</span></span><br><span class="line"><span class="comment"># å¯¹äºjoinç®—å­æ¥è¯´ å…³è”æ¡ä»¶ æŒ‰ç…§äºŒå…ƒå…ƒç»„çš„keyæ¥è¿›è¡Œå…³è”</span></span><br><span class="line">print(rdd1.join(rdd2).collect())</span><br><span class="line"></span><br><span class="line"><span class="comment"># å·¦å¤–è¿æ¥, å³å¤–è¿æ¥ å¯ä»¥æ›´æ¢ä¸€ä¸‹rddçš„é¡ºåº æˆ–è€…è°ƒç”¨rightOuterJoinå³å¯</span></span><br><span class="line">print(rdd1.leftOuterJoin(rdd2).collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[(1001, (&apos;zhangsan&apos;, &apos;é”€å”®éƒ¨&apos;)), (1002, (&apos;lisi&apos;, &apos;ç§‘æŠ€éƒ¨&apos;))]</span><br><span class="line">[(1004, (&apos;zhaoliu&apos;, None)), (1001, (&apos;zhangsan&apos;, &apos;é”€å”®éƒ¨&apos;)), (1002, (&apos;lisi&apos;, &apos;ç§‘æŠ€éƒ¨&apos;)), (1003, (&apos;wangwu&apos;, None))]</span><br></pre></td></tr></table></figure><h4 id="intersection"><a href="#intersection" class="headerlink" title="intersection"></a>intersection</h4><p>æ±‚ä¸¤ä¸ªRDDçš„äº¤é›†ï¼Œè¿”å›ä¸€ä¸ªæ–°RDD</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd.intersection(other_rdd)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd1 = sc.parallelize([(<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'a'</span>, <span class="number">3</span>)])</span><br><span class="line">rdd2 = sc.parallelize([(<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">3</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡intersectionç®—å­æ±‚RDDä¹‹é—´çš„äº¤é›†, å°†äº¤é›†å–å‡º è¿”å›æ–°RDD</span></span><br><span class="line">rdd3 = rdd1.intersection(rdd2)</span><br><span class="line"></span><br><span class="line">print(rdd3.collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[(&apos;a&apos;, 1)]</span><br></pre></td></tr></table></figure><h4 id="glom"><a href="#glom" class="headerlink" title="glom"></a>glom</h4><p>å°†RDDçš„æ•°æ®æŒ‰ç…§åˆ†åŒºåŠ ä¸ŠåµŒå¥—</p><p>ä¾‹å¦‚RDDæ•°æ®[1,2,3,4,5]æœ‰ä¸¤ä¸ªåˆ†åŒºï¼Œç»è¿‡glomå¤„ç†åå˜æˆï¼š[[1,2,3]],[4,5]]</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd.glom()</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>], <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">print(rdd.glom().collect())</span><br><span class="line">print(rdd.glom().flatMap(<span class="keyword">lambda</span> x: x).collect()) <span class="comment"># tipsï¼šè§£åµŒå¥—</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[[1, 2, 3, 4], [5, 6, 7, 8, 9]]</span><br><span class="line">[1, 2, 3, 4, 5, 6, 7, 8, 9]</span><br></pre></td></tr></table></figure><h4 id="groupByKey"><a href="#groupByKey" class="headerlink" title="groupByKey"></a>groupByKey</h4><p>é’ˆå¯¹KVå‹RDDè‡ªåŠ¨æŒ‰keyåˆ†ç»„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd.groupByKey()</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([(<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">1</span>)])</span><br><span class="line"></span><br><span class="line">rdd2 = rdd.groupByKey()</span><br><span class="line"></span><br><span class="line">print(rdd2.map(<span class="keyword">lambda</span> x: (x[<span class="number">0</span>], list(x[<span class="number">1</span>]))).collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[(&apos;b&apos;, [1, 1, 1]), (&apos;a&apos;, [1, 1])]</span><br></pre></td></tr></table></figure><h4 id="sortBy"><a href="#sortBy" class="headerlink" title="sortBy"></a>sortBy</h4><p>åŸºäºæŒ‡å®šçš„æ’åºå‡½æ•°å¯¹RDDæ•°æ®è¿›è¡Œæ’åº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ascendingï¼šTrue-å‡åºï¼ŒFalse-é™åº</span></span><br><span class="line"><span class="comment"># numPartitionsï¼šç”¨äºæ’åºçš„åˆ†åŒºæ•°é‡ï¼Œè¦è¿›è¡Œå…¨å±€æ’åºï¼Œè®¾ç½®ä¸º1</span></span><br><span class="line">rdd.sortBy(func, ascending=<span class="literal">False</span>, numPartitions=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([(<span class="string">'c'</span>, <span class="number">3</span>), (<span class="string">'f'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">11</span>), (<span class="string">'c'</span>, <span class="number">3</span>), (<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'c'</span>, <span class="number">5</span>), (<span class="string">'e'</span>, <span class="number">1</span>), (<span class="string">'n'</span>, <span class="number">9</span>), (<span class="string">'a'</span>, <span class="number">1</span>)], <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨sortByå¯¹rddæ‰§è¡Œæ’åº</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰ç…§value æ•°å­—è¿›è¡Œæ’åº</span></span><br><span class="line"><span class="comment"># å‚æ•°1å‡½æ•°ï¼Œå‘ŠçŸ¥Spark æŒ‰ç…§æ•°æ®çš„å“ªä¸ªåˆ—è¿›è¡Œæ’åº</span></span><br><span class="line"><span class="comment"># å‚æ•°2: Trueè¡¨ç¤ºå‡åº Falseè¡¨ç¤ºé™åº</span></span><br><span class="line"><span class="comment"># å‚æ•°3: æ’åºçš„åˆ†åŒºæ•°</span></span><br><span class="line"><span class="string">"""æ³¨æ„: å¦‚æœè¦å…¨å±€æœ‰åº, æ’åºåˆ†åŒºæ•°éœ€è®¾ç½®ä¸º1"""</span></span><br><span class="line">print(rdd.sortBy(<span class="keyword">lambda</span> x: x[<span class="number">1</span>], ascending=<span class="literal">True</span>, numPartitions=<span class="number">1</span>).collect())</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰ç…§keyæ¥è¿›è¡Œæ’åº</span></span><br><span class="line">print(rdd.sortBy(<span class="keyword">lambda</span> x: x[<span class="number">0</span>], ascending=<span class="literal">False</span>, numPartitions=<span class="number">1</span>).collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[(&apos;f&apos;, 1), (&apos;a&apos;, 1), (&apos;e&apos;, 1), (&apos;a&apos;, 1), (&apos;c&apos;, 3), (&apos;c&apos;, 3), (&apos;c&apos;, 5), (&apos;n&apos;, 9), (&apos;b&apos;, 11)]</span><br><span class="line">[(&apos;n&apos;, 9), (&apos;f&apos;, 1), (&apos;e&apos;, 1), (&apos;c&apos;, 3), (&apos;c&apos;, 3), (&apos;c&apos;, 5), (&apos;b&apos;, 11), (&apos;a&apos;, 1), (&apos;a&apos;, 1)]</span><br></pre></td></tr></table></figure><h4 id="sortByKey"><a href="#sortByKey" class="headerlink" title="sortByKey"></a>sortByKey</h4><p>é’ˆå¯¹KVå‹RDDæŒ‰ç…§keyè¿›è¡Œæ’åº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ascendingï¼šTrue-å‡åºï¼ŒFalse-é™åº</span></span><br><span class="line"><span class="comment"># numPartitionsï¼šç”¨äºæ’åºçš„åˆ†åŒºæ•°é‡ï¼Œè¦è¿›è¡Œå…¨å±€æ’åºï¼Œè®¾ç½®ä¸º1</span></span><br><span class="line"><span class="comment"># keyfuncï¼šåœ¨æ’åºå‰å¯¹keyè¿›è¡Œçš„å¤„ç†</span></span><br><span class="line">rdd.sortByKey(ascending=<span class="literal">True</span>, numPartitions=<span class="literal">None</span>, keyfunc=&lt;function RDD.&lt;<span class="keyword">lambda</span>&gt;&gt;)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([(<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'E'</span>, <span class="number">1</span>), (<span class="string">'C'</span>, <span class="number">1</span>), (<span class="string">'D'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">1</span>), (<span class="string">'g'</span>, <span class="number">1</span>), (<span class="string">'f'</span>, <span class="number">1</span>),</span><br><span class="line">                      (<span class="string">'y'</span>, <span class="number">1</span>), (<span class="string">'u'</span>, <span class="number">1</span>), (<span class="string">'i'</span>, <span class="number">1</span>), (<span class="string">'o'</span>, <span class="number">1</span>), (<span class="string">'p'</span>, <span class="number">1</span>),</span><br><span class="line">                      (<span class="string">'m'</span>, <span class="number">1</span>), (<span class="string">'n'</span>, <span class="number">1</span>), (<span class="string">'j'</span>, <span class="number">1</span>), (<span class="string">'k'</span>, <span class="number">1</span>), (<span class="string">'l'</span>, <span class="number">1</span>)], <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">print(rdd.sortByKey(ascending=<span class="literal">True</span>, numPartitions=<span class="number">1</span>, keyfunc=<span class="keyword">lambda</span> key: str(key).lower()).collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[(&apos;a&apos;, 1), (&apos;b&apos;, 1), (&apos;C&apos;, 1), (&apos;D&apos;, 1), (&apos;E&apos;, 1), (&apos;f&apos;, 1), (&apos;g&apos;, 1), (&apos;i&apos;, 1), (&apos;j&apos;, 1), (&apos;k&apos;, 1), (&apos;l&apos;, 1), (&apos;m&apos;, 1), (&apos;n&apos;, 1), (&apos;o&apos;, 1), (&apos;p&apos;, 1), (&apos;u&apos;, 1), (&apos;y&apos;, 1)]</span><br></pre></td></tr></table></figure><h4 id="repartition-amp-coalesce"><a href="#repartition-amp-coalesce" class="headerlink" title="repartition &amp; coalesce"></a>repartition &amp; coalesce</h4><p>å¯¹RDDçš„åˆ†åŒºæ‰§è¡Œé‡æ–°åˆ†åŒºï¼ˆä»…æ•°é‡ï¼‰</p><p><font color="gold">æ³¨</font>ï¼šå°½é‡é¿å…ä½¿ç”¨ï¼Œå½±å“å¹¶è¡Œè®¡ç®—æ€§èƒ½ã€‚åœ¨åˆå¹¶åˆ°1ä¸ªåˆ†åŒºè¿›è¡Œå…¨å±€æ’åºç­‰åœºæ™¯ä¸‹ä½¿ç”¨ï¼Œå°½å¯èƒ½é¿å…å¢åŠ åˆ†åŒºï¼Œå¯èƒ½ç ´åå†…å­˜è¿­ä»£çš„è®¡ç®—ç®¡é“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nï¼šå†³å®šæ–°çš„åˆ†åŒºæ•°é‡</span></span><br><span class="line"><span class="comment"># coalesceä¸­å¢åŠ åˆ†åŒºå¿…é¡»æŒ‡å®šshuffle=True</span></span><br><span class="line">rdd.repartition(n)</span><br><span class="line">rdd.coalesce(n, shuffle)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># repartition ä¿®æ”¹åˆ†åŒº</span></span><br><span class="line">print(rdd.repartition(<span class="number">1</span>).getNumPartitions())</span><br><span class="line"></span><br><span class="line">print(rdd.repartition(<span class="number">5</span>).getNumPartitions())</span><br><span class="line"></span><br><span class="line"><span class="comment"># coalesce ä¿®æ”¹åˆ†åŒº</span></span><br><span class="line">print(rdd.coalesce(<span class="number">1</span>).getNumPartitions())</span><br><span class="line"></span><br><span class="line">print(rdd.coalesce(<span class="number">5</span>, shuffle=<span class="literal">True</span>).getNumPartitions())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">5</span><br><span class="line">1</span><br><span class="line">5</span><br></pre></td></tr></table></figure><h3 id="Actionç®—å­"><a href="#Actionç®—å­" class="headerlink" title="Actionç®—å­"></a>Actionç®—å­</h3><h4 id="countByKey"><a href="#countByKey" class="headerlink" title="countByKey"></a>countByKey</h4><p>ç”¨äºç»Ÿè®¡keyå‡ºç°çš„æ¬¡æ•°ï¼ˆä¸€èˆ¬é€‚ç”¨äºKVå‹RDDï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd.countByKey()</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.textFile(<span class="string">"hdfs://master:8020/input/words.txt"</span>)</span><br><span class="line">rdd2 = rdd.flatMap(<span class="keyword">lambda</span> x: x.split(<span class="string">" "</span>)).map(<span class="keyword">lambda</span> x: (x, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡countByKeyæ¥å¯¹keyè¿›è¡Œè®¡æ•°, è¿™æ˜¯ä¸€ä¸ªActionç®—å­</span></span><br><span class="line">result = rdd2.countByKey()</span><br><span class="line"></span><br><span class="line">print(result)</span><br><span class="line">print(type(result))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">defaultdict(&lt;class &apos;int&apos;&gt;, &#123;&apos;hadoop&apos;: 7, &apos;spark&apos;: 5, &apos;flink&apos;: 3&#125;)</span><br><span class="line">&lt;class &apos;collections.defaultdict&apos;&gt;</span><br></pre></td></tr></table></figure><h4 id="collect"><a href="#collect" class="headerlink" title="collect"></a>collect</h4><p>å°†RDDå„ä¸ªåˆ†åŒºå†…çš„æ•°æ®ç»Ÿä¸€æ”¶é›†åˆ°Driverä¸­ï¼Œå½¢æˆä¸€ä¸ªlistå¯¹è±¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd.collect()</span><br></pre></td></tr></table></figure><p><font color="gold">æ³¨</font>ï¼šæ•°æ®é›†å¤§å°ä¸èƒ½è¶…è¿‡Driverå†…å­˜</p><h4 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h4><p>å¯¹RDDæ•°æ®é›†æŒ‰ç…§funcé€»è¾‘è¿›è¡Œèšåˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¹funcï¼šä¼ å…¥2ä¸ªå‚æ•°å¾—åˆ°1ä¸ªè¿”å›å€¼ï¼Œè¦æ±‚è¿”å›å€¼å’Œå‚æ•°çš„ç±»å‹ä¿æŒä¸€è‡´</span></span><br><span class="line">rdd.reduce(func)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line">print(rdd.reduce(<span class="keyword">lambda</span> a, b: a + b))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">15</span><br></pre></td></tr></table></figure><h4 id="fold"><a href="#fold" class="headerlink" title="fold"></a>fold</h4><p>åŒreduceï¼Œæ¥å—ä¼ å…¥é€»è¾‘è¿›è¡Œèšåˆï¼Œä½†æ˜¯èšåˆæ˜¯å¸¦æœ‰åˆå§‹å€¼çš„ã€‚è¿™ä¸ªåˆå§‹å€¼çš„èšåˆä½œç”¨åœ¨ï¼š</p><ul><li>åˆ†åŒºå†…èšåˆ</li><li>åˆ†åŒºé—´èšåˆ</li></ul><p>ä¾‹å¦‚ï¼š[[1, 2, 3], [4, 5, 6], [7, 8, 9]]</p><p>æ•°æ®åˆ†å¸ƒåœ¨ä¸‰ä¸ª<strong>åˆ†åŒº</strong>ä¸Š</p><p><strong><font color="orange">åˆ†åŒº1</font></strong>ï¼š123èšåˆæ—¶å¸¦ä¸Š10ä½œä¸ºåˆå§‹å€¼å¾—åˆ°16</p><p><strong><font color="orange">åˆ†åŒº2</font></strong>ï¼š456èšåˆæ—¶å¸¦ä¸Š10ä½œä¸ºåˆå§‹å€¼å¾—åˆ°25</p><p><strong><font color="orange">åˆ†åŒº3</font></strong>ï¼š789èšåˆæ—¶å¸¦ä¸Š10ä½œä¸ºåˆå§‹å€¼å¾—åˆ°34</p><p>æœ€åå†åš3ä¸ªåˆ†åŒºé—´çš„èšåˆï¼š16+25+34å¾—åˆ°85</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd.fold(src, func)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>], <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">print(rdd.fold(<span class="number">10</span>, <span class="keyword">lambda</span> a, b: a + b))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">85</span><br></pre></td></tr></table></figure><h4 id="firstÂ·takeÂ·countÂ·top"><a href="#firstÂ·takeÂ·countÂ·top" class="headerlink" title="firstÂ·takeÂ·countÂ·top"></a>firstÂ·takeÂ·countÂ·top</h4><p><strong><font color="orange">first</font></strong></p><p>å–å‡ºRDDçš„ç¬¬ä¸€ä¸ªå…ƒç´ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;sc.parallelize([<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]).first()</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><p><strong><font color="orange">take</font></strong></p><p>å–å‡ºRDDçš„å‰nä¸ªå…ƒç´ ï¼Œç»„åˆæˆlistè¿”å›</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]).take(<span class="number">5</span>)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br></pre></td></tr></table></figure><p> <strong><font color="orange">count</font></strong></p><p>è®¡ç®—RDDæœ‰å¤šå°‘æ¡æ•°æ®ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°å­—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;sc.parallelize([<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]).count()</span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure><p><strong><font color="orange">top</font></strong></p><p>å¯¹RDDæ•°æ®é›†è¿›è¡Œé™åºæ’åºï¼Œå–ç»“æœå‰nä¸ª</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;sc.parallelize([<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]).top(<span class="number">3</span>)</span><br><span class="line">[<span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure><h4 id="takeSample"><a href="#takeSample" class="headerlink" title="takeSample"></a>takeSample</h4><p>éšæœºæŠ½æ ·RDDæ•°æ®ï¼Œå¯ç”¨äºæ•°æ®æ£€æŸ¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># arg1ï¼šTrueè¡¨ç¤ºè¿è¡Œå–åŒä¸€ä¸ªæ•°æ®ï¼ŒFalseè¡¨ç¤ºä¸å…è®¸å–åŒä¸€ä¸ªæ•°æ®ï¼ˆå’Œæ•°æ®å†…å®¹æ— å…³ï¼Œæ˜¯å¦é‡å¤è¡¨ç¤ºçš„æ˜¯åŒä¸€ä¸ªä½ç½®çš„æ•°æ®ï¼‰</span></span><br><span class="line"><span class="comment"># arg2ï¼šæŠ½æ ·æ•°ç›®</span></span><br><span class="line"><span class="comment"># arg3ï¼šå¯é€‰ï¼Œéšæœºæ•°ç§å­ï¼Œéšæ„ä¼ è¿›ä¸€ä¸ªæ•°å­—</span></span><br><span class="line">takeSample(arg1ï¼š<span class="literal">True</span>/<span class="literal">False</span>, arg2:é‡‡æ ·æ•°, arg3:éšæœºæ•°ç§å­)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">6</span>], <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">print(rdd.takeSample(<span class="literal">False</span>, <span class="number">5</span>, <span class="number">1</span>))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2, 7, 6, 6, 3]</span><br></pre></td></tr></table></figure><h4 id="takeOrdered"><a href="#takeOrdered" class="headerlink" title="takeOrdered"></a>takeOrdered</h4><p>å¯¹RDDè¿›è¡Œæ’åºï¼Œå–ç»“æœå‰nä¸ª</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># arg1ï¼šéœ€è¦å‡ ä¸ªæ•°æ®</span></span><br><span class="line"><span class="comment"># arg2ï¼šå¯¹æ’åºçš„æ•°æ®è¿›è¡Œæ›´æ”¹ï¼ˆä¸ä¼šæ›´æ”¹æ•°æ®æœ¬èº«ï¼Œä»…åœ¨æ’åºæ—¶ä½¿ç”¨ï¼‰</span></span><br><span class="line">rdd.takeOrdered(arg1, arg2)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">6</span>], <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">print(rdd.takeOrdered(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">print(rdd.takeOrdered(<span class="number">3</span>, <span class="keyword">lambda</span> x: -x))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1, 2, 3]</span><br><span class="line">[9, 7, 6]</span><br></pre></td></tr></table></figure><h4 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h4><p>å¯¹RDDçš„æ¯ä¸€ä¸ªå…ƒç´ æ‰§è¡Œæä¾›çš„é€»è¾‘æ“ä½œï¼ˆåŒmapï¼‰ï¼Œæ— è¿”å›å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd.foreach(func)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">6</span>], <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">result = rdd.foreach(<span class="keyword">lambda</span> x: print(x * <span class="number">10</span>))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">30</span><br><span class="line">20</span><br><span class="line">40</span><br><span class="line">70</span><br><span class="line">90</span><br><span class="line">60</span><br></pre></td></tr></table></figure><p>ç‰¹æ€§ï¼šç”±Executorç›´æ¥è¾“å‡º</p><h4 id="saveAsTextFile"><a href="#saveAsTextFile" class="headerlink" title="saveAsTextFile"></a>saveAsTextFile</h4><p>å°†RDDæ•°æ®å†™å…¥æ–‡æœ¬æ–‡ä»¶</p><p>æ”¯æŒï¼šæœ¬åœ°å†™å‡ºæˆ–hdfsç­‰æ–‡ä»¶ç³»ç»Ÿ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd.saveAsTextFile()</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">6</span>], <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">rdd.saveAsTextFile(<span class="string">"hdfs://master:8020/output/out_test1"</span>)</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -ls /output/out_test1</span><br><span class="line">hadoop fs -cat /output/out_test1/*</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Found 4 items</span><br><span class="line">-rw-r--r--   3 root supergroup          0 2022-12-06 17:44 /output/out_test1/_SUCCESS</span><br><span class="line">-rw-r--r--   3 root supergroup          4 2022-12-06 17:44 /output/out_test1/part-00000</span><br><span class="line">-rw-r--r--   3 root supergroup          4 2022-12-06 17:44 /output/out_test1/part-00001</span><br><span class="line">-rw-r--r--   3 root supergroup          6 2022-12-06 17:44 /output/out_test1/part-00002</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">3</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">7</span><br><span class="line">9</span><br><span class="line">6</span><br></pre></td></tr></table></figure><p>ç‰¹æ€§ï¼šç”±Executorç›´æ¥å†™å…¥æ–‡ä»¶</p><h4 id="mapPartitions"><a href="#mapPartitions" class="headerlink" title="mapPartitions"></a>mapPartitions</h4><p>ä¸åŒäºmapæ¯æ¬¡æ“ä½œä¸€ä¸ªåˆ†åŒºçš„å•ä¸€å¯¹è±¡ï¼ŒmapPartitionsä¸€æ¬¡æ“ä½œä¸€æ•´ä¸ªåˆ†åŒºçš„æ•°æ®ï¼Œä½œä¸ºä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ä¼ å…¥è¿›æ¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd.mapPartitions(func)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">6</span>], <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">(iter)</span>:</span></span><br><span class="line">    result = list()</span><br><span class="line">    <span class="keyword">for</span> it <span class="keyword">in</span> iter:</span><br><span class="line">        result.append(it * <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">print(rdd.mapPartitions(process).collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[10, 20, 70]</span><br></pre></td></tr></table></figure><h4 id="foreachPartition"><a href="#foreachPartition" class="headerlink" title="foreachPartition"></a>foreachPartition</h4><p>å’Œforeachä¸€è‡´ï¼Œforeachä¸€æ¡æ¡å¤„ç†ï¼Œè€ŒforeachPartitionä¸€æ¬¡å¤„ç†ä¸€æ•´ä¸ªåˆ†åŒºçš„æ•°æ®ï¼Œç±»ä¼¼äºæ²¡æœ‰è¿”å›å€¼çš„mapPartitions</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd.foreachPartition(func)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">6</span>], <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">(iter)</span>:</span></span><br><span class="line">    result = list()</span><br><span class="line">    <span class="keyword">for</span> it <span class="keyword">in</span> iter:</span><br><span class="line">        result.append(it * <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">        print(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rdd.foreachPartition(process)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[20]</span><br><span class="line">[20, 40]</span><br><span class="line">[10]</span><br><span class="line">[10, 30]</span><br><span class="line">[70]</span><br><span class="line">[70, 90]</span><br><span class="line">[70, 90, 60]</span><br></pre></td></tr></table></figure><h4 id="partitionBy"><a href="#partitionBy" class="headerlink" title="partitionBy"></a>partitionBy</h4><p>å¯¹RDDè¿›è¡Œè‡ªå®šä¹‰åˆ†åŒºæ“ä½œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># arg1ï¼šé‡æ–°åˆ†åŒºåçš„åˆ†åŒºæ•°é‡</span></span><br><span class="line"><span class="comment"># arg2ï¼šè‡ªå®šä¹‰åˆ†åŒºè§„åˆ™ï¼Œé€šè¿‡å‡½æ•°ä¼ å…¥ï¼Œå‡½æ•°è¿”å›å€¼å¿…é¡»ä½intå‹ï¼ˆåˆ†åŒºç¼–å·ä»0å¼€å§‹ï¼Œä¸å¾—è¶…è¿‡åˆ†åŒºæ•°-1ï¼‰</span></span><br><span class="line">rdd.partitionBy(arg1, arg2)</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd = sc.parallelize([(<span class="string">'hadoop'</span>, <span class="number">1</span>), (<span class="string">'spark'</span>, <span class="number">1</span>), (<span class="string">'hello'</span>, <span class="number">1</span>), (<span class="string">'flink'</span>, <span class="number">1</span>), (<span class="string">'hadoop'</span>, <span class="number">1</span>), (<span class="string">'spark'</span>, <span class="number">1</span>)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨partitionBy è‡ªå®šä¹‰ åˆ†åŒº</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">(k)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'hadoop'</span> == k <span class="keyword">or</span> <span class="string">'hello'</span> == k: <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">'spark'</span> == k: <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(rdd.partitionBy(<span class="number">3</span>, process).glom().collect())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[(&apos;hadoop&apos;, 1), (&apos;hello&apos;, 1), (&apos;hadoop&apos;, 1)], [(&apos;spark&apos;, 1), (&apos;spark&apos;, 1)], [(&apos;flink&apos;, 1)]]</span><br></pre></td></tr></table></figure><h2 id="RDDçš„æ•°æ®æ˜¯è¿‡ç¨‹æ•°æ®"><a href="#RDDçš„æ•°æ®æ˜¯è¿‡ç¨‹æ•°æ®" class="headerlink" title="RDDçš„æ•°æ®æ˜¯è¿‡ç¨‹æ•°æ®"></a>RDDçš„æ•°æ®æ˜¯è¿‡ç¨‹æ•°æ®</h2><p>RDDä¹‹é—´è¿›è¡Œç›¸äº’è¿­ä»£è®¡ç®—ï¼ˆTransformationçš„è½¬æ¢ï¼‰ï¼Œå½“æ‰§è¡Œå¼€å¯ä»¥åï¼Œæ–°RDDç”Ÿæˆï¼Œæ—§RDDæ¶ˆå¤±ã€‚æ‰€ä»¥RDDçš„æ•°æ®æ˜¯è¿‡ç¨‹æ•°æ®ï¼Œä»…åœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­å­˜åœ¨ï¼Œä¸€æ—¦å¤„ç†å®Œæˆä¾¿ä¼šè¢«é‡Šæ”¾ï¼Œæ—¨åœ¨æœ€å¤§åŒ–çš„åˆç†åˆ©ç”¨ç³»ç»Ÿèµ„æº</p><p>å½“RDDè¢«é‡Šæ”¾åéœ€è¦è¢«é‡æ–°ä½¿ç”¨ï¼Œä¼šä»å¤´å¼€å§‹æ‰§è¡Œ</p><h3 id="RDDç¼“å­˜"><a href="#RDDç¼“å­˜" class="headerlink" title="RDDç¼“å­˜"></a>RDDç¼“å­˜</h3><p>é˜²æ­¢å½“RDDè¢«é‡Šæ”¾è€Œåˆè¦è¢«é‡æ–°è°ƒç”¨çš„æƒ…å†µä¸‹ï¼Œé¿å…ä»å¤´æ‰§è¡Œä»£ç ï¼Œä½¿ç”¨RDDç¼“å­˜API</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rdd.cache()                                  <span class="comment"># ç¼“å­˜åˆ°å†…å­˜ä¸­</span></span><br><span class="line">rdd.persist(StorageLevel.MEMORY_ONLY)        <span class="comment"># ä»…åœ¨å†…å­˜ç¼“å­˜</span></span><br><span class="line">rdd.persist(StorageLevel.MEMORY_ONLY_2)      <span class="comment"># ä»…åœ¨å†…å­˜ç¼“å­˜ï¼Œç”Ÿæˆ2ä¸ªå‰¯æœ¬</span></span><br><span class="line">rdd.persist(StorageLevel.DISK_ONLY)          <span class="comment"># ä»…ç¼“å­˜åˆ°ç¡¬ç›˜</span></span><br><span class="line">rdd.persist(StorageLevel.DISK_ONLY_2)        <span class="comment"># ä»…ç¼“å­˜åˆ°ç¡¬ç›˜ï¼Œç”Ÿæˆ2ä¸ªå‰¯æœ¬</span></span><br><span class="line">rdd.persist(StorageLevel.DISK_ONLY_3)        <span class="comment"># ä»…ç¼“å­˜åˆ°ç¡¬ç›˜ï¼Œç”Ÿæˆ3ä¸ªå‰¯æœ¬</span></span><br><span class="line">rdd.persist(StorageLevel.MEMORY_AND_DISK)    <span class="comment"># å…ˆåœ¨å†…å­˜ç¼“å­˜ï¼Œå†…å­˜ä¸å¤Ÿç¼“å­˜åˆ°ç¡¬ç›˜</span></span><br><span class="line">rdd.persist(StorageLevel.MEMORY_AND_DISK_2)  <span class="comment"># å…ˆåœ¨å†…å­˜ç¼“å­˜ï¼Œå†…å­˜ä¸å¤Ÿç¼“å­˜åˆ°ç¡¬ç›˜ï¼Œç”Ÿæˆ2ä¸ªå‰¯æœ¬</span></span><br><span class="line">rdd.persist(StorageLevel.OFF_HEAP)           <span class="comment"># å †å¤–å†…å­˜</span></span><br><span class="line">rdd.unpersist()                              <span class="comment"># ä¸»åŠ¨æ¸…ç†ç¼“å­˜</span></span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"><span class="keyword">from</span> pyspark.storagelevel <span class="keyword">import</span> StorageLevel</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">rdd1 = sc.textFile(<span class="string">"hdfs://master:8020/input/words.txt"</span>)</span><br><span class="line">rdd2 = rdd1.flatMap(<span class="keyword">lambda</span> x: x.split(<span class="string">" "</span>))</span><br><span class="line">rdd3 = rdd2.map(<span class="keyword">lambda</span> x: (x, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">rdd3.cache()</span><br><span class="line">rdd3.persist(StorageLevel.MEMORY_AND_DISK_2)</span><br><span class="line"></span><br><span class="line">rdd4 = rdd3.reduceByKey(<span class="keyword">lambda</span> a, b: a + b)</span><br><span class="line">print(rdd4.collect())</span><br><span class="line"></span><br><span class="line">rdd5 = rdd3.groupByKey()</span><br><span class="line">rdd6 = rdd5.mapValues(<span class="keyword">lambda</span> x: sum(x))</span><br><span class="line">print(rdd6.collect())</span><br><span class="line"></span><br><span class="line">rdd3.unpersist()</span><br><span class="line">time.sleep(<span class="number">100000</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[(&apos;hadoop&apos;, 1), (&apos;hello&apos;, 3), (&apos;spark&apos;, 1), (&apos;flink&apos;, 1)]</span><br><span class="line">[(&apos;hadoop&apos;, 1), (&apos;hello&apos;, 3), (&apos;spark&apos;, 1), (&apos;flink&apos;, 1)]</span><br></pre></td></tr></table></figure><p><font color="gold">æ³¨</font>ï¼šç¼“å­˜åˆ†æ•£å­˜å‚¨åœ¨å„Executoræ‰€åœ¨æœåŠ¡å™¨ä¸­ã€‚ç¼“å­˜ä»è®¾è®¡ä¸Šæ¥è¯´æ˜¯ä¸å®‰å…¨çš„ï¼Œç¼“å­˜ä¸€æ—¦ä¸¢å¤±ï¼Œéœ€è¦é‡æ–°è®¡ç®—ç¼“å­˜ï¼Œå¿…é¡»ä¿ç•™è¢«ç¼“å­˜RDDçš„å‰ç½®è¡€ç¼˜å…³ç³»</p><h3 id="RDD-CheckPoint"><a href="#RDD-CheckPoint" class="headerlink" title="RDD CheckPoint"></a>RDD CheckPoint</h3><p>ç”¨äºä¿å­˜RDDæ•°æ®ï¼Œä»…æ”¯æŒç¡¬ç›˜å­˜å‚¨ï¼Œä¸”å¯ä»¥å†™å…¥HDFSï¼ˆcacheä¸è¡Œï¼‰ï¼Œä»è®¾è®¡ä¸Šæ¥è¯´æ˜¯å®‰å…¨çš„ï¼Œä¸ä¿ç•™RDDçš„å‰ç½®è¡€ç¼˜å…³ç³»</p><p>ChickPointé›†ä¸­æ”¶é›†å„ä¸ªåˆ†åŒºçš„æ•°æ®è¿›è¡Œå­˜å‚¨ï¼Œè€Œécacheçš„åˆ†æ•£å­˜å‚¨</p><p>e.g.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"><span class="keyword">from</span> pyspark.storagelevel <span class="keyword">import</span> StorageLevel</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setAppName(<span class="string">"test"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å‘ŠçŸ¥spark, å¼€å¯CheckPointåŠŸèƒ½</span></span><br><span class="line">sc.setCheckpointDir(<span class="string">"hdfs://master:8020/output/ckp"</span>)</span><br><span class="line">rdd1 = sc.textFile(<span class="string">"hdfs://master:8020/input/words.txt"</span>)</span><br><span class="line">rdd2 = rdd1.flatMap(<span class="keyword">lambda</span> x: x.split(<span class="string">" "</span>))</span><br><span class="line">rdd3 = rdd2.map(<span class="keyword">lambda</span> x: (x, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨checkpoint API ä¿å­˜æ•°æ®å³å¯</span></span><br><span class="line">rdd3.checkpoint()</span><br><span class="line"></span><br><span class="line">rdd4 = rdd3.reduceByKey(<span class="keyword">lambda</span> a, b: a + b)</span><br><span class="line">print(rdd4.collect())</span><br><span class="line"></span><br><span class="line">rdd5 = rdd3.groupByKey()</span><br><span class="line">rdd6 = rdd5.mapValues(<span class="keyword">lambda</span> x: sum(x))</span><br><span class="line">print(rdd6.collect())</span><br><span class="line"></span><br><span class="line">rdd3.unpersist()</span><br><span class="line">time.sleep(<span class="number">100000</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[(&apos;hadoop&apos;, 1), (&apos;hello&apos;, 3), (&apos;spark&apos;, 1), (&apos;flink&apos;, 1)]</span><br><span class="line">[(&apos;hadoop&apos;, 1), (&apos;hello&apos;, 3), (&apos;spark&apos;, 1), (&apos;flink&apos;, 1)]</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;RDD&quot;&gt;&lt;a href=&quot;#RDD&quot; class=&quot;headerlink&quot; title=&quot;RDD&quot;&gt;&lt;/a&gt;RDD&lt;/h2&gt;&lt;p&gt;RDDï¼ˆResilient Distributed Datasetï¼‰å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œæ˜¯sparkä¸­æœ€åŸºæœ¬çš„æ•°æ®æŠ½è±¡ï¼Œä»£è¡¨ä¸€ä¸ªä¸å¯å˜ã€å¯åˆ†åŒºã€å…¶ä¸­å…ƒç´ å¯å¹¶è¡Œè®¡ç®—çš„é›†åˆ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Resilientï¼šRDDä¸­çš„æ•°æ®å¯å­˜å‚¨å†å†…å­˜æˆ–ç£ç›˜ä¸­&lt;/li&gt;
&lt;li&gt;Distributedï¼šåˆ†å¸ƒå¼å­˜å‚¨æ•°æ®ï¼ˆè·¨æœºå™¨/è·¨è¿›ç¨‹ï¼‰ï¼Œç”¨äºåˆ†å¸ƒå¼è®¡ç®—&lt;/li&gt;
&lt;li&gt;Datasetï¼šä¸€ä¸ªç”¨äºå­˜æ”¾æ•°æ®çš„æ•°æ®é›†åˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;ç‰¹æ€§&quot;&gt;&lt;a href=&quot;#ç‰¹æ€§&quot; class=&quot;headerlink&quot; title=&quot;ç‰¹æ€§&quot;&gt;&lt;/a&gt;ç‰¹æ€§&lt;/h3&gt;&lt;h4 id=&quot;åˆ†åŒº&quot;&gt;&lt;a href=&quot;#åˆ†åŒº&quot; class=&quot;headerlink&quot; title=&quot;åˆ†åŒº&quot;&gt;&lt;/a&gt;åˆ†åŒº&lt;/h4&gt;&lt;p&gt;RDDåˆ†åŒºæ˜¯RDDæ•°æ®å­˜å‚¨çš„æœ€å°å•ä½ï¼Œä¸€ä»½RDDæ•°æ®æœ¬è´¨ä¸Šåˆ†éš”æˆäº†å¤šä¸ªåˆ†åŒº&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# å­˜å‚¨9ä¸ªæ•°å­—ï¼Œè®¾ç«‹ä¸‰ä¸ªåˆ†åŒº&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rdd = sc.parallelize([&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;], &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rdd.glom().collect()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[[1,2,3],[4,5,6],[7,8,9]]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;RDDæ–¹æ³•ä¼šä½œç”¨åœ¨å…¶æ‰€æœ‰æ–¹æ³•ä¸Š&quot;&gt;&lt;a href=&quot;#RDDæ–¹æ³•ä¼šä½œç”¨åœ¨å…¶æ‰€æœ‰æ–¹æ³•ä¸Š&quot; class=&quot;headerlink&quot; title=&quot;RDDæ–¹æ³•ä¼šä½œç”¨åœ¨å…¶æ‰€æœ‰æ–¹æ³•ä¸Š&quot;&gt;&lt;/a&gt;RDDæ–¹æ³•ä¼šä½œç”¨åœ¨å…¶æ‰€æœ‰æ–¹æ³•ä¸Š&lt;/h4&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;rdd.map(&lt;span class=&quot;keyword&quot;&gt;lambda&lt;/span&gt; x: x * &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;).collect()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[10,20,30,40,50,60,70,80,90]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;RDDä¹‹é—´å…·æœ‰ä¾èµ–å…³ç³»&quot;&gt;&lt;a href=&quot;#RDDä¹‹é—´å…·æœ‰ä¾èµ–å…³ç³»&quot; class=&quot;headerlink&quot; title=&quot;RDDä¹‹é—´å…·æœ‰ä¾èµ–å…³ç³»&quot;&gt;&lt;/a&gt;RDDä¹‹é—´å…·æœ‰ä¾èµ–å…³ç³»&lt;/h4&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sc = SparkContext(conf=conf)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rdd1 = sc.textFile(&lt;span class=&quot;string&quot;&gt;&quot;../test.text&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rdd2 = rdd1.flatMap(&lt;span class=&quot;keyword&quot;&gt;lambda&lt;/span&gt; x: x.split(&lt;span class=&quot;string&quot;&gt;&#39; &#39;&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rdd3 = rdd2.map(&lt;span class=&quot;keyword&quot;&gt;lambda&lt;/span&gt; x: (x, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rdd4 = rdd3.reduceByKey(&lt;span class=&quot;keyword&quot;&gt;lambda&lt;/span&gt; a, b: a+b)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(rdd4.collect())&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;Key-Valueå‹RDDå¯ä»¥æœ‰åˆ†åŒºå™¨&quot;&gt;&lt;a href=&quot;#Key-Valueå‹RDDå¯ä»¥æœ‰åˆ†åŒºå™¨&quot; class=&quot;headerlink&quot; title=&quot;Key-Valueå‹RDDå¯ä»¥æœ‰åˆ†åŒºå™¨&quot;&gt;&lt;/a&gt;Key-Valueå‹RDDå¯ä»¥æœ‰åˆ†åŒºå™¨&lt;/h4&gt;&lt;p&gt;KVå‹RDDï¼šRDDå†…å­˜å‚¨çš„æ•°æ®æ˜¯åªæœ‰ä¸¤ä¸ªå…ƒç´ çš„äºŒå…ƒå…ƒç»„&lt;/p&gt;
&lt;p&gt;é»˜è®¤åˆ†åŒºå™¨ï¼šHashåˆ†åŒºè§„åˆ™ï¼Œä¹Ÿå¯æ‰‹åŠ¨è®¾ç½®åˆ†åŒºå™¨ï¼šrdd.partitionBy()æ–¹æ³•&lt;/p&gt;
&lt;p&gt;&lt;font color=&quot;gold&quot;&gt;æ³¨&lt;/font&gt;ï¼šä¸æ˜¯æ‰€æœ‰RDDéƒ½æ˜¯KVå‹&lt;/p&gt;
&lt;h4 id=&quot;RDDçš„åˆ†åŒºè§„åˆ’ï¼šä¼šå°½é‡é è¿‘æ•°æ®æ‰€åœ¨çš„æœåŠ¡å™¨&quot;&gt;&lt;a href=&quot;#RDDçš„åˆ†åŒºè§„åˆ’ï¼šä¼šå°½é‡é è¿‘æ•°æ®æ‰€åœ¨çš„æœåŠ¡å™¨&quot; class=&quot;headerlink&quot; title=&quot;RDDçš„åˆ†åŒºè§„åˆ’ï¼šä¼šå°½é‡é è¿‘æ•°æ®æ‰€åœ¨çš„æœåŠ¡å™¨&quot;&gt;&lt;/a&gt;RDDçš„åˆ†åŒºè§„åˆ’ï¼šä¼šå°½é‡é è¿‘æ•°æ®æ‰€åœ¨çš„æœåŠ¡å™¨&lt;/h4&gt;&lt;p&gt;åœ¨åˆå§‹RDDè¯»å–æ•°æ®è§„åˆ’é˜¶æ®µï¼Œåˆ†åŒºä¼šå°½é‡è§„åˆ’åˆ°å­˜å‚¨æ•°æ®æ‰€åœ¨æœåŠ¡å™¨ï¼Œç›´æ¥è¯»å–æœ¬åœ°æ•°æ®ï¼Œé¿å…ä»ç½‘ç»œè¯»å–æ•°æ®&lt;/p&gt;
&lt;p&gt;Sparkä¼šåœ¨ç¡®ä¿å¹¶è¡Œè®¡ç®—èƒ½åŠ›çš„å‰æä¸‹ï¼Œå°½é‡ç¡®ä¿æœ¬åœ°è¯»å–&lt;/p&gt;
&lt;h3 id=&quot;RDDåˆ›å»º&quot;&gt;&lt;a href=&quot;#RDDåˆ›å»º&quot; class=&quot;headerlink&quot; title=&quot;RDDåˆ›å»º&quot;&gt;&lt;/a&gt;RDDåˆ›å»º&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;é€šè¿‡å¹¶è¡ŒåŒ–é›†åˆåˆ›å»ºï¼ˆæœ¬åœ°å¯¹è±¡è½¬åŒ–ä¸ºåˆ†å¸ƒå¼RDDï¼‰&lt;/li&gt;
&lt;li&gt;è¯»å–å¤–éƒ¨æ•°æ®æºï¼ˆè¯»æ–‡ä»¶ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;å¹¶è¡ŒåŒ–åˆ›å»º&quot;&gt;&lt;a href=&quot;#å¹¶è¡ŒåŒ–åˆ›å»º&quot; class=&quot;headerlink&quot; title=&quot;å¹¶è¡ŒåŒ–åˆ›å»º&quot;&gt;&lt;/a&gt;å¹¶è¡ŒåŒ–åˆ›å»º&lt;/h4&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# arg1: é›†åˆå¯¹è±¡ï¼Œå¦‚ï¼šlist&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# arg2ï¼šå¯é€‰ï¼ŒæŒ‡å®šåˆ†åŒºæ•°é‡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rdd = SparkContext.parallelize(arg1, arg2)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;è¯»å–æ–‡ä»¶&quot;&gt;&lt;a href=&quot;#è¯»å–æ–‡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;è¯»å–æ–‡ä»¶&quot;&gt;&lt;/a&gt;è¯»å–æ–‡ä»¶&lt;/h4&gt;&lt;p&gt;é€šè¿‡textFile APIæ¥è¯»å–æœ¬åœ°æˆ–è€…hdfsçš„æ•°æ®&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# arg1: æ–‡ä»¶è·¯å¾„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# arg2ï¼šå¯é€‰ï¼Œæœ€å°åˆ†åŒºæ•°é‡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# å½“arg2è¶…å‡ºsparkå…è®¸èŒƒå›´ï¼Œå‚æ•°å¤±æ•ˆ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SparkContext.textFile(arg1, arg2)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é€šè¿‡wholeTextFile APIæ¥è¯»å–å°æ–‡ä»¶ï¼Œè¿™ä¸ªapiåå‘äºå°‘é‡åˆ†åŒºè¯»å–æ•°æ®ï¼Œæ˜¯pysparkåŸºäºå°æ–‡ä»¶çš„ä¼˜åŒ–&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# arg1ï¼šæ–‡ä»¶è·¯å¾„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# arg2ï¼šå¯é€‰ï¼Œæœ€å°åˆ†åŒºæ•°é‡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# å½“arg2è¶…å‡ºsparkå…è®¸èŒƒå›´ï¼Œå‚æ•°å¤±æ•ˆ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SparkContext.wholeTextFiles(arg1, arg2)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="BigData" scheme="http://yoursite.com/categories/BigData/"/>
    
    
    <category term="spark" scheme="http://yoursite.com/tags/spark/"/>
    
    <category term="pyspark" scheme="http://yoursite.com/tags/pyspark/"/>
    
  </entry>
  
  <entry>
    <title>Pyspark</title>
    <link href="http://yoursite.com/2022/12/05/Pyspark/"/>
    <id>http://yoursite.com/2022/12/05/Pyspark/</id>
    <published>2022-12-05T08:45:40.000Z</published>
    <updated>2022-12-07T05:47:29.586Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><h2 id="Pysparkåº“å®‰è£…"><a href="#Pysparkåº“å®‰è£…" class="headerlink" title="Pysparkåº“å®‰è£…"></a>Pysparkåº“å®‰è£…</h2><p>ï¼ˆæœ¬æ–‡åŸºäºä¸Šæ–‡sparkåŸºç¡€ï¼‰</p><h3 id="Pythonåº“å®‰è£…"><a href="#Pythonåº“å®‰è£…" class="headerlink" title="Pythonåº“å®‰è£…"></a>Pythonåº“å®‰è£…</h3><p>åœ¨ä¸‰å°æœºå™¨åˆ†åˆ«å®‰è£…pyspark</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda activate pyspark</span><br><span class="line">pip install pyspark -i https://mirror.baidu.com/pypi/simple</span><br></pre></td></tr></table></figure><h3 id="Windowsè¡¥ä¸"><a href="#Windowsè¡¥ä¸" class="headerlink" title="Windowsè¡¥ä¸"></a>Windowsè¡¥ä¸</h3><p>å°†hadoop.dllç½®äºC:/windows/system32/ç›®å½•ä¸‹ï¼Œç„¶åé…ç½®hadoopå·¥å…·åŒ…çš„ç¯å¢ƒå˜é‡</p><p><img src="/2022/12/05/Pyspark/A.png" alt></p><p>å®‰è£…ç›¸å…³pythonåº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pyspark pyhive pymysql jieba -i https://mirror.baidu.com/pypi/simple</span><br></pre></td></tr></table></figure><h3 id="ä¸ºpycharmæ·»åŠ sshè§£é‡Šå™¨ç¯å¢ƒ"><a href="#ä¸ºpycharmæ·»åŠ sshè§£é‡Šå™¨ç¯å¢ƒ" class="headerlink" title="ä¸ºpycharmæ·»åŠ sshè§£é‡Šå™¨ç¯å¢ƒ"></a>ä¸ºpycharmæ·»åŠ sshè§£é‡Šå™¨ç¯å¢ƒ</h3><p><img src="/2022/12/05/Pyspark/B.png" alt></p><p><img src="/2022/12/05/Pyspark/C.png" alt></p><p><img src="/2022/12/05/Pyspark/D.png" alt></p><a id="more"></a><h2 id="SparkContextå¯¹è±¡"><a href="#SparkContextå¯¹è±¡" class="headerlink" title="SparkContextå¯¹è±¡"></a>SparkContextå¯¹è±¡</h2><p>Spark Applicationç¨‹åºçš„å…¥å£ä¸ºSparkContextã€‚ä»»ä½•ä¸€ä¸ªsparkåº”ç”¨éƒ½è¦å…ˆæ„å»ºSparkContextå¯¹è±¡ï¼š</p><ul><li>åˆ›å»ºSparkConfå¯¹è±¡</li><li>åŸºäºSparkConfåˆ›å»ºSparkContext</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conf = SparkConf().setAppName(appName).setMaster(master)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br></pre></td></tr></table></figure><h2 id="WorldCountæµ‹è¯•ç¨‹åº"><a href="#WorldCountæµ‹è¯•ç¨‹åº" class="headerlink" title="WorldCountæµ‹è¯•ç¨‹åº"></a>WorldCountæµ‹è¯•ç¨‹åº</h2><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>åœ¨pycharmä¸­æ–°å»ºpythonè„šæœ¬ï¼Œé€šè¿‡è§£é‡Šå™¨æ‰§è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf8</span></span><br><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"><span class="comment"># æäº¤åˆ°yarné›†ç¾¤æ‰§è¡Œæ—¶ï¼Œéœ€é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="comment"># import os</span></span><br><span class="line"><span class="comment"># os.environ["HADOOP_CONF_DIR"] = "/usr/local/hadoop/etc/hadoop"</span></span><br><span class="line"><span class="comment"># os.environ["YARN_CONF_DIR"] = "/usr/local/hadoop/etc/hadoop"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># é€šè¿‡è„šæœ¬æ‰§è¡Œæ—¶æ— éœ€åœ¨ä»£ç ä¸­æŒ‡å®šMaster</span></span><br><span class="line">    <span class="comment"># conf = SparkConf().setAppName("WordCountHelloWorld")</span></span><br><span class="line">    <span class="comment"># ç›´æ¥åœ¨pycharmæ‰§è¡Œ</span></span><br><span class="line">    conf = SparkConf().setAppName(<span class="string">"WordCountHelloWorld"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">    <span class="comment"># é€šè¿‡SparkConfå¯¹è±¡æ„å»ºSparkContextå¯¹è±¡</span></span><br><span class="line">    sc = SparkContext(conf=conf)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># éœ€æ±‚ : wordcountå•è¯è®¡æ•°, è¯»å–HDFSä¸Šçš„words.txtæ–‡ä»¶, å¯¹å…¶å†…éƒ¨çš„å•è¯ç»Ÿè®¡å‡ºç° çš„æ•°é‡</span></span><br><span class="line">    <span class="comment"># è¯»å–hdfsæ–‡ä»¶</span></span><br><span class="line">    file_rdd = sc.textFile(<span class="string">"hdfs://master:8020/input/words.txt"</span>)</span><br><span class="line">    <span class="comment"># è¯»å–æœ¬åœ°æ–‡ä»¶</span></span><br><span class="line">    <span class="comment"># file_rdd = sc.textFile("/usr/local/words.txt")</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†å•è¯è¿›è¡Œåˆ‡å‰², å¾—åˆ°ä¸€ä¸ªå­˜å‚¨å…¨éƒ¨å•è¯çš„é›†åˆå¯¹è±¡</span></span><br><span class="line">    words_rdd = file_rdd.flatMap(<span class="keyword">lambda</span> line: line.split(<span class="string">" "</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†å•è¯è½¬æ¢ä¸ºå…ƒç»„å¯¹è±¡, keyæ˜¯å•è¯, valueæ˜¯æ•°å­—1</span></span><br><span class="line">    words_with_one_rdd = words_rdd.map(<span class="keyword">lambda</span> x: (x, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†å…ƒç»„çš„value æŒ‰ç…§keyæ¥åˆ†ç»„, å¯¹æ‰€æœ‰çš„valueæ‰§è¡Œèšåˆæ“ä½œ(ç›¸åŠ )</span></span><br><span class="line">    result_rdd = words_with_one_rdd.reduceByKey(<span class="keyword">lambda</span> a, b: a + b)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é€šè¿‡collectæ–¹æ³•æ”¶é›†RDDçš„æ•°æ®æ‰“å°è¾“å‡ºç»“æœ</span></span><br><span class="line">    print(result_rdd.collect())</span><br></pre></td></tr></table></figure><h3 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h3><p>åœ¨æ ¹ç›®å½•åˆ›å»ºä¸€ä»½pyè„šæœ¬ï¼Œé€šè¿‡sparkå®¢æˆ·ç«¯æ‰§è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/spark/bin/spark-submit --master local[*] /root/helloworld.py</span><br><span class="line">/usr/local/spark/bin/spark-submit --master yarn /root/helloworld.py</span><br></pre></td></tr></table></figure><h2 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h2><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><p>æ„å»ºSparkContextå¯¹è±¡ç­‰éä»»åŠ¡å¤„ç†ç”±Driveræ‰§è¡Œï¼ŒRDDæ•°æ®ä»»åŠ¡å¤„ç†ç”±Executoræ‰§è¡Œï¼Œå†ç”±Driverå¤„ç†åˆ†å¸ƒå¼è®¡ç®—ç»“æœ</p><h3 id="Master-Node"><a href="#Master-Node" class="headerlink" title="Master Node"></a>Master Node</h3><p>sparkè‡ªèº«çš„JVMæ¡†æ¶JVM Driverå’ŒJVM Executorä¹‹é—´å¯ä»¥ç›¸äº’é€šè®¯ï¼ŒPythoné€šè¿‡æ„å»ºSparkContextå¯¹è±¡ä¸JVM Driverè¿›è¡Œè¿æ¥ï¼ˆPythonçš„Driverä»£ç ç¿»è¯‘æˆJVMä»£ç -py4jåº“ï¼Œå˜æˆJVM Driverï¼‰</p><h3 id="Worker-Node"><a href="#Worker-Node" class="headerlink" title="Worker Node"></a>Worker Node</h3><p>Driverçš„æ“ä½œæŒ‡ä»¤å‘é€ç»™JVM Executorï¼ˆRPCï¼‰ï¼ŒJVM Executorå†é€šè¿‡pysparkå®ˆæŠ¤è¿›ç¨‹å°†æŒ‡ä»¤å‘é€ç»™pysparkå®ˆæŠ¤è¿›ç¨‹ï¼Œpysparkå®ˆæŠ¤è¿›ç¨‹å°†æŒ‡ä»¤è°ƒåº¦åˆ°è¿è¡Œçš„pythonè¿›ç¨‹ä¸­å»ã€‚Executorç«¯æœ¬è´¨ä¸Šæ˜¯ç”±pythonè¿›ç¨‹å†å·¥ä½œ</p><p>Driveræ®µæ˜¯ç›´æ¥ç”±py4jç›´æ¥ç¿»è¯‘è¿‡å»ï¼ŒExecutorç«¯åˆ™æ˜¯è½¬å‘</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Pysparkåº“å®‰è£…&quot;&gt;&lt;a href=&quot;#Pysparkåº“å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;Pysparkåº“å®‰è£…&quot;&gt;&lt;/a&gt;Pysparkåº“å®‰è£…&lt;/h2&gt;&lt;p&gt;ï¼ˆæœ¬æ–‡åŸºäºä¸Šæ–‡sparkåŸºç¡€ï¼‰&lt;/p&gt;
&lt;h3 id=&quot;Pythonåº“å®‰è£…&quot;&gt;&lt;a href=&quot;#Pythonåº“å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;Pythonåº“å®‰è£…&quot;&gt;&lt;/a&gt;Pythonåº“å®‰è£…&lt;/h3&gt;&lt;p&gt;åœ¨ä¸‰å°æœºå™¨åˆ†åˆ«å®‰è£…pyspark&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;conda activate pyspark&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install pyspark -i https://mirror.baidu.com/pypi/simple&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;Windowsè¡¥ä¸&quot;&gt;&lt;a href=&quot;#Windowsè¡¥ä¸&quot; class=&quot;headerlink&quot; title=&quot;Windowsè¡¥ä¸&quot;&gt;&lt;/a&gt;Windowsè¡¥ä¸&lt;/h3&gt;&lt;p&gt;å°†hadoop.dllç½®äºC:/windows/system32/ç›®å½•ä¸‹ï¼Œç„¶åé…ç½®hadoopå·¥å…·åŒ…çš„ç¯å¢ƒå˜é‡&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2022/12/05/Pyspark/A.png&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;å®‰è£…ç›¸å…³pythonåº“&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;pip install pyspark pyhive pymysql jieba -i https://mirror.baidu.com/pypi/simple&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;ä¸ºpycharmæ·»åŠ sshè§£é‡Šå™¨ç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#ä¸ºpycharmæ·»åŠ sshè§£é‡Šå™¨ç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºpycharmæ·»åŠ sshè§£é‡Šå™¨ç¯å¢ƒ&quot;&gt;&lt;/a&gt;ä¸ºpycharmæ·»åŠ sshè§£é‡Šå™¨ç¯å¢ƒ&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;/2022/12/05/Pyspark/B.png&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2022/12/05/Pyspark/C.png&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2022/12/05/Pyspark/D.png&quot; alt&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="BigData" scheme="http://yoursite.com/categories/BigData/"/>
    
    
    <category term="spark" scheme="http://yoursite.com/tags/spark/"/>
    
    <category term="pyspark" scheme="http://yoursite.com/tags/pyspark/"/>
    
  </entry>
  
  <entry>
    <title>SparkåŸºç¡€</title>
    <link href="http://yoursite.com/2022/12/01/Spark%E5%9F%BA%E7%A1%80/"/>
    <id>http://yoursite.com/2022/12/01/Spark%E5%9F%BA%E7%A1%80/</id>
    <published>2022-12-01T07:40:17.000Z</published>
    <updated>2023-04-13T01:43:42.844Z</updated>
    
    <content type="html"><![CDATA[<script src="\assets\js\APlayer.min.js"> </script><p><font color="gold">å®šä¹‰</font>ï¼š<font color="gold">Apache Sparkæ˜¯ç”¨äºå¤§è§„æ¨¡æ•°æ®å¤„ç†çš„ç»Ÿä¸€åˆ†æå¼•æ“ã€‚</font>å…¶æ ¸å¿ƒæ•°æ®ç»“æ„ï¼šå¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼ˆRDDï¼‰èƒ½å¤Ÿåœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­åšå†…å­˜è¿ç®—ï¼Œä¸”å…·æœ‰ä¸€å®šå®¹é”™æ–¹å¼ã€‚</p><h2 id="Sparkæ¡†æ¶"><a href="#Sparkæ¡†æ¶" class="headerlink" title="Sparkæ¡†æ¶"></a>Sparkæ¡†æ¶</h2><h3 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h3><p><font color="orange"><strong>Â· Spark Core</strong></font>ï¼šä»¥RDDä¸ºæ•°æ®æŠ½è±¡ï¼Œæä¾›Pythonã€Javaã€Scalaã€Rè¯­è¨€çš„APIå’ŒSparkçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæ˜¯Sparkè¿è¡Œçš„åŸºç¡€ï¼›</p><p><font color="orange"><strong>Â· SparkSQL</strong></font>ï¼šåŸºäºSparkCoreï¼Œæä¾›æœºæ„åŒ–æ•°æ®å¤„ç†æ¨¡å—ï¼Œæ”¯æŒä»¥SQLè¯­è¨€å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼›åŒæ—¶å¯ä»¥ä½œä¸ºStructuredStreamingæ¨¡å—çš„åŸºç¡€ï¼Œè¿›è¡Œæ•°æ®æµå¼è®¡ç®—ï¼›</p><p><font color="orange"><strong>Â· SparkStreaming</strong></font>ï¼šåŸºäºSparkCoreï¼Œæä¾›æ•°æ®æµå¼è®¡ç®—ï¼›</p><p><font color="orange"><strong>Â· MLlib</strong></font>ï¼šåŸºäºSparkCoreï¼Œå†…ç½®å¤§é‡æœºå™¨å­¦ä¹ åº“å’Œç®—æ³•APIï¼Œè¿›è¡Œæœºå™¨å­¦ä¹ è®¡ç®—ï¼›</p><p><font color="orange"><strong>Â· GraphX</strong></font>ï¼šåŸºäºSparkCoreï¼Œæä¾›äº†å¤§é‡å›¾è®¡ç®—APIï¼Œç”¨äºåˆ†å¸ƒå¼å›¾è®¡ç®—</p><h3 id="è¿è¡Œæ¨¡å¼"><a href="#è¿è¡Œæ¨¡å¼" class="headerlink" title="è¿è¡Œæ¨¡å¼"></a>è¿è¡Œæ¨¡å¼</h3><p><strong>Â· æœ¬åœ°æ¨¡å¼ï¼ˆå•æœº/localï¼‰</strong>ï¼šä»¥ä¸€ä¸ªç‹¬ç«‹è¿›ç¨‹ï¼Œé€šè¿‡å†…éƒ¨çš„å¤šçº¿ç¨‹æ¨¡æ‹ŸSparkè¿è¡Œç¯å¢ƒ</p><p><strong>Â· Standaloneæ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰</strong>ï¼šSparkçš„å„ä¸ªè§’è‰²ä»¥ç‹¬ç«‹è¿›ç¨‹å½¢å¼å­˜åœ¨ï¼Œç»„æˆé›†ç¾¤ç¯å¢ƒ</p><p><strong>Â· Hadoop YARNæ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰</strong>ï¼šSparkçš„å„ä¸ªè§’è‰²è¿è¡Œåœ¨YARNå®¹å™¨å†…éƒ¨ï¼Œç»„æˆé›†ç¾¤ç¯å¢ƒ</p><p><strong>Â· Kubernetesæ¨¡å¼ï¼ˆå®¹å™¨é›†ç¾¤ï¼‰</strong>ï¼šSparkçš„å„ä¸ªè§’è‰²è¿è¡Œåœ¨Kuberneteså®¹å™¨å†…éƒ¨ï¼Œç»„æˆé›†ç¾¤ç¯å¢ƒ</p><p><strong>Â· äº‘æœåŠ¡æ¨¡å¼</strong></p><h3 id="è§’è‰²"><a href="#è§’è‰²" class="headerlink" title="è§’è‰²"></a>è§’è‰²</h3><ul><li><strong>èµ„æº</strong></li></ul><p><strong>Â· Masterè§’è‰²</strong>ï¼šé›†ç¾¤èµ„æºç®¡ç†</p><p><strong>Â· Workerè§’è‰²</strong>ï¼šå•æœºèµ„æºç®¡ç†(æ‰€åœ¨æœåŠ¡å™¨èµ„æºç®¡ç†)</p><ul><li><strong>ä»»åŠ¡</strong></li></ul><p><strong>Â· Driverè§’è‰²</strong>ï¼šå•ä¸ªä»»åŠ¡ç®¡ç†</p><p><strong>Â· Executorè§’è‰²</strong>ï¼šå•ä¸ªä»»åŠ¡è®¡ç®—</p><a id="more"></a><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><h3 id="Hadoopä¼ªåˆ†å¸ƒå¼æ­å»º"><a href="#Hadoopä¼ªåˆ†å¸ƒå¼æ­å»º" class="headerlink" title="Hadoopä¼ªåˆ†å¸ƒå¼æ­å»º"></a>Hadoopä¼ªåˆ†å¸ƒå¼æ­å»º</h3><h4 id="å‡†å¤‡masterè™šæ‹Ÿæœº"><a href="#å‡†å¤‡masterè™šæ‹Ÿæœº" class="headerlink" title="å‡†å¤‡masterè™šæ‹Ÿæœº"></a>å‡†å¤‡masterè™šæ‹Ÿæœº</h4><ul><li>é…ç½®é™æ€ip</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-ens33</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#ä¿®æ”¹</span><br><span class="line">BOOTPROTO=&quot;static&quot;</span><br><span class="line">ONBOOT=&quot;yes&quot;</span><br><span class="line"></span><br><span class="line"># æ–°å¢</span><br><span class="line">IPADDR=&quot;192.168.80.129&quot;</span><br><span class="line">GATEWAY=&quot;192.168.80.2&quot;</span><br><span class="line">NETMASK=&quot;255.255.255.0&quot;</span><br><span class="line">DNS1=&quot;8.8.8.8&quot;</span><br><span class="line">DNS2=&quot;114.114.114.114&quot;</span><br><span class="line">IPV6_PRIVACY=&quot;no&quot;</span><br></pre></td></tr></table></figure><ul><li>é‡å¯ç½‘å¡æœåŠ¡</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure><ul><li>å…³é—­é˜²ç«å¢™ï¼Œå¹¶ç¦æ­¢é˜²ç«å¢™å¼€æœºè‡ªå¯</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure><ul><li>å…³é—­selinux</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/selinux/config</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># This file controls the state of SELinux on the system.</span><br><span class="line"># SELINUX= can take one of these three values:</span><br><span class="line">#     enforcing - SELinux security policy is enforced.</span><br><span class="line">#     permissive - SELinux prints warnings instead of enforcing.</span><br><span class="line">#     disabled - No SELinux policy is loaded.</span><br><span class="line">SELINUX=disabled</span><br><span class="line"># SELINUXTYPE= can take one of three values:</span><br><span class="line">#     targeted - Targeted processes are protected,</span><br><span class="line">#     minimum - Modification of targeted policy. Only selected processes are protected. </span><br><span class="line">#     mls - Multi Level Security protection.</span><br><span class="line">SELINUXTYPE=targeted</span><br></pre></td></tr></table></figure><ul><li>é‡å¯master</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure><p>é‡å¯å®Œæˆåå°†ç›¸å…³è½¯ä»¶åŒ…ï¼ˆjdkã€hadoopã€sparkç­‰ï¼‰å¯¼å…¥è‡³/usr/localç›®å½•ä¸‹å¹¶è§£å‹</p><ul><li>è§£å‹jdk</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf jdk-8u211-linux-x64.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure><p>é…ç½®jdkç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#set java environment </span><br><span class="line">JAVA_HOME=/usr/local/jdk1.8.0_211</span><br><span class="line">CLASSPATH=.:$JAVA_HOME/lib </span><br><span class="line">PATH=$JAVA_HOME/bin:$PATH </span><br><span class="line">export JAVA_HOME CLASSPATH PATH</span><br></pre></td></tr></table></figure><p>é‡å¯ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java version &quot;1.8.0_211&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_211-b12)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.211-b12, mixed mode)</span><br></pre></td></tr></table></figure><h4 id="é…ç½®linuxé›†ç¾¤"><a href="#é…ç½®linuxé›†ç¾¤" class="headerlink" title="é…ç½®linuxé›†ç¾¤"></a>é…ç½®linuxé›†ç¾¤</h4><p>å°†masterå®Œæ•´å…‹éš†ä¸¤å°node1ã€node2æœºå™¨ï¼Œé…ç½®é™æ€ip</p><p>é…ç½®ä¸»æœºåï¼Œåˆ†åˆ«æ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hostname</span><br></pre></td></tr></table></figure><p>å°†ä¸‰å°æœºå™¨çš„ä¸»æœºåè®¾ç½®ä¸ºmasterã€node1ã€node2</p><p>é…ç½®ä¸‰å°è™šæ‹Ÿæœºçš„åŸŸåæ˜ å°„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line">192.168.80.129 master</span><br><span class="line">192.168.80.130 node1</span><br><span class="line">192.168.80.131 node2</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ä¸‰å°æœºå™¨å·²ç»å¯ä»¥äº’ç›¸pingé€š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ping master</span><br><span class="line">ping node1</span><br><span class="line">ping node2</span><br></pre></td></tr></table></figure><p>åˆ†åˆ«é‡å¯ä¸‰å°æœºå™¨</p><p>ç”Ÿæˆä¸‰å°æœºå™¨çš„å…¬é’¥å’Œç§é’¥ï¼Œåˆ†åˆ«æ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p>åå¤å›è½¦ï¼Œåœ¨/root/.sshéšè—ç›®å½•ä¸‹ç”Ÿæˆç§é’¥id_rsaå’Œå…¬é’¥id_rsa.pub</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Created directory &apos;/root/.ssh&apos;.</span><br><span class="line">Enter passphrase (empty for no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:/Vd3sEsHhz3CcxGwbRp5lj6+srZ7OpwAvyKS+qoTi9Q root@master</span><br><span class="line">The key&apos;s randomart image is:</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|             ..o.|</span><br><span class="line">|            . +oo|</span><br><span class="line">|             B+Oo|</span><br><span class="line">|         o    @=.|</span><br><span class="line">|  .     S +  .oo=|</span><br><span class="line">| o E       + ..++|</span><br><span class="line">|o o   .     = +. |</span><br><span class="line">|.o   o . . . B ..|</span><br><span class="line">| .oo+.. . . .=O. |</span><br><span class="line">+----[SHA256]-----+</span><br></pre></td></tr></table></figure><p>åœ¨ä¸‰å°è™šæ‹Ÿæœºæ‰§è¡Œå‘½ä»¤å°†å…¬é’¥æ‹·è´åˆ°master</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id master</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">The authenticity of host &apos;master (192.168.80.129)&apos; can&apos;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:9UGNQgh5SWXh/1Z9iWTOzBSbqXf8kjbxc5SC73j9ct4.</span><br><span class="line">ECDSA key fingerprint is MD5:ee:b1:5d:3c:a5:2b:2e:08:cd:85:44:68:fe:c7:29:d9.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span><br><span class="line">root@master&apos;s password: </span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   &quot;ssh &apos;master&apos;&quot;</span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br></pre></td></tr></table></figure><p>å°†masterçš„å…¬é’¥æ‹·è´åˆ°nodeä¸Š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp /root/.ssh/authorized_keys node1:/root/.ssh</span><br><span class="line">scp /root/.ssh/authorized_keys node2:/root/.ssh</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">The authenticity of host &apos;node1 (192.168.80.130)&apos; can&apos;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:9UGNQgh5SWXh/1Z9iWTOzBSbqXf8kjbxc5SC73j9ct4.</span><br><span class="line">ECDSA key fingerprint is MD5:ee:b1:5d:3c:a5:2b:2e:08:cd:85:44:68:fe:c7:29:d9.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added &apos;node1,192.168.80.130&apos; (ECDSA) to the list of known hosts.</span><br><span class="line">root@node1&apos;s password: </span><br><span class="line">authorized_keys                                      100% 1177     1.2MB/s   00:00</span><br></pre></td></tr></table></figure><p>æµ‹è¯•sshå…å¯†ç™»å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh node1</span><br><span class="line">ssh node2</span><br><span class="line">exit</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…hadoop"><a href="#å®‰è£…hadoop" class="headerlink" title="å®‰è£…hadoop"></a>å®‰è£…hadoop</h4><p>è§£å‹å®‰è£…åŒ…å¹¶é‡å‘½å</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf hadoop-3.3.1.tar.gz -C /usr/local</span><br><span class="line">mv hadoop-3.3.1 hadoop</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/hadoop/etc/hadoop</span><br></pre></td></tr></table></figure><p>hadoop-env.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim hadoop-env.sh</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/local/jdk1.8.0_211</span><br><span class="line">export HDFS_NAMENODE_USER=root</span><br><span class="line">export HDFS_DATANODE_USER=root</span><br><span class="line">export HDFS_SECONDARYNAMENODE_USER=root</span><br><span class="line">export YARN_RESOURCEMANAGER_USER=root</span><br><span class="line">export YARN_NODEMANAGER_USER=root</span><br></pre></td></tr></table></figure><p>core-site.xml</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim core-site.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è®¾ç½®é»˜è®¤ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿ Hadoopæ”¯æŒfileã€HDFSã€GFSã€ali|Amazonäº‘ç­‰æ–‡ä»¶ç³»ç»Ÿ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://master:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- è®¾ç½®Hadoopæœ¬åœ°ä¿å­˜æ•°æ®è·¯å¾„ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/data/hadoop<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- è®¾ç½®HDFS web UIç”¨æˆ·èº«ä»½ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.http.staticuser.user<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ•´åˆhive ç”¨æˆ·ä»£ç†è®¾ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.root.hosts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.root.groups<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>hdfs-site.xml</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim hdfs-site.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è®¾ç½®SNNè¿›ç¨‹è¿è¡Œæœºå™¨ä½ç½®ä¿¡æ¯ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>node1:9868<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>mapred-site.xml</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim mapred-site.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è®¾ç½®MRç¨‹åºé»˜è®¤è¿è¡Œæ¨¡å¼ï¼š yarné›†ç¾¤æ¨¡å¼ localæœ¬åœ°æ¨¡å¼ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- MRç¨‹åºå†å²æœåŠ¡å™¨ç«¯åœ°å€ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>master:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å†å²æœåŠ¡å™¨webç«¯åœ°å€ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>master:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.app.mapreduce.am.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=$&#123;HADOOP_HOME&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=$&#123;HADOOP_HOME&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=$&#123;HADOOP_HOME&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>yarn-site.xml</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim yarn-site.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è®¾ç½®YARNé›†ç¾¤ä¸»è§’è‰²è¿è¡Œæœºå™¨ä½ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>master<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ˜¯å¦å°†å¯¹å®¹å™¨å®æ–½ç‰©ç†å†…å­˜é™åˆ¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.pmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ˜¯å¦å°†å¯¹å®¹å™¨å®æ–½è™šæ‹Ÿå†…å­˜é™åˆ¶ã€‚ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å¼€å¯æ—¥å¿—èšé›† --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation-enable<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- è®¾ç½®yarnå†å²æœåŠ¡å™¨åœ°å€ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log.server.url<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>http://master:19888/jobhistory/logs<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ä¿å­˜çš„æ—¶é—´7å¤© --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation.retain-seconds<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>604800<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>workers</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim workers</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">master</span><br><span class="line">node1</span><br><span class="line">node2</span><br></pre></td></tr></table></figure><p>slaves</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim workers</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">master</span><br><span class="line">node1</span><br><span class="line">node2</span><br></pre></td></tr></table></figure><p>å°†å®‰è£…åŒ…åˆ†å‘è‡³å…¶ä»–æœºå™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local</span><br><span class="line">scp -r hadoop root@node1:/usr/local</span><br><span class="line">scp -r hadoop root@node2:/usr/local</span><br></pre></td></tr></table></figure><p>é…ç½®hadoopç¯å¢ƒå˜é‡ï¼Œåˆ†å‘è‡³å…¶ä»–æœºå™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># set hadoop env</span><br><span class="line">export HADOOP_HOME=/usr/local/hadoop</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp /etc/profile node1:/etc/</span><br><span class="line">scp /etc/profile node2:/etc/</span><br></pre></td></tr></table></figure><p>åœ¨ä¸‰å°æœºå™¨åˆ†åˆ«é‡å¯ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><p>é¦–æ¬¡å¯åŠ¨ï¼Œå…ˆæ ¼å¼åŒ–namenode</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin hdfs namenode -format</span><br></pre></td></tr></table></figure><p>å¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">start-dfs.sh</span><br><span class="line">start-yarn.sh</span><br><span class="line">mapred --daemon start historyserver</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start-all.sh</span><br><span class="line">mapred --daemon start historyserver</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ä»»åŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jps</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">61488 Jps</span><br><span class="line">60417 NameNode</span><br><span class="line">60597 DataNode</span><br><span class="line">60981 ResourceManager</span><br><span class="line">61133 NodeManager</span><br><span class="line">61567 JobHistoryServer</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹webé¡µé¢ï¼ˆhadoop3.0ç‰ˆæœ¬ä»¥åwebç«¯å£è·Ÿæ”¹ä¸º9870ï¼‰</p><p><code>master:9870</code></p><p><img src="/2022/12/01/SparkåŸºç¡€/A.png" alt></p><p>å…³é—­ä»»åŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stop-dfs.sh</span><br><span class="line">stop-yarn.sh</span><br><span class="line">mapred --daemon stop historyserver</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stop-all.sh</span><br><span class="line">mapred --daemon stop historyserver</span><br></pre></td></tr></table></figure><h3 id="Anaconda3å®‰è£…"><a href="#Anaconda3å®‰è£…" class="headerlink" title="Anaconda3å®‰è£…"></a>Anaconda3å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh ./Anaconda3-2021.05-Linux-x86_64.sh</span><br></pre></td></tr></table></figure><p>é…ç½®æ¸…åæº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.condarc</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">channels:</span><br><span class="line">  - defaults</span><br><span class="line">show_channel_urls: true</span><br><span class="line">default_channels:</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2</span><br><span class="line">custom_channels:</span><br><span class="line">  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br></pre></td></tr></table></figure><p>åˆ›å»ºpysparkè™šæ‹Ÿç¯å¢ƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n pyspark python=3.8</span><br></pre></td></tr></table></figure><h3 id="Spark-localæ¨¡å¼æ­å»º"><a href="#Spark-localæ¨¡å¼æ­å»º" class="headerlink" title="Spark localæ¨¡å¼æ­å»º"></a>Spark localæ¨¡å¼æ­å»º</h3><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>è§£å‹sparkå®‰è£…åŒ…å¹¶é‡å‘½å</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf spark-3.2.0-bin-hadoop3.2.tgz -C /usr/local</span><br><span class="line">mv spark-3.2.0-bin-hadoop3.2 spark</span><br></pre></td></tr></table></figure><p>é…ç½®ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export SPARK_HOME=/usr/local/spark</span><br><span class="line">export PYSPARK_PYTHON=/usr/local/anaconda3/envs/pyspark/bin/python3.8</span><br><span class="line">export HADOOP_CONF_DIR=$HADOOP_HOME/etc/hadoop</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><p><font color="gold">æ³¨</font>ï¼šæŸ¥æ‰¾pysparkè™šæ‹Ÿç¯å¢ƒä½ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/anaconda3/envs/pyspark/bin</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/local/jdk1.8.0_211</span><br><span class="line">export PYSPARK_PYTHON=/usr/local/anaconda3/envs/pyspark/bin/python3.8</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨pysparkäº¤äº’å¼è§£é‡Šå™¨"><a href="#å¯åŠ¨pysparkäº¤äº’å¼è§£é‡Šå™¨" class="headerlink" title="å¯åŠ¨pysparkäº¤äº’å¼è§£é‡Šå™¨"></a>å¯åŠ¨pysparkäº¤äº’å¼è§£é‡Šå™¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/pyspark</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Python 3.8.8 (default, Apr 13 2021, 19:58:26) </span><br><span class="line">[GCC 7.3.0] :: Anaconda, Inc. on linux</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br><span class="line">Using Spark&apos;s default log4j profile: org/apache/spark/log4j-defaults.properties</span><br><span class="line">Setting default log level to &quot;WARN&quot;.</span><br><span class="line">To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).</span><br><span class="line">22/12/02 17:38:56 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br><span class="line">Welcome to</span><br><span class="line">      ____              __</span><br><span class="line">     / __/__  ___ _____/ /__</span><br><span class="line">    _\ \/ _ \/ _ `/ __/  &apos;_/</span><br><span class="line">   /__ / .__/\_,_/_/ /_/\_\   version 3.2.0</span><br><span class="line">      /_/</span><br><span class="line"></span><br><span class="line">Using Python version 3.8.8 (default, Apr 13 2021 19:58:26)</span><br><span class="line">Spark context Web UI available at http://master:4040</span><br><span class="line">Spark context available as &apos;sc&apos; (master = local[*], app id = local-1669973937905).</span><br><span class="line">SparkSession available as &apos;spark&apos;.</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure><p>è¿›å…¥æµè§ˆå™¨ä»»åŠ¡é¡µé¢<code>master:4040</code>ï¼Œå¯ä»¥æŸ¥çœ‹ä¿¡æ¯</p><p><img src="/2022/12/01/SparkåŸºç¡€/B.png" alt></p><p>æ‰§è¡Œä¸€æ¡pysparkæŒ‡ä»¤åï¼š</p><p><img src="/2022/12/01/SparkåŸºç¡€/C.png" alt></p><h3 id="Spark-StandAloneæ¨¡å¼æ­å»º"><a href="#Spark-StandAloneæ¨¡å¼æ­å»º" class="headerlink" title="Spark StandAloneæ¨¡å¼æ­å»º"></a>Spark StandAloneæ¨¡å¼æ­å»º</h3><h4 id="StandAlone"><a href="#StandAlone" class="headerlink" title="StandAlone"></a>StandAlone</h4><p>StandAloneæ¨¡å¼æ˜¯Sparkè‡ªå¸¦çš„é›†ç¾¤æ¨¡å¼ï¼ŒMasterè§’è‰²ä»¥Masterè¿›ç¨‹å½¢å¼å­˜åœ¨ï¼ŒWorkerè§’è‰²ä»¥Workerè¿›ç¨‹å½¢å¼å­˜åœ¨ã€‚å…¶ä¸­Driverè§’è‰²è¿è¡Œåœ¨Masterè¿›ç¨‹å†…ï¼ŒExecutorè§’è‰²è¿è¡Œåœ¨Workerè¿›ç¨‹å†…ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥å¼€å¯ç¬¬ä¸‰ä¸ªè¿›ç¨‹ï¼šå†å²æœåŠ¡å™¨ï¼ˆHistoryServerï¼‰ï¼Œç”¨äºä¿å­˜Spark appè¿è¡Œåçš„äº‹ä»¶æ—¥å¿—ã€‚</p><h4 id="ç¯å¢ƒåˆ†å‘"><a href="#ç¯å¢ƒåˆ†å‘" class="headerlink" title="ç¯å¢ƒåˆ†å‘"></a>ç¯å¢ƒåˆ†å‘</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp Anaconda3-2021.05-Linux-x86_64.sh node1:`pwd`/</span><br><span class="line">scp Anaconda3-2021.05-Linux-x86_64.sh node2:`pwd`/</span><br></pre></td></tr></table></figure><p>è¿›å…¥node1ã€node2å®‰è£…anacondaï¼ŒåŒmasterï¼šé…ç½®condaæºï¼Œåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</p><p>å°†master:/etc/profileå’Œbashrcä¸­çš„ç¯å¢ƒå˜é‡å¤åˆ¶åˆ°node1ã€2ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scp /etc/profile node1:/etc/profile</span><br><span class="line">scp /etc/profile node2:/etc/profile</span><br><span class="line">scp ~/.bashrc node1:~/</span><br><span class="line">scp ~/.bashrc node2:~/</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºhadoopç”¨æˆ·ï¼ˆä»…æœ‰rootç”¨æˆ·å¯è·³è¿‡ï¼‰"><a href="#åˆ›å»ºhadoopç”¨æˆ·ï¼ˆä»…æœ‰rootç”¨æˆ·å¯è·³è¿‡ï¼‰" class="headerlink" title="åˆ›å»ºhadoopç”¨æˆ·ï¼ˆä»…æœ‰rootç”¨æˆ·å¯è·³è¿‡ï¼‰"></a>åˆ›å»ºhadoopç”¨æˆ·ï¼ˆä»…æœ‰rootç”¨æˆ·å¯è·³è¿‡ï¼‰</h4><p>hadoopç”¨æˆ·æ‹¥æœ‰yarnçš„æœ€é«˜æƒé™</p><p>æ–°å»ºç”¨æˆ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser hadoop</span><br><span class="line">passwd hadoop</span><br></pre></td></tr></table></figure><p>æ·»åŠ ç”¨æˆ·ç»„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -a -G hadoop hadoop</span><br></pre></td></tr></table></figure><p>èµ‹äºˆrootæƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sudoers</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">## Allow root to run any commands anywhere </span><br><span class="line">root    ALL=(ALL)       ALL</span><br><span class="line">hadoop    ALL=(ALL)       ALL</span><br></pre></td></tr></table></figure><p>æ·»åŠ æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/</span><br><span class="line">chown -R hadoop:hadoop hadoop*</span><br><span class="line">chown -R hadoop:hadoop spark*</span><br></pre></td></tr></table></figure><h4 id="é…ç½®sparké…ç½®æ–‡ä»¶"><a href="#é…ç½®sparké…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®sparké…ç½®æ–‡ä»¶"></a>é…ç½®sparké…ç½®æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su - hadoop</span><br><span class="line">cd /usr/local/spark/conf</span><br><span class="line">mv workers.template workers</span><br><span class="line">vim workers</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">master</span><br><span class="line">node1</span><br><span class="line">node2</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv spark-env.sh.template spark-env.sh</span><br><span class="line">vim spark-env.sh</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># è®¾ç½®JAVAå®‰è£…ç›®å½•</span></span></span><br><span class="line">JAVA_HOME=/usr/local/jdk1.8.0_211</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># HADOOPè½¯ä»¶é…ç½®æ–‡ä»¶ç›®å½•ï¼Œè¯»å–HDFSä¸Šæ–‡ä»¶å’Œè¿è¡ŒYARNé›†ç¾¤</span></span></span><br><span class="line">HADOOP_CONF_DIR=/usr/local/hadoop/etc/hadoop</span><br><span class="line">YARN_CONF_DIR=/usr/local/hadoop/etc/hadoop</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æŒ‡å®šspark masterçš„IPå’Œæäº¤ä»»åŠ¡çš„é€šä¿¡ç«¯å£</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‘ŠçŸ¥sparkçš„masterè¿è¡Œåœ¨å“ªä¸ªæœºå™¨ä¸Š</span></span><br><span class="line">export SPARK_MASTER_HOST=master</span><br><span class="line"><span class="meta">#</span><span class="bash"> å‘ŠçŸ¥sparkmasterçš„é€šè®¯ç«¯å£</span></span><br><span class="line">export SPARK_MASTER_PORT=7077</span><br><span class="line"><span class="meta">#</span><span class="bash"> å‘ŠçŸ¥spark masterçš„ webuiç«¯å£</span></span><br><span class="line">SPARK_MASTER_WEBUI_PORT=8080</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> worker cpuå¯ç”¨æ ¸æ•°</span></span><br><span class="line">SPARK_WORKER_CORES=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> workerå¯ç”¨å†…å­˜</span></span><br><span class="line">SPARK_WORKER_MEMORY=1g</span><br><span class="line"><span class="meta">#</span><span class="bash"> workerçš„å·¥ä½œé€šè®¯åœ°å€</span></span><br><span class="line">SPARK_WORKER_PORT=7078</span><br><span class="line"><span class="meta">#</span><span class="bash"> workerçš„ webuiåœ°å€</span></span><br><span class="line">SPARK_WORKER_WEBUI_PORT=8081</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># è®¾ç½®å†å²æœåŠ¡å™¨</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é…ç½®çš„æ„æ€æ˜¯  å°†sparkç¨‹åºè¿è¡Œçš„å†å²æ—¥å¿— å­˜åˆ°hdfsçš„/sparklogæ–‡ä»¶å¤¹ä¸­</span></span><br><span class="line">SPARK_HISTORY_OPTS="-Dspark.history.fs.logDirectory=hdfs://master:8020/sparklog/ -Dspark.history.fs.cleaner.enabled=true"</span><br></pre></td></tr></table></figure><p>å¯åŠ¨hadoop</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -ls /</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ²¡æœ‰sparklogæ–‡ä»¶ã€‚åˆ›å»ºsparklogæ–‡ä»¶,èµ‹äºˆæƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -mkdir /sparklog</span><br><span class="line">hadoop fs -chmod 777 /sparklog</span><br></pre></td></tr></table></figure><p>ç»§ç»­é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv spark-defaults.conf.template spark-defaults.conf</span><br><span class="line">vim spark-defaults.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># å¼€å¯sparkçš„æ—¥æœŸè®°å½•åŠŸèƒ½</span><br><span class="line">spark.eventLog.enabled true</span><br><span class="line"># è®¾ç½®sparkæ—¥å¿—è®°å½•çš„è·¯å¾„</span><br><span class="line">spark.eventLog.dir hdfs://master:8020/sparklog/ </span><br><span class="line"># è®¾ç½®sparkæ—¥å¿—æ˜¯å¦å¯åŠ¨å‹ç¼©</span><br><span class="line">spark.eventLog.compress true</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv log4j.properties.template log4j.properties</span><br><span class="line">vim log4j.properties</span><br></pre></td></tr></table></figure><p>å°†INFOæ”¹ä¸ºWARNï¼Œå‡å°‘å†—ä½™æ—¥å¿—</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Set everything to be logged to the console</span><br><span class="line">log4j.rootCategory=WARN, console</span><br></pre></td></tr></table></figure><h4 id="åˆ†å‘sparké…ç½®æ–‡ä»¶"><a href="#åˆ†å‘sparké…ç½®æ–‡ä»¶" class="headerlink" title="åˆ†å‘sparké…ç½®æ–‡ä»¶"></a>åˆ†å‘sparké…ç½®æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local</span><br><span class="line">scp -r spark node1:`pwd`/</span><br><span class="line">scp -r spark node2:`pwd`/</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨sparké›†ç¾¤"><a href="#å¯åŠ¨sparké›†ç¾¤" class="headerlink" title="å¯åŠ¨sparké›†ç¾¤"></a>å¯åŠ¨sparké›†ç¾¤</h3><p>å¯åŠ¨å†å²æœåŠ¡å™¨è¿›ç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd spark</span><br><span class="line">sbin/start-history-server.sh</span><br><span class="line">jps</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">49297 JobHistoryServer</span><br><span class="line">49778 HistoryServer</span><br><span class="line">48296 DataNode</span><br><span class="line">49835 Jps</span><br><span class="line">48734 ResourceManager</span><br><span class="line">48910 NodeManager</span><br><span class="line">48127 NameNode</span><br></pre></td></tr></table></figure><p>å¯åŠ¨é›†ç¾¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sbin/start-all.sh</span><br><span class="line">jps</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">49297 JobHistoryServer</span><br><span class="line">50162 Jps</span><br><span class="line">50020 Master</span><br><span class="line">48296 DataNode</span><br><span class="line">50107 Worker</span><br><span class="line">48734 ResourceManager</span><br><span class="line">48910 NodeManager</span><br><span class="line">48127 NameNode</span><br><span class="line">49903 HistoryServer</span><br></pre></td></tr></table></figure><p>è¿›å…¥<code>master:8080</code>webç«¯å£å¯ä»¥çœ‹åˆ°sparké›†ç¾¤ç•Œé¢</p><p><img src="/2022/12/01/SparkåŸºç¡€/D.png" alt></p><h4 id="StandAloneé›†ç¾¤æµ‹è¯•"><a href="#StandAloneé›†ç¾¤æµ‹è¯•" class="headerlink" title="StandAloneé›†ç¾¤æµ‹è¯•"></a>StandAloneé›†ç¾¤æµ‹è¯•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/spark/bin</span><br><span class="line">./pyspark --master spark://master:7077</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Python 3.8.15 (default, Nov 24 2022, 15:19:38) </span><br><span class="line">[GCC 11.2.0] :: Anaconda, Inc. on linux</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br><span class="line">22/12/05 11:54:36 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br><span class="line">Welcome to</span><br><span class="line">      ____              __</span><br><span class="line">     / __/__  ___ _____/ /__</span><br><span class="line">    _\ \/ _ \/ _ `/ __/  &apos;_/</span><br><span class="line">   /__ / .__/\_,_/_/ /_/\_\   version 3.2.0</span><br><span class="line">      /_/</span><br><span class="line"></span><br><span class="line">Using Python version 3.8.15 (default, Nov 24 2022 15:19:38)</span><br><span class="line">Spark context Web UI available at http://master:4040</span><br><span class="line">Spark context available as &apos;sc&apos; (master = spark://master:7077, app id = app-20221205115438-0000).</span><br><span class="line">SparkSession available as &apos;spark&apos;.</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure><p><img src="/2022/12/01/SparkåŸºç¡€/E.png" alt></p><p>åœ¨/usr/localä¸‹åˆ›å»ºä¸€ä¸ªwords.txtæ–‡ä»¶ï¼Œå†™å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hadoop spark flink</span><br><span class="line">hadoop spark flink hadoop hadoop</span><br><span class="line">hadoop spark flink hadoop hadoop spark spark</span><br></pre></td></tr></table></figure><p>åˆ›å»ºinputæ–‡ä»¶å¤¹ï¼Œå°†æ–‡ä»¶ä¸Šä¼ è‡³hdfs</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -mkdir /input/</span><br><span class="line">hdfs dfs -put /usr/local/words.txt /input/</span><br><span class="line">hadoop fs -ls /input</span><br><span class="line">hadoop fs -cat /input/words.txt</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc.textFile(<span class="string">"hdfs://master:8020/input/words.txt"</span>).flatMap(<span class="keyword">lambda</span> line: line.split(<span class="string">" "</span>)).map(<span class="keyword">lambda</span> x:(x,<span class="number">1</span>)).reduceByKey(<span class="keyword">lambda</span> a,b:a+b).collect()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[(&apos;hadoop&apos;, 7), (&apos;spark&apos;, 5), (&apos;flink&apos;, 3)]</span><br></pre></td></tr></table></figure><p><img src="/2022/12/01/SparkåŸºç¡€/F.png" alt></p><p><img src="/2022/12/01/SparkåŸºç¡€/G.png" alt></p><p><img src="/2022/12/01/SparkåŸºç¡€/H.png" alt></p><h2 id="Spark-on-YARN"><a href="#Spark-on-YARN" class="headerlink" title="Spark on YARN"></a>Spark on YARN</h2><ul><li><p>å°†sparkéƒ¨ç½²åˆ°yarné›†ç¾¤ä¸­å¯ä»¥æé«˜å¯¹èµ„æºçš„åˆ©ç”¨ç‡ï¼Œæ— éœ€éƒ¨ç½²sparké›†ç¾¤ï¼Œåªéœ€è¦ä¸€å°å……å½“sparkå®¢æˆ·ç«¯çš„æœåŠ¡å™¨å³å¯æäº¤ä»»åŠ¡åˆ°yarné›†ç¾¤è¿è¡Œ</p></li><li><p>Masterè§’è‰²ç”±yarnçš„ResourceManageræ‹…ä»»</p></li><li>Workerè§’è‰²ç”±yarnçš„NodeManageræ‹…ä»»</li><li>Driverè§’è‰²è¿è¡Œåœ¨yarnå®¹å™¨å†…æˆ–æäº¤ä»»åŠ¡çš„å®¢æˆ·ç«¯è¿›ç¨‹ä¸­</li><li>Executorè¿è¡Œåœ¨yarnæä¾›çš„å®¹å™¨å†…</li></ul><p>è®©sparkè®¡ç®—ä»»åŠ¡è¿è¡Œåœ¨yarnå®¹å™¨å†…éƒ¨ï¼Œèµ„æºç®¡ç†äº¤å‹yarnçš„ResourceManagerå’ŒNodeManagerä»£æ›¿</p><h3 id="å¯åŠ¨Spark-on-YARN"><a href="#å¯åŠ¨Spark-on-YARN" class="headerlink" title="å¯åŠ¨Spark on YARN"></a>å¯åŠ¨Spark on YARN</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/spark</span><br><span class="line">./sbin/stop-all.sh #å…³é—­standaloneé›†ç¾¤</span><br><span class="line">bin/pyspark --master yarn</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Python 3.8.15 (default, Nov 24 2022, 15:19:38) </span><br><span class="line">[GCC 11.2.0] :: Anaconda, Inc. on linux</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br><span class="line">22/12/05 15:27:46 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br><span class="line">22/12/05 15:27:49 WARN Client: Neither spark.yarn.jars nor spark.yarn.archive is set, falling back to uploading libraries under SPARK_HOME.</span><br><span class="line"> Welcome to</span><br><span class="line">      ____              __</span><br><span class="line">     / __/__  ___ _____/ /__</span><br><span class="line">    _\ \/ _ \/ _ `/ __/  &apos;_/</span><br><span class="line">   /__ / .__/\_,_/_/ /_/\_\   version 3.2.0</span><br><span class="line">      /_/</span><br><span class="line"></span><br><span class="line">Using Python version 3.8.15 (default, Nov 24 2022 15:19:38)</span><br><span class="line">Spark context Web UI available at http://master:4040</span><br><span class="line">Spark context available as &apos;sc&apos; (master = yarn, app id = application_1670210110128_0001).</span><br><span class="line">SparkSession available as &apos;spark&apos;.</span><br><span class="line">&gt;&gt;&gt; sc.parallelize([1,2,3,4,5]).map(lambda x:x*10).collect()</span><br><span class="line">[10, 20, 30, 40, 50]                                                            </span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç¨‹åºæµ‹è¯•ï¼Œæˆ–é€šè¿‡sparkå®¢æˆ·ç«¯spark-submitæäº¤ä»£ç ï¼Œsparkâ€˜ç®—æ³•ä¼šè¿è¡Œåœ¨å®¹å™¨ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/spark-submit --master yarn /usr/local/spark/examples/src/main/python/pi.py 100</span><br></pre></td></tr></table></figure><p><img src="/2022/12/01/SparkåŸºç¡€/I.png" alt></p><p><img src="/2022/12/01/SparkåŸºç¡€/J.png" alt></p><h3 id="Spark-on-YARNéƒ¨ç½²æ¨¡å¼"><a href="#Spark-on-YARNéƒ¨ç½²æ¨¡å¼" class="headerlink" title="Spark on YARNéƒ¨ç½²æ¨¡å¼"></a>Spark on YARNéƒ¨ç½²æ¨¡å¼</h3><ul><li><p>Clusterï¼ˆé›†ç¾¤æ¨¡å¼ï¼‰</p><p>Driverè¿è¡Œåœ¨yarnå®¹å™¨å†…éƒ¨ï¼Œå’ŒApplicationMasteråœ¨åŒä¸€ä¸ªå®¹å™¨å†…</p></li><li><p>Clientï¼ˆå®¢æˆ·ç«¯æ¨¡å¼ï¼‰</p><p>Driverè¿è¡Œåœ¨å®¢æˆ·ç«¯è¿›ç¨‹ä¸­ï¼Œä¾‹å¦‚Driverè¿è¡Œåœ¨spark-submitå®¢æˆ·ç«¯çš„è¿›ç¨‹ä¸­</p></li></ul><p>å…¶ä¸­é›†ç¾¤æ¨¡å¼åœ¨å®¹å™¨å†…è¿›è¡Œé€šè®¯ï¼Œæ•ˆç‡é«˜ï¼Œä½†æ˜¯æ—¥å¿—åŒæ ·å­˜æ”¾äºå®¹å™¨å†…éƒ¨</p><h4 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/spark-submit --master yarn --deploy-mode client /usr/local/spark/examples/src/main/python/pi.py 100</span><br></pre></td></tr></table></figure><h4 id="Cluster"><a href="#Cluster" class="headerlink" title="Cluster"></a>Cluster</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/spark-submit --master yarn --deploy-mode cluster /usr/local/spark/examples/src/main/python/pi.py 100</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;font color=&quot;gold&quot;&gt;å®šä¹‰&lt;/font&gt;ï¼š&lt;font color=&quot;gold&quot;&gt;Apache Sparkæ˜¯ç”¨äºå¤§è§„æ¨¡æ•°æ®å¤„ç†çš„ç»Ÿä¸€åˆ†æå¼•æ“ã€‚&lt;/font&gt;å…¶æ ¸å¿ƒæ•°æ®ç»“æ„ï¼šå¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼ˆRDDï¼‰èƒ½å¤Ÿåœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­åšå†…å­˜è¿ç®—ï¼Œä¸”å…·æœ‰ä¸€å®šå®¹é”™æ–¹å¼ã€‚&lt;/p&gt;
&lt;h2 id=&quot;Sparkæ¡†æ¶&quot;&gt;&lt;a href=&quot;#Sparkæ¡†æ¶&quot; class=&quot;headerlink&quot; title=&quot;Sparkæ¡†æ¶&quot;&gt;&lt;/a&gt;Sparkæ¡†æ¶&lt;/h2&gt;&lt;h3 id=&quot;ç»„æˆ&quot;&gt;&lt;a href=&quot;#ç»„æˆ&quot; class=&quot;headerlink&quot; title=&quot;ç»„æˆ&quot;&gt;&lt;/a&gt;ç»„æˆ&lt;/h3&gt;&lt;p&gt;&lt;font color=&quot;orange&quot;&gt;&lt;strong&gt;Â· Spark Core&lt;/strong&gt;&lt;/font&gt;ï¼šä»¥RDDä¸ºæ•°æ®æŠ½è±¡ï¼Œæä¾›Pythonã€Javaã€Scalaã€Rè¯­è¨€çš„APIå’ŒSparkçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæ˜¯Sparkè¿è¡Œçš„åŸºç¡€ï¼›&lt;/p&gt;
&lt;p&gt;&lt;font color=&quot;orange&quot;&gt;&lt;strong&gt;Â· SparkSQL&lt;/strong&gt;&lt;/font&gt;ï¼šåŸºäºSparkCoreï¼Œæä¾›æœºæ„åŒ–æ•°æ®å¤„ç†æ¨¡å—ï¼Œæ”¯æŒä»¥SQLè¯­è¨€å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼›åŒæ—¶å¯ä»¥ä½œä¸ºStructuredStreamingæ¨¡å—çš„åŸºç¡€ï¼Œè¿›è¡Œæ•°æ®æµå¼è®¡ç®—ï¼›&lt;/p&gt;
&lt;p&gt;&lt;font color=&quot;orange&quot;&gt;&lt;strong&gt;Â· SparkStreaming&lt;/strong&gt;&lt;/font&gt;ï¼šåŸºäºSparkCoreï¼Œæä¾›æ•°æ®æµå¼è®¡ç®—ï¼›&lt;/p&gt;
&lt;p&gt;&lt;font color=&quot;orange&quot;&gt;&lt;strong&gt;Â· MLlib&lt;/strong&gt;&lt;/font&gt;ï¼šåŸºäºSparkCoreï¼Œå†…ç½®å¤§é‡æœºå™¨å­¦ä¹ åº“å’Œç®—æ³•APIï¼Œè¿›è¡Œæœºå™¨å­¦ä¹ è®¡ç®—ï¼›&lt;/p&gt;
&lt;p&gt;&lt;font color=&quot;orange&quot;&gt;&lt;strong&gt;Â· GraphX&lt;/strong&gt;&lt;/font&gt;ï¼šåŸºäºSparkCoreï¼Œæä¾›äº†å¤§é‡å›¾è®¡ç®—APIï¼Œç”¨äºåˆ†å¸ƒå¼å›¾è®¡ç®—&lt;/p&gt;
&lt;h3 id=&quot;è¿è¡Œæ¨¡å¼&quot;&gt;&lt;a href=&quot;#è¿è¡Œæ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;è¿è¡Œæ¨¡å¼&quot;&gt;&lt;/a&gt;è¿è¡Œæ¨¡å¼&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;Â· æœ¬åœ°æ¨¡å¼ï¼ˆå•æœº/localï¼‰&lt;/strong&gt;ï¼šä»¥ä¸€ä¸ªç‹¬ç«‹è¿›ç¨‹ï¼Œé€šè¿‡å†…éƒ¨çš„å¤šçº¿ç¨‹æ¨¡æ‹ŸSparkè¿è¡Œç¯å¢ƒ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Â· Standaloneæ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰&lt;/strong&gt;ï¼šSparkçš„å„ä¸ªè§’è‰²ä»¥ç‹¬ç«‹è¿›ç¨‹å½¢å¼å­˜åœ¨ï¼Œç»„æˆé›†ç¾¤ç¯å¢ƒ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Â· Hadoop YARNæ¨¡å¼ï¼ˆé›†ç¾¤ï¼‰&lt;/strong&gt;ï¼šSparkçš„å„ä¸ªè§’è‰²è¿è¡Œåœ¨YARNå®¹å™¨å†…éƒ¨ï¼Œç»„æˆé›†ç¾¤ç¯å¢ƒ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Â· Kubernetesæ¨¡å¼ï¼ˆå®¹å™¨é›†ç¾¤ï¼‰&lt;/strong&gt;ï¼šSparkçš„å„ä¸ªè§’è‰²è¿è¡Œåœ¨Kuberneteså®¹å™¨å†…éƒ¨ï¼Œç»„æˆé›†ç¾¤ç¯å¢ƒ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Â· äº‘æœåŠ¡æ¨¡å¼&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;è§’è‰²&quot;&gt;&lt;a href=&quot;#è§’è‰²&quot; class=&quot;headerlink&quot; title=&quot;è§’è‰²&quot;&gt;&lt;/a&gt;è§’è‰²&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èµ„æº&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Â· Masterè§’è‰²&lt;/strong&gt;ï¼šé›†ç¾¤èµ„æºç®¡ç†&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Â· Workerè§’è‰²&lt;/strong&gt;ï¼šå•æœºèµ„æºç®¡ç†(æ‰€åœ¨æœåŠ¡å™¨èµ„æºç®¡ç†)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Â· Driverè§’è‰²&lt;/strong&gt;ï¼šå•ä¸ªä»»åŠ¡ç®¡ç†&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Â· Executorè§’è‰²&lt;/strong&gt;ï¼šå•ä¸ªä»»åŠ¡è®¡ç®—&lt;/p&gt;</summary>
    
    
    
    <category term="BigData" scheme="http://yoursite.com/categories/BigData/"/>
    
    
    <category term="Spark" scheme="http://yoursite.com/tags/Spark/"/>
    
  </entry>
  
</feed>
